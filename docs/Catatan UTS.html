<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>catatan</title>
  <style>
    /* Default styles provided by pandoc.
    ** See https://pandoc.org/MANUAL.html#variables-for-html for config info.
    */
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="cheatsheet.css" />
</head>
<body>
<h1 id="setup-build-project">📦 Setup &amp; Build Project</h1>
<blockquote>
<p><strong>Dokumentasi Lengkap</strong>: Setup Environment, Instalasi
Dependencies, Konfigurasi, dan Build Project</p>
</blockquote>
<hr />
<h2 id="daftar-isi">📑 Daftar Isi</h2>
<ul>
<li><a href="#prasyarat">Prasyarat</a></li>
<li><a href="#instalasi-awal">Instalasi Awal</a></li>
<li><a href="#konfigurasi-environment">Konfigurasi Environment</a></li>
<li><a href="#setup-database">Setup Database</a></li>
<li><a href="#menjalankan-project">Menjalankan Project</a></li>
<li><a href="#build-untuk-production">Build untuk Production</a></li>
<li><a href="#troubleshooting">Troubleshooting</a></li>
</ul>
<hr />
<h2 id="prasyarat">🔧 Prasyarat</h2>
<p>Sebelum memulai, pastikan sistem Anda sudah terinstall:</p>
<h3 id="node.js-npmbun">1. <strong>Node.js &amp; npm/bun</strong></h3>
<div class="sourceCode" id="cb1"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cek versi Node.js (minimal v18.17.0 atau lebih tinggi)</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">node</span> <span class="at">--version</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Cek versi npm</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> <span class="at">--version</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Atau jika pakai bun (lebih cepat)</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="ex">bun</span> <span class="at">--version</span></span></code></pre></div>
<p><strong>Versi yang Direkomendasikan:</strong> - Node.js:
<code>v20.x</code> atau <code>v22.x</code> (LTS) - npm:
<code>v10.x</code> atau lebih tinggi - bun: <code>v1.x</code> (opsional,
lebih cepat dari npm)</p>
<p><strong>Download:</strong> - Node.js: <a
href="https://nodejs.org">https://nodejs.org</a> - Bun: <a
href="https://bun.sh">https://bun.sh</a></p>
<h3 id="mysql-database">2. <strong>MySQL Database</strong></h3>
<div class="sourceCode" id="cb2"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cek versi MySQL (minimal 5.7 atau 8.0)</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">mysql</span> <span class="at">--version</span></span></code></pre></div>
<p><strong>Opsi Database:</strong> - <strong>Lokal</strong>: MySQL
Server di komputer Anda - <strong>Cloud</strong>: PlanetScale, Railway,
Supabase, atau AWS RDS</p>
<p><strong>Download MySQL:</strong> - Windows: <a
href="https://dev.mysql.com/downloads/installer/">https://dev.mysql.com/downloads/installer/</a>
- macOS: <code>brew install mysql</code> - Linux:
<code>sudo apt-get install mysql-server</code></p>
<h3 id="git-opsional-untuk-version-control">3. <strong>Git</strong>
(opsional, untuk version control)</h3>
<div class="sourceCode" id="cb3"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> <span class="at">--version</span></span></code></pre></div>
<h3 id="code-editor">4. <strong>Code Editor</strong></h3>
<ul>
<li>VS Code (direkomendasikan) dengan extensions:
<ul>
<li>Prisma</li>
<li>ESLint</li>
<li>Tailwind CSS IntelliSense</li>
<li>ES7+ React/Redux/React-Native snippets</li>
</ul></li>
</ul>
<hr />
<h2 id="instalasi-awal">🚀 Instalasi Awal</h2>
<h3 id="step-1-clone-atau-download-project">Step 1: Clone atau Download
Project</h3>
<p><strong>Opsi A: Clone dari GitHub</strong></p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/amrfad/Electronics-eCommerce-Shop-With-Admin-Dashboard-NextJS-NodeJS.git</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> Electronics-eCommerce-Shop-With-Admin-Dashboard-NextJS-NodeJS</span></code></pre></div>
<p><strong>Opsi B: Download ZIP</strong> 1. Download ZIP dari GitHub 2.
Extract ke folder kerja Anda 3. Buka terminal di folder tersebut</p>
<h3 id="step-2-install-dependencies">Step 2: Install Dependencies</h3>
<p>Project ini menggunakan <strong>bun</strong> sebagai package manager
(terlihat dari <code>bun.lock</code>).</p>
<p><strong>Menggunakan Bun (Direkomendasikan - Lebih
Cepat):</strong></p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">bun</span> install</span></code></pre></div>
<p><strong>Atau Menggunakan npm:</strong></p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install</span></code></pre></div>
<p><strong>Atau Menggunakan yarn:</strong></p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">yarn</span> install</span></code></pre></div>
<p><strong>Waktu Instalasi:</strong> - Bun: ~10-20 detik - npm: ~1-2
menit - yarn: ~30-60 detik</p>
<h3 id="step-3-verifikasi-instalasi">Step 3: Verifikasi Instalasi</h3>
<p>Setelah instalasi selesai, cek apakah <code>node_modules</code> sudah
terisi:</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Windows</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dir</span> node_modules</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># macOS/Linux</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> node_modules</span></code></pre></div>
<p>Anda harus melihat folder-folder dependencies seperti: -
<code>next</code> - <code>react</code> - <code>@prisma/client</code> -
<code>next-auth</code> - dll.</p>
<hr />
<h2 id="konfigurasi-environment">⚙️ Konfigurasi Environment</h2>
<h3 id="step-1-buat-file-.env">Step 1: Buat File <code>.env</code></h3>
<p>Copy file <code>.env.example</code> (jika ada) atau buat file baru
<code>.env</code> di root project:</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Windows (PowerShell)</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Copy-Item</span> .env.example .env</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># macOS/Linux</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> .env.example .env</span></code></pre></div>
<p>Jika tidak ada <code>.env.example</code>, buat file <code>.env</code>
secara manual.</p>
<h3 id="step-2-isi-konfigurasi-.env">Step 2: Isi Konfigurasi
<code>.env</code></h3>
<p>Buka file <code>.env</code> dan isi dengan konfigurasi berikut:</p>
<pre class="env"><code># ============================================
# DATABASE CONFIGURATION
# ============================================
# Format: mysql://USER:PASSWORD@HOST:PORT/DATABASE_NAME
# Contoh lokal: mysql://root:password@localhost:3306/ecommerce_db
# Contoh PlanetScale: mysql://username:password@host.psdb.cloud/database?sslaccept=strict

DATABASE_URL=&quot;mysql://root:password@localhost:3306/electronics_ecommerce&quot;

# ============================================
# NEXTAUTH CONFIGURATION
# ============================================
# Secret untuk enkripsi JWT (generate dengan: openssl rand -base64 32)
NEXTAUTH_SECRET=&quot;your-super-secret-key-change-this-in-production&quot;

# URL aplikasi Anda
NEXTAUTH_URL=&quot;http://localhost:3000&quot;

# ============================================
# OAUTH PROVIDERS (Opsional)
# ============================================
# GitHub OAuth (jika ingin pakai login GitHub)
# GITHUB_ID=&quot;your-github-oauth-client-id&quot;
# GITHUB_SECRET=&quot;your-github-oauth-client-secret&quot;

# Google OAuth (jika ingin pakai login Google)
# GOOGLE_CLIENT_ID=&quot;your-google-oauth-client-id&quot;
# GOOGLE_CLIENT_SECRET=&quot;your-google-oauth-client-secret&quot;

# ============================================
# API CONFIGURATION
# ============================================
NEXT_PUBLIC_API_BASE_URL=&quot;http://localhost:3000&quot;

# ============================================
# OPTIONAL: EMAIL CONFIGURATION
# ============================================
# EMAIL_SERVER=&quot;smtp://username:password@smtp.example.com:587&quot;
# EMAIL_FROM=&quot;noreply@example.com&quot;</code></pre>
<h3 id="step-3-generate-nextauth_secret">Step 3: Generate
NEXTAUTH_SECRET</h3>
<p>Untuk keamanan, generate secret yang random:</p>
<p><strong>Menggunakan OpenSSL:</strong></p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Windows (Git Bash atau WSL)</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="ex">openssl</span> rand <span class="at">-base64</span> 32</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Output contoh: xK7m3p9qR2wN5vT8yU4zX1cA6bE0dF9g</span></span></code></pre></div>
<p><strong>Menggunakan Node.js:</strong></p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">node</span> <span class="at">-e</span> <span class="st">&quot;console.log(require(&#39;crypto&#39;).randomBytes(32).toString(&#39;base64&#39;))&quot;</span></span></code></pre></div>
<p>Copy hasilnya dan paste ke <code>NEXTAUTH_SECRET</code> di file
<code>.env</code>.</p>
<h3 id="step-4-konfigurasi-database-url">Step 4: Konfigurasi Database
URL</h3>
<p><strong>Format DATABASE_URL:</strong></p>
<pre><code>mysql://[USER]:[PASSWORD]@[HOST]:[PORT]/[DATABASE_NAME]</code></pre>
<p><strong>Contoh untuk Berbagai Skenario:</strong></p>
<p><strong>1. MySQL Lokal (Default)</strong></p>
<pre class="env"><code>DATABASE_URL=&quot;mysql://root:@localhost:3306/electronics_ecommerce&quot;</code></pre>
<p><strong>2. MySQL Lokal dengan Password</strong></p>
<pre class="env"><code>DATABASE_URL=&quot;mysql://root:mypassword@localhost:3306/electronics_ecommerce&quot;</code></pre>
<p><strong>3. MySQL di Server Lain</strong></p>
<pre class="env"><code>DATABASE_URL=&quot;mysql://admin:secret123@192.168.1.100:3306/ecommerce&quot;</code></pre>
<p><strong>4. PlanetScale (Cloud)</strong></p>
<pre class="env"><code>DATABASE_URL=&quot;mysql://xxxxxxx:pscale_pw_xxxxx@aws.connect.psdb.cloud/electronics_ecommerce?sslaccept=strict&quot;</code></pre>
<p><strong>5. Railway (Cloud)</strong></p>
<pre class="env"><code>DATABASE_URL=&quot;mysql://root:password@containers-us-west-123.railway.app:1234/railway&quot;</code></pre>
<hr />
<h2 id="setup-database">🗄️ Setup Database</h2>
<h3 id="step-1-buat-database-mysql">Step 1: Buat Database MySQL</h3>
<p>Buka MySQL command line atau MySQL Workbench, lalu jalankan:</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Buat database baru</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">DATABASE</span> electronics_ecommerce;</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co">-- Verifikasi database sudah dibuat</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>SHOW DATABASES;</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co">-- Gunakan database</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="kw">USE</span> electronics_ecommerce;</span></code></pre></div>
<p><strong>Atau menggunakan command line:</strong></p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Login ke MySQL</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="ex">mysql</span> <span class="at">-u</span> root <span class="at">-p</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Jalankan perintah SQL di atas</span></span></code></pre></div>
<h3 id="step-2-generate-prisma-client">Step 2: Generate Prisma
Client</h3>
<p>Generate Prisma Client dari schema:</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma generate</span></code></pre></div>
<p><strong>Output yang diharapkan:</strong></p>
<pre><code>✔ Generated Prisma Client (v6.16.1) to ./node_modules/@prisma/client</code></pre>
<h3 id="step-3-jalankan-migrations">Step 3: Jalankan Migrations</h3>
<p>Buat tabel-tabel di database:</p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma migrate deploy</span></code></pre></div>
<p><strong>Atau untuk development:</strong></p>
<div class="sourceCode" id="cb24"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma migrate dev <span class="at">--name</span> init</span></code></pre></div>
<p><strong>Output yang diharapkan:</strong></p>
<pre><code>Applying migration &#39;20240101120000_init&#39;
✔ Generated Prisma Client

The following migrations have been applied:
  - 20240101120000_init</code></pre>
<h3 id="step-4-seed-database-isi-data-awal">Step 4: Seed Database (Isi
Data Awal)</h3>
<p>Isi database dengan data contoh:</p>
<div class="sourceCode" id="cb26"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="ex">node</span> prisma/seed.js</span></code></pre></div>
<p><strong>Data yang akan di-seed:</strong> - Kategori produk - Beberapa
produk contoh - User admin default - User biasa untuk testing</p>
<h3 id="step-5-verifikasi-database">Step 5: Verifikasi Database</h3>
<p>Cek apakah tabel sudah terbuat:</p>
<div class="sourceCode" id="cb27"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma studio</span></code></pre></div>
<p>Ini akan membuka Prisma Studio di browser (http://localhost:5555) di
mana Anda bisa: - Melihat semua tabel - Edit data secara visual - Cek
relationships antar tabel</p>
<p><strong>Atau via MySQL:</strong></p>
<div class="sourceCode" id="cb28"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="ex">mysql</span> <span class="at">-u</span> root <span class="at">-p</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="ex">USE</span> electronics_ecommerce<span class="kw">;</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="ex">SHOW</span> TABLES<span class="kw">;</span></span></code></pre></div>
<p><strong>Tabel yang harus ada:</strong> - <code>Product</code> -
<code>Category</code> - <code>User</code> - <code>Customer_order</code>
- <code>customer_order_product</code> - <code>Wishlist</code> -
<code>Feedback</code> - <code>Image</code></p>
<hr />
<h2 id="menjalankan-project">🏃 Menjalankan Project</h2>
<h3 id="mode-development">Mode Development</h3>
<p><strong>Menggunakan Bun:</strong></p>
<div class="sourceCode" id="cb29"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="ex">bun</span> run dev</span></code></pre></div>
<p><strong>Menggunakan npm:</strong></p>
<div class="sourceCode" id="cb30"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> run dev</span></code></pre></div>
<p><strong>Output yang diharapkan:</strong></p>
<pre><code>▲ Next.js 15.5.3
- Local:        http://localhost:3000
- Environments: .env

✓ Ready in 2.3s</code></pre>
<h3 id="akses-aplikasi">Akses Aplikasi</h3>
<p>Buka browser dan kunjungi:</p>
<p><strong>Frontend (Customer):</strong> - Homepage: <a
href="http://localhost:3000">http://localhost:3000</a> - Shop: <a
href="http://localhost:3000/shop">http://localhost:3000/shop</a> -
Product Detail: <a
href="http://localhost:3000/product/laptop-dell">http://localhost:3000/product/[slug]</a>
- Cart: <a
href="http://localhost:3000/cart">http://localhost:3000/cart</a> -
Checkout: <a
href="http://localhost:3000/checkout">http://localhost:3000/checkout</a>
- Login: <a
href="http://localhost:3000/login">http://localhost:3000/login</a> -
Register: <a
href="http://localhost:3000/register">http://localhost:3000/register</a></p>
<p><strong>Admin Dashboard:</strong> - Dashboard: <a
href="http://localhost:3000/admin">http://localhost:3000/admin</a> -
Products: <a
href="http://localhost:3000/admin/products">http://localhost:3000/admin/products</a>
- Orders: <a
href="http://localhost:3000/admin/orders">http://localhost:3000/admin/orders</a>
- Users: <a
href="http://localhost:3000/admin/users">http://localhost:3000/admin/users</a>
- Categories: <a
href="http://localhost:3000/admin/categories">http://localhost:3000/admin/categories</a></p>
<p><strong>Login Credentials (setelah seed):</strong></p>
<pre><code>Admin:
Email: admin@example.com
Password: admin123

User:
Email: user@example.com
Password: user123</code></pre>
<h3 id="hot-reload">Hot Reload</h3>
<p>Project ini menggunakan <strong>Fast Refresh</strong> dari Next.js: -
Edit file <code>.tsx</code> atau <code>.ts</code> - Save (Ctrl+S) -
Browser otomatis reload dengan perubahan</p>
<p><strong>Tips:</strong> - Jangan edit file saat ada error - Jika Fast
Refresh tidak bekerja, restart server (Ctrl+C, lalu
<code>npm run dev</code> lagi)</p>
<hr />
<h2 id="build-untuk-production">🏗️ Build untuk Production</h2>
<h3 id="step-1-build-project">Step 1: Build Project</h3>
<div class="sourceCode" id="cb33"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Menggunakan bun</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="ex">bun</span> run build</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Atau npm</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> run build</span></code></pre></div>
<p><strong>Proses Build:</strong> 1. ✓ Compile TypeScript 2. ✓ Generate
optimized bundles 3. ✓ Create static pages 4. ✓ Optimize images 5. ✓
Generate sitemap (jika ada)</p>
<p><strong>Output:</strong></p>
<pre><code>Route (app)                                Size     First Load JS
┌ ○ /                                      5.2 kB         123 kB
├ ○ /cart                                  3.8 kB         120 kB
├ ○ /checkout                              8.1 kB         135 kB
├ λ /product/[slug]                        12.3 kB        145 kB
└ ○ /shop                                  6.5 kB         128 kB

○ (Static)  automatically rendered as static HTML
λ (Server)  server-side rendered</code></pre>
<h3 id="step-2-test-production-build-lokal">Step 2: Test Production
Build Lokal</h3>
<p>Jalankan server production di lokal:</p>
<div class="sourceCode" id="cb35"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Menggunakan bun</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="ex">bun</span> run start</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Atau npm</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> run start</span></code></pre></div>
<p>Akses: <a href="http://localhost:3000">http://localhost:3000</a></p>
<h3 id="step-3-deployment">Step 3: Deployment</h3>
<p><strong>Opsi A: Vercel (Paling Mudah)</strong></p>
<ol type="1">
<li>Install Vercel CLI:</li>
</ol>
<div class="sourceCode" id="cb36"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> i <span class="at">-g</span> vercel</span></code></pre></div>
<ol start="2" type="1">
<li>Login:</li>
</ol>
<div class="sourceCode" id="cb37"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="ex">vercel</span> login</span></code></pre></div>
<ol start="3" type="1">
<li>Deploy:</li>
</ol>
<div class="sourceCode" id="cb38"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="ex">vercel</span></span></code></pre></div>
<ol start="4" type="1">
<li>Setup environment variables di Vercel Dashboard:
<ul>
<li><code>DATABASE_URL</code></li>
<li><code>NEXTAUTH_SECRET</code></li>
<li><code>NEXTAUTH_URL</code></li>
</ul></li>
</ol>
<p><strong>Opsi B: Netlify</strong></p>
<ol type="1">
<li>Build project: <code>npm run build</code></li>
<li>Upload folder <code>.next</code> ke Netlify</li>
<li>Set environment variables di Netlify Dashboard</li>
</ol>
<p><strong>Opsi C: VPS (Digital Ocean, Linode, etc.)</strong></p>
<ol type="1">
<li>SSH ke server Anda</li>
<li>Install Node.js, nginx, PM2</li>
<li>Clone project</li>
<li>Setup <code>.env</code></li>
<li>Build: <code>npm run build</code></li>
<li>Jalankan dengan PM2:</li>
</ol>
<div class="sourceCode" id="cb39"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pm2</span> start npm <span class="at">--name</span> <span class="st">&quot;ecommerce&quot;</span> <span class="at">--</span> start</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="ex">pm2</span> save</span></code></pre></div>
<p><strong>Opsi D: Docker</strong></p>
<p>Buat <code>Dockerfile</code>:</p>
<div class="sourceCode" id="cb40"><pre
class="sourceCode dockerfile"><code class="sourceCode dockerfile"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> node:20-alpine</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="kw">WORKDIR</span> /app</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> package*.json ./</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">npm</span> ci <span class="at">--only</span><span class="op">=</span>production</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> . .</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">npm</span> run build</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="kw">EXPOSE</span> 3000</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="kw">CMD</span> [<span class="st">&quot;npm&quot;</span>, <span class="st">&quot;start&quot;</span>]</span></code></pre></div>
<p>Build &amp; run:</p>
<div class="sourceCode" id="cb41"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> ecommerce-app .</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-p</span> 3000:3000 <span class="at">--env-file</span> .env ecommerce-app</span></code></pre></div>
<hr />
<h2 id="troubleshooting">🔍 Troubleshooting</h2>
<h3 id="problem-1-cannot-connect-to-database">Problem 1:
<code>Cannot connect to database</code></h3>
<p><strong>Error:</strong></p>
<pre><code>PrismaClientInitializationError: Can&#39;t reach database server</code></pre>
<p><strong>Solusi:</strong> 1. Cek MySQL service berjalan:</p>
<div class="sourceCode" id="cb43"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Windows</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="ex">net</span> start MySQL80</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="co"># macOS</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="ex">brew</span> services start mysql</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Linux</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> systemctl start mysql</span></code></pre></div>
<ol start="2" type="1">
<li>Cek <code>DATABASE_URL</code> di <code>.env</code> sudah benar</li>
<li>Test koneksi database:</li>
</ol>
<div class="sourceCode" id="cb44"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma db pull</span></code></pre></div>
<h3 id="problem-2-module-not-found">Problem 2:
<code>Module not found</code></h3>
<p><strong>Error:</strong></p>
<pre><code>Error: Cannot find module &#39;@prisma/client&#39;</code></pre>
<p><strong>Solusi:</strong></p>
<div class="sourceCode" id="cb46"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate Prisma Client</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma generate</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Re-install dependencies</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-rf</span> node_modules</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install</span></code></pre></div>
<h3 id="problem-3-port-3000-sudah-digunakan">Problem 3: Port 3000 sudah
digunakan</h3>
<p><strong>Error:</strong></p>
<pre><code>Error: listen EADDRINUSE: address already in use :::3000</code></pre>
<p><strong>Solusi:</strong></p>
<div class="sourceCode" id="cb48"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Windows - Kill proses di port 3000</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">netstat</span> <span class="at">-ano</span> <span class="kw">|</span> <span class="ex">findstr</span> :3000</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="ex">taskkill</span> /PID <span class="pp">[</span><span class="ss">PID_NUMBER</span><span class="pp">]</span> /F</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="co"># macOS/Linux</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="ex">lsof</span> <span class="at">-ti:3000</span> <span class="kw">|</span> <span class="fu">xargs</span> kill <span class="at">-9</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Atau jalankan di port lain</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="va">PORT</span><span class="op">=</span>3001 <span class="ex">npm</span> run dev</span></code></pre></div>
<h3 id="problem-4-nextauth_secret-tidak-valid">Problem 4:
<code>NEXTAUTH_SECRET</code> tidak valid</h3>
<p><strong>Error:</strong></p>
<pre><code>[next-auth][error][INVALID_SECRET]</code></pre>
<p><strong>Solusi:</strong></p>
<div class="sourceCode" id="cb50"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate secret baru</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="ex">openssl</span> rand <span class="at">-base64</span> 32</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Copy ke .env</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="va">NEXTAUTH_SECRET</span><span class="op">=</span><span class="st">&quot;hasil-generate-di-atas&quot;</span></span></code></pre></div>
<h3 id="problem-5-prisma-migration-failed">Problem 5: Prisma Migration
Failed</h3>
<p><strong>Error:</strong></p>
<pre><code>Error: P3005 Database is not empty</code></pre>
<p><strong>Solusi:</strong></p>
<div class="sourceCode" id="cb52"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Reset database (</span><span class="al">WARNING</span><span class="co">: Hapus semua data)</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma migrate reset</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Atau push schema tanpa migration</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma db push</span></code></pre></div>
<h3 id="problem-6-build-error---out-of-memory">Problem 6: Build Error -
Out of Memory</h3>
<p><strong>Error:</strong></p>
<pre><code>FATAL ERROR: Reached heap limit Allocation failed</code></pre>
<p><strong>Solusi:</strong></p>
<div class="sourceCode" id="cb54"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Increase Node.js memory limit</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="va">NODE_OPTIONS</span><span class="op">=</span><span class="st">&quot;--max-old-space-size=4096&quot;</span> <span class="ex">npm</span> run build</span></code></pre></div>
<h3 id="problem-7-typescript-errors">Problem 7: TypeScript Errors</h3>
<p><strong>Error:</strong></p>
<pre><code>Type error: Property &#39;X&#39; does not exist on type &#39;Y&#39;</code></pre>
<p><strong>Solusi:</strong></p>
<div class="sourceCode" id="cb56"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Re-generate Prisma types</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma generate</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Check TypeScript config</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> tsc <span class="at">--noEmit</span></span></code></pre></div>
<h3 id="problem-8-hot-reload-tidak-bekerja">Problem 8: Hot Reload Tidak
Bekerja</h3>
<p><strong>Solusi:</strong> 1. Restart dev server (Ctrl+C, lalu
<code>npm run dev</code>) 2. Clear <code>.next</code> folder:</p>
<div class="sourceCode" id="cb57"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-rf</span> .next</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> run dev</span></code></pre></div>
<ol start="3" type="1">
<li>Disable antivirus sementara (bisa block file watcher)</li>
</ol>
<hr />
<h2 id="performance-tips">📊 Performance Tips</h2>
<h3 id="optimize-dependencies">1. <strong>Optimize
Dependencies</strong></h3>
<div class="sourceCode" id="cb58"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Audit dependencies</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> audit</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Update packages</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> update</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove unused dependencies</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> prune</span></code></pre></div>
<h3 id="enable-swc-minifier-sudah-default-di-next.js-15">2.
<strong>Enable SWC Minifier</strong> (sudah default di Next.js 15)</h3>
<p>Di <code>next.config.mjs</code>:</p>
<div class="sourceCode" id="cb59"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> nextConfig <span class="op">=</span> {</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">swcMinify</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="co">// Default true di Next.js 15</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="enable-caching">3. <strong>Enable Caching</strong></h3>
<p>Di <code>next.config.mjs</code>:</p>
<div class="sourceCode" id="cb60"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> nextConfig <span class="op">=</span> {</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">experimental</span><span class="op">:</span> {</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">outputFileTracingExcludes</span><span class="op">:</span> {</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;*&#39;</span><span class="op">:</span> [</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;node_modules/@swc/core-linux-x64-gnu&#39;</span><span class="op">,</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;node_modules/@swc/core-linux-x64-musl&#39;</span><span class="op">,</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>      ]<span class="op">,</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="optimize-images">4. <strong>Optimize Images</strong></h3>
<p>Gunakan <code>next/image</code> untuk lazy loading otomatis:</p>
<pre class="tsx"><code>import Image from &#39;next/image&#39;

&lt;Image 
  src=&quot;/product.jpg&quot; 
  alt=&quot;Product&quot; 
  width={500} 
  height={500}
  loading=&quot;lazy&quot; // Default
/&gt;</code></pre>
<hr />
<h2 id="scripts-yang-tersedia">📝 Scripts yang Tersedia</h2>
<div class="sourceCode" id="cb62"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;scripts&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;dev&quot;</span><span class="fu">:</span> <span class="st">&quot;next dev&quot;</span><span class="fu">,</span>                    <span class="er">//</span> <span class="er">Jalankan</span> <span class="er">development</span> <span class="er">server</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;build&quot;</span><span class="fu">:</span> <span class="st">&quot;next build&quot;</span><span class="fu">,</span>                 <span class="er">//</span> <span class="er">Build</span> <span class="er">untuk</span> <span class="er">production</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;start&quot;</span><span class="fu">:</span> <span class="st">&quot;next start&quot;</span><span class="fu">,</span>                 <span class="er">//</span> <span class="er">Jalankan</span> <span class="er">production</span> <span class="er">server</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;lint&quot;</span><span class="fu">:</span> <span class="st">&quot;next lint&quot;</span><span class="fu">,</span>                   <span class="er">//</span> <span class="er">Check</span> <span class="er">linting</span> <span class="er">errors</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;prisma:generate&quot;</span><span class="fu">:</span> <span class="st">&quot;prisma generate&quot;</span><span class="fu">,</span>  <span class="er">//</span> <span class="er">Generate</span> <span class="er">Prisma</span> <span class="er">Client</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;prisma:migrate&quot;</span><span class="fu">:</span> <span class="st">&quot;prisma migrate dev&quot;</span><span class="fu">,</span><span class="er">//</span> <span class="er">Jalankan</span> <span class="er">migrations</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;prisma:studio&quot;</span><span class="fu">:</span> <span class="st">&quot;prisma studio&quot;</span><span class="fu">,</span>      <span class="er">//</span> <span class="er">Buka</span> <span class="er">Prisma</span> <span class="er">Studio</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;prisma:seed&quot;</span><span class="fu">:</span> <span class="st">&quot;node prisma/seed.js&quot;</span>   <span class="er">//</span> <span class="er">Seed</span> <span class="er">database</span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<hr />
<h2 id="checklist-setup">🎯 Checklist Setup</h2>
<p>Gunakan checklist ini untuk memastikan setup berhasil:</p>
<ul class="task-list">
<li><label><input type="checkbox" />Node.js v20+ terinstall</label></li>
<li><label><input type="checkbox" />MySQL terinstall dan
berjalan</label></li>
<li><label><input type="checkbox" />Dependencies terinstall
(<code>node_modules</code> ada)</label></li>
<li><label><input type="checkbox" />File <code>.env</code> sudah
dikonfigurasi</label></li>
<li><label><input type="checkbox" /><code>NEXTAUTH_SECRET</code> sudah
di-generate</label></li>
<li><label><input type="checkbox" /><code>DATABASE_URL</code> sudah
benar</label></li>
<li><label><input type="checkbox" />Database sudah dibuat</label></li>
<li><label><input type="checkbox" />Prisma Client sudah
di-generate</label></li>
<li><label><input type="checkbox" />Migrations sudah
dijalankan</label></li>
<li><label><input type="checkbox" />Database sudah di-seed</label></li>
<li><label><input type="checkbox" />Dev server berjalan di
http://localhost:3000</label></li>
<li><label><input type="checkbox" />Bisa akses homepage</label></li>
<li><label><input type="checkbox" />Bisa login ke admin
dashboard</label></li>
<li><label><input type="checkbox" />Bisa register user baru</label></li>
</ul>
<hr />
<h2 id="referensi">🔗 Referensi</h2>
<ul>
<li><a href="https://nextjs.org/docs">Next.js Documentation</a></li>
<li><a href="https://www.prisma.io/docs">Prisma Documentation</a></li>
<li><a href="https://next-auth.js.org">NextAuth.js
Documentation</a></li>
<li><a href="https://tailwindcss.com/docs">TailwindCSS
Documentation</a></li>
<li><a href="https://dev.mysql.com/doc/">MySQL Documentation</a></li>
</ul>
<hr />
<p><strong>📌 Catatan Penting:</strong> - Jangan commit file
<code>.env</code> ke Git (sudah ada di <code>.gitignore</code>) - Backup
database sebelum migration di production - Gunakan
<code>DATABASE_URL</code> yang berbeda untuk development dan production
- Generate <code>NEXTAUTH_SECRET</code> baru untuk setiap
environment</p>
<hr />
<h1 id="struktur-project-arsitektur">🏗️ Struktur Project &amp;
Arsitektur</h1>
<blockquote>
<p><strong>Dokumentasi Lengkap</strong>: Memahami struktur folder,
routing, komponen, dan arsitektur aplikasi</p>
</blockquote>
<hr />
<h2 id="daftar-isi-1">📑 Daftar Isi</h2>
<ul>
<li><a href="#gambaran-umum-arsitektur">Gambaran Umum
Arsitektur</a></li>
<li><a href="#struktur-folder-project">Struktur Folder Project</a></li>
<li><a href="#nextjs-app-router">Next.js App Router</a></li>
<li><a href="#komponen-komponen-utama">Komponen-Komponen Utama</a></li>
<li><a href="#state-management-zustand">State Management
(Zustand)</a></li>
<li><a href="#server-components-vs-client-components">Server Components
vs Client Components</a></li>
<li><a href="#data-flow--patterns">Data Flow &amp; Patterns</a></li>
<li><a href="#file-naming-conventions">File Naming Conventions</a></li>
</ul>
<hr />
<h2 id="gambaran-umum-arsitektur">🎯 Gambaran Umum Arsitektur</h2>
<h3 id="stack-teknologi">Stack Teknologi</h3>
<pre><code>┌─────────────────────────────────────────────────┐
│          Frontend (Client-Side)                  │
├─────────────────────────────────────────────────┤
│  - Next.js 15 (App Router)                      │
│  - React 18 (Server &amp; Client Components)        │
│  - TailwindCSS + DaisyUI                        │
│  - Zustand (State Management)                   │
│  - React Hot Toast (Notifications)              │
└─────────────────────────────────────────────────┘
                      ↓
┌─────────────────────────────────────────────────┐
│          API Layer (Server-Side)                 │
├─────────────────────────────────────────────────┤
│  - Next.js API Routes (app/api)                 │
│  - NextAuth.js (Authentication)                 │
│  - Zod (Validation)                             │
│  - DOMPurify (Sanitization)                     │
└─────────────────────────────────────────────────┘
                      ↓
┌─────────────────────────────────────────────────┐
│          Database Layer                          │
├─────────────────────────────────────────────────┤
│  - Prisma ORM                                   │
│  - MySQL Database                               │
└─────────────────────────────────────────────────┘</code></pre>
<h3 id="alur-request-response">Alur Request-Response</h3>
<pre><code>User Browser
    ↓
Next.js Server (SSR/SSG)
    ↓
API Route Handler
    ↓
Validation (Zod) → Sanitization (DOMPurify)
    ↓
Prisma ORM
    ↓
MySQL Database
    ↓
Response (JSON)
    ↓
Client Component (Update UI)</code></pre>
<hr />
<h2 id="struktur-folder-project">📁 Struktur Folder Project</h2>
<h3 id="root-directory">Root Directory</h3>
<pre><code>Electronics-eCommerce-Shop/
├── 📁 app/                    # Next.js App Router (halaman &amp; API)
├── 📁 components/             # Komponen React (reusable)
├── 📁 prisma/                 # Database schema &amp; migrations
├── 📁 public/                 # Static assets (images, icons)
├── 📁 lib/                    # Utility functions &amp; helpers
├── 📁 utils/                  # Validation, schemas, helpers
├── 📁 server/                 # Server-side utilities (legacy)
├── 📁 helpers/                # Browser &amp; screen helpers
├── 📁 hooks/                  # Custom React hooks
├── 📁 docs/                   # Dokumentasi (folder ini!)
├── 📄 middleware.ts           # Next.js middleware (auth)
├── 📄 next.config.mjs         # Konfigurasi Next.js
├── 📄 tailwind.config.ts      # Konfigurasi TailwindCSS
├── 📄 tsconfig.json           # Konfigurasi TypeScript
├── 📄 package.json            # Dependencies &amp; scripts
├── 📄 .env                    # Environment variables
└── 📄 README.md               # Dokumentasi project</code></pre>
<h3 id="struktur-app-directory-app-router">Struktur <code>app/</code>
Directory (App Router)</h3>
<pre><code>app/
├── 📄 layout.tsx              # Root layout (wrapper semua halaman)
├── 📄 page.tsx                # Homepage (/)
├── 📄 error.tsx               # Error boundary
├── 📄 not-found.tsx           # 404 page
├── 📄 globals.css             # Global CSS
│
├── 📁 (dashboard)/            # Route group (tidak muncul di URL)
│   └── 📁 admin/              # Admin dashboard (/admin)
│       ├── 📄 page.tsx        # Dashboard home
│       ├── 📁 products/       # Manage products
│       ├── 📁 orders/         # Manage orders
│       ├── 📁 users/          # Manage users
│       └── 📁 categories/     # Manage categories
│
├── 📁 api/                    # API routes (backend)
│   ├── 📁 auth/               # Authentication endpoints
│   ├── 📁 register/           # User registration
│   ├── 📁 feedback/           # Product feedbacks
│   └── ...                    # Other API endpoints
│
├── 📁 product/                # Product pages
│   └── 📁 [slug]/             # Dynamic route (/product/laptop-dell)
│       └── 📄 page.tsx        # Single product page
│
├── 📁 cart/                   # Shopping cart
│   └── 📄 page.tsx
├── 📁 checkout/               # Checkout page
│   └── 📄 page.tsx
├── 📁 shop/                   # All products page
│   └── 📄 page.tsx
├── 📁 login/                  # Login page
│   └── 📄 page.tsx
├── 📁 register/               # Register page
│   └── 📄 page.tsx
├── 📁 wishlist/               # Wishlist page
│   └── 📄 page.tsx
│
├── 📁 _zustand/               # Zustand stores (state management)
│   ├── 📄 store.ts            # Cart state
│   ├── 📄 wishlistStore.ts    # Wishlist state
│   ├── 📄 paginationStore.ts  # Pagination state
│   └── 📄 sortStore.ts        # Sort state
│
└── 📁 actions/                # Server Actions
    └── 📄 index.ts            # Server-side functions</code></pre>
<h3 id="struktur-components-directory">Struktur <code>components/</code>
Directory</h3>
<pre><code>components/
├── 📄 index.ts                # Export semua components
│
├── 📄 Header.tsx              # Header dengan cart, wishlist
├── 📄 HeaderTop.tsx           # Top bar (info toko)
├── 📄 Footer.tsx              # Footer
├── 📄 CategoryMenu.tsx        # Menu kategori
├── 📄 SearchInput.tsx         # Search bar
│
├── 📄 Hero.tsx                # Hero section (banner)
├── 📄 Products.tsx            # Product grid
├── 📄 ProductItem.tsx         # Single product card
├── 📄 ProductsSection.tsx     # Products dengan filter
│
├── 📄 CartElement.tsx         # Cart icon + quantity
├── 📄 HeartElement.tsx        # Wishlist icon + quantity
├── 📄 WishItem.tsx            # Wishlist item
│
├── 📄 AddToCartSingleProductBtn.tsx
├── 📄 AddToWishlistBtn.tsx
├── 📄 BuyNowSingleProductBtn.tsx
│
├── 📄 FeedbackForm.tsx        # Form feedback produk
├── 📄 FeedbackList.tsx        # List feedback
├── 📄 ProductFeedbackSection.tsx
│
├── 📄 DashboardSidebar.tsx    # Sidebar admin
├── 📄 DashboardProductTable.tsx
├── 📄 AdminOrders.tsx
├── 📄 AdminFeedbackTable.tsx
│
├── 📄 Filters.tsx             # Filter produk
├── 📄 SortBy.tsx              # Sorting
├── 📄 Pagination.tsx          # Pagination
│
├── 📄 Loader.tsx              # Loading spinner
├── 📄 CustomButton.tsx        # Button reusable
├── 📄 Checkbox.tsx            # Checkbox input
├── 📄 QuantityInput.tsx       # Input quantity
│
└── 📁 modules/                # Feature modules
    ├── 📁 cart/
    │   └── 📄 index.tsx       # Cart module
    └── 📁 wishlist/
        └── 📄 index.tsx       # Wishlist module</code></pre>
<h3 id="struktur-prisma-directory">Struktur <code>prisma/</code>
Directory</h3>
<pre><code>prisma/
├── 📄 schema.prisma           # Database schema (models)
├── 📄 seed.js                 # Seed data (data awal)
└── 📁 migrations/             # Migration history
    ├── 📁 20240101_init/
    │   └── migration.sql
    └── ...</code></pre>
<h3 id="struktur-lib-utils-directory">Struktur <code>lib/</code> &amp;
<code>utils/</code> Directory</h3>
<pre><code>lib/
├── 📄 api.ts                  # API client (fetch wrapper)
├── 📄 config.ts               # Konfigurasi app
├── 📄 utils.ts                # Helper functions
├── 📄 sanitize.ts             # Sanitization
└── 📄 form-sanitize.ts        # Form sanitization

utils/
├── 📄 validation.ts           # Common validations
├── 📄 schema.ts               # Zod schemas
├── 📄 errorHandler.ts         # Error handling
└── 📄 db.ts                   # Prisma client</code></pre>
<hr />
<h2 id="next.js-app-router">🛣️ Next.js App Router</h2>
<h3 id="konsep-dasar-app-router">Konsep Dasar App Router</h3>
<p>Next.js 15 menggunakan <strong>App Router</strong> (bukan Pages
Router lama):</p>
<p><strong>Perbedaan Utama:</strong></p>
<pre><code>Pages Router (❌ Lama):
pages/
  ├── index.js          → /
  ├── about.js          → /about
  └── blog/
      └── [slug].js     → /blog/:slug

App Router (✅ Baru):
app/
  ├── page.tsx          → /
  ├── about/
  │   └── page.tsx      → /about
  └── blog/
      └── [slug]/
          └── page.tsx  → /blog/:slug</code></pre>
<h3 id="special-files-di-app-router">Special Files di App Router</h3>
<table>
<thead>
<tr>
<th>File</th>
<th>Fungsi</th>
<th>Contoh</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>page.tsx</code></td>
<td>Halaman route</td>
<td><code>/admin/page.tsx</code> → <code>/admin</code></td>
</tr>
<tr>
<td><code>layout.tsx</code></td>
<td>Layout wrapper</td>
<td>Shared UI (header, footer)</td>
</tr>
<tr>
<td><code>loading.tsx</code></td>
<td>Loading UI</td>
<td>Suspense fallback</td>
</tr>
<tr>
<td><code>error.tsx</code></td>
<td>Error boundary</td>
<td>Catch errors</td>
</tr>
<tr>
<td><code>not-found.tsx</code></td>
<td>404 page</td>
<td>Not found errors</td>
</tr>
<tr>
<td><code>route.ts</code></td>
<td>API endpoint</td>
<td><code>/api/users/route.ts</code></td>
</tr>
</tbody>
</table>
<h3 id="route-groups-folder">Route Groups <code>(folder)</code></h3>
<p>Folder dengan <code>()</code> <strong>tidak muncul di
URL</strong>:</p>
<pre><code>app/
├── (dashboard)/       # ← Tidak muncul di URL!
│   └── admin/
│       └── page.tsx   # URL: /admin (bukan /dashboard/admin)</code></pre>
<p><strong>Kenapa pakai route groups?</strong> - Grouping halaman tanpa
mempengaruhi URL - Shared layout untuk grup tertentu - Organisasi kode
lebih rapi</p>
<h3 id="dynamic-routes-param">Dynamic Routes <code>[param]</code></h3>
<p>Folder dengan <code>[]</code> adalah <strong>dynamic
route</strong>:</p>
<pre class="tsx"><code>// app/product/[slug]/page.tsx

interface ProductPageProps {
  params: {
    slug: string;  // ← dari URL
  };
}

export default async function ProductPage({ params }: ProductPageProps) {
  const { slug } = params;
  
  // Fetch product by slug
  const product = await getProductBySlug(slug);
  
  return &lt;div&gt;{product.title}&lt;/div&gt;;
}</code></pre>
<p><strong>Contoh URL:</strong> - <code>/product/laptop-dell</code> →
<code>slug = "laptop-dell"</code> - <code>/product/iphone-15-pro</code>
→ <code>slug = "iphone-15-pro"</code></p>
<h3 id="routing-di-project-ini">Routing di Project Ini</h3>
<table>
<colgroup>
<col style="width: 22%" />
<col style="width: 27%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th>URL</th>
<th>File</th>
<th>Deskripsi</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/</code></td>
<td><code>app/page.tsx</code></td>
<td>Homepage</td>
</tr>
<tr>
<td><code>/shop</code></td>
<td><code>app/shop/page.tsx</code></td>
<td>Semua produk</td>
</tr>
<tr>
<td><code>/product/[slug]</code></td>
<td><code>app/product/[slug]/page.tsx</code></td>
<td>Detail produk</td>
</tr>
<tr>
<td><code>/cart</code></td>
<td><code>app/cart/page.tsx</code></td>
<td>Shopping cart</td>
</tr>
<tr>
<td><code>/checkout</code></td>
<td><code>app/checkout/page.tsx</code></td>
<td>Checkout</td>
</tr>
<tr>
<td><code>/login</code></td>
<td><code>app/login/page.tsx</code></td>
<td>Login</td>
</tr>
<tr>
<td><code>/register</code></td>
<td><code>app/register/page.tsx</code></td>
<td>Register</td>
</tr>
<tr>
<td><code>/wishlist</code></td>
<td><code>app/wishlist/page.tsx</code></td>
<td>Wishlist</td>
</tr>
<tr>
<td><code>/admin</code></td>
<td><code>app/(dashboard)/admin/page.tsx</code></td>
<td>Admin dashboard</td>
</tr>
<tr>
<td><code>/admin/products</code></td>
<td><code>app/(dashboard)/admin/products/page.tsx</code></td>
<td>Manage products</td>
</tr>
<tr>
<td><code>/admin/orders</code></td>
<td><code>app/(dashboard)/admin/orders/page.tsx</code></td>
<td>Manage orders</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="komponen-komponen-utama">🧩 Komponen-Komponen Utama</h2>
<h3 id="layout-components">1. Layout Components</h3>
<p><strong><code>app/layout.tsx</code></strong> - Root Layout (wrapper
semua halaman)</p>
<pre class="tsx"><code>import { Providers } from &quot;@/Providers&quot;;
import Header from &quot;@/components/Header&quot;;
import Footer from &quot;@/components/Footer&quot;;

export default function RootLayout({ children }) {
  return (
    &lt;html lang=&quot;en&quot;&gt;
      &lt;body&gt;
        &lt;Providers&gt;
          &lt;Header /&gt;
          {children}  {/* ← Konten halaman */}
          &lt;Footer /&gt;
        &lt;/Providers&gt;
      &lt;/body&gt;
    &lt;/html&gt;
  );
}</code></pre>
<p><strong>Fungsi:</strong> - Wrapper untuk semua halaman - Include
Header &amp; Footer - Setup Providers (NextAuth, Toaster, dll)</p>
<h3 id="header-navigation">2. Header &amp; Navigation</h3>
<p><strong><code>components/Header.tsx</code></strong></p>
<pre class="tsx"><code>&quot;use client&quot;;
import { useSession } from &quot;next-auth/react&quot;;
import { useWishlistStore } from &quot;@/app/_zustand/wishlistStore&quot;;

const Header = () =&gt; {
  const { data: session } = useSession();
  const { wishlist, wishQuantity } = useWishlistStore();
  
  return (
    &lt;header&gt;
      &lt;HeaderTop /&gt;
      &lt;CategoryMenu /&gt;
      &lt;SearchInput /&gt;
      &lt;CartElement /&gt;
      &lt;HeartElement wishQuantity={wishQuantity} /&gt;
      {session ? (
        &lt;button onClick={signOut}&gt;Logout&lt;/button&gt;
      ) : (
        &lt;Link href=&quot;/login&quot;&gt;Login&lt;/Link&gt;
      )}
    &lt;/header&gt;
  );
};</code></pre>
<p><strong>Fitur Header:</strong> - ✅ Session management (login/logout)
- ✅ Cart icon + quantity - ✅ Wishlist icon + quantity - ✅ Search bar
- ✅ Category menu</p>
<h3 id="product-components">3. Product Components</h3>
<p><strong><code>components/ProductItem.tsx</code></strong> - Single
Product Card</p>
<pre class="tsx"><code>interface ProductItemProps {
  id: string;
  title: string;
  price: number;
  mainImage: string;
  slug: string;
  rating: number;
}

const ProductItem = ({ id, title, price, mainImage, slug, rating }: ProductItemProps) =&gt; {
  return (
    &lt;div className=&quot;product-card&quot;&gt;
      &lt;Link href={`/product/${slug}`}&gt;
        &lt;Image src={mainImage} alt={title} /&gt;
        &lt;h3&gt;{title}&lt;/h3&gt;
        &lt;p&gt;${price}&lt;/p&gt;
        &lt;ProductItemRating rating={rating} /&gt;
      &lt;/Link&gt;
      &lt;AddToCartSingleProductBtn product={...} /&gt;
      &lt;AddToWishlistBtn product={...} /&gt;
    &lt;/div&gt;
  );
};</code></pre>
<p><strong>Lokasi penggunaan:</strong> - Homepage
(<code>app/page.tsx</code>) - Shop page (<code>app/shop/page.tsx</code>)
- Search results</p>
<h3 id="cart-components">4. Cart Components</h3>
<p><strong><code>components/modules/cart/index.tsx</code></strong> -
Cart Module</p>
<pre class="tsx"><code>&quot;use client&quot;;
import { useProductStore } from &quot;@/app/_zustand/store&quot;;

export const CartModule = () =&gt; {
  const { products, removeFromCart, calculateTotals, total } = useProductStore();
  
  return (
    &lt;div&gt;
      {products.map((product) =&gt; (
        &lt;div key={product.id}&gt;
          &lt;Image src={product.image} alt={product.title} /&gt;
          &lt;h3&gt;{product.title}&lt;/h3&gt;
          &lt;QuantityInputCart product={product} /&gt;
          &lt;p&gt;${product.price * product.amount}&lt;/p&gt;
          &lt;button onClick={() =&gt; removeFromCart(product.id)}&gt;
            Remove
          &lt;/button&gt;
        &lt;/div&gt;
      ))}
      &lt;div&gt;
        &lt;p&gt;Total: ${total}&lt;/p&gt;
        &lt;Link href=&quot;/checkout&quot;&gt;Checkout&lt;/Link&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
};</code></pre>
<p><strong>State yang digunakan:</strong> - <code>products</code> -
Array produk di cart - <code>total</code> - Total harga -
<code>removeFromCart()</code> - Hapus produk -
<code>calculateTotals()</code> - Hitung ulang total</p>
<h3 id="admin-components">5. Admin Components</h3>
<p><strong><code>components/DashboardSidebar.tsx</code></strong> - Admin
Sidebar</p>
<pre class="tsx"><code>const DashboardSidebar = () =&gt; {
  const pathname = usePathname();
  
  const menuItems = [
    { href: &quot;/admin&quot;, label: &quot;Dashboard&quot;, icon: &lt;FaHome /&gt; },
    { href: &quot;/admin/products&quot;, label: &quot;Products&quot;, icon: &lt;FaBox /&gt; },
    { href: &quot;/admin/orders&quot;, label: &quot;Orders&quot;, icon: &lt;FaShoppingCart /&gt; },
    { href: &quot;/admin/users&quot;, label: &quot;Users&quot;, icon: &lt;FaUsers /&gt; },
    { href: &quot;/admin/categories&quot;, label: &quot;Categories&quot;, icon: &lt;FaTags /&gt; },
  ];
  
  return (
    &lt;aside&gt;
      {menuItems.map((item) =&gt; (
        &lt;Link
          key={item.href}
          href={item.href}
          className={pathname === item.href ? &quot;active&quot; : &quot;&quot;}
        &gt;
          {item.icon}
          {item.label}
        &lt;/Link&gt;
      ))}
    &lt;/aside&gt;
  );
};</code></pre>
<p><strong>Halaman Admin:</strong> - <code>/admin</code> - Dashboard
stats - <code>/admin/products</code> - CRUD produk -
<code>/admin/orders</code> - Manage pesanan - <code>/admin/users</code>
- Manage users - <code>/admin/categories</code> - Manage kategori</p>
<hr />
<h2 id="state-management-zustand">🗃️ State Management (Zustand)</h2>
<h3 id="kenapa-zustand">Kenapa Zustand?</h3>
<p><strong>Keuntungan Zustand vs Redux/Context API:</strong> - ✅
<strong>Simple</strong>: Tidak perlu boilerplate - ✅
<strong>Fast</strong>: Tidak re-render unnecessary - ✅
<strong>TypeScript</strong>: Type-safe - ✅
<strong>Persistence</strong>: Auto save ke localStorage/sessionStorage -
✅ <strong>Devtools</strong>: Support Redux DevTools</p>
<h3 id="store-cart-app_zustandstore.ts">Store Cart
(<code>app/_zustand/store.ts</code>)</h3>
<div class="sourceCode" id="cb78"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { create } <span class="im">from</span> <span class="st">&quot;zustand&quot;</span><span class="op">;</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { persist<span class="op">,</span> createJSONStorage } <span class="im">from</span> <span class="st">&quot;zustand/middleware&quot;</span><span class="op">;</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="im">export type</span> ProductInCart <span class="op">=</span> {</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>  id<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>  title<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>  price<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>  image<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>  amount<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a><span class="im">export type</span> State <span class="op">=</span> {</span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>  products<span class="op">:</span> ProductInCart[]<span class="op">;</span></span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a>  allQuantity<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a>  total<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true" tabindex="-1"></a><span class="im">export type</span> Actions <span class="op">=</span> {</span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true" tabindex="-1"></a>  addToCart<span class="op">:</span> (newProduct<span class="op">:</span> ProductInCart) <span class="kw">=&gt;</span> <span class="dt">void</span><span class="op">;</span></span>
<span id="cb78-20"><a href="#cb78-20" aria-hidden="true" tabindex="-1"></a>  removeFromCart<span class="op">:</span> (id<span class="op">:</span> <span class="dt">string</span>) <span class="kw">=&gt;</span> <span class="dt">void</span><span class="op">;</span></span>
<span id="cb78-21"><a href="#cb78-21" aria-hidden="true" tabindex="-1"></a>  updateCartAmount<span class="op">:</span> (id<span class="op">:</span> <span class="dt">string</span><span class="op">,</span> quantity<span class="op">:</span> <span class="dt">number</span>) <span class="kw">=&gt;</span> <span class="dt">void</span><span class="op">;</span></span>
<span id="cb78-22"><a href="#cb78-22" aria-hidden="true" tabindex="-1"></a>  calculateTotals<span class="op">:</span> () <span class="kw">=&gt;</span> <span class="dt">void</span><span class="op">;</span></span>
<span id="cb78-23"><a href="#cb78-23" aria-hidden="true" tabindex="-1"></a>  clearCart<span class="op">:</span> () <span class="kw">=&gt;</span> <span class="dt">void</span><span class="op">;</span></span>
<span id="cb78-24"><a href="#cb78-24" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb78-25"><a href="#cb78-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-26"><a href="#cb78-26" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> useProductStore <span class="op">=</span> <span class="fu">create</span><span class="op">&lt;</span>State <span class="op">&amp;</span> Actions<span class="op">&gt;</span>()(</span>
<span id="cb78-27"><a href="#cb78-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">persist</span>(</span>
<span id="cb78-28"><a href="#cb78-28" aria-hidden="true" tabindex="-1"></a>    (<span class="kw">set</span>) <span class="kw">=&gt;</span> ({</span>
<span id="cb78-29"><a href="#cb78-29" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Initial State</span></span>
<span id="cb78-30"><a href="#cb78-30" aria-hidden="true" tabindex="-1"></a>      products<span class="op">:</span> []<span class="op">,</span></span>
<span id="cb78-31"><a href="#cb78-31" aria-hidden="true" tabindex="-1"></a>      allQuantity<span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb78-32"><a href="#cb78-32" aria-hidden="true" tabindex="-1"></a>      total<span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb78-33"><a href="#cb78-33" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb78-34"><a href="#cb78-34" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Actions</span></span>
<span id="cb78-35"><a href="#cb78-35" aria-hidden="true" tabindex="-1"></a>      addToCart<span class="op">:</span> (newProduct) <span class="kw">=&gt;</span> {</span>
<span id="cb78-36"><a href="#cb78-36" aria-hidden="true" tabindex="-1"></a>        <span class="kw">set</span>((state) <span class="kw">=&gt;</span> {</span>
<span id="cb78-37"><a href="#cb78-37" aria-hidden="true" tabindex="-1"></a>          <span class="co">// Cek apakah produk sudah ada di cart</span></span>
<span id="cb78-38"><a href="#cb78-38" aria-hidden="true" tabindex="-1"></a>          <span class="kw">const</span> cartItem <span class="op">=</span> state<span class="op">.</span><span class="at">products</span><span class="op">.</span><span class="fu">find</span>(</span>
<span id="cb78-39"><a href="#cb78-39" aria-hidden="true" tabindex="-1"></a>            (item) <span class="kw">=&gt;</span> item<span class="op">.</span><span class="at">id</span> <span class="op">===</span> newProduct<span class="op">.</span><span class="at">id</span></span>
<span id="cb78-40"><a href="#cb78-40" aria-hidden="true" tabindex="-1"></a>          )<span class="op">;</span></span>
<span id="cb78-41"><a href="#cb78-41" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb78-42"><a href="#cb78-42" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="op">!</span>cartItem) {</span>
<span id="cb78-43"><a href="#cb78-43" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Produk baru, tambahkan ke array</span></span>
<span id="cb78-44"><a href="#cb78-44" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> { products<span class="op">:</span> [<span class="op">...</span>state<span class="op">.</span><span class="at">products</span><span class="op">,</span> newProduct] }<span class="op">;</span></span>
<span id="cb78-45"><a href="#cb78-45" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb78-46"><a href="#cb78-46" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Produk sudah ada, update quantity</span></span>
<span id="cb78-47"><a href="#cb78-47" aria-hidden="true" tabindex="-1"></a>            state<span class="op">.</span><span class="at">products</span><span class="op">.</span><span class="fu">map</span>((product) <span class="kw">=&gt;</span> {</span>
<span id="cb78-48"><a href="#cb78-48" aria-hidden="true" tabindex="-1"></a>              <span class="cf">if</span> (product<span class="op">.</span><span class="at">id</span> <span class="op">===</span> cartItem<span class="op">.</span><span class="at">id</span>) {</span>
<span id="cb78-49"><a href="#cb78-49" aria-hidden="true" tabindex="-1"></a>                product<span class="op">.</span><span class="at">amount</span> <span class="op">+=</span> newProduct<span class="op">.</span><span class="at">amount</span><span class="op">;</span></span>
<span id="cb78-50"><a href="#cb78-50" aria-hidden="true" tabindex="-1"></a>              }</span>
<span id="cb78-51"><a href="#cb78-51" aria-hidden="true" tabindex="-1"></a>            })<span class="op">;</span></span>
<span id="cb78-52"><a href="#cb78-52" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> { products<span class="op">:</span> [<span class="op">...</span>state<span class="op">.</span><span class="at">products</span>] }<span class="op">;</span></span>
<span id="cb78-53"><a href="#cb78-53" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb78-54"><a href="#cb78-54" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb78-55"><a href="#cb78-55" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb78-56"><a href="#cb78-56" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb78-57"><a href="#cb78-57" aria-hidden="true" tabindex="-1"></a>      removeFromCart<span class="op">:</span> (id) <span class="kw">=&gt;</span> {</span>
<span id="cb78-58"><a href="#cb78-58" aria-hidden="true" tabindex="-1"></a>        <span class="kw">set</span>((state) <span class="kw">=&gt;</span> {</span>
<span id="cb78-59"><a href="#cb78-59" aria-hidden="true" tabindex="-1"></a>          state<span class="op">.</span><span class="at">products</span> <span class="op">=</span> state<span class="op">.</span><span class="at">products</span><span class="op">.</span><span class="fu">filter</span>(</span>
<span id="cb78-60"><a href="#cb78-60" aria-hidden="true" tabindex="-1"></a>            (product) <span class="kw">=&gt;</span> product<span class="op">.</span><span class="at">id</span> <span class="op">!==</span> id</span>
<span id="cb78-61"><a href="#cb78-61" aria-hidden="true" tabindex="-1"></a>          )<span class="op">;</span></span>
<span id="cb78-62"><a href="#cb78-62" aria-hidden="true" tabindex="-1"></a>          <span class="cf">return</span> { products<span class="op">:</span> state<span class="op">.</span><span class="at">products</span> }<span class="op">;</span></span>
<span id="cb78-63"><a href="#cb78-63" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb78-64"><a href="#cb78-64" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb78-65"><a href="#cb78-65" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb78-66"><a href="#cb78-66" aria-hidden="true" tabindex="-1"></a>      calculateTotals<span class="op">:</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb78-67"><a href="#cb78-67" aria-hidden="true" tabindex="-1"></a>        <span class="kw">set</span>((state) <span class="kw">=&gt;</span> {</span>
<span id="cb78-68"><a href="#cb78-68" aria-hidden="true" tabindex="-1"></a>          <span class="kw">let</span> amount <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb78-69"><a href="#cb78-69" aria-hidden="true" tabindex="-1"></a>          <span class="kw">let</span> total <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb78-70"><a href="#cb78-70" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb78-71"><a href="#cb78-71" aria-hidden="true" tabindex="-1"></a>          state<span class="op">.</span><span class="at">products</span><span class="op">.</span><span class="fu">forEach</span>((item) <span class="kw">=&gt;</span> {</span>
<span id="cb78-72"><a href="#cb78-72" aria-hidden="true" tabindex="-1"></a>            amount <span class="op">+=</span> item<span class="op">.</span><span class="at">amount</span><span class="op">;</span></span>
<span id="cb78-73"><a href="#cb78-73" aria-hidden="true" tabindex="-1"></a>            total <span class="op">+=</span> item<span class="op">.</span><span class="at">amount</span> <span class="op">*</span> item<span class="op">.</span><span class="at">price</span><span class="op">;</span></span>
<span id="cb78-74"><a href="#cb78-74" aria-hidden="true" tabindex="-1"></a>          })<span class="op">;</span></span>
<span id="cb78-75"><a href="#cb78-75" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb78-76"><a href="#cb78-76" aria-hidden="true" tabindex="-1"></a>          <span class="cf">return</span> {</span>
<span id="cb78-77"><a href="#cb78-77" aria-hidden="true" tabindex="-1"></a>            products<span class="op">:</span> state<span class="op">.</span><span class="at">products</span><span class="op">,</span></span>
<span id="cb78-78"><a href="#cb78-78" aria-hidden="true" tabindex="-1"></a>            allQuantity<span class="op">:</span> amount<span class="op">,</span></span>
<span id="cb78-79"><a href="#cb78-79" aria-hidden="true" tabindex="-1"></a>            total<span class="op">:</span> total<span class="op">,</span></span>
<span id="cb78-80"><a href="#cb78-80" aria-hidden="true" tabindex="-1"></a>          }<span class="op">;</span></span>
<span id="cb78-81"><a href="#cb78-81" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb78-82"><a href="#cb78-82" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb78-83"><a href="#cb78-83" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb78-84"><a href="#cb78-84" aria-hidden="true" tabindex="-1"></a>      updateCartAmount<span class="op">:</span> (id<span class="op">,</span> amount) <span class="kw">=&gt;</span> {</span>
<span id="cb78-85"><a href="#cb78-85" aria-hidden="true" tabindex="-1"></a>        <span class="kw">set</span>((state) <span class="kw">=&gt;</span> {</span>
<span id="cb78-86"><a href="#cb78-86" aria-hidden="true" tabindex="-1"></a>          <span class="kw">const</span> cartItem <span class="op">=</span> state<span class="op">.</span><span class="at">products</span><span class="op">.</span><span class="fu">find</span>((item) <span class="kw">=&gt;</span> item<span class="op">.</span><span class="at">id</span> <span class="op">===</span> id)<span class="op">;</span></span>
<span id="cb78-87"><a href="#cb78-87" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb78-88"><a href="#cb78-88" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (cartItem) {</span>
<span id="cb78-89"><a href="#cb78-89" aria-hidden="true" tabindex="-1"></a>            state<span class="op">.</span><span class="at">products</span><span class="op">.</span><span class="fu">map</span>((product) <span class="kw">=&gt;</span> {</span>
<span id="cb78-90"><a href="#cb78-90" aria-hidden="true" tabindex="-1"></a>              <span class="cf">if</span> (product<span class="op">.</span><span class="at">id</span> <span class="op">===</span> cartItem<span class="op">.</span><span class="at">id</span>) {</span>
<span id="cb78-91"><a href="#cb78-91" aria-hidden="true" tabindex="-1"></a>                product<span class="op">.</span><span class="at">amount</span> <span class="op">=</span> amount<span class="op">;</span></span>
<span id="cb78-92"><a href="#cb78-92" aria-hidden="true" tabindex="-1"></a>              }</span>
<span id="cb78-93"><a href="#cb78-93" aria-hidden="true" tabindex="-1"></a>            })<span class="op">;</span></span>
<span id="cb78-94"><a href="#cb78-94" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb78-95"><a href="#cb78-95" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb78-96"><a href="#cb78-96" aria-hidden="true" tabindex="-1"></a>          <span class="cf">return</span> { products<span class="op">:</span> [<span class="op">...</span>state<span class="op">.</span><span class="at">products</span>] }<span class="op">;</span></span>
<span id="cb78-97"><a href="#cb78-97" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb78-98"><a href="#cb78-98" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb78-99"><a href="#cb78-99" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb78-100"><a href="#cb78-100" aria-hidden="true" tabindex="-1"></a>      clearCart<span class="op">:</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb78-101"><a href="#cb78-101" aria-hidden="true" tabindex="-1"></a>        <span class="kw">set</span>(() <span class="kw">=&gt;</span> ({</span>
<span id="cb78-102"><a href="#cb78-102" aria-hidden="true" tabindex="-1"></a>          products<span class="op">:</span> []<span class="op">,</span></span>
<span id="cb78-103"><a href="#cb78-103" aria-hidden="true" tabindex="-1"></a>          allQuantity<span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb78-104"><a href="#cb78-104" aria-hidden="true" tabindex="-1"></a>          total<span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb78-105"><a href="#cb78-105" aria-hidden="true" tabindex="-1"></a>        }))<span class="op">;</span></span>
<span id="cb78-106"><a href="#cb78-106" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb78-107"><a href="#cb78-107" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb78-108"><a href="#cb78-108" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb78-109"><a href="#cb78-109" aria-hidden="true" tabindex="-1"></a>      name<span class="op">:</span> <span class="st">&quot;products-storage&quot;</span><span class="op">,</span> <span class="co">// Key di sessionStorage</span></span>
<span id="cb78-110"><a href="#cb78-110" aria-hidden="true" tabindex="-1"></a>      storage<span class="op">:</span> <span class="fu">createJSONStorage</span>(() <span class="kw">=&gt;</span> sessionStorage)<span class="op">,</span></span>
<span id="cb78-111"><a href="#cb78-111" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb78-112"><a href="#cb78-112" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb78-113"><a href="#cb78-113" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div>
<p><strong>Cara Pakai di Component:</strong></p>
<pre class="tsx"><code>&quot;use client&quot;;
import { useProductStore } from &quot;@/app/_zustand/store&quot;;

const MyComponent = () =&gt; {
  // Ambil state &amp; actions
  const { products, total, addToCart, calculateTotals } = useProductStore();
  
  const handleAddToCart = () =&gt; {
    addToCart({
      id: &quot;123&quot;,
      title: &quot;Laptop&quot;,
      price: 1000,
      image: &quot;/laptop.jpg&quot;,
      amount: 1,
    });
    calculateTotals();
  };
  
  return (
    &lt;div&gt;
      &lt;p&gt;Total Items: {products.length}&lt;/p&gt;
      &lt;p&gt;Total Price: ${total}&lt;/p&gt;
      &lt;button onClick={handleAddToCart}&gt;Add to Cart&lt;/button&gt;
    &lt;/div&gt;
  );
};</code></pre>
<h3 id="store-wishlist-app_zustandwishliststore.ts">Store Wishlist
(<code>app/_zustand/wishlistStore.ts</code>)</h3>
<div class="sourceCode" id="cb80"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> useWishlistStore <span class="op">=</span> <span class="fu">create</span><span class="op">&lt;</span>State <span class="op">&amp;</span> Actions<span class="op">&gt;</span>((<span class="kw">set</span>) <span class="kw">=&gt;</span> ({</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>  wishlist<span class="op">:</span> []<span class="op">,</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  wishQuantity<span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>  addToWishlist<span class="op">:</span> (product) <span class="kw">=&gt;</span> {</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span>((state) <span class="kw">=&gt;</span> {</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> productInWishlist <span class="op">=</span> state<span class="op">.</span><span class="at">wishlist</span><span class="op">.</span><span class="fu">find</span>(</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>        (item) <span class="kw">=&gt;</span> product<span class="op">.</span><span class="at">id</span> <span class="op">===</span> item<span class="op">.</span><span class="at">id</span></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>      )<span class="op">;</span></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="op">!</span>productInWishlist) {</span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>          wishlist<span class="op">:</span> [<span class="op">...</span>state<span class="op">.</span><span class="at">wishlist</span><span class="op">,</span> product]<span class="op">,</span></span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>          wishQuantity<span class="op">:</span> state<span class="op">.</span><span class="at">wishlist</span><span class="op">.</span><span class="at">length</span> <span class="op">+</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>        }<span class="op">;</span></span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> { wishlist<span class="op">:</span> [<span class="op">...</span>state<span class="op">.</span><span class="at">wishlist</span>]<span class="op">,</span> wishQuantity<span class="op">:</span> state<span class="op">.</span><span class="at">wishlist</span><span class="op">.</span><span class="at">length</span> }<span class="op">;</span></span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a>  removeFromWishlist<span class="op">:</span> (id) <span class="kw">=&gt;</span> {</span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span>((state) <span class="kw">=&gt;</span> {</span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> newWishlist <span class="op">=</span> state<span class="op">.</span><span class="at">wishlist</span><span class="op">.</span><span class="fu">filter</span>((item) <span class="kw">=&gt;</span> item<span class="op">.</span><span class="at">id</span> <span class="op">!==</span> id)<span class="op">;</span></span>
<span id="cb80-25"><a href="#cb80-25" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> {</span>
<span id="cb80-26"><a href="#cb80-26" aria-hidden="true" tabindex="-1"></a>        wishlist<span class="op">:</span> [<span class="op">...</span>newWishlist]<span class="op">,</span></span>
<span id="cb80-27"><a href="#cb80-27" aria-hidden="true" tabindex="-1"></a>        wishQuantity<span class="op">:</span> newWishlist<span class="op">.</span><span class="at">length</span><span class="op">,</span></span>
<span id="cb80-28"><a href="#cb80-28" aria-hidden="true" tabindex="-1"></a>      }<span class="op">;</span></span>
<span id="cb80-29"><a href="#cb80-29" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb80-30"><a href="#cb80-30" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb80-31"><a href="#cb80-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-32"><a href="#cb80-32" aria-hidden="true" tabindex="-1"></a>  setWishlist<span class="op">:</span> (wishlist) <span class="kw">=&gt;</span> {</span>
<span id="cb80-33"><a href="#cb80-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span>(() <span class="kw">=&gt;</span> ({</span>
<span id="cb80-34"><a href="#cb80-34" aria-hidden="true" tabindex="-1"></a>      wishlist<span class="op">:</span> [<span class="op">...</span>wishlist]<span class="op">,</span></span>
<span id="cb80-35"><a href="#cb80-35" aria-hidden="true" tabindex="-1"></a>      wishQuantity<span class="op">:</span> wishlist<span class="op">.</span><span class="at">length</span><span class="op">,</span></span>
<span id="cb80-36"><a href="#cb80-36" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">;</span></span>
<span id="cb80-37"><a href="#cb80-37" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb80-38"><a href="#cb80-38" aria-hidden="true" tabindex="-1"></a>}))<span class="op">;</span></span></code></pre></div>
<h3 id="store-pagination-app_zustandpaginationstore.ts">Store Pagination
(<code>app/_zustand/paginationStore.ts</code>)</h3>
<div class="sourceCode" id="cb81"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> usePaginationStore <span class="op">=</span> <span class="fu">create</span><span class="op">&lt;</span>State <span class="op">&amp;</span> Actions<span class="op">&gt;</span>((<span class="kw">set</span>) <span class="kw">=&gt;</span> ({</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  page<span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>  incrementPage<span class="op">:</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span>((state) <span class="kw">=&gt;</span> ({ page<span class="op">:</span> state<span class="op">.</span><span class="at">page</span> <span class="op">+</span> <span class="dv">1</span> }))<span class="op">;</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>  decrementPage<span class="op">:</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span>((state) <span class="kw">=&gt;</span> {</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (state<span class="op">.</span><span class="at">page</span> <span class="op">!==</span> <span class="dv">1</span>) {</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> { page<span class="op">:</span> state<span class="op">.</span><span class="at">page</span> <span class="op">-</span> <span class="dv">1</span> }<span class="op">;</span></span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> { page<span class="op">:</span> <span class="dv">1</span> }<span class="op">;</span></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>}))<span class="op">;</span></span></code></pre></div>
<h3 id="store-sort-app_zustandsortstore.ts">Store Sort
(<code>app/_zustand/sortStore.ts</code>)</h3>
<div class="sourceCode" id="cb82"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> useSortStore <span class="op">=</span> <span class="fu">create</span><span class="op">&lt;</span>State <span class="op">&amp;</span> Actions<span class="op">&gt;</span>((<span class="kw">set</span>) <span class="kw">=&gt;</span> ({</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  sortBy<span class="op">:</span> <span class="st">&quot;defaultSort&quot;</span><span class="op">,</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>  changeSortBy<span class="op">:</span> (mode<span class="op">:</span> <span class="dt">string</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span>(() <span class="kw">=&gt;</span> ({ sortBy<span class="op">:</span> mode }))<span class="op">;</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>}))<span class="op">;</span></span></code></pre></div>
<p><strong>Cara Pakai:</strong></p>
<pre class="tsx"><code>const { sortBy, changeSortBy } = useSortStore();

&lt;select onChange={(e) =&gt; changeSortBy(e.target.value)}&gt;
  &lt;option value=&quot;defaultSort&quot;&gt;Default&lt;/option&gt;
  &lt;option value=&quot;priceAsc&quot;&gt;Price: Low to High&lt;/option&gt;
  &lt;option value=&quot;priceDesc&quot;&gt;Price: High to Low&lt;/option&gt;
&lt;/select&gt;</code></pre>
<hr />
<h2 id="server-components-vs-client-components">🎨 Server Components vs
Client Components</h2>
<h3 id="default-server-components">Default: Server Components</h3>
<p>Di Next.js App Router, <strong>semua components adalah Server
Components</strong> secara default.</p>
<p><strong>Server Components:</strong> - ✅ Render di server - ✅ Tidak
dikirim ke browser (ukuran bundle kecil) - ✅ Bisa akses database
langsung - ❌ Tidak bisa pakai hooks (useState, useEffect) - ❌ Tidak
bisa pakai event handlers (onClick, onChange)</p>
<pre class="tsx"><code>// ✅ Server Component (default)
export default async function ProductPage() {
  // Bisa fetch data langsung di component
  const products = await prisma.product.findMany();
  
  return (
    &lt;div&gt;
      {products.map((product) =&gt; (
        &lt;ProductItem key={product.id} {...product} /&gt;
      ))}
    &lt;/div&gt;
  );
}</code></pre>
<h3 id="client-components-use-client">Client Components:
<code>"use client"</code></h3>
<p>Jika butuh interactivity, tambahkan <code>"use client"</code> di atas
file:</p>
<pre class="tsx"><code>&quot;use client&quot;; // ← Wajib di baris pertama!

import { useState } from &quot;react&quot;;

export default function Counter() {
  const [count, setCount] = useState(0);
  
  return (
    &lt;div&gt;
      &lt;p&gt;Count: {count}&lt;/p&gt;
      &lt;button onClick={() =&gt; setCount(count + 1)}&gt;
        Increment
      &lt;/button&gt;
    &lt;/div&gt;
  );
}</code></pre>
<p><strong>Kapan pakai Client Component?</strong> - ✅ Butuh React hooks
(useState, useEffect, useContext) - ✅ Butuh event handlers (onClick,
onChange, onSubmit) - ✅ Butuh browser APIs (localStorage, window,
document) - ✅ Butuh third-party libraries yang pakai hooks - ✅ Butuh
NextAuth session dengan <code>useSession()</code></p>
<h3 id="pattern-server-client-components">Pattern: Server + Client
Components</h3>
<p><strong>Best Practice:</strong></p>
<pre class="tsx"><code>// app/products/page.tsx (Server Component)
export default async function ProductsPage() {
  // Fetch di server
  const products = await getProducts();
  
  return (
    &lt;div&gt;
      &lt;h1&gt;Products&lt;/h1&gt;
      {/* Pass data ke Client Component */}
      &lt;ProductList products={products} /&gt;
    &lt;/div&gt;
  );
}

// components/ProductList.tsx (Client Component)
&quot;use client&quot;;
import { useState } from &quot;react&quot;;

export default function ProductList({ products }) {
  const [filteredProducts, setFilteredProducts] = useState(products);
  
  // Interactivity di sini
  const handleFilter = (category) =&gt; {
    setFilteredProducts(
      products.filter((p) =&gt; p.category === category)
    );
  };
  
  return (
    &lt;div&gt;
      &lt;button onClick={() =&gt; handleFilter(&quot;laptop&quot;)}&gt;Laptop&lt;/button&gt;
      {filteredProducts.map((product) =&gt; (
        &lt;ProductCard key={product.id} product={product} /&gt;
      ))}
    &lt;/div&gt;
  );
}</code></pre>
<p><strong>Kenapa dipisah?</strong> - Server Component → Fetch data
(lebih cepat, SEO friendly) - Client Component → Interactivity (filter,
sort, animation)</p>
<hr />
<h2 id="data-flow-patterns">🔄 Data Flow &amp; Patterns</h2>
<h3 id="data-fetching-pattern">1. Data Fetching Pattern</h3>
<p><strong>Server Component (Recommended):</strong></p>
<pre class="tsx"><code>// app/products/page.tsx
import prisma from &quot;@/utils/db&quot;;

export default async function ProductsPage() {
  // Direct database access
  const products = await prisma.product.findMany({
    include: { category: true },
  });
  
  return &lt;ProductList products={products} /&gt;;
}</code></pre>
<p><strong>Client Component (via API):</strong></p>
<pre class="tsx"><code>&quot;use client&quot;;
import { useEffect, useState } from &quot;react&quot;;
import apiClient from &quot;@/lib/api&quot;;

export default function ProductsPage() {
  const [products, setProducts] = useState([]);
  
  useEffect(() =&gt; {
    apiClient.get(&quot;/api/products&quot;)
      .then((res) =&gt; res.json())
      .then((data) =&gt; setProducts(data));
  }, []);
  
  return &lt;ProductList products={products} /&gt;;
}</code></pre>
<h3 id="form-submission-pattern">2. Form Submission Pattern</h3>
<p><strong>Client Component dengan API Route:</strong></p>
<pre class="tsx"><code>&quot;use client&quot;;
import { useState } from &quot;react&quot;;
import toast from &quot;react-hot-toast&quot;;
import apiClient from &quot;@/lib/api&quot;;

export default function ProductForm() {
  const [formData, setFormData] = useState({
    title: &quot;&quot;,
    price: 0,
  });
  
  const handleSubmit = async (e) =&gt; {
    e.preventDefault();
    
    try {
      const response = await apiClient.post(&quot;/api/products&quot;, formData);
      
      if (response.ok) {
        toast.success(&quot;Product created!&quot;);
      } else {
        toast.error(&quot;Failed to create product&quot;);
      }
    } catch (error) {
      toast.error(&quot;Error occurred&quot;);
    }
  };
  
  return (
    &lt;form onSubmit={handleSubmit}&gt;
      &lt;input
        value={formData.title}
        onChange={(e) =&gt; setFormData({ ...formData, title: e.target.value })}
      /&gt;
      &lt;button type=&quot;submit&quot;&gt;Submit&lt;/button&gt;
    &lt;/form&gt;
  );
}</code></pre>
<h3 id="authentication-pattern">3. Authentication Pattern</h3>
<p><strong>Menggunakan NextAuth:</strong></p>
<pre class="tsx"><code>&quot;use client&quot;;
import { useSession, signIn, signOut } from &quot;next-auth/react&quot;;

export default function LoginButton() {
  const { data: session, status } = useSession();
  
  if (status === &quot;loading&quot;) {
    return &lt;p&gt;Loading...&lt;/p&gt;;
  }
  
  if (session) {
    return (
      &lt;&gt;
        &lt;p&gt;Welcome, {session.user?.email}&lt;/p&gt;
        &lt;button onClick={() =&gt; signOut()}&gt;Logout&lt;/button&gt;
      &lt;/&gt;
    );
  }
  
  return &lt;button onClick={() =&gt; signIn()}&gt;Login&lt;/button&gt;;
}</code></pre>
<h3 id="protected-route-pattern">4. Protected Route Pattern</h3>
<p><strong>Menggunakan Middleware:</strong></p>
<div class="sourceCode" id="cb91"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co">// middleware.ts</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { withAuth } <span class="im">from</span> <span class="st">&quot;next-auth/middleware&quot;</span><span class="op">;</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="im">default</span> <span class="fu">withAuth</span>(</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">middleware</span>(req) {</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Check for admin routes</span></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (req<span class="op">.</span><span class="at">nextUrl</span><span class="op">.</span><span class="at">pathname</span><span class="op">.</span><span class="fu">startsWith</span>(<span class="st">&quot;/admin&quot;</span>)) {</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (req<span class="op">.</span><span class="at">nextauth</span><span class="op">.</span><span class="at">token</span><span class="op">?.</span><span class="at">role</span> <span class="op">!==</span> <span class="st">&quot;admin&quot;</span>) {</span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">redirect</span>(<span class="kw">new</span> <span class="fu">URL</span>(<span class="st">&quot;/&quot;</span><span class="op">,</span> req<span class="op">.</span><span class="at">url</span>))<span class="op">;</span></span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a>    callbacks<span class="op">:</span> {</span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a>      authorized<span class="op">:</span> ({ token<span class="op">,</span> req }) <span class="kw">=&gt;</span> {</span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (req<span class="op">.</span><span class="at">nextUrl</span><span class="op">.</span><span class="at">pathname</span><span class="op">.</span><span class="fu">startsWith</span>(<span class="st">&quot;/admin&quot;</span>)) {</span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a>          <span class="cf">return</span> <span class="op">!!</span>token <span class="op">&amp;&amp;</span> token<span class="op">.</span><span class="at">role</span> <span class="op">===</span> <span class="st">&quot;admin&quot;</span><span class="op">;</span></span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb91-21"><a href="#cb91-21" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb91-22"><a href="#cb91-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb91-23"><a href="#cb91-23" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb91-24"><a href="#cb91-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-25"><a href="#cb91-25" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> config <span class="op">=</span> {</span>
<span id="cb91-26"><a href="#cb91-26" aria-hidden="true" tabindex="-1"></a>  matcher<span class="op">:</span> [<span class="st">&quot;/admin/:path*&quot;</span>]</span>
<span id="cb91-27"><a href="#cb91-27" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<hr />
<h2 id="file-naming-conventions">📝 File Naming Conventions</h2>
<h3 id="naming-standards">Naming Standards</h3>
<table>
<thead>
<tr>
<th>Type</th>
<th>Convention</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Components</strong></td>
<td>PascalCase</td>
<td><code>ProductItem.tsx</code></td>
</tr>
<tr>
<td><strong>Pages</strong></td>
<td>lowercase</td>
<td><code>page.tsx</code>, <code>layout.tsx</code></td>
</tr>
<tr>
<td><strong>API Routes</strong></td>
<td>lowercase</td>
<td><code>route.ts</code></td>
</tr>
<tr>
<td><strong>Utilities</strong></td>
<td>camelCase</td>
<td><code>validation.ts</code>, <code>sanitize.ts</code></td>
</tr>
<tr>
<td><strong>Stores</strong></td>
<td>camelCase + Store</td>
<td><code>wishlistStore.ts</code></td>
</tr>
<tr>
<td><strong>Types</strong></td>
<td>PascalCase</td>
<td><code>ProductType</code>, <code>UserType</code></td>
</tr>
<tr>
<td><strong>Hooks</strong></td>
<td>use + PascalCase</td>
<td><code>useSessionTimeout.ts</code></td>
</tr>
</tbody>
</table>
<h3 id="component-structure">Component Structure</h3>
<p><strong>Template Component:</strong></p>
<pre class="tsx"><code>// *********************
// Role: Brief description of component
// Name: ComponentName.tsx
// Developer: Your Name
// Version: 1.0
// Call: &lt;ComponentName prop={value} /&gt;
// Input: interface ComponentNameProps
// Output: What it renders
// *********************

&quot;use client&quot;; // (jika client component)

import React from &quot;react&quot;;

interface ComponentNameProps {
  prop1: string;
  prop2: number;
}

const ComponentName = ({ prop1, prop2 }: ComponentNameProps) =&gt; {
  return (
    &lt;div&gt;
      {/* Component content */}
    &lt;/div&gt;
  );
};

export default ComponentName;</code></pre>
<h3 id="folder-organization-best-practices">Folder Organization Best
Practices</h3>
<ol type="1">
<li><p><strong>Group by Feature</strong> (bukan by type)</p>
<pre><code>✅ Good:
components/
├── cart/
│   ├── CartItem.tsx
│   ├── CartSummary.tsx
│   └── index.tsx

❌ Bad:
components/
├── CartItem.tsx
├── CartSummary.tsx
├── ProductItem.tsx
└── ProductGrid.tsx</code></pre></li>
<li><p><strong>Use index.ts for exports</strong></p>
<div class="sourceCode" id="cb94"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co">// components/index.ts</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> { <span class="im">default</span> <span class="im">as</span> Header } <span class="im">from</span> <span class="st">&quot;./Header&quot;</span><span class="op">;</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> { <span class="im">default</span> <span class="im">as</span> Footer } <span class="im">from</span> <span class="st">&quot;./Footer&quot;</span><span class="op">;</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> { <span class="im">default</span> <span class="im">as</span> ProductItem } <span class="im">from</span> <span class="st">&quot;./ProductItem&quot;</span><span class="op">;</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Usage:</span></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { Header<span class="op">,</span> Footer<span class="op">,</span> ProductItem } <span class="im">from</span> <span class="st">&quot;@/components&quot;</span><span class="op">;</span></span></code></pre></div></li>
<li><p><strong>Colocate related files</strong></p>
<pre><code>ProductItem/
├── ProductItem.tsx
├── ProductItem.test.tsx
├── ProductItem.module.css
└── index.ts</code></pre></li>
</ol>
<hr />
<h2 id="key-takeaways">🎯 Key Takeaways</h2>
<h3 id="arsitektur-project">Arsitektur Project</h3>
<p>✅ <strong>Next.js App Router</strong> dengan Server Components
(default)<br />
✅ <strong>Zustand</strong> untuk state management (cart, wishlist,
pagination)<br />
✅ <strong>Prisma ORM</strong> untuk database access<br />
✅ <strong>NextAuth</strong> untuk authentication &amp; session<br />
✅ <strong>TailwindCSS + DaisyUI</strong> untuk styling</p>
<h3 id="best-practices">Best Practices</h3>
<ol type="1">
<li><strong>Server Components</strong> untuk data fetching (lebih cepat,
SEO)</li>
<li><strong>Client Components</strong> untuk interactivity (state,
events)</li>
<li><strong>Zustand</strong> untuk global state yang perlu persist</li>
<li><strong>Route Groups</strong> untuk organisasi tanpa mempengaruhi
URL</li>
<li><strong>Dynamic Routes</strong> untuk halaman dengan parameter</li>
</ol>
<h3 id="file-structure">File Structure</h3>
<ul>
<li><code>app/</code> → Pages &amp; API routes</li>
<li><code>components/</code> → Reusable UI components</li>
<li><code>app/_zustand/</code> → State management stores</li>
<li><code>prisma/</code> → Database schema &amp; migrations</li>
<li><code>lib/</code> &amp; <code>utils/</code> → Helper functions &amp;
utilities</li>
</ul>
<hr />
<h1 id="authentication-authorization">🔐 Authentication &amp;
Authorization</h1>
<blockquote>
<p><strong>Dokumentasi Lengkap</strong>: Setup NextAuth, JWT Tokens,
Session Management, Role-Based Access Control</p>
</blockquote>
<hr />
<h2 id="daftar-isi-2">📑 Daftar Isi</h2>
<ul>
<li><a href="#konsep-dasar">Konsep Dasar</a></li>
<li><a href="#nextauth-setup">NextAuth Setup</a></li>
<li><a href="#credential-provider">Credential Provider</a></li>
<li><a href="#oauth-providers">OAuth Providers (GitHub, Google)</a></li>
<li><a href="#jwt-tokens--session">JWT Tokens &amp; Session</a></li>
<li><a href="#session-timeout">Session Timeout</a></li>
<li><a href="#middleware--protected-routes">Middleware &amp; Protected
Routes</a></li>
<li><a href="#role-based-access-control">Role-Based Access
Control</a></li>
<li><a href="#login--register-flow">Login &amp; Register Flow</a></li>
<li><a href="#security-best-practices">Security Best Practices</a></li>
<li><a href="#troubleshooting">Troubleshooting</a></li>
</ul>
<hr />
<h2 id="konsep-dasar">🎯 Konsep Dasar</h2>
<h3 id="authentication-vs-authorization">Authentication vs
Authorization</h3>
<table>
<thead>
<tr>
<th><strong>Authentication</strong></th>
<th><strong>Authorization</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Siapa Anda? (Identity)</td>
<td>Apa yang boleh Anda lakukan? (Permission)</td>
</tr>
<tr>
<td>Login dengan email/password</td>
<td>User vs Admin</td>
</tr>
<tr>
<td>JWT Token</td>
<td>Role-based access</td>
</tr>
</tbody>
</table>
<h3 id="flow-diagram">Flow Diagram</h3>
<pre><code>┌──────────────┐
│   Browser    │
└──────┬───────┘
       │ 1. Login (email, password)
       ↓
┌──────────────┐
│  NextAuth.js │
└──────┬───────┘
       │ 2. Verify credentials
       ↓
┌──────────────┐
│   Database   │ ← Check user exists &amp; password match
└──────┬───────┘
       │ 3. User found
       ↓
┌──────────────┐
│  JWT Token   │ ← Generate token dengan role &amp; id
└──────┬───────┘
       │ 4. Send token
       ↓
┌──────────────┐
│   Session    │ ← Store di cookies (httpOnly)
└──────┬───────┘
       │ 5. Access protected routes
       ↓
┌──────────────┐
│  Middleware  │ ← Check role (user/admin)
└──────────────┘</code></pre>
<hr />
<h2 id="nextauth-setup">⚙️ NextAuth Setup</h2>
<h3 id="instalasi">1. Instalasi</h3>
<p>NextAuth sudah terinstall di project:</p>
<div class="sourceCode" id="cb97"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="er">//</span> <span class="er">package.json</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;dependencies&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;next-auth&quot;</span><span class="fu">:</span> <span class="st">&quot;^4.24.11&quot;</span></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h3 id="environment-variables">2. Environment Variables</h3>
<pre class="env"><code># .env
NEXTAUTH_SECRET=&quot;your-super-secret-key-change-this&quot;
NEXTAUTH_URL=&quot;http://localhost:3000&quot;

# Optional: OAuth Providers
GITHUB_ID=&quot;your-github-oauth-client-id&quot;
GITHUB_SECRET=&quot;your-github-oauth-client-secret&quot;
GOOGLE_CLIENT_ID=&quot;your-google-client-id&quot;
GOOGLE_CLIENT_SECRET=&quot;your-google-client-secret&quot;</code></pre>
<p><strong>Generate NEXTAUTH_SECRET:</strong></p>
<div class="sourceCode" id="cb99"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="ex">openssl</span> rand <span class="at">-base64</span> 32</span></code></pre></div>
<h3 id="nextauth-route-handler">3. NextAuth Route Handler</h3>
<p><strong>Lokasi:</strong>
<code>app/api/auth/[...nextauth]/route.ts</code></p>
<div class="sourceCode" id="cb100"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> NextAuth<span class="op">,</span> { NextAuthOptions } <span class="im">from</span> <span class="st">&quot;next-auth&quot;</span><span class="op">;</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { Account<span class="op">,</span> User <span class="im">as</span> AuthUser } <span class="im">from</span> <span class="st">&quot;next-auth&quot;</span><span class="op">;</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> CredentialsProvider <span class="im">from</span> <span class="st">&quot;next-auth/providers/credentials&quot;</span><span class="op">;</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> GithubProvider <span class="im">from</span> <span class="st">&quot;next-auth/providers/github&quot;</span><span class="op">;</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> GoogleProvider <span class="im">from</span> <span class="st">&quot;next-auth/providers/google&quot;</span><span class="op">;</span></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> bcrypt <span class="im">from</span> <span class="st">&quot;bcryptjs&quot;</span><span class="op">;</span></span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> prisma <span class="im">from</span> <span class="st">&quot;@/utils/db&quot;</span><span class="op">;</span></span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { nanoid } <span class="im">from</span> <span class="st">&quot;nanoid&quot;</span><span class="op">;</span></span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> authOptions<span class="op">:</span> NextAuthOptions <span class="op">=</span> {</span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Providers configuration</span></span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a>  providers<span class="op">:</span> [</span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 1. Email/Password (Credentials)</span></span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">CredentialsProvider</span>({</span>
<span id="cb100-15"><a href="#cb100-15" aria-hidden="true" tabindex="-1"></a>      id<span class="op">:</span> <span class="st">&quot;credentials&quot;</span><span class="op">,</span></span>
<span id="cb100-16"><a href="#cb100-16" aria-hidden="true" tabindex="-1"></a>      name<span class="op">:</span> <span class="st">&quot;Credentials&quot;</span><span class="op">,</span></span>
<span id="cb100-17"><a href="#cb100-17" aria-hidden="true" tabindex="-1"></a>      credentials<span class="op">:</span> {</span>
<span id="cb100-18"><a href="#cb100-18" aria-hidden="true" tabindex="-1"></a>        email<span class="op">:</span> { label<span class="op">:</span> <span class="st">&quot;Email&quot;</span><span class="op">,</span> type<span class="op">:</span> <span class="st">&quot;text&quot;</span> }<span class="op">,</span></span>
<span id="cb100-19"><a href="#cb100-19" aria-hidden="true" tabindex="-1"></a>        password<span class="op">:</span> { label<span class="op">:</span> <span class="st">&quot;Password&quot;</span><span class="op">,</span> type<span class="op">:</span> <span class="st">&quot;password&quot;</span> }<span class="op">,</span></span>
<span id="cb100-20"><a href="#cb100-20" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb100-21"><a href="#cb100-21" aria-hidden="true" tabindex="-1"></a>      <span class="kw">async</span> <span class="fu">authorize</span>(credentials<span class="op">:</span> <span class="dt">any</span>) {</span>
<span id="cb100-22"><a href="#cb100-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span> {</span>
<span id="cb100-23"><a href="#cb100-23" aria-hidden="true" tabindex="-1"></a>          <span class="co">// Find user by email</span></span>
<span id="cb100-24"><a href="#cb100-24" aria-hidden="true" tabindex="-1"></a>          <span class="kw">const</span> user <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">user</span><span class="op">.</span><span class="fu">findFirst</span>({</span>
<span id="cb100-25"><a href="#cb100-25" aria-hidden="true" tabindex="-1"></a>            where<span class="op">:</span> { email<span class="op">:</span> credentials<span class="op">.</span><span class="at">email</span> }<span class="op">,</span></span>
<span id="cb100-26"><a href="#cb100-26" aria-hidden="true" tabindex="-1"></a>          })<span class="op">;</span></span>
<span id="cb100-27"><a href="#cb100-27" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb100-28"><a href="#cb100-28" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (user) {</span>
<span id="cb100-29"><a href="#cb100-29" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Compare password with hashed password</span></span>
<span id="cb100-30"><a href="#cb100-30" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> isPasswordCorrect <span class="op">=</span> <span class="cf">await</span> bcrypt<span class="op">.</span><span class="fu">compare</span>(</span>
<span id="cb100-31"><a href="#cb100-31" aria-hidden="true" tabindex="-1"></a>              credentials<span class="op">.</span><span class="at">password</span><span class="op">,</span></span>
<span id="cb100-32"><a href="#cb100-32" aria-hidden="true" tabindex="-1"></a>              user<span class="op">.</span><span class="at">password</span><span class="op">!</span></span>
<span id="cb100-33"><a href="#cb100-33" aria-hidden="true" tabindex="-1"></a>            )<span class="op">;</span></span>
<span id="cb100-34"><a href="#cb100-34" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb100-35"><a href="#cb100-35" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (isPasswordCorrect) {</span>
<span id="cb100-36"><a href="#cb100-36" aria-hidden="true" tabindex="-1"></a>              <span class="cf">return</span> {</span>
<span id="cb100-37"><a href="#cb100-37" aria-hidden="true" tabindex="-1"></a>                id<span class="op">:</span> user<span class="op">.</span><span class="at">id</span><span class="op">,</span></span>
<span id="cb100-38"><a href="#cb100-38" aria-hidden="true" tabindex="-1"></a>                email<span class="op">:</span> user<span class="op">.</span><span class="at">email</span><span class="op">,</span></span>
<span id="cb100-39"><a href="#cb100-39" aria-hidden="true" tabindex="-1"></a>                role<span class="op">:</span> user<span class="op">.</span><span class="at">role</span><span class="op">,</span></span>
<span id="cb100-40"><a href="#cb100-40" aria-hidden="true" tabindex="-1"></a>              }<span class="op">;</span></span>
<span id="cb100-41"><a href="#cb100-41" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb100-42"><a href="#cb100-42" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb100-43"><a href="#cb100-43" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">catch</span> (err<span class="op">:</span> <span class="dt">any</span>) {</span>
<span id="cb100-44"><a href="#cb100-44" aria-hidden="true" tabindex="-1"></a>          <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(err)<span class="op">;</span></span>
<span id="cb100-45"><a href="#cb100-45" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb100-46"><a href="#cb100-46" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb100-47"><a href="#cb100-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span> <span class="co">// Login failed</span></span>
<span id="cb100-48"><a href="#cb100-48" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb100-49"><a href="#cb100-49" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb100-50"><a href="#cb100-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb100-51"><a href="#cb100-51" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 2. GitHub OAuth (Opsional)</span></span>
<span id="cb100-52"><a href="#cb100-52" aria-hidden="true" tabindex="-1"></a>    <span class="co">// GithubProvider({</span></span>
<span id="cb100-53"><a href="#cb100-53" aria-hidden="true" tabindex="-1"></a>    <span class="co">//   clientId: process.env.GITHUB_ID!,</span></span>
<span id="cb100-54"><a href="#cb100-54" aria-hidden="true" tabindex="-1"></a>    <span class="co">//   clientSecret: process.env.GITHUB_SECRET!,</span></span>
<span id="cb100-55"><a href="#cb100-55" aria-hidden="true" tabindex="-1"></a>    <span class="co">// }),</span></span>
<span id="cb100-56"><a href="#cb100-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb100-57"><a href="#cb100-57" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 3. Google OAuth (Opsional)</span></span>
<span id="cb100-58"><a href="#cb100-58" aria-hidden="true" tabindex="-1"></a>    <span class="co">// GoogleProvider({</span></span>
<span id="cb100-59"><a href="#cb100-59" aria-hidden="true" tabindex="-1"></a>    <span class="co">//   clientId: process.env.GOOGLE_CLIENT_ID!,</span></span>
<span id="cb100-60"><a href="#cb100-60" aria-hidden="true" tabindex="-1"></a>    <span class="co">//   clientSecret: process.env.GOOGLE_CLIENT_SECRET!,</span></span>
<span id="cb100-61"><a href="#cb100-61" aria-hidden="true" tabindex="-1"></a>    <span class="co">// }),</span></span>
<span id="cb100-62"><a href="#cb100-62" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb100-63"><a href="#cb100-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-64"><a href="#cb100-64" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Callbacks</span></span>
<span id="cb100-65"><a href="#cb100-65" aria-hidden="true" tabindex="-1"></a>  callbacks<span class="op">:</span> {</span>
<span id="cb100-66"><a href="#cb100-66" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Called on successful sign in</span></span>
<span id="cb100-67"><a href="#cb100-67" aria-hidden="true" tabindex="-1"></a>    <span class="kw">async</span> <span class="fu">signIn</span>({ user<span class="op">,</span> account }<span class="op">:</span> { user<span class="op">:</span> AuthUser<span class="op">;</span> account<span class="op">:</span> Account }) {</span>
<span id="cb100-68"><a href="#cb100-68" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (account<span class="op">?.</span><span class="at">provider</span> <span class="op">===</span> <span class="st">&quot;credentials&quot;</span>) {</span>
<span id="cb100-69"><a href="#cb100-69" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb100-70"><a href="#cb100-70" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb100-71"><a href="#cb100-71" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb100-72"><a href="#cb100-72" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Handle OAuth providers (GitHub, Google)</span></span>
<span id="cb100-73"><a href="#cb100-73" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (account<span class="op">?.</span><span class="at">provider</span> <span class="op">===</span> <span class="st">&quot;github&quot;</span> <span class="op">||</span> account<span class="op">?.</span><span class="at">provider</span> <span class="op">===</span> <span class="st">&quot;google&quot;</span>) {</span>
<span id="cb100-74"><a href="#cb100-74" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span> {</span>
<span id="cb100-75"><a href="#cb100-75" aria-hidden="true" tabindex="-1"></a>          <span class="co">// Check if user exists</span></span>
<span id="cb100-76"><a href="#cb100-76" aria-hidden="true" tabindex="-1"></a>          <span class="kw">const</span> existingUser <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">user</span><span class="op">.</span><span class="fu">findFirst</span>({</span>
<span id="cb100-77"><a href="#cb100-77" aria-hidden="true" tabindex="-1"></a>            where<span class="op">:</span> { email<span class="op">:</span> user<span class="op">.</span><span class="at">email</span><span class="op">!</span> }<span class="op">,</span></span>
<span id="cb100-78"><a href="#cb100-78" aria-hidden="true" tabindex="-1"></a>          })<span class="op">;</span></span>
<span id="cb100-79"><a href="#cb100-79" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb100-80"><a href="#cb100-80" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="op">!</span>existingUser) {</span>
<span id="cb100-81"><a href="#cb100-81" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Create new user for OAuth</span></span>
<span id="cb100-82"><a href="#cb100-82" aria-hidden="true" tabindex="-1"></a>            <span class="cf">await</span> prisma<span class="op">.</span><span class="at">user</span><span class="op">.</span><span class="fu">create</span>({</span>
<span id="cb100-83"><a href="#cb100-83" aria-hidden="true" tabindex="-1"></a>              data<span class="op">:</span> {</span>
<span id="cb100-84"><a href="#cb100-84" aria-hidden="true" tabindex="-1"></a>                id<span class="op">:</span> <span class="fu">nanoid</span>()<span class="op">,</span></span>
<span id="cb100-85"><a href="#cb100-85" aria-hidden="true" tabindex="-1"></a>                email<span class="op">:</span> user<span class="op">.</span><span class="at">email</span><span class="op">!,</span></span>
<span id="cb100-86"><a href="#cb100-86" aria-hidden="true" tabindex="-1"></a>                role<span class="op">:</span> <span class="st">&quot;user&quot;</span><span class="op">,</span> <span class="co">// Default role</span></span>
<span id="cb100-87"><a href="#cb100-87" aria-hidden="true" tabindex="-1"></a>                password<span class="op">:</span> <span class="dt">null</span><span class="op">,</span> <span class="co">// OAuth users don&#39;t have passwords</span></span>
<span id="cb100-88"><a href="#cb100-88" aria-hidden="true" tabindex="-1"></a>              }<span class="op">,</span></span>
<span id="cb100-89"><a href="#cb100-89" aria-hidden="true" tabindex="-1"></a>            })<span class="op">;</span></span>
<span id="cb100-90"><a href="#cb100-90" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb100-91"><a href="#cb100-91" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb100-92"><a href="#cb100-92" aria-hidden="true" tabindex="-1"></a>          <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb100-93"><a href="#cb100-93" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">catch</span> (error) {</span>
<span id="cb100-94"><a href="#cb100-94" aria-hidden="true" tabindex="-1"></a>          <span class="bu">console</span><span class="op">.</span><span class="fu">error</span>(<span class="st">&quot;Error in signIn callback:&quot;</span><span class="op">,</span> error)<span class="op">;</span></span>
<span id="cb100-95"><a href="#cb100-95" aria-hidden="true" tabindex="-1"></a>          <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb100-96"><a href="#cb100-96" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb100-97"><a href="#cb100-97" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb100-98"><a href="#cb100-98" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb100-99"><a href="#cb100-99" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb100-100"><a href="#cb100-100" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb100-101"><a href="#cb100-101" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb100-102"><a href="#cb100-102" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Called whenever a JWT is created or updated</span></span>
<span id="cb100-103"><a href="#cb100-103" aria-hidden="true" tabindex="-1"></a>    <span class="kw">async</span> <span class="fu">jwt</span>({ token<span class="op">,</span> user }) {</span>
<span id="cb100-104"><a href="#cb100-104" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (user) {</span>
<span id="cb100-105"><a href="#cb100-105" aria-hidden="true" tabindex="-1"></a>        token<span class="op">.</span><span class="at">role</span> <span class="op">=</span> user<span class="op">.</span><span class="at">role</span><span class="op">;</span></span>
<span id="cb100-106"><a href="#cb100-106" aria-hidden="true" tabindex="-1"></a>        token<span class="op">.</span><span class="at">id</span> <span class="op">=</span> user<span class="op">.</span><span class="at">id</span><span class="op">;</span></span>
<span id="cb100-107"><a href="#cb100-107" aria-hidden="true" tabindex="-1"></a>        token<span class="op">.</span><span class="at">iat</span> <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(<span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>() <span class="op">/</span> <span class="dv">1000</span>)<span class="op">;</span> <span class="co">// Issued at time</span></span>
<span id="cb100-108"><a href="#cb100-108" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb100-109"><a href="#cb100-109" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb100-110"><a href="#cb100-110" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Check if token is expired (15 minutes)</span></span>
<span id="cb100-111"><a href="#cb100-111" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> now <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(<span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>() <span class="op">/</span> <span class="dv">1000</span>)<span class="op">;</span></span>
<span id="cb100-112"><a href="#cb100-112" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> tokenAge <span class="op">=</span> now <span class="op">-</span> (token<span class="op">.</span><span class="at">iat</span> <span class="im">as</span> <span class="dt">number</span>)<span class="op">;</span></span>
<span id="cb100-113"><a href="#cb100-113" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> maxAge <span class="op">=</span> <span class="dv">15</span> <span class="op">*</span> <span class="dv">60</span><span class="op">;</span> <span class="co">// 15 minutes</span></span>
<span id="cb100-114"><a href="#cb100-114" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb100-115"><a href="#cb100-115" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (tokenAge <span class="op">&gt;</span> maxAge) {</span>
<span id="cb100-116"><a href="#cb100-116" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Token expired, force re-authentication</span></span>
<span id="cb100-117"><a href="#cb100-117" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {}<span class="op">;</span></span>
<span id="cb100-118"><a href="#cb100-118" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb100-119"><a href="#cb100-119" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb100-120"><a href="#cb100-120" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> token<span class="op">;</span></span>
<span id="cb100-121"><a href="#cb100-121" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb100-122"><a href="#cb100-122" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb100-123"><a href="#cb100-123" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Called whenever session is checked</span></span>
<span id="cb100-124"><a href="#cb100-124" aria-hidden="true" tabindex="-1"></a>    <span class="kw">async</span> <span class="fu">session</span>({ session<span class="op">,</span> token }) {</span>
<span id="cb100-125"><a href="#cb100-125" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (token) {</span>
<span id="cb100-126"><a href="#cb100-126" aria-hidden="true" tabindex="-1"></a>        session<span class="op">.</span><span class="at">user</span><span class="op">.</span><span class="at">role</span> <span class="op">=</span> token<span class="op">.</span><span class="at">role</span> <span class="im">as</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb100-127"><a href="#cb100-127" aria-hidden="true" tabindex="-1"></a>        session<span class="op">.</span><span class="at">user</span><span class="op">.</span><span class="at">id</span> <span class="op">=</span> token<span class="op">.</span><span class="at">id</span> <span class="im">as</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb100-128"><a href="#cb100-128" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb100-129"><a href="#cb100-129" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> session<span class="op">;</span></span>
<span id="cb100-130"><a href="#cb100-130" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb100-131"><a href="#cb100-131" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb100-132"><a href="#cb100-132" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-133"><a href="#cb100-133" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Pages</span></span>
<span id="cb100-134"><a href="#cb100-134" aria-hidden="true" tabindex="-1"></a>  pages<span class="op">:</span> {</span>
<span id="cb100-135"><a href="#cb100-135" aria-hidden="true" tabindex="-1"></a>    signIn<span class="op">:</span> <span class="st">&#39;/login&#39;</span><span class="op">,</span></span>
<span id="cb100-136"><a href="#cb100-136" aria-hidden="true" tabindex="-1"></a>    error<span class="op">:</span> <span class="st">&#39;/login&#39;</span><span class="op">,</span> <span class="co">// Redirect to login on errors</span></span>
<span id="cb100-137"><a href="#cb100-137" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb100-138"><a href="#cb100-138" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-139"><a href="#cb100-139" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Session configuration</span></span>
<span id="cb100-140"><a href="#cb100-140" aria-hidden="true" tabindex="-1"></a>  session<span class="op">:</span> {</span>
<span id="cb100-141"><a href="#cb100-141" aria-hidden="true" tabindex="-1"></a>    strategy<span class="op">:</span> <span class="st">&quot;jwt&quot;</span><span class="op">,</span></span>
<span id="cb100-142"><a href="#cb100-142" aria-hidden="true" tabindex="-1"></a>    maxAge<span class="op">:</span> <span class="dv">15</span> <span class="op">*</span> <span class="dv">60</span><span class="op">,</span> <span class="co">// 15 minutes</span></span>
<span id="cb100-143"><a href="#cb100-143" aria-hidden="true" tabindex="-1"></a>    updateAge<span class="op">:</span> <span class="dv">5</span> <span class="op">*</span> <span class="dv">60</span><span class="op">,</span> <span class="co">// Update every 5 minutes</span></span>
<span id="cb100-144"><a href="#cb100-144" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb100-145"><a href="#cb100-145" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-146"><a href="#cb100-146" aria-hidden="true" tabindex="-1"></a>  <span class="co">// JWT configuration</span></span>
<span id="cb100-147"><a href="#cb100-147" aria-hidden="true" tabindex="-1"></a>  jwt<span class="op">:</span> {</span>
<span id="cb100-148"><a href="#cb100-148" aria-hidden="true" tabindex="-1"></a>    maxAge<span class="op">:</span> <span class="dv">15</span> <span class="op">*</span> <span class="dv">60</span><span class="op">,</span> <span class="co">// 15 minutes</span></span>
<span id="cb100-149"><a href="#cb100-149" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb100-150"><a href="#cb100-150" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-151"><a href="#cb100-151" aria-hidden="true" tabindex="-1"></a>  secret<span class="op">:</span> <span class="bu">process</span><span class="op">.</span><span class="at">env</span><span class="op">.</span><span class="at">NEXTAUTH_SECRET</span><span class="op">,</span></span>
<span id="cb100-152"><a href="#cb100-152" aria-hidden="true" tabindex="-1"></a>  debug<span class="op">:</span> <span class="bu">process</span><span class="op">.</span><span class="at">env</span><span class="op">.</span><span class="at">NODE_ENV</span> <span class="op">===</span> <span class="st">&quot;development&quot;</span><span class="op">,</span></span>
<span id="cb100-153"><a href="#cb100-153" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb100-154"><a href="#cb100-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-155"><a href="#cb100-155" aria-hidden="true" tabindex="-1"></a><span class="co">// Export handlers for GET and POST</span></span>
<span id="cb100-156"><a href="#cb100-156" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> handler <span class="op">=</span> <span class="fu">NextAuth</span>(authOptions)<span class="op">;</span></span>
<span id="cb100-157"><a href="#cb100-157" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> { handler <span class="im">as</span> GET<span class="op">,</span> handler <span class="im">as</span> POST }<span class="op">;</span></span></code></pre></div>
<h3 id="nextauth-provider-wrapper">4. NextAuth Provider Wrapper</h3>
<p><strong>Lokasi:</strong> <code>Providers.tsx</code></p>
<pre class="tsx"><code>&quot;use client&quot;;
import { SessionProvider } from &quot;next-auth/react&quot;;
import { Toaster } from &quot;react-hot-toast&quot;;

export function Providers({ children }: { children: React.ReactNode }) {
  return (
    &lt;SessionProvider&gt;
      {children}
      &lt;Toaster position=&quot;top-right&quot; /&gt;
    &lt;/SessionProvider&gt;
  );
}</code></pre>
<p><strong>Digunakan di Root Layout:</strong></p>
<pre class="tsx"><code>// app/layout.tsx
import { Providers } from &quot;@/Providers&quot;;

export default function RootLayout({ children }) {
  return (
    &lt;html lang=&quot;en&quot;&gt;
      &lt;body&gt;
        &lt;Providers&gt;
          {children}
        &lt;/Providers&gt;
      &lt;/body&gt;
    &lt;/html&gt;
  );
}</code></pre>
<hr />
<h2 id="credential-provider">🔑 Credential Provider</h2>
<h3 id="register-new-user">Register New User</h3>
<p><strong>Lokasi:</strong> <code>app/api/register/route.ts</code></p>
<div class="sourceCode" id="cb103"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { NextRequest<span class="op">,</span> NextResponse } <span class="im">from</span> <span class="st">&quot;next/server&quot;</span><span class="op">;</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> prisma <span class="im">from</span> <span class="st">&quot;@/utils/db&quot;</span><span class="op">;</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> bcrypt <span class="im">from</span> <span class="st">&quot;bcryptjs&quot;</span><span class="op">;</span></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { nanoid } <span class="im">from</span> <span class="st">&quot;nanoid&quot;</span><span class="op">;</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { registrationSchema } <span class="im">from</span> <span class="st">&quot;@/utils/schema&quot;</span><span class="op">;</span></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { handleApiError } <span class="im">from</span> <span class="st">&quot;@/utils/errorHandler&quot;</span><span class="op">;</span></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { sanitizeInput } <span class="im">from</span> <span class="st">&quot;@/utils/validation&quot;</span><span class="op">;</span></span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">async</span> <span class="kw">function</span> <span class="fu">POST</span>(request<span class="op">:</span> NextRequest) {</span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span> {</span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 1. Parse &amp; validate request body</span></span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> body <span class="op">=</span> <span class="cf">await</span> sanitizeInput<span class="op">.</span><span class="fu">validateJsonInput</span>(request)<span class="op">;</span></span>
<span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-14"><a href="#cb103-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 2. Validate with Zod schema</span></span>
<span id="cb103-15"><a href="#cb103-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> validatedData <span class="op">=</span> registrationSchema<span class="op">.</span><span class="fu">parse</span>(body)<span class="op">;</span></span>
<span id="cb103-16"><a href="#cb103-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-17"><a href="#cb103-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 3. Check if user already exists</span></span>
<span id="cb103-18"><a href="#cb103-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> existingUser <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">user</span><span class="op">.</span><span class="fu">findFirst</span>({</span>
<span id="cb103-19"><a href="#cb103-19" aria-hidden="true" tabindex="-1"></a>      where<span class="op">:</span> { email<span class="op">:</span> validatedData<span class="op">.</span><span class="at">email</span> }<span class="op">,</span></span>
<span id="cb103-20"><a href="#cb103-20" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb103-21"><a href="#cb103-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-22"><a href="#cb103-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (existingUser) {</span>
<span id="cb103-23"><a href="#cb103-23" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">json</span>(</span>
<span id="cb103-24"><a href="#cb103-24" aria-hidden="true" tabindex="-1"></a>        { message<span class="op">:</span> <span class="st">&quot;User with this email already exists&quot;</span> }<span class="op">,</span></span>
<span id="cb103-25"><a href="#cb103-25" aria-hidden="true" tabindex="-1"></a>        { status<span class="op">:</span> <span class="dv">409</span> }</span>
<span id="cb103-26"><a href="#cb103-26" aria-hidden="true" tabindex="-1"></a>      )<span class="op">;</span></span>
<span id="cb103-27"><a href="#cb103-27" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb103-28"><a href="#cb103-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-29"><a href="#cb103-29" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 4. Hash password</span></span>
<span id="cb103-30"><a href="#cb103-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> hashedPassword <span class="op">=</span> <span class="cf">await</span> bcrypt<span class="op">.</span><span class="fu">hash</span>(validatedData<span class="op">.</span><span class="at">password</span><span class="op">,</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb103-31"><a href="#cb103-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-32"><a href="#cb103-32" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 5. Create user</span></span>
<span id="cb103-33"><a href="#cb103-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> newUser <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">user</span><span class="op">.</span><span class="fu">create</span>({</span>
<span id="cb103-34"><a href="#cb103-34" aria-hidden="true" tabindex="-1"></a>      data<span class="op">:</span> {</span>
<span id="cb103-35"><a href="#cb103-35" aria-hidden="true" tabindex="-1"></a>        id<span class="op">:</span> <span class="fu">nanoid</span>()<span class="op">,</span></span>
<span id="cb103-36"><a href="#cb103-36" aria-hidden="true" tabindex="-1"></a>        email<span class="op">:</span> validatedData<span class="op">.</span><span class="at">email</span><span class="op">,</span></span>
<span id="cb103-37"><a href="#cb103-37" aria-hidden="true" tabindex="-1"></a>        password<span class="op">:</span> hashedPassword<span class="op">,</span></span>
<span id="cb103-38"><a href="#cb103-38" aria-hidden="true" tabindex="-1"></a>        role<span class="op">:</span> <span class="st">&quot;user&quot;</span><span class="op">,</span> <span class="co">// Default role</span></span>
<span id="cb103-39"><a href="#cb103-39" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb103-40"><a href="#cb103-40" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb103-41"><a href="#cb103-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-42"><a href="#cb103-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">json</span>(</span>
<span id="cb103-43"><a href="#cb103-43" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb103-44"><a href="#cb103-44" aria-hidden="true" tabindex="-1"></a>        message<span class="op">:</span> <span class="st">&quot;User registered successfully&quot;</span><span class="op">,</span></span>
<span id="cb103-45"><a href="#cb103-45" aria-hidden="true" tabindex="-1"></a>        user<span class="op">:</span> {</span>
<span id="cb103-46"><a href="#cb103-46" aria-hidden="true" tabindex="-1"></a>          id<span class="op">:</span> newUser<span class="op">.</span><span class="at">id</span><span class="op">,</span></span>
<span id="cb103-47"><a href="#cb103-47" aria-hidden="true" tabindex="-1"></a>          email<span class="op">:</span> newUser<span class="op">.</span><span class="at">email</span><span class="op">,</span></span>
<span id="cb103-48"><a href="#cb103-48" aria-hidden="true" tabindex="-1"></a>          role<span class="op">:</span> newUser<span class="op">.</span><span class="at">role</span><span class="op">,</span></span>
<span id="cb103-49"><a href="#cb103-49" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb103-50"><a href="#cb103-50" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb103-51"><a href="#cb103-51" aria-hidden="true" tabindex="-1"></a>      { status<span class="op">:</span> <span class="dv">201</span> }</span>
<span id="cb103-52"><a href="#cb103-52" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb103-53"><a href="#cb103-53" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">catch</span> (error) {</span>
<span id="cb103-54"><a href="#cb103-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">handleApiError</span>(error)<span class="op">;</span></span>
<span id="cb103-55"><a href="#cb103-55" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb103-56"><a href="#cb103-56" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="login-page">Login Page</h3>
<p><strong>Lokasi:</strong> <code>app/login/page.tsx</code></p>
<pre class="tsx"><code>&quot;use client&quot;;
import { useState } from &quot;react&quot;;
import { signIn } from &quot;next-auth/react&quot;;
import { useRouter } from &quot;next/navigation&quot;;
import toast from &quot;react-hot-toast&quot;;

export default function LoginPage() {
  const router = useRouter();
  const [isLoading, setIsLoading] = useState(false);
  
  const handleSubmit = async (e: React.FormEvent&lt;HTMLFormElement&gt;) =&gt; {
    e.preventDefault();
    setIsLoading(true);
    
    const formData = new FormData(e.currentTarget);
    const email = formData.get(&quot;email&quot;) as string;
    const password = formData.get(&quot;password&quot;) as string;
    
    try {
      const result = await signIn(&quot;credentials&quot;, {
        email,
        password,
        redirect: false, // Don&#39;t auto redirect
      });
      
      if (result?.error) {
        toast.error(&quot;Invalid email or password&quot;);
      } else {
        toast.success(&quot;Login successful!&quot;);
        router.push(&quot;/&quot;); // Redirect to homepage
        router.refresh();
      }
    } catch (error) {
      toast.error(&quot;An error occurred&quot;);
    } finally {
      setIsLoading(false);
    }
  };
  
  return (
    &lt;div className=&quot;min-h-screen flex items-center justify-center&quot;&gt;
      &lt;div className=&quot;max-w-md w-full&quot;&gt;
        &lt;h1 className=&quot;text-3xl font-bold text-center mb-8&quot;&gt;Login&lt;/h1&gt;
        
        &lt;form onSubmit={handleSubmit} className=&quot;space-y-6&quot;&gt;
          &lt;div&gt;
            &lt;label htmlFor=&quot;email&quot; className=&quot;block text-sm font-medium&quot;&gt;
              Email address
            &lt;/label&gt;
            &lt;input
              id=&quot;email&quot;
              name=&quot;email&quot;
              type=&quot;email&quot;
              required
              className=&quot;mt-1 block w-full rounded-md border px-3 py-2&quot;
            /&gt;
          &lt;/div&gt;
          
          &lt;div&gt;
            &lt;label htmlFor=&quot;password&quot; className=&quot;block text-sm font-medium&quot;&gt;
              Password
            &lt;/label&gt;
            &lt;input
              id=&quot;password&quot;
              name=&quot;password&quot;
              type=&quot;password&quot;
              required
              className=&quot;mt-1 block w-full rounded-md border px-3 py-2&quot;
            /&gt;
          &lt;/div&gt;
          
          &lt;button
            type=&quot;submit&quot;
            disabled={isLoading}
            className=&quot;w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 disabled:opacity-50&quot;
          &gt;
            {isLoading ? &quot;Loading...&quot; : &quot;Sign In&quot;}
          &lt;/button&gt;
        &lt;/form&gt;
        
        &lt;p className=&quot;mt-4 text-center text-sm&quot;&gt;
          Don&#39;t have an account?{&quot; &quot;}
          &lt;a href=&quot;/register&quot; className=&quot;text-blue-600 hover:underline&quot;&gt;
            Register here
          &lt;/a&gt;
        &lt;/p&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
}</code></pre>
<h3 id="register-page">Register Page</h3>
<p><strong>Lokasi:</strong> <code>app/register/page.tsx</code></p>
<pre class="tsx"><code>&quot;use client&quot;;
import { useState } from &quot;react&quot;;
import { useRouter } from &quot;next/navigation&quot;;
import toast from &quot;react-hot-toast&quot;;
import apiClient from &quot;@/lib/api&quot;;

export default function RegisterPage() {
  const router = useRouter();
  const [isLoading, setIsLoading] = useState(false);
  
  const handleSubmit = async (e: React.FormEvent&lt;HTMLFormElement&gt;) =&gt; {
    e.preventDefault();
    setIsLoading(true);
    
    const formData = new FormData(e.currentTarget);
    const email = formData.get(&quot;email&quot;) as string;
    const password = formData.get(&quot;password&quot;) as string;
    
    try {
      const response = await apiClient.post(&quot;/api/register&quot;, {
        email,
        password,
      });
      
      if (response.ok) {
        toast.success(&quot;Registration successful! Please login.&quot;);
        router.push(&quot;/login&quot;);
      } else {
        const data = await response.json();
        toast.error(data.message || &quot;Registration failed&quot;);
      }
    } catch (error) {
      toast.error(&quot;An error occurred&quot;);
    } finally {
      setIsLoading(false);
    }
  };
  
  return (
    &lt;div className=&quot;min-h-screen flex items-center justify-center&quot;&gt;
      &lt;div className=&quot;max-w-md w-full&quot;&gt;
        &lt;h1 className=&quot;text-3xl font-bold text-center mb-8&quot;&gt;Register&lt;/h1&gt;
        
        &lt;form onSubmit={handleSubmit} className=&quot;space-y-6&quot;&gt;
          &lt;div&gt;
            &lt;label htmlFor=&quot;email&quot; className=&quot;block text-sm font-medium&quot;&gt;
              Email address
            &lt;/label&gt;
            &lt;input
              id=&quot;email&quot;
              name=&quot;email&quot;
              type=&quot;email&quot;
              required
              className=&quot;mt-1 block w-full rounded-md border px-3 py-2&quot;
            /&gt;
            &lt;p className=&quot;mt-1 text-xs text-gray-500&quot;&gt;
              Must be a valid email address
            &lt;/p&gt;
          &lt;/div&gt;
          
          &lt;div&gt;
            &lt;label htmlFor=&quot;password&quot; className=&quot;block text-sm font-medium&quot;&gt;
              Password
            &lt;/label&gt;
            &lt;input
              id=&quot;password&quot;
              name=&quot;password&quot;
              type=&quot;password&quot;
              required
              minLength={8}
              className=&quot;mt-1 block w-full rounded-md border px-3 py-2&quot;
            /&gt;
            &lt;p className=&quot;mt-1 text-xs text-gray-500&quot;&gt;
              Must be at least 8 characters with uppercase, lowercase, number, and special character
            &lt;/p&gt;
          &lt;/div&gt;
          
          &lt;button
            type=&quot;submit&quot;
            disabled={isLoading}
            className=&quot;w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 disabled:opacity-50&quot;
          &gt;
            {isLoading ? &quot;Loading...&quot; : &quot;Register&quot;}
          &lt;/button&gt;
        &lt;/form&gt;
        
        &lt;p className=&quot;mt-4 text-center text-sm&quot;&gt;
          Already have an account?{&quot; &quot;}
          &lt;a href=&quot;/login&quot; className=&quot;text-blue-600 hover:underline&quot;&gt;
            Login here
          &lt;/a&gt;
        &lt;/p&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
}</code></pre>
<hr />
<h2 id="oauth-providers">🌐 OAuth Providers</h2>
<h3 id="github-oauth">1. GitHub OAuth</h3>
<h4 id="step-1-buat-github-oauth-app">Step 1: Buat GitHub OAuth App</h4>
<ol type="1">
<li>Pergi ke <a href="https://github.com/settings/developers">GitHub
Settings</a></li>
<li>Klik <strong>OAuth Apps</strong> → <strong>New OAuth
App</strong></li>
<li>Isi form:
<ul>
<li><strong>Application name</strong>: Your App Name</li>
<li><strong>Homepage URL</strong>:
<code>http://localhost:3000</code></li>
<li><strong>Authorization callback URL</strong>:
<code>http://localhost:3000/api/auth/callback/github</code></li>
</ul></li>
<li>Klik <strong>Register application</strong></li>
<li>Copy <strong>Client ID</strong> dan generate <strong>Client
Secret</strong></li>
</ol>
<h4 id="step-2-tambahkan-ke-.env">Step 2: Tambahkan ke
<code>.env</code></h4>
<pre class="env"><code>GITHUB_ID=&quot;your-github-client-id&quot;
GITHUB_SECRET=&quot;your-github-client-secret&quot;</code></pre>
<h4 id="step-3-aktifkan-provider">Step 3: Aktifkan Provider</h4>
<div class="sourceCode" id="cb107"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co">// app/api/auth/[...nextauth]/route.ts</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="fu">GithubProvider</span>({</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>  clientId<span class="op">:</span> <span class="bu">process</span><span class="op">.</span><span class="at">env</span><span class="op">.</span><span class="at">GITHUB_ID</span><span class="op">!,</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>  clientSecret<span class="op">:</span> <span class="bu">process</span><span class="op">.</span><span class="at">env</span><span class="op">.</span><span class="at">GITHUB_SECRET</span><span class="op">!,</span></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>})<span class="op">,</span></span></code></pre></div>
<h4 id="step-4-tambahkan-button-di-login-page">Step 4: Tambahkan Button
di Login Page</h4>
<pre class="tsx"><code>&lt;button onClick={() =&gt; signIn(&quot;github&quot;)}&gt;
  Sign in with GitHub
&lt;/button&gt;</code></pre>
<h3 id="google-oauth">2. Google OAuth</h3>
<h4 id="step-1-buat-google-oauth-credentials">Step 1: Buat Google OAuth
Credentials</h4>
<ol type="1">
<li>Pergi ke <a href="https://console.cloud.google.com/">Google Cloud
Console</a></li>
<li>Buat project baru atau pilih existing</li>
<li>Enable <strong>Google+ API</strong></li>
<li>Pergi ke <strong>Credentials</strong> → <strong>Create
Credentials</strong> → <strong>OAuth client ID</strong></li>
<li>Application type: <strong>Web application</strong></li>
<li>Authorized redirect URIs:
<ul>
<li><code>http://localhost:3000/api/auth/callback/google</code></li>
</ul></li>
<li>Copy <strong>Client ID</strong> dan <strong>Client
Secret</strong></li>
</ol>
<h4 id="step-2-tambahkan-ke-.env-1">Step 2: Tambahkan ke
<code>.env</code></h4>
<pre class="env"><code>GOOGLE_CLIENT_ID=&quot;your-google-client-id&quot;
GOOGLE_CLIENT_SECRET=&quot;your-google-client-secret&quot;</code></pre>
<h4 id="step-3-aktifkan-provider-1">Step 3: Aktifkan Provider</h4>
<div class="sourceCode" id="cb110"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co">// app/api/auth/[...nextauth]/route.ts</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="fu">GoogleProvider</span>({</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>  clientId<span class="op">:</span> <span class="bu">process</span><span class="op">.</span><span class="at">env</span><span class="op">.</span><span class="at">GOOGLE_CLIENT_ID</span><span class="op">!,</span></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>  clientSecret<span class="op">:</span> <span class="bu">process</span><span class="op">.</span><span class="at">env</span><span class="op">.</span><span class="at">GOOGLE_CLIENT_SECRET</span><span class="op">!,</span></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>})<span class="op">,</span></span></code></pre></div>
<h4 id="step-4-tambahkan-button-di-login-page-1">Step 4: Tambahkan
Button di Login Page</h4>
<pre class="tsx"><code>&lt;button onClick={() =&gt; signIn(&quot;google&quot;)}&gt;
  Sign in with Google
&lt;/button&gt;</code></pre>
<hr />
<h2 id="jwt-tokens-session">🎫 JWT Tokens &amp; Session</h2>
<h3 id="jwt-token-structure">JWT Token Structure</h3>
<div class="sourceCode" id="cb112"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;user&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;email&quot;</span><span class="fu">:</span> <span class="st">&quot;user@example.com&quot;</span><span class="fu">,</span></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;abc123&quot;</span><span class="fu">,</span></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;role&quot;</span><span class="fu">:</span> <span class="st">&quot;user&quot;</span></span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;iat&quot;</span><span class="fu">:</span> <span class="dv">1704067200</span><span class="fu">,</span>  <span class="er">//</span> <span class="er">Issued</span> <span class="er">at</span> <span class="er">(timestamp)</span></span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;exp&quot;</span><span class="fu">:</span> <span class="dv">1704068100</span><span class="fu">,</span>  <span class="er">//</span> <span class="er">Expires</span> <span class="er">at</span> <span class="er">(15</span> <span class="er">minutes</span> <span class="er">later)</span></span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;jti&quot;</span><span class="fu">:</span> <span class="st">&quot;xyz789&quot;</span>     <span class="er">//</span> <span class="er">JWT</span> <span class="er">ID</span> <span class="er">(unique)</span></span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h3 id="jwt-callback-token-creation">JWT Callback (Token Creation)</h3>
<div class="sourceCode" id="cb113"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="kw">async</span> <span class="fu">jwt</span>({ token<span class="op">,</span> user }) {</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (user) {</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// First time JWT created (login)</span></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>    token<span class="op">.</span><span class="at">role</span> <span class="op">=</span> user<span class="op">.</span><span class="at">role</span><span class="op">;</span></span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>    token<span class="op">.</span><span class="at">id</span> <span class="op">=</span> user<span class="op">.</span><span class="at">id</span><span class="op">;</span></span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>    token<span class="op">.</span><span class="at">iat</span> <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(<span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>() <span class="op">/</span> <span class="dv">1000</span>)<span class="op">;</span></span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Check token expiration</span></span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> now <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(<span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>() <span class="op">/</span> <span class="dv">1000</span>)<span class="op">;</span></span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> tokenAge <span class="op">=</span> now <span class="op">-</span> (token<span class="op">.</span><span class="at">iat</span> <span class="im">as</span> <span class="dt">number</span>)<span class="op">;</span></span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> maxAge <span class="op">=</span> <span class="dv">15</span> <span class="op">*</span> <span class="dv">60</span><span class="op">;</span> <span class="co">// 15 minutes</span></span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb113-14"><a href="#cb113-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (tokenAge <span class="op">&gt;</span> maxAge) {</span>
<span id="cb113-15"><a href="#cb113-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Token expired, return empty to force re-login</span></span>
<span id="cb113-16"><a href="#cb113-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {}<span class="op">;</span></span>
<span id="cb113-17"><a href="#cb113-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb113-18"><a href="#cb113-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb113-19"><a href="#cb113-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> token<span class="op">;</span></span>
<span id="cb113-20"><a href="#cb113-20" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="session-callback-session-access">Session Callback (Session
Access)</h3>
<div class="sourceCode" id="cb114"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="kw">async</span> <span class="fu">session</span>({ session<span class="op">,</span> token }) {</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (token) {</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Add custom fields to session</span></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>    session<span class="op">.</span><span class="at">user</span><span class="op">.</span><span class="at">role</span> <span class="op">=</span> token<span class="op">.</span><span class="at">role</span> <span class="im">as</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>    session<span class="op">.</span><span class="at">user</span><span class="op">.</span><span class="at">id</span> <span class="op">=</span> token<span class="op">.</span><span class="at">id</span> <span class="im">as</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> session<span class="op">;</span></span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="accessing-session-in-components">Accessing Session in
Components</h3>
<h4 id="client-component">Client Component:</h4>
<pre class="tsx"><code>&quot;use client&quot;;
import { useSession } from &quot;next-auth/react&quot;;

export default function MyComponent() {
  const { data: session, status } = useSession();
  
  if (status === &quot;loading&quot;) {
    return &lt;p&gt;Loading...&lt;/p&gt;;
  }
  
  if (status === &quot;unauthenticated&quot;) {
    return &lt;p&gt;Please login&lt;/p&gt;;
  }
  
  return (
    &lt;div&gt;
      &lt;p&gt;Welcome, {session?.user?.email}&lt;/p&gt;
      &lt;p&gt;Role: {session?.user?.role}&lt;/p&gt;
    &lt;/div&gt;
  );
}</code></pre>
<h4 id="server-component">Server Component:</h4>
<pre class="tsx"><code>import { getServerSession } from &quot;next-auth&quot;;
import { authOptions } from &quot;@/app/api/auth/[...nextauth]/route&quot;;

export default async function MyServerComponent() {
  const session = await getServerSession(authOptions);
  
  if (!session) {
    return &lt;p&gt;Not authenticated&lt;/p&gt;;
  }
  
  return (
    &lt;div&gt;
      &lt;p&gt;Welcome, {session.user?.email}&lt;/p&gt;
      &lt;p&gt;Role: {session.user?.role}&lt;/p&gt;
    &lt;/div&gt;
  );
}</code></pre>
<hr />
<h2 id="session-timeout">⏱️ Session Timeout</h2>
<h3 id="configuration">Configuration</h3>
<p><strong>Session expires after 15 minutes of inactivity:</strong></p>
<div class="sourceCode" id="cb117"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co">// app/api/auth/[...nextauth]/route.ts</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>session<span class="op">:</span> {</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>  strategy<span class="op">:</span> <span class="st">&quot;jwt&quot;</span><span class="op">,</span></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>  maxAge<span class="op">:</span> <span class="dv">15</span> <span class="op">*</span> <span class="dv">60</span><span class="op">,</span> <span class="co">// 15 minutes</span></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>  updateAge<span class="op">:</span> <span class="dv">5</span> <span class="op">*</span> <span class="dv">60</span><span class="op">,</span> <span class="co">// Update every 5 minutes</span></span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span></span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>jwt<span class="op">:</span> {</span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a>  maxAge<span class="op">:</span> <span class="dv">15</span> <span class="op">*</span> <span class="dv">60</span><span class="op">,</span> <span class="co">// 15 minutes</span></span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span></span></code></pre></div>
<h3 id="custom-session-timeout-hook">Custom Session Timeout Hook</h3>
<p><strong>Lokasi:</strong> <code>hooks/useSessionTimeout.ts</code></p>
<div class="sourceCode" id="cb118"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { useEffect<span class="op">,</span> useCallback<span class="op">,</span> useState } <span class="im">from</span> <span class="st">&quot;react&quot;</span><span class="op">;</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { useSession<span class="op">,</span> signOut } <span class="im">from</span> <span class="st">&quot;next-auth/react&quot;</span><span class="op">;</span></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> toast <span class="im">from</span> <span class="st">&quot;react-hot-toast&quot;</span><span class="op">;</span></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> useSessionTimeout <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> { data<span class="op">:</span> session<span class="op">,</span> status } <span class="op">=</span> <span class="fu">useSession</span>()<span class="op">;</span></span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> [timeoutId<span class="op">,</span> setTimeoutId] <span class="op">=</span> <span class="fu">useState</span><span class="op">&lt;</span>NodeJS<span class="op">.</span><span class="at">Timeout</span> <span class="op">|</span> <span class="dt">null</span><span class="op">&gt;</span>(<span class="kw">null</span>)<span class="op">;</span></span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> TIMEOUT_DURATION <span class="op">=</span> <span class="dv">15</span> <span class="op">*</span> <span class="dv">60</span> <span class="op">*</span> <span class="dv">1000</span><span class="op">;</span> <span class="co">// 15 minutes</span></span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> WARNING_BEFORE <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> <span class="dv">60</span> <span class="op">*</span> <span class="dv">1000</span><span class="op">;</span> <span class="co">// Warn 2 minutes before</span></span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb118-12"><a href="#cb118-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> handleLogout <span class="op">=</span> <span class="fu">useCallback</span>(<span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb118-13"><a href="#cb118-13" aria-hidden="true" tabindex="-1"></a>    toast<span class="op">.</span><span class="fu">error</span>(<span class="st">&quot;Session expired. Please login again.&quot;</span>)<span class="op">;</span></span>
<span id="cb118-14"><a href="#cb118-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="fu">signOut</span>({ redirect<span class="op">:</span> <span class="kw">true</span><span class="op">,</span> callbackUrl<span class="op">:</span> <span class="st">&quot;/login&quot;</span> })<span class="op">;</span></span>
<span id="cb118-15"><a href="#cb118-15" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span> [])<span class="op">;</span></span>
<span id="cb118-16"><a href="#cb118-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb118-17"><a href="#cb118-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> resetTimer <span class="op">=</span> <span class="fu">useCallback</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb118-18"><a href="#cb118-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (timeoutId) {</span>
<span id="cb118-19"><a href="#cb118-19" aria-hidden="true" tabindex="-1"></a>      <span class="pp">clearTimeout</span>(timeoutId)<span class="op">;</span></span>
<span id="cb118-20"><a href="#cb118-20" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb118-21"><a href="#cb118-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb118-22"><a href="#cb118-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Show warning 2 minutes before timeout</span></span>
<span id="cb118-23"><a href="#cb118-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> warningTimeout <span class="op">=</span> <span class="pp">setTimeout</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb118-24"><a href="#cb118-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">toast</span>(<span class="st">&quot;Your session will expire in 2 minutes&quot;</span><span class="op">,</span> {</span>
<span id="cb118-25"><a href="#cb118-25" aria-hidden="true" tabindex="-1"></a>        icon<span class="op">:</span> <span class="st">&quot;⚠️&quot;</span><span class="op">,</span></span>
<span id="cb118-26"><a href="#cb118-26" aria-hidden="true" tabindex="-1"></a>        duration<span class="op">:</span> <span class="dv">5000</span><span class="op">,</span></span>
<span id="cb118-27"><a href="#cb118-27" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb118-28"><a href="#cb118-28" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span> TIMEOUT_DURATION <span class="op">-</span> WARNING_BEFORE)<span class="op">;</span></span>
<span id="cb118-29"><a href="#cb118-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb118-30"><a href="#cb118-30" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Logout after timeout</span></span>
<span id="cb118-31"><a href="#cb118-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> logoutTimeout <span class="op">=</span> <span class="pp">setTimeout</span>(handleLogout<span class="op">,</span> TIMEOUT_DURATION)<span class="op">;</span></span>
<span id="cb118-32"><a href="#cb118-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb118-33"><a href="#cb118-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setTimeoutId</span>(logoutTimeout)<span class="op">;</span></span>
<span id="cb118-34"><a href="#cb118-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb118-35"><a href="#cb118-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb118-36"><a href="#cb118-36" aria-hidden="true" tabindex="-1"></a>      <span class="pp">clearTimeout</span>(warningTimeout)<span class="op">;</span></span>
<span id="cb118-37"><a href="#cb118-37" aria-hidden="true" tabindex="-1"></a>      <span class="pp">clearTimeout</span>(logoutTimeout)<span class="op">;</span></span>
<span id="cb118-38"><a href="#cb118-38" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb118-39"><a href="#cb118-39" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span> [handleLogout<span class="op">,</span> timeoutId])<span class="op">;</span></span>
<span id="cb118-40"><a href="#cb118-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb118-41"><a href="#cb118-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">useEffect</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb118-42"><a href="#cb118-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (status <span class="op">===</span> <span class="st">&quot;authenticated&quot;</span>) {</span>
<span id="cb118-43"><a href="#cb118-43" aria-hidden="true" tabindex="-1"></a>      <span class="fu">resetTimer</span>()<span class="op">;</span></span>
<span id="cb118-44"><a href="#cb118-44" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb118-45"><a href="#cb118-45" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Reset timer on user activity</span></span>
<span id="cb118-46"><a href="#cb118-46" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> events <span class="op">=</span> [<span class="st">&quot;mousedown&quot;</span><span class="op">,</span> <span class="st">&quot;keypress&quot;</span><span class="op">,</span> <span class="st">&quot;scroll&quot;</span><span class="op">,</span> <span class="st">&quot;touchstart&quot;</span>]<span class="op">;</span></span>
<span id="cb118-47"><a href="#cb118-47" aria-hidden="true" tabindex="-1"></a>      events<span class="op">.</span><span class="fu">forEach</span>((<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb118-48"><a href="#cb118-48" aria-hidden="true" tabindex="-1"></a>        <span class="bu">document</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="bu">event</span><span class="op">,</span> resetTimer)<span class="op">;</span></span>
<span id="cb118-49"><a href="#cb118-49" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb118-50"><a href="#cb118-50" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb118-51"><a href="#cb118-51" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb118-52"><a href="#cb118-52" aria-hidden="true" tabindex="-1"></a>        events<span class="op">.</span><span class="fu">forEach</span>((<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb118-53"><a href="#cb118-53" aria-hidden="true" tabindex="-1"></a>          <span class="bu">document</span><span class="op">.</span><span class="fu">removeEventListener</span>(<span class="bu">event</span><span class="op">,</span> resetTimer)<span class="op">;</span></span>
<span id="cb118-54"><a href="#cb118-54" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb118-55"><a href="#cb118-55" aria-hidden="true" tabindex="-1"></a>      }<span class="op">;</span></span>
<span id="cb118-56"><a href="#cb118-56" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb118-57"><a href="#cb118-57" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span> [status<span class="op">,</span> resetTimer])<span class="op">;</span></span>
<span id="cb118-58"><a href="#cb118-58" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<p><strong>Usage:</strong></p>
<pre class="tsx"><code>&quot;use client&quot;;
import { useSessionTimeout } from &quot;@/hooks/useSessionTimeout&quot;;

export default function MyApp({ children }) {
  useSessionTimeout(); // Automatically handle session timeout
  
  return &lt;div&gt;{children}&lt;/div&gt;;
}</code></pre>
<hr />
<h2 id="middleware-protected-routes">🛡️ Middleware &amp; Protected
Routes</h2>
<h3 id="middleware-setup">Middleware Setup</h3>
<p><strong>Lokasi:</strong> <code>middleware.ts</code> (root
directory)</p>
<div class="sourceCode" id="cb120"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { withAuth } <span class="im">from</span> <span class="st">&quot;next-auth/middleware&quot;</span><span class="op">;</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { NextResponse } <span class="im">from</span> <span class="st">&quot;next/server&quot;</span><span class="op">;</span></span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="im">default</span> <span class="fu">withAuth</span>(</span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">middleware</span>(req) {</span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Check for admin routes</span></span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (req<span class="op">.</span><span class="at">nextUrl</span><span class="op">.</span><span class="at">pathname</span><span class="op">.</span><span class="fu">startsWith</span>(<span class="st">&quot;/admin&quot;</span>)) {</span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (req<span class="op">.</span><span class="at">nextauth</span><span class="op">.</span><span class="at">token</span><span class="op">?.</span><span class="at">role</span> <span class="op">!==</span> <span class="st">&quot;admin&quot;</span>) {</span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Not admin, redirect to homepage</span></span>
<span id="cb120-10"><a href="#cb120-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">redirect</span>(<span class="kw">new</span> <span class="fu">URL</span>(<span class="st">&quot;/&quot;</span><span class="op">,</span> req<span class="op">.</span><span class="at">url</span>))<span class="op">;</span></span>
<span id="cb120-11"><a href="#cb120-11" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb120-12"><a href="#cb120-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb120-13"><a href="#cb120-13" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb120-14"><a href="#cb120-14" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb120-15"><a href="#cb120-15" aria-hidden="true" tabindex="-1"></a>    callbacks<span class="op">:</span> {</span>
<span id="cb120-16"><a href="#cb120-16" aria-hidden="true" tabindex="-1"></a>      authorized<span class="op">:</span> ({ token<span class="op">,</span> req }) <span class="kw">=&gt;</span> {</span>
<span id="cb120-17"><a href="#cb120-17" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Admin routes require admin token</span></span>
<span id="cb120-18"><a href="#cb120-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (req<span class="op">.</span><span class="at">nextUrl</span><span class="op">.</span><span class="at">pathname</span><span class="op">.</span><span class="fu">startsWith</span>(<span class="st">&quot;/admin&quot;</span>)) {</span>
<span id="cb120-19"><a href="#cb120-19" aria-hidden="true" tabindex="-1"></a>          <span class="cf">return</span> <span class="op">!!</span>token <span class="op">&amp;&amp;</span> token<span class="op">.</span><span class="at">role</span> <span class="op">===</span> <span class="st">&quot;admin&quot;</span><span class="op">;</span></span>
<span id="cb120-20"><a href="#cb120-20" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb120-21"><a href="#cb120-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb120-22"><a href="#cb120-22" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb120-23"><a href="#cb120-23" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb120-24"><a href="#cb120-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb120-25"><a href="#cb120-25" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb120-26"><a href="#cb120-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-27"><a href="#cb120-27" aria-hidden="true" tabindex="-1"></a><span class="co">// Specify which routes to protect</span></span>
<span id="cb120-28"><a href="#cb120-28" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> config <span class="op">=</span> {</span>
<span id="cb120-29"><a href="#cb120-29" aria-hidden="true" tabindex="-1"></a>  matcher<span class="op">:</span> [<span class="st">&quot;/admin/:path*&quot;</span>]</span>
<span id="cb120-30"><a href="#cb120-30" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<h3 id="protect-specific-routes">Protect Specific Routes</h3>
<div class="sourceCode" id="cb121"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co">// middleware.ts</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> config <span class="op">=</span> {</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>  matcher<span class="op">:</span> [</span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;/admin/:path*&quot;</span><span class="op">,</span>      <span class="co">// All admin routes</span></span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;/checkout&quot;</span><span class="op">,</span>          <span class="co">// Checkout page</span></span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;/wishlist&quot;</span><span class="op">,</span>          <span class="co">// Wishlist page</span></span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;/api/wishlist/:path*&quot;</span><span class="op">,</span> <span class="co">// Wishlist API</span></span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<h3 id="conditional-ui-based-on-auth">Conditional UI Based on Auth</h3>
<pre class="tsx"><code>&quot;use client&quot;;
import { useSession } from &quot;next-auth/react&quot;;
import Link from &quot;next/link&quot;;

export default function Header() {
  const { data: session } = useSession();
  
  return (
    &lt;header&gt;
      {session ? (
        &lt;&gt;
          &lt;p&gt;Welcome, {session.user?.email}&lt;/p&gt;
          {session.user?.role === &quot;admin&quot; &amp;&amp; (
            &lt;Link href=&quot;/admin&quot;&gt;Admin Dashboard&lt;/Link&gt;
          )}
          &lt;button onClick={() =&gt; signOut()}&gt;Logout&lt;/button&gt;
        &lt;/&gt;
      ) : (
        &lt;&gt;
          &lt;Link href=&quot;/login&quot;&gt;Login&lt;/Link&gt;
          &lt;Link href=&quot;/register&quot;&gt;Register&lt;/Link&gt;
        &lt;/&gt;
      )}
    &lt;/header&gt;
  );
}</code></pre>
<hr />
<h2 id="role-based-access-control">👥 Role-Based Access Control</h2>
<h3 id="database-schema">Database Schema</h3>
<pre class="prisma"><code>// prisma/schema.prisma
model User {
  id       String   @id @default(uuid())
  email    String   @unique
  password String?
  role     String?  @default(&quot;user&quot;) // &quot;user&quot; or &quot;admin&quot;
}</code></pre>
<h3 id="check-role-in-component">Check Role in Component</h3>
<pre class="tsx"><code>&quot;use client&quot;;
import { useSession } from &quot;next-auth/react&quot;;

export default function AdminPanel() {
  const { data: session } = useSession();
  
  if (session?.user?.role !== &quot;admin&quot;) {
    return &lt;p&gt;Access Denied. Admin only.&lt;/p&gt;;
  }
  
  return (
    &lt;div&gt;
      &lt;h1&gt;Admin Panel&lt;/h1&gt;
      {/* Admin content */}
    &lt;/div&gt;
  );
}</code></pre>
<h3 id="check-role-in-api-route">Check Role in API Route</h3>
<div class="sourceCode" id="cb125"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co">// app/api/admin/users/route.ts</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { getServerSession } <span class="im">from</span> <span class="st">&quot;next-auth&quot;</span><span class="op">;</span></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { authOptions } <span class="im">from</span> <span class="st">&quot;@/app/api/auth/[...nextauth]/route&quot;</span><span class="op">;</span></span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { NextResponse } <span class="im">from</span> <span class="st">&quot;next/server&quot;</span><span class="op">;</span></span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">async</span> <span class="kw">function</span> <span class="fu">GET</span>(request<span class="op">:</span> Request) {</span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> session <span class="op">=</span> <span class="cf">await</span> <span class="fu">getServerSession</span>(authOptions)<span class="op">;</span></span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb125-9"><a href="#cb125-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Check if user is authenticated</span></span>
<span id="cb125-10"><a href="#cb125-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>session) {</span>
<span id="cb125-11"><a href="#cb125-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">json</span>(</span>
<span id="cb125-12"><a href="#cb125-12" aria-hidden="true" tabindex="-1"></a>      { message<span class="op">:</span> <span class="st">&quot;Unauthorized&quot;</span> }<span class="op">,</span></span>
<span id="cb125-13"><a href="#cb125-13" aria-hidden="true" tabindex="-1"></a>      { status<span class="op">:</span> <span class="dv">401</span> }</span>
<span id="cb125-14"><a href="#cb125-14" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb125-15"><a href="#cb125-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb125-16"><a href="#cb125-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb125-17"><a href="#cb125-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Check if user is admin</span></span>
<span id="cb125-18"><a href="#cb125-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (session<span class="op">.</span><span class="at">user</span><span class="op">?.</span><span class="at">role</span> <span class="op">!==</span> <span class="st">&quot;admin&quot;</span>) {</span>
<span id="cb125-19"><a href="#cb125-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">json</span>(</span>
<span id="cb125-20"><a href="#cb125-20" aria-hidden="true" tabindex="-1"></a>      { message<span class="op">:</span> <span class="st">&quot;Forbidden. Admin only.&quot;</span> }<span class="op">,</span></span>
<span id="cb125-21"><a href="#cb125-21" aria-hidden="true" tabindex="-1"></a>      { status<span class="op">:</span> <span class="dv">403</span> }</span>
<span id="cb125-22"><a href="#cb125-22" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb125-23"><a href="#cb125-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb125-24"><a href="#cb125-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb125-25"><a href="#cb125-25" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Admin logic here</span></span>
<span id="cb125-26"><a href="#cb125-26" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> users <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">user</span><span class="op">.</span><span class="fu">findMany</span>()<span class="op">;</span></span>
<span id="cb125-27"><a href="#cb125-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">json</span>({ users })<span class="op">;</span></span>
<span id="cb125-28"><a href="#cb125-28" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="create-admin-user">Create Admin User</h3>
<p><strong>Via Prisma Studio:</strong></p>
<div class="sourceCode" id="cb126"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma studio</span></code></pre></div>
<ol type="1">
<li>Buka table <code>User</code></li>
<li>Buat user baru atau edit existing</li>
<li>Set <code>role</code> menjadi <code>"admin"</code></li>
</ol>
<p><strong>Via SQL:</strong></p>
<div class="sourceCode" id="cb127"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="kw">UPDATE</span> <span class="fu">User</span> <span class="kw">SET</span> <span class="kw">role</span> <span class="op">=</span> <span class="st">&#39;admin&#39;</span> <span class="kw">WHERE</span> email <span class="op">=</span> <span class="st">&#39;admin@example.com&#39;</span>;</span></code></pre></div>
<p><strong>Via API (dengan password):</strong></p>
<div class="sourceCode" id="cb128"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> hashedPassword <span class="op">=</span> <span class="cf">await</span> bcrypt<span class="op">.</span><span class="fu">hash</span>(<span class="st">&quot;admin123&quot;</span><span class="op">,</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> prisma<span class="op">.</span><span class="at">user</span><span class="op">.</span><span class="fu">create</span>({</span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>  data<span class="op">:</span> {</span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>    id<span class="op">:</span> <span class="fu">nanoid</span>()<span class="op">,</span></span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>    email<span class="op">:</span> <span class="st">&quot;admin@example.com&quot;</span><span class="op">,</span></span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>    password<span class="op">:</span> hashedPassword<span class="op">,</span></span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a>    role<span class="op">:</span> <span class="st">&quot;admin&quot;</span><span class="op">,</span></span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<hr />
<h2 id="login-register-flow">🔄 Login &amp; Register Flow</h2>
<h3 id="complete-login-flow">Complete Login Flow</h3>
<pre><code>User → Enter email &amp; password
  ↓
Frontend → signIn(&quot;credentials&quot;, { email, password })
  ↓
NextAuth → CredentialsProvider.authorize()
  ↓
Database → Find user by email
  ↓
bcrypt → Compare password
  ↓
JWT → Generate token with user data
  ↓
Session → Store in cookies (httpOnly, secure)
  ↓
Redirect → Homepage or dashboard</code></pre>
<h3 id="complete-register-flow">Complete Register Flow</h3>
<pre><code>User → Enter email &amp; password
  ↓
Frontend → POST /api/register
  ↓
Validation → Zod schema validation
  ↓
Sanitization → Remove XSS
  ↓
Database → Check if email exists
  ↓
bcrypt → Hash password
  ↓
Database → Create new user
  ↓
Redirect → Login page</code></pre>
<hr />
<h2 id="security-best-practices">🔒 Security Best Practices</h2>
<h3 id="password-security">1. Password Security</h3>
<p>✅ <strong>DO:</strong> - Hash passwords dengan bcrypt (cost factor
10+) - Validate password strength (min 8 chars, uppercase, lowercase,
number, special char) - Never store plain text passwords - Never log
passwords</p>
<p>❌ <strong>DON’T:</strong> - Store passwords in plain text - Use weak
hashing (MD5, SHA1) - Return password in API responses</p>
<h3 id="jwt-security">2. JWT Security</h3>
<p>✅ <strong>DO:</strong> - Use strong <code>NEXTAUTH_SECRET</code>
(32+ characters random) - Set short expiration time (15 minutes
recommended) - Store JWT in httpOnly cookies - Validate JWT on every
request</p>
<p>❌ <strong>DON’T:</strong> - Store JWT in localStorage (XSS
vulnerable) - Use predictable secrets - Never expire tokens - Trust
client-side token validation</p>
<h3 id="session-security">3. Session Security</h3>
<p>✅ <strong>DO:</strong> - Implement session timeout - Refresh tokens
periodically - Logout on sensitive actions - Clear session on logout</p>
<p>❌ <strong>DON’T:</strong> - Use long session durations (&gt; 24
hours) - Store sensitive data in session - Trust session without
re-validation</p>
<h3 id="api-security">4. API Security</h3>
<p>✅ <strong>DO:</strong> - Validate all inputs with Zod - Sanitize
inputs (XSS protection) - Check authentication on every API route - Use
HTTPS in production - Rate limit API endpoints</p>
<p>❌ <strong>DON’T:</strong> - Trust client-side validation alone -
Expose sensitive errors to client - Allow SQL injection - Return stack
traces in production</p>
<hr />
<h2 id="troubleshooting-1">🔧 Troubleshooting</h2>
<h3 id="problem-1-session-tidak-tersimpan">Problem 1: Session tidak
tersimpan</h3>
<p><strong>Symptoms:</strong> - Login berhasil tapi langsung logout -
<code>useSession()</code> return null</p>
<p><strong>Solutions:</strong></p>
<div class="sourceCode" id="cb131"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Cek NEXTAUTH_SECRET sudah di-set</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">$NEXTAUTH_SECRET</span></span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Cek NEXTAUTH_URL correct</span></span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a><span class="va">NEXTAUTH_URL</span><span class="op">=</span><span class="st">&quot;http://localhost:3000&quot;</span></span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Clear cookies &amp; restart server</span></span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Ctrl+C, lalu:</span></span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> run dev</span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-11"><a href="#cb131-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Cek browser cookies</span></span>
<span id="cb131-12"><a href="#cb131-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Chrome DevTools → Application → Cookies</span></span>
<span id="cb131-13"><a href="#cb131-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Harus ada: next-auth.session-token</span></span></code></pre></div>
<h3 id="problem-2-invalid-token">Problem 2: “Invalid token”</h3>
<p><strong>Solutions:</strong></p>
<div class="sourceCode" id="cb132"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Cek JWT callback return value</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a><span class="kw">async</span> <span class="fu">jwt</span>({ token<span class="op">,</span> user }) {</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;JWT callback:&quot;</span><span class="op">,</span> { token<span class="op">,</span> user })<span class="op">;</span></span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Make sure return token, not {}</span></span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> token<span class="op">;</span></span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="problem-3-redirect-loop">Problem 3: Redirect loop</h3>
<p><strong>Solutions:</strong></p>
<div class="sourceCode" id="cb133"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="co">// middleware.ts</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a><span class="co">// Jangan protect login/register page!</span></span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> config <span class="op">=</span> {</span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>  matcher<span class="op">:</span> [</span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;/admin/:path*&quot;</span><span class="op">,</span></span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ❌ JANGAN: &quot;/login&quot;, &quot;/register&quot;</span></span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<h3 id="problem-4-oauth-provider-error">Problem 4: OAuth provider
error</h3>
<p><strong>Solutions:</strong></p>
<div class="sourceCode" id="cb134"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Cek environment variables</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">$GITHUB_ID</span></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">$GITHUB_SECRET</span></span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Cek callback URL di OAuth provider</span></span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Harus exact match:</span></span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a><span class="co"># http://localhost:3000/api/auth/callback/github</span></span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Restart server setelah add env variables</span></span></code></pre></div>
<h3 id="problem-5-role-tidak-tersimpan">Problem 5: Role tidak
tersimpan</h3>
<p><strong>Solutions:</strong></p>
<div class="sourceCode" id="cb135"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Pastikan role di-add ke JWT token</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="kw">async</span> <span class="fu">jwt</span>({ token<span class="op">,</span> user }) {</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (user) {</span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>    token<span class="op">.</span><span class="at">role</span> <span class="op">=</span> user<span class="op">.</span><span class="at">role</span><span class="op">;</span> <span class="co">// ← IMPORTANT!</span></span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> token<span class="op">;</span></span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a><span class="co">// Pastikan role di-add ke session</span></span>
<span id="cb135-10"><a href="#cb135-10" aria-hidden="true" tabindex="-1"></a><span class="kw">async</span> <span class="fu">session</span>({ session<span class="op">,</span> token }) {</span>
<span id="cb135-11"><a href="#cb135-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (token) {</span>
<span id="cb135-12"><a href="#cb135-12" aria-hidden="true" tabindex="-1"></a>    session<span class="op">.</span><span class="at">user</span><span class="op">.</span><span class="at">role</span> <span class="op">=</span> token<span class="op">.</span><span class="at">role</span><span class="op">;</span> <span class="co">// ← IMPORTANT!</span></span>
<span id="cb135-13"><a href="#cb135-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb135-14"><a href="#cb135-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> session<span class="op">;</span></span>
<span id="cb135-15"><a href="#cb135-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<hr />
<h2 id="summary-authentication-checklist">📊 Summary: Authentication
Checklist</h2>
<ul class="task-list">
<li><label><input type="checkbox" />NextAuth installed &amp;
configured</label></li>
<li><label><input type="checkbox" /><code>NEXTAUTH_SECRET</code>
generated &amp; set</label></li>
<li><label><input type="checkbox" /><code>NEXTAUTH_URL</code>
configured</label></li>
<li><label><input type="checkbox" />Credential provider
setup</label></li>
<li><label><input type="checkbox" />Register API route
created</label></li>
<li><label><input type="checkbox" />Login page created</label></li>
<li><label><input type="checkbox" />Register page created</label></li>
<li><label><input type="checkbox" />JWT callbacks
configured</label></li>
<li><label><input type="checkbox" />Session callbacks
configured</label></li>
<li><label><input type="checkbox" />Middleware untuk protected
routes</label></li>
<li><label><input type="checkbox" />Role-based access
control</label></li>
<li><label><input type="checkbox" />Session timeout
implemented</label></li>
<li><label><input type="checkbox" />Logout functionality</label></li>
<li><label><input type="checkbox" />OAuth providers
(opsional)</label></li>
</ul>
<hr />
<h1 id="validasi-data">✅ Validasi Data</h1>
<blockquote>
<p><strong>Dokumentasi Lengkap</strong>: Zod Schema, Validation,
Sanitization, Error Handling, dan Security Best Practices</p>
</blockquote>
<hr />
<h2 id="daftar-isi-3">📑 Daftar Isi</h2>
<ul>
<li><a href="#konsep-dasar-validasi">Konsep Dasar Validasi</a></li>
<li><a href="#zod-schema-validation">Zod Schema Validation</a></li>
<li><a href="#common-validations">Common Validations</a></li>
<li><a href="#sanitization-xss-protection">Sanitization (XSS
Protection)</a></li>
<li><a href="#client-side-vs-server-side-validation">Client-Side vs
Server-Side Validation</a></li>
<li><a href="#error-handling">Error Handling</a></li>
<li><a href="#validation-patterns">Validation Patterns</a></li>
<li><a href="#range--tipe-data">Range &amp; Tipe Data</a></li>
<li><a href="#custom-validators">Custom Validators</a></li>
<li><a href="#security-best-practices">Security Best Practices</a></li>
</ul>
<hr />
<h2 id="konsep-dasar-validasi">🎯 Konsep Dasar Validasi</h2>
<h3 id="mengapa-validasi-penting">Mengapa Validasi Penting?</h3>
<ol type="1">
<li><strong>Security</strong> 🔒 - Prevent SQL injection, XSS, malicious
input</li>
<li><strong>Data Integrity</strong> ✅ - Ensure data format correct</li>
<li><strong>User Experience</strong> 💫 - Clear error messages</li>
<li><strong>Business Logic</strong> 📊 - Enforce rules (min price, max
quantity, etc.)</li>
</ol>
<h3 id="validation-flow">Validation Flow</h3>
<pre><code>User Input
    ↓
Client-Side Validation (Optional, UX)
    ↓
HTTP Request
    ↓
Server-Side Validation (REQUIRED!)
    ↓
Sanitization (Remove XSS)
    ↓
Business Logic Validation
    ↓
Database Operation
    ↓
Response</code></pre>
<hr />
<h2 id="zod-schema-validation">📐 Zod Schema Validation</h2>
<h3 id="instalasi-1">Instalasi</h3>
<p>Zod sudah terinstall di project:</p>
<div class="sourceCode" id="cb137"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="er">//</span> <span class="er">package.json</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;dependencies&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;zod&quot;</span><span class="fu">:</span> <span class="st">&quot;^3.22.4&quot;</span></span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h3 id="konsep-dasar-zod">Konsep Dasar Zod</h3>
<p><strong>Zod</strong> adalah TypeScript-first schema validation
library.</p>
<p><strong>Keuntungan:</strong> - ✅ Type-safe (TypeScript support) - ✅
Composable schemas - ✅ Clear error messages - ✅ Runtime validation -
✅ Type inference</p>
<h3 id="basic-schema-example">Basic Schema Example</h3>
<div class="sourceCode" id="cb138"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { z } <span class="im">from</span> <span class="st">&quot;zod&quot;</span><span class="op">;</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Define schema</span></span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> userSchema <span class="op">=</span> z<span class="op">.</span><span class="fu">object</span>({</span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>  email<span class="op">:</span> z<span class="op">.</span><span class="fu">string</span>()<span class="op">.</span><span class="fu">email</span>()<span class="op">,</span></span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a>  password<span class="op">:</span> z<span class="op">.</span><span class="fu">string</span>()<span class="op">.</span><span class="fu">min</span>(<span class="dv">8</span>)<span class="op">,</span></span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a>  age<span class="op">:</span> z<span class="op">.</span><span class="fu">number</span>()<span class="op">.</span><span class="fu">min</span>(<span class="dv">18</span>)<span class="op">.</span><span class="fu">max</span>(<span class="dv">100</span>)<span class="op">,</span></span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb138-9"><a href="#cb138-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-10"><a href="#cb138-10" aria-hidden="true" tabindex="-1"></a><span class="co">// Type inference</span></span>
<span id="cb138-11"><a href="#cb138-11" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> User <span class="op">=</span> z<span class="op">.</span><span class="at">infer</span><span class="op">&lt;</span><span class="kw">typeof</span> userSchema<span class="op">&gt;;</span></span>
<span id="cb138-12"><a href="#cb138-12" aria-hidden="true" tabindex="-1"></a><span class="co">// → { email: string; password: string; age: number }</span></span>
<span id="cb138-13"><a href="#cb138-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-14"><a href="#cb138-14" aria-hidden="true" tabindex="-1"></a><span class="co">// Validate data</span></span>
<span id="cb138-15"><a href="#cb138-15" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> result <span class="op">=</span> userSchema<span class="op">.</span><span class="fu">safeParse</span>({</span>
<span id="cb138-16"><a href="#cb138-16" aria-hidden="true" tabindex="-1"></a>  email<span class="op">:</span> <span class="st">&quot;user@example.com&quot;</span><span class="op">,</span></span>
<span id="cb138-17"><a href="#cb138-17" aria-hidden="true" tabindex="-1"></a>  password<span class="op">:</span> <span class="st">&quot;password123&quot;</span><span class="op">,</span></span>
<span id="cb138-18"><a href="#cb138-18" aria-hidden="true" tabindex="-1"></a>  age<span class="op">:</span> <span class="dv">25</span><span class="op">,</span></span>
<span id="cb138-19"><a href="#cb138-19" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb138-20"><a href="#cb138-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-21"><a href="#cb138-21" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (result<span class="op">.</span><span class="at">success</span>) {</span>
<span id="cb138-22"><a href="#cb138-22" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;Valid:&quot;</span><span class="op">,</span> result<span class="op">.</span><span class="at">data</span>)<span class="op">;</span></span>
<span id="cb138-23"><a href="#cb138-23" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb138-24"><a href="#cb138-24" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;Errors:&quot;</span><span class="op">,</span> result<span class="op">.</span><span class="at">error</span><span class="op">.</span><span class="at">errors</span>)<span class="op">;</span></span>
<span id="cb138-25"><a href="#cb138-25" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<hr />
<h2 id="common-validations">🔐 Common Validations</h2>
<h3 id="lokasi-utilsvalidation.ts">Lokasi:
<code>utils/validation.ts</code></h3>
<div class="sourceCode" id="cb139"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { z } <span class="im">from</span> <span class="st">&quot;zod&quot;</span><span class="op">;</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> commonValidations <span class="op">=</span> {</span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">/**</span></span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a><span class="co">   * Email validation dengan comprehensive checks</span></span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a><span class="co">   */</span></span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a>  email<span class="op">:</span> z</span>
<span id="cb139-8"><a href="#cb139-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">string</span>()</span>
<span id="cb139-9"><a href="#cb139-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">min</span>(<span class="dv">1</span><span class="op">,</span> <span class="st">&quot;Email is required&quot;</span>)</span>
<span id="cb139-10"><a href="#cb139-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">max</span>(<span class="dv">254</span><span class="op">,</span> <span class="st">&quot;Email must be no more than 254 characters&quot;</span>)</span>
<span id="cb139-11"><a href="#cb139-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">email</span>(<span class="st">&quot;Please provide a valid email address&quot;</span>)</span>
<span id="cb139-12"><a href="#cb139-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">toLowerCase</span>()</span>
<span id="cb139-13"><a href="#cb139-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">trim</span>()</span>
<span id="cb139-14"><a href="#cb139-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">refine</span>(</span>
<span id="cb139-15"><a href="#cb139-15" aria-hidden="true" tabindex="-1"></a>      (email) <span class="kw">=&gt;</span> {</span>
<span id="cb139-16"><a href="#cb139-16" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Check for suspicious patterns (XSS attempts)</span></span>
<span id="cb139-17"><a href="#cb139-17" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> suspiciousPatterns <span class="op">=</span> [</span>
<span id="cb139-18"><a href="#cb139-18" aria-hidden="true" tabindex="-1"></a>          <span class="ss">/&lt;script/i</span><span class="op">,</span></span>
<span id="cb139-19"><a href="#cb139-19" aria-hidden="true" tabindex="-1"></a>          <span class="ss">/javascript:/i</span><span class="op">,</span></span>
<span id="cb139-20"><a href="#cb139-20" aria-hidden="true" tabindex="-1"></a>          <span class="ss">/on</span><span class="sc">\w+\s*</span><span class="ss">=/i</span><span class="op">,</span></span>
<span id="cb139-21"><a href="#cb139-21" aria-hidden="true" tabindex="-1"></a>          <span class="ss">/data:/i</span><span class="op">,</span></span>
<span id="cb139-22"><a href="#cb139-22" aria-hidden="true" tabindex="-1"></a>        ]<span class="op">;</span></span>
<span id="cb139-23"><a href="#cb139-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">!</span>suspiciousPatterns<span class="op">.</span><span class="fu">some</span>(pattern <span class="kw">=&gt;</span> pattern<span class="op">.</span><span class="fu">test</span>(email))<span class="op">;</span></span>
<span id="cb139-24"><a href="#cb139-24" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb139-25"><a href="#cb139-25" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;Email contains invalid characters&quot;</span></span>
<span id="cb139-26"><a href="#cb139-26" aria-hidden="true" tabindex="-1"></a>    )<span class="op">,</span></span>
<span id="cb139-27"><a href="#cb139-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-28"><a href="#cb139-28" aria-hidden="true" tabindex="-1"></a>  <span class="co">/**</span></span>
<span id="cb139-29"><a href="#cb139-29" aria-hidden="true" tabindex="-1"></a><span class="co">   * Strong password validation</span></span>
<span id="cb139-30"><a href="#cb139-30" aria-hidden="true" tabindex="-1"></a><span class="co">   */</span></span>
<span id="cb139-31"><a href="#cb139-31" aria-hidden="true" tabindex="-1"></a>  password<span class="op">:</span> z</span>
<span id="cb139-32"><a href="#cb139-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">string</span>()</span>
<span id="cb139-33"><a href="#cb139-33" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">min</span>(<span class="dv">8</span><span class="op">,</span> <span class="st">&quot;Password must be at least 8 characters long&quot;</span>)</span>
<span id="cb139-34"><a href="#cb139-34" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">max</span>(<span class="dv">128</span><span class="op">,</span> <span class="st">&quot;Password must be no more than 128 characters&quot;</span>)</span>
<span id="cb139-35"><a href="#cb139-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">regex</span>(</span>
<span id="cb139-36"><a href="#cb139-36" aria-hidden="true" tabindex="-1"></a>      <span class="ss">/</span><span class="sc">^(?</span><span class="ss">=.</span><span class="sc">*[a-z])(?</span><span class="ss">=.</span><span class="sc">*[A-Z])(?</span><span class="ss">=.</span><span class="sc">*\d)(?</span><span class="ss">=.</span><span class="sc">*[@$!%*?&amp;])[A-Za-z\d@$!%*?&amp;]</span><span class="ss">/</span><span class="op">,</span></span>
<span id="cb139-37"><a href="#cb139-37" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;Password must contain at least one uppercase letter, one lowercase letter, one number, and one special character&quot;</span></span>
<span id="cb139-38"><a href="#cb139-38" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb139-39"><a href="#cb139-39" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">refine</span>(</span>
<span id="cb139-40"><a href="#cb139-40" aria-hidden="true" tabindex="-1"></a>      (password) <span class="kw">=&gt;</span> {</span>
<span id="cb139-41"><a href="#cb139-41" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Check for common weak passwords</span></span>
<span id="cb139-42"><a href="#cb139-42" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> commonPasswords <span class="op">=</span> [</span>
<span id="cb139-43"><a href="#cb139-43" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;password&quot;</span><span class="op">,</span> <span class="st">&quot;123456&quot;</span><span class="op">,</span> <span class="st">&quot;qwerty&quot;</span><span class="op">,</span> <span class="st">&quot;abc123&quot;</span><span class="op">,</span> <span class="st">&quot;password123&quot;</span><span class="op">,</span></span>
<span id="cb139-44"><a href="#cb139-44" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;admin&quot;</span><span class="op">,</span> <span class="st">&quot;letmein&quot;</span><span class="op">,</span> <span class="st">&quot;welcome&quot;</span><span class="op">,</span> <span class="st">&quot;monkey&quot;</span><span class="op">,</span> <span class="st">&quot;dragon&quot;</span></span>
<span id="cb139-45"><a href="#cb139-45" aria-hidden="true" tabindex="-1"></a>        ]<span class="op">;</span></span>
<span id="cb139-46"><a href="#cb139-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">!</span>commonPasswords<span class="op">.</span><span class="fu">includes</span>(password<span class="op">.</span><span class="fu">toLowerCase</span>())<span class="op">;</span></span>
<span id="cb139-47"><a href="#cb139-47" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb139-48"><a href="#cb139-48" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;Password is too common, please choose a stronger password&quot;</span></span>
<span id="cb139-49"><a href="#cb139-49" aria-hidden="true" tabindex="-1"></a>    )<span class="op">,</span></span>
<span id="cb139-50"><a href="#cb139-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-51"><a href="#cb139-51" aria-hidden="true" tabindex="-1"></a>  <span class="co">/**</span></span>
<span id="cb139-52"><a href="#cb139-52" aria-hidden="true" tabindex="-1"></a><span class="co">   * Request size validation</span></span>
<span id="cb139-53"><a href="#cb139-53" aria-hidden="true" tabindex="-1"></a><span class="co">   */</span></span>
<span id="cb139-54"><a href="#cb139-54" aria-hidden="true" tabindex="-1"></a>  validateRequestSize<span class="op">:</span> (contentLength<span class="op">:</span> <span class="dt">number</span> <span class="op">|</span> <span class="dt">null</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb139-55"><a href="#cb139-55" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> MAX_REQUEST_SIZE <span class="op">=</span> <span class="dv">1024</span> <span class="op">*</span> <span class="dv">1024</span><span class="op">;</span> <span class="co">// 1MB limit</span></span>
<span id="cb139-56"><a href="#cb139-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (contentLength <span class="op">&amp;&amp;</span> contentLength <span class="op">&gt;</span> MAX_REQUEST_SIZE) {</span>
<span id="cb139-57"><a href="#cb139-57" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">&quot;Request payload too large&quot;</span>)<span class="op">;</span></span>
<span id="cb139-58"><a href="#cb139-58" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb139-59"><a href="#cb139-59" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb139-60"><a href="#cb139-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-61"><a href="#cb139-61" aria-hidden="true" tabindex="-1"></a>  <span class="co">/**</span></span>
<span id="cb139-62"><a href="#cb139-62" aria-hidden="true" tabindex="-1"></a><span class="co">   * Rate limiting helper</span></span>
<span id="cb139-63"><a href="#cb139-63" aria-hidden="true" tabindex="-1"></a><span class="co">   */</span></span>
<span id="cb139-64"><a href="#cb139-64" aria-hidden="true" tabindex="-1"></a>  rateLimit<span class="op">:</span> <span class="kw">new</span> <span class="bu">Map</span><span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> { count<span class="op">:</span> <span class="dt">number</span><span class="op">;</span> resetTime<span class="op">:</span> <span class="dt">number</span> }<span class="op">&gt;</span>()<span class="op">,</span></span>
<span id="cb139-65"><a href="#cb139-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb139-66"><a href="#cb139-66" aria-hidden="true" tabindex="-1"></a>  checkRateLimit<span class="op">:</span> (</span>
<span id="cb139-67"><a href="#cb139-67" aria-hidden="true" tabindex="-1"></a>    identifier<span class="op">:</span> <span class="dt">string</span><span class="op">,</span></span>
<span id="cb139-68"><a href="#cb139-68" aria-hidden="true" tabindex="-1"></a>    maxRequests<span class="op">:</span> <span class="dt">number</span> <span class="op">=</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb139-69"><a href="#cb139-69" aria-hidden="true" tabindex="-1"></a>    windowMs<span class="op">:</span> <span class="dt">number</span> <span class="op">=</span> <span class="dv">15</span> <span class="op">*</span> <span class="dv">60</span> <span class="op">*</span> <span class="dv">1000</span></span>
<span id="cb139-70"><a href="#cb139-70" aria-hidden="true" tabindex="-1"></a>  ) <span class="kw">=&gt;</span> {</span>
<span id="cb139-71"><a href="#cb139-71" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> now <span class="op">=</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>()<span class="op">;</span></span>
<span id="cb139-72"><a href="#cb139-72" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> userLimit <span class="op">=</span> commonValidations<span class="op">.</span><span class="at">rateLimit</span><span class="op">.</span><span class="fu">get</span>(identifier)<span class="op">;</span></span>
<span id="cb139-73"><a href="#cb139-73" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb139-74"><a href="#cb139-74" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>userLimit <span class="op">||</span> now <span class="op">&gt;</span> userLimit<span class="op">.</span><span class="at">resetTime</span>) {</span>
<span id="cb139-75"><a href="#cb139-75" aria-hidden="true" tabindex="-1"></a>      commonValidations<span class="op">.</span><span class="at">rateLimit</span><span class="op">.</span><span class="fu">set</span>(identifier<span class="op">,</span> {</span>
<span id="cb139-76"><a href="#cb139-76" aria-hidden="true" tabindex="-1"></a>        count<span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb139-77"><a href="#cb139-77" aria-hidden="true" tabindex="-1"></a>        resetTime<span class="op">:</span> now <span class="op">+</span> windowMs</span>
<span id="cb139-78"><a href="#cb139-78" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb139-79"><a href="#cb139-79" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb139-80"><a href="#cb139-80" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb139-81"><a href="#cb139-81" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb139-82"><a href="#cb139-82" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (userLimit<span class="op">.</span><span class="at">count</span> <span class="op">&gt;=</span> maxRequests) {</span>
<span id="cb139-83"><a href="#cb139-83" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb139-84"><a href="#cb139-84" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb139-85"><a href="#cb139-85" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb139-86"><a href="#cb139-86" aria-hidden="true" tabindex="-1"></a>    userLimit<span class="op">.</span><span class="at">count</span><span class="op">++;</span></span>
<span id="cb139-87"><a href="#cb139-87" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb139-88"><a href="#cb139-88" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb139-89"><a href="#cb139-89" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<h3 id="usage-example">Usage Example</h3>
<div class="sourceCode" id="cb140"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { commonValidations } <span class="im">from</span> <span class="st">&quot;@/utils/validation&quot;</span><span class="op">;</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Validate email</span></span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> emailSchema <span class="op">=</span> z<span class="op">.</span><span class="fu">object</span>({</span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>  email<span class="op">:</span> commonValidations<span class="op">.</span><span class="at">email</span><span class="op">,</span></span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> result <span class="op">=</span> emailSchema<span class="op">.</span><span class="fu">safeParse</span>({</span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a>  email<span class="op">:</span> <span class="st">&quot;user@example.com&quot;</span></span>
<span id="cb140-10"><a href="#cb140-10" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<hr />
<h2 id="sanitization-xss-protection">🧹 Sanitization (XSS
Protection)</h2>
<h3 id="konsep-sanitization">Konsep Sanitization</h3>
<p><strong>Sanitization</strong> = Membersihkan input dari karakter
berbahaya.</p>
<p><strong>Kenapa penting?</strong> - Prevent XSS (Cross-Site Scripting)
- Prevent SQL Injection - Remove malicious code</p>
<h3 id="sanitization-helpers">Sanitization Helpers</h3>
<p><strong>Lokasi:</strong> <code>utils/validation.ts</code></p>
<div class="sourceCode" id="cb141"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> sanitizeInput <span class="op">=</span> {</span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">/**</span></span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a><span class="co">   * Remove potentially dangerous characters</span></span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a><span class="co">   */</span></span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a>  sanitizeString<span class="op">:</span> (input<span class="op">:</span> <span class="dt">string</span>)<span class="op">:</span> <span class="dt">string</span> <span class="kw">=&gt;</span> {</span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> input</span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">replace</span>(<span class="ss">/</span><span class="sc">[&lt;&gt;]</span><span class="ss">/g</span><span class="op">,</span> <span class="st">&#39;&#39;</span>) <span class="co">// Remove &lt; and &gt;</span></span>
<span id="cb141-8"><a href="#cb141-8" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">replace</span>(<span class="ss">/javascript:/gi</span><span class="op">,</span> <span class="st">&#39;&#39;</span>) <span class="co">// Remove javascript: protocol</span></span>
<span id="cb141-9"><a href="#cb141-9" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">replace</span>(<span class="ss">/on</span><span class="sc">\w+\s*</span><span class="ss">=/gi</span><span class="op">,</span> <span class="st">&#39;&#39;</span>) <span class="co">// Remove event handlers</span></span>
<span id="cb141-10"><a href="#cb141-10" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">trim</span>()<span class="op">;</span></span>
<span id="cb141-11"><a href="#cb141-11" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb141-12"><a href="#cb141-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-13"><a href="#cb141-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">/**</span></span>
<span id="cb141-14"><a href="#cb141-14" aria-hidden="true" tabindex="-1"></a><span class="co">   * Validate and sanitize JSON input</span></span>
<span id="cb141-15"><a href="#cb141-15" aria-hidden="true" tabindex="-1"></a><span class="co">   */</span></span>
<span id="cb141-16"><a href="#cb141-16" aria-hidden="true" tabindex="-1"></a>  validateJsonInput<span class="op">:</span> <span class="kw">async</span> (request<span class="op">:</span> Request) <span class="kw">=&gt;</span> {</span>
<span id="cb141-17"><a href="#cb141-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> contentLength <span class="op">=</span> request<span class="op">.</span><span class="at">headers</span><span class="op">.</span><span class="fu">get</span>(<span class="st">&quot;content-length&quot;</span>)<span class="op">;</span></span>
<span id="cb141-18"><a href="#cb141-18" aria-hidden="true" tabindex="-1"></a>    commonValidations<span class="op">.</span><span class="fu">validateRequestSize</span>(</span>
<span id="cb141-19"><a href="#cb141-19" aria-hidden="true" tabindex="-1"></a>      contentLength <span class="op">?</span> <span class="pp">parseInt</span>(contentLength) <span class="op">:</span> <span class="dt">null</span></span>
<span id="cb141-20"><a href="#cb141-20" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb141-21"><a href="#cb141-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-22"><a href="#cb141-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb141-23"><a href="#cb141-23" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="cf">await</span> request<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb141-24"><a href="#cb141-24" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (error) {</span>
<span id="cb141-25"><a href="#cb141-25" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">&quot;Invalid JSON format&quot;</span>)<span class="op">;</span></span>
<span id="cb141-26"><a href="#cb141-26" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb141-27"><a href="#cb141-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb141-28"><a href="#cb141-28" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<h3 id="dompurify-for-html-sanitization">DOMPurify for HTML
Sanitization</h3>
<p><strong>Lokasi:</strong> <code>lib/sanitize.ts</code></p>
<div class="sourceCode" id="cb142"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> DOMPurify <span class="im">from</span> <span class="st">&#39;dompurify&#39;</span><span class="op">;</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { JSDOM } <span class="im">from</span> <span class="st">&#39;jsdom&#39;</span><span class="op">;</span></span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> <span class="bu">window</span> <span class="op">=</span> <span class="kw">new</span> <span class="fu">JSDOM</span>(<span class="st">&#39;&#39;</span>)<span class="op">.</span><span class="at">window</span><span class="op">;</span></span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> purify <span class="op">=</span> <span class="fu">DOMPurify</span>(<span class="bu">window</span> <span class="im">as</span> <span class="dt">unknown</span> <span class="im">as</span> <span class="bu">Window</span>)<span class="op">;</span></span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb142-8"><a href="#cb142-8" aria-hidden="true" tabindex="-1"></a><span class="co"> * Sanitize HTML content to prevent XSS attacks</span></span>
<span id="cb142-9"><a href="#cb142-9" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb142-10"><a href="#cb142-10" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">function</span> <span class="fu">sanitize</span>(dirty<span class="op">:</span> <span class="dt">string</span>)<span class="op">:</span> <span class="dt">string</span> {</span>
<span id="cb142-11"><a href="#cb142-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="kw">typeof</span> dirty <span class="op">!==</span> <span class="st">&#39;string&#39;</span>) {</span>
<span id="cb142-12"><a href="#cb142-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">&#39;&#39;</span><span class="op">;</span></span>
<span id="cb142-13"><a href="#cb142-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb142-14"><a href="#cb142-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb142-15"><a href="#cb142-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Configure DOMPurify</span></span>
<span id="cb142-16"><a href="#cb142-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> clean <span class="op">=</span> purify<span class="op">.</span><span class="fu">sanitize</span>(dirty<span class="op">,</span> {</span>
<span id="cb142-17"><a href="#cb142-17" aria-hidden="true" tabindex="-1"></a>    ALLOWED_TAGS<span class="op">:</span> []<span class="op">,</span> <span class="co">// No HTML tags allowed</span></span>
<span id="cb142-18"><a href="#cb142-18" aria-hidden="true" tabindex="-1"></a>    ALLOWED_ATTR<span class="op">:</span> []<span class="op">,</span> <span class="co">// No attributes allowed</span></span>
<span id="cb142-19"><a href="#cb142-19" aria-hidden="true" tabindex="-1"></a>    KEEP_CONTENT<span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="co">// Keep text content</span></span>
<span id="cb142-20"><a href="#cb142-20" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb142-21"><a href="#cb142-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb142-22"><a href="#cb142-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> clean<span class="op">.</span><span class="fu">trim</span>()<span class="op">;</span></span>
<span id="cb142-23"><a href="#cb142-23" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="form-sanitization">Form Sanitization</h3>
<p><strong>Lokasi:</strong> <code>lib/form-sanitize.ts</code></p>
<div class="sourceCode" id="cb143"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { sanitize } <span class="im">from</span> <span class="st">&#39;./sanitize&#39;</span><span class="op">;</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * Sanitize form data before sending to API</span></span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">function</span> <span class="fu">sanitizeFormData</span>(formData<span class="op">:</span> <span class="dt">any</span>)<span class="op">:</span> <span class="dt">any</span> {</span>
<span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>formData) <span class="cf">return</span> formData<span class="op">;</span></span>
<span id="cb143-8"><a href="#cb143-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-9"><a href="#cb143-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> sanitized <span class="op">=</span> { <span class="op">...</span>formData }<span class="op">;</span></span>
<span id="cb143-10"><a href="#cb143-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-11"><a href="#cb143-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Sanitize text fields</span></span>
<span id="cb143-12"><a href="#cb143-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (sanitized<span class="op">.</span><span class="at">title</span>) sanitized<span class="op">.</span><span class="at">title</span> <span class="op">=</span> <span class="fu">sanitize</span>(sanitized<span class="op">.</span><span class="at">title</span>)<span class="op">;</span></span>
<span id="cb143-13"><a href="#cb143-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (sanitized<span class="op">.</span><span class="at">manufacturer</span>) sanitized<span class="op">.</span><span class="at">manufacturer</span> <span class="op">=</span> <span class="fu">sanitize</span>(sanitized<span class="op">.</span><span class="at">manufacturer</span>)<span class="op">;</span></span>
<span id="cb143-14"><a href="#cb143-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (sanitized<span class="op">.</span><span class="at">description</span>) sanitized<span class="op">.</span><span class="at">description</span> <span class="op">=</span> <span class="fu">sanitize</span>(sanitized<span class="op">.</span><span class="at">description</span>)<span class="op">;</span></span>
<span id="cb143-15"><a href="#cb143-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (sanitized<span class="op">.</span><span class="at">slug</span>) sanitized<span class="op">.</span><span class="at">slug</span> <span class="op">=</span> <span class="fu">sanitize</span>(sanitized<span class="op">.</span><span class="at">slug</span>)<span class="op">;</span></span>
<span id="cb143-16"><a href="#cb143-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (sanitized<span class="op">.</span><span class="at">name</span>) sanitized<span class="op">.</span><span class="at">name</span> <span class="op">=</span> <span class="fu">sanitize</span>(sanitized<span class="op">.</span><span class="at">name</span>)<span class="op">;</span></span>
<span id="cb143-17"><a href="#cb143-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (sanitized<span class="op">.</span><span class="at">lastname</span>) sanitized<span class="op">.</span><span class="at">lastname</span> <span class="op">=</span> <span class="fu">sanitize</span>(sanitized<span class="op">.</span><span class="at">lastname</span>)<span class="op">;</span></span>
<span id="cb143-18"><a href="#cb143-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (sanitized<span class="op">.</span><span class="at">email</span>) sanitized<span class="op">.</span><span class="at">email</span> <span class="op">=</span> <span class="fu">sanitize</span>(sanitized<span class="op">.</span><span class="at">email</span>)<span class="op">;</span></span>
<span id="cb143-19"><a href="#cb143-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-20"><a href="#cb143-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> sanitized<span class="op">;</span></span>
<span id="cb143-21"><a href="#cb143-21" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="usage-in-component">Usage in Component</h3>
<pre class="tsx"><code>&quot;use client&quot;;
import { sanitizeFormData } from &quot;@/lib/form-sanitize&quot;;

const MyForm = () =&gt; {
  const handleSubmit = async (e) =&gt; {
    e.preventDefault();
    
    const formData = {
      title: e.target.title.value,
      description: e.target.description.value,
    };
    
    // Sanitize before sending to API
    const sanitized = sanitizeFormData(formData);
    
    await fetch(&quot;/api/products&quot;, {
      method: &quot;POST&quot;,
      body: JSON.stringify(sanitized),
    });
  };
  
  return &lt;form onSubmit={handleSubmit}&gt;...&lt;/form&gt;;
};</code></pre>
<hr />
<h2 id="client-side-vs-server-side-validation">🔄 Client-Side vs
Server-Side Validation</h2>
<h3 id="client-side-validation-ux">Client-Side Validation (UX)</h3>
<p><strong>Tujuan:</strong> Improve user experience, immediate
feedback</p>
<pre class="tsx"><code>&quot;use client&quot;;
import { useState } from &quot;react&quot;;

const RegisterForm = () =&gt; {
  const [errors, setErrors] = useState({});
  
  const validateEmail = (email: string) =&gt; {
    const regex = /^\S+@\S+\.\S+$/;
    return regex.test(email);
  };
  
  const handleChange = (e) =&gt; {
    const { name, value } = e.target;
    
    // Client-side validation (instant feedback)
    if (name === &quot;email&quot; &amp;&amp; !validateEmail(value)) {
      setErrors({ ...errors, email: &quot;Invalid email format&quot; });
    } else {
      const { email, ...rest } = errors;
      setErrors(rest);
    }
  };
  
  return (
    &lt;form&gt;
      &lt;input
        name=&quot;email&quot;
        type=&quot;email&quot;
        onChange={handleChange}
        required
        minLength={5}
      /&gt;
      {errors.email &amp;&amp; &lt;p className=&quot;error&quot;&gt;{errors.email}&lt;/p&gt;}
    &lt;/form&gt;
  );
};</code></pre>
<h3 id="server-side-validation-security">Server-Side Validation
(Security) ✅</h3>
<p><strong>Tujuan:</strong> Security, data integrity (REQUIRED!)</p>
<div class="sourceCode" id="cb146"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="co">// app/api/register/route.ts</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { NextRequest<span class="op">,</span> NextResponse } <span class="im">from</span> <span class="st">&quot;next/server&quot;</span><span class="op">;</span></span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { registrationSchema } <span class="im">from</span> <span class="st">&quot;@/utils/schema&quot;</span><span class="op">;</span></span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { sanitizeInput } <span class="im">from</span> <span class="st">&quot;@/utils/validation&quot;</span><span class="op">;</span></span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">async</span> <span class="kw">function</span> <span class="fu">POST</span>(request<span class="op">:</span> NextRequest) {</span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span> {</span>
<span id="cb146-8"><a href="#cb146-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 1. Parse &amp; validate JSON</span></span>
<span id="cb146-9"><a href="#cb146-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> body <span class="op">=</span> <span class="cf">await</span> sanitizeInput<span class="op">.</span><span class="fu">validateJsonInput</span>(request)<span class="op">;</span></span>
<span id="cb146-10"><a href="#cb146-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb146-11"><a href="#cb146-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 2. Validate with Zod schema (SERVER-SIDE!)</span></span>
<span id="cb146-12"><a href="#cb146-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> validatedData <span class="op">=</span> registrationSchema<span class="op">.</span><span class="fu">parse</span>(body)<span class="op">;</span></span>
<span id="cb146-13"><a href="#cb146-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb146-14"><a href="#cb146-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 3. Business logic...</span></span>
<span id="cb146-15"><a href="#cb146-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ...</span></span>
<span id="cb146-16"><a href="#cb146-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb146-17"><a href="#cb146-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">json</span>({ success<span class="op">:</span> <span class="kw">true</span> })<span class="op">;</span></span>
<span id="cb146-18"><a href="#cb146-18" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">catch</span> (error) {</span>
<span id="cb146-19"><a href="#cb146-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (error <span class="kw">instanceof</span> z<span class="op">.</span><span class="at">ZodError</span>) {</span>
<span id="cb146-20"><a href="#cb146-20" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">json</span>(</span>
<span id="cb146-21"><a href="#cb146-21" aria-hidden="true" tabindex="-1"></a>        { errors<span class="op">:</span> error<span class="op">.</span><span class="at">errors</span> }<span class="op">,</span></span>
<span id="cb146-22"><a href="#cb146-22" aria-hidden="true" tabindex="-1"></a>        { status<span class="op">:</span> <span class="dv">400</span> }</span>
<span id="cb146-23"><a href="#cb146-23" aria-hidden="true" tabindex="-1"></a>      )<span class="op">;</span></span>
<span id="cb146-24"><a href="#cb146-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb146-25"><a href="#cb146-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb146-26"><a href="#cb146-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">json</span>(</span>
<span id="cb146-27"><a href="#cb146-27" aria-hidden="true" tabindex="-1"></a>      { message<span class="op">:</span> <span class="st">&quot;Internal server error&quot;</span> }<span class="op">,</span></span>
<span id="cb146-28"><a href="#cb146-28" aria-hidden="true" tabindex="-1"></a>      { status<span class="op">:</span> <span class="dv">500</span> }</span>
<span id="cb146-29"><a href="#cb146-29" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb146-30"><a href="#cb146-30" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb146-31"><a href="#cb146-31" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="best-practice-both">Best Practice: Both!</h3>
<pre><code>Client-Side Validation → Immediate UX feedback
         +
Server-Side Validation → Security &amp; Data Integrity</code></pre>
<p>❌ <strong>Never trust client-side validation alone!</strong> ✅
<strong>Always validate on server!</strong></p>
<hr />
<h2 id="error-handling">🎨 Error Handling</h2>
<h3 id="zod-error-format">Zod Error Format</h3>
<div class="sourceCode" id="cb148"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="co">// When validation fails</span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;issues&quot;</span><span class="op">:</span> [</span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;code&quot;</span><span class="op">:</span> <span class="st">&quot;invalid_type&quot;</span><span class="op">,</span></span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expected&quot;</span><span class="op">:</span> <span class="st">&quot;string&quot;</span><span class="op">,</span></span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;received&quot;</span><span class="op">:</span> <span class="st">&quot;number&quot;</span><span class="op">,</span></span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;path&quot;</span><span class="op">:</span> [<span class="st">&quot;email&quot;</span>]<span class="op">,</span></span>
<span id="cb148-9"><a href="#cb148-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;message&quot;</span><span class="op">:</span> <span class="st">&quot;Expected string, received number&quot;</span></span>
<span id="cb148-10"><a href="#cb148-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb148-11"><a href="#cb148-11" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb148-12"><a href="#cb148-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="error-handler-utility">Error Handler Utility</h3>
<p><strong>Lokasi:</strong> <code>utils/errorHandler.ts</code></p>
<div class="sourceCode" id="cb149"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { NextResponse } <span class="im">from</span> <span class="st">&quot;next/server&quot;</span><span class="op">;</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { ZodError } <span class="im">from</span> <span class="st">&quot;zod&quot;</span><span class="op">;</span></span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { Prisma } <span class="im">from</span> <span class="st">&quot;@prisma/client&quot;</span><span class="op">;</span></span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a><span class="co"> * Centralized error handler for API routes</span></span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">function</span> <span class="fu">handleApiError</span>(error<span class="op">:</span> <span class="dt">unknown</span>)<span class="op">:</span> NextResponse {</span>
<span id="cb149-9"><a href="#cb149-9" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">error</span>(<span class="st">&quot;API Error:&quot;</span><span class="op">,</span> error)<span class="op">;</span></span>
<span id="cb149-10"><a href="#cb149-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb149-11"><a href="#cb149-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Zod validation errors</span></span>
<span id="cb149-12"><a href="#cb149-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (error <span class="kw">instanceof</span> ZodError) {</span>
<span id="cb149-13"><a href="#cb149-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">json</span>(</span>
<span id="cb149-14"><a href="#cb149-14" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb149-15"><a href="#cb149-15" aria-hidden="true" tabindex="-1"></a>        message<span class="op">:</span> <span class="st">&quot;Validation failed&quot;</span><span class="op">,</span></span>
<span id="cb149-16"><a href="#cb149-16" aria-hidden="true" tabindex="-1"></a>        errors<span class="op">:</span> error<span class="op">.</span><span class="at">errors</span><span class="op">.</span><span class="fu">map</span>((err) <span class="kw">=&gt;</span> ({</span>
<span id="cb149-17"><a href="#cb149-17" aria-hidden="true" tabindex="-1"></a>          field<span class="op">:</span> err<span class="op">.</span><span class="at">path</span><span class="op">.</span><span class="fu">join</span>(<span class="st">&quot;.&quot;</span>)<span class="op">,</span></span>
<span id="cb149-18"><a href="#cb149-18" aria-hidden="true" tabindex="-1"></a>          message<span class="op">:</span> err<span class="op">.</span><span class="at">message</span><span class="op">,</span></span>
<span id="cb149-19"><a href="#cb149-19" aria-hidden="true" tabindex="-1"></a>        }))<span class="op">,</span></span>
<span id="cb149-20"><a href="#cb149-20" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb149-21"><a href="#cb149-21" aria-hidden="true" tabindex="-1"></a>      { status<span class="op">:</span> <span class="dv">400</span> }</span>
<span id="cb149-22"><a href="#cb149-22" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb149-23"><a href="#cb149-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb149-24"><a href="#cb149-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb149-25"><a href="#cb149-25" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Prisma errors</span></span>
<span id="cb149-26"><a href="#cb149-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (error <span class="kw">instanceof</span> Prisma<span class="op">.</span><span class="at">PrismaClientKnownRequestError</span>) {</span>
<span id="cb149-27"><a href="#cb149-27" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Unique constraint violation</span></span>
<span id="cb149-28"><a href="#cb149-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (error<span class="op">.</span><span class="at">code</span> <span class="op">===</span> <span class="st">&quot;P2002&quot;</span>) {</span>
<span id="cb149-29"><a href="#cb149-29" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">json</span>(</span>
<span id="cb149-30"><a href="#cb149-30" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb149-31"><a href="#cb149-31" aria-hidden="true" tabindex="-1"></a>          message<span class="op">:</span> <span class="st">&quot;A record with this value already exists&quot;</span><span class="op">,</span></span>
<span id="cb149-32"><a href="#cb149-32" aria-hidden="true" tabindex="-1"></a>          field<span class="op">:</span> error<span class="op">.</span><span class="at">meta</span><span class="op">?.</span><span class="at">target</span><span class="op">,</span></span>
<span id="cb149-33"><a href="#cb149-33" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb149-34"><a href="#cb149-34" aria-hidden="true" tabindex="-1"></a>        { status<span class="op">:</span> <span class="dv">409</span> }</span>
<span id="cb149-35"><a href="#cb149-35" aria-hidden="true" tabindex="-1"></a>      )<span class="op">;</span></span>
<span id="cb149-36"><a href="#cb149-36" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb149-37"><a href="#cb149-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb149-38"><a href="#cb149-38" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Record not found</span></span>
<span id="cb149-39"><a href="#cb149-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (error<span class="op">.</span><span class="at">code</span> <span class="op">===</span> <span class="st">&quot;P2025&quot;</span>) {</span>
<span id="cb149-40"><a href="#cb149-40" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">json</span>(</span>
<span id="cb149-41"><a href="#cb149-41" aria-hidden="true" tabindex="-1"></a>        { message<span class="op">:</span> <span class="st">&quot;Record not found&quot;</span> }<span class="op">,</span></span>
<span id="cb149-42"><a href="#cb149-42" aria-hidden="true" tabindex="-1"></a>        { status<span class="op">:</span> <span class="dv">404</span> }</span>
<span id="cb149-43"><a href="#cb149-43" aria-hidden="true" tabindex="-1"></a>      )<span class="op">;</span></span>
<span id="cb149-44"><a href="#cb149-44" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb149-45"><a href="#cb149-45" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb149-46"><a href="#cb149-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb149-47"><a href="#cb149-47" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Generic error</span></span>
<span id="cb149-48"><a href="#cb149-48" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">json</span>(</span>
<span id="cb149-49"><a href="#cb149-49" aria-hidden="true" tabindex="-1"></a>    { message<span class="op">:</span> <span class="st">&quot;Internal server error&quot;</span> }<span class="op">,</span></span>
<span id="cb149-50"><a href="#cb149-50" aria-hidden="true" tabindex="-1"></a>    { status<span class="op">:</span> <span class="dv">500</span> }</span>
<span id="cb149-51"><a href="#cb149-51" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb149-52"><a href="#cb149-52" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="usage-in-api-route">Usage in API Route</h3>
<div class="sourceCode" id="cb150"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="co">// app/api/products/route.ts</span></span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { handleApiError } <span class="im">from</span> <span class="st">&quot;@/utils/errorHandler&quot;</span><span class="op">;</span></span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">async</span> <span class="kw">function</span> <span class="fu">POST</span>(request<span class="op">:</span> Request) {</span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span> {</span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Your logic here...</span></span>
<span id="cb150-7"><a href="#cb150-7" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">catch</span> (error) {</span>
<span id="cb150-8"><a href="#cb150-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">handleApiError</span>(error)<span class="op">;</span> <span class="co">// ← Centralized error handling</span></span>
<span id="cb150-9"><a href="#cb150-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb150-10"><a href="#cb150-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="display-errors-in-ui">Display Errors in UI</h3>
<pre class="tsx"><code>&quot;use client&quot;;
import toast from &quot;react-hot-toast&quot;;

const MyForm = () =&gt; {
  const handleSubmit = async (e) =&gt; {
    e.preventDefault();
    
    try {
      const response = await fetch(&quot;/api/products&quot;, {
        method: &quot;POST&quot;,
        body: JSON.stringify(formData),
      });
      
      const data = await response.json();
      
      if (!response.ok) {
        // Show validation errors
        if (data.errors) {
          data.errors.forEach((err) =&gt; {
            toast.error(`${err.field}: ${err.message}`);
          });
        } else {
          toast.error(data.message);
        }
      } else {
        toast.success(&quot;Success!&quot;);
      }
    } catch (error) {
      toast.error(&quot;An error occurred&quot;);
    }
  };
  
  return &lt;form onSubmit={handleSubmit}&gt;...&lt;/form&gt;;
};</code></pre>
<hr />
<h2 id="range-tipe-data">🔢 Range &amp; Tipe Data</h2>
<h3 id="numeric-ranges">Numeric Ranges</h3>
<div class="sourceCode" id="cb152"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { z } <span class="im">from</span> <span class="st">&quot;zod&quot;</span><span class="op">;</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Product schema with ranges</span></span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> productSchema <span class="op">=</span> z<span class="op">.</span><span class="fu">object</span>({</span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a>  price<span class="op">:</span> z</span>
<span id="cb152-6"><a href="#cb152-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">number</span>()</span>
<span id="cb152-7"><a href="#cb152-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">min</span>(<span class="dv">0</span><span class="op">,</span> <span class="st">&quot;Price must be non-negative&quot;</span>)</span>
<span id="cb152-8"><a href="#cb152-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">max</span>(<span class="dv">1000000</span><span class="op">,</span> <span class="st">&quot;Price too high&quot;</span>)</span>
<span id="cb152-9"><a href="#cb152-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">int</span>(<span class="st">&quot;Price must be an integer&quot;</span>)<span class="op">,</span></span>
<span id="cb152-10"><a href="#cb152-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-11"><a href="#cb152-11" aria-hidden="true" tabindex="-1"></a>  rating<span class="op">:</span> z</span>
<span id="cb152-12"><a href="#cb152-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">number</span>()</span>
<span id="cb152-13"><a href="#cb152-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">min</span>(<span class="dv">0</span><span class="op">,</span> <span class="st">&quot;Rating must be at least 0&quot;</span>)</span>
<span id="cb152-14"><a href="#cb152-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">max</span>(<span class="dv">5</span><span class="op">,</span> <span class="st">&quot;Rating cannot exceed 5&quot;</span>)<span class="op">,</span></span>
<span id="cb152-15"><a href="#cb152-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-16"><a href="#cb152-16" aria-hidden="true" tabindex="-1"></a>  inStock<span class="op">:</span> z</span>
<span id="cb152-17"><a href="#cb152-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">number</span>()</span>
<span id="cb152-18"><a href="#cb152-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">int</span>(<span class="st">&quot;Stock must be an integer&quot;</span>)</span>
<span id="cb152-19"><a href="#cb152-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">min</span>(<span class="dv">0</span><span class="op">,</span> <span class="st">&quot;Stock cannot be negative&quot;</span>)</span>
<span id="cb152-20"><a href="#cb152-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">max</span>(<span class="dv">10000</span><span class="op">,</span> <span class="st">&quot;Stock limit exceeded&quot;</span>)<span class="op">,</span></span>
<span id="cb152-21"><a href="#cb152-21" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h3 id="string-ranges">String Ranges</h3>
<div class="sourceCode" id="cb153"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> orderSchema <span class="op">=</span> z<span class="op">.</span><span class="fu">object</span>({</span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>  name<span class="op">:</span> z</span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">string</span>()</span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">min</span>(<span class="dv">2</span><span class="op">,</span> <span class="st">&quot;Name must be at least 2 characters&quot;</span>)</span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">max</span>(<span class="dv">50</span><span class="op">,</span> <span class="st">&quot;Name must be less than 50 characters&quot;</span>)</span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">regex</span>(<span class="ss">/</span><span class="sc">^[a-zA-Z\s\-&#39;]+$</span><span class="ss">/</span><span class="op">,</span> <span class="st">&quot;Name contains invalid characters&quot;</span>)<span class="op">,</span></span>
<span id="cb153-7"><a href="#cb153-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb153-8"><a href="#cb153-8" aria-hidden="true" tabindex="-1"></a>  phone<span class="op">:</span> z</span>
<span id="cb153-9"><a href="#cb153-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">string</span>()</span>
<span id="cb153-10"><a href="#cb153-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">min</span>(<span class="dv">10</span><span class="op">,</span> <span class="st">&quot;Phone number must be at least 10 digits&quot;</span>)</span>
<span id="cb153-11"><a href="#cb153-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">max</span>(<span class="dv">20</span><span class="op">,</span> <span class="st">&quot;Phone number must be less than 20 characters&quot;</span>)</span>
<span id="cb153-12"><a href="#cb153-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">regex</span>(<span class="ss">/</span><span class="sc">^[0-9+\-\(\)\s]+$</span><span class="ss">/</span><span class="op">,</span> <span class="st">&quot;Invalid phone format&quot;</span>)<span class="op">,</span></span>
<span id="cb153-13"><a href="#cb153-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb153-14"><a href="#cb153-14" aria-hidden="true" tabindex="-1"></a>  address<span class="op">:</span> z</span>
<span id="cb153-15"><a href="#cb153-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">string</span>()</span>
<span id="cb153-16"><a href="#cb153-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">min</span>(<span class="dv">5</span><span class="op">,</span> <span class="st">&quot;Address must be at least 5 characters&quot;</span>)</span>
<span id="cb153-17"><a href="#cb153-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">max</span>(<span class="dv">200</span><span class="op">,</span> <span class="st">&quot;Address too long&quot;</span>)<span class="op">,</span></span>
<span id="cb153-18"><a href="#cb153-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb153-19"><a href="#cb153-19" aria-hidden="true" tabindex="-1"></a>  apartment<span class="op">:</span> z</span>
<span id="cb153-20"><a href="#cb153-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">string</span>()</span>
<span id="cb153-21"><a href="#cb153-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">min</span>(<span class="dv">1</span><span class="op">,</span> <span class="st">&quot;Apartment is required&quot;</span>)</span>
<span id="cb153-22"><a href="#cb153-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">max</span>(<span class="dv">50</span><span class="op">,</span> <span class="st">&quot;Apartment too long&quot;</span>)<span class="op">,</span></span>
<span id="cb153-23"><a href="#cb153-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb153-24"><a href="#cb153-24" aria-hidden="true" tabindex="-1"></a>  postalCode<span class="op">:</span> z</span>
<span id="cb153-25"><a href="#cb153-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">string</span>()</span>
<span id="cb153-26"><a href="#cb153-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">min</span>(<span class="dv">3</span><span class="op">,</span> <span class="st">&quot;Postal code too short&quot;</span>)</span>
<span id="cb153-27"><a href="#cb153-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">max</span>(<span class="dv">10</span><span class="op">,</span> <span class="st">&quot;Postal code too long&quot;</span>)<span class="op">,</span></span>
<span id="cb153-28"><a href="#cb153-28" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h3 id="date-ranges">Date Ranges</h3>
<div class="sourceCode" id="cb154"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> feedbackSchema <span class="op">=</span> z<span class="op">.</span><span class="fu">object</span>({</span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>  createdAt<span class="op">:</span> z</span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">date</span>()</span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">min</span>(<span class="kw">new</span> <span class="bu">Date</span>(<span class="st">&quot;2020-01-01&quot;</span>)<span class="op">,</span> <span class="st">&quot;Date too old&quot;</span>)</span>
<span id="cb154-5"><a href="#cb154-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">max</span>(<span class="kw">new</span> <span class="bu">Date</span>()<span class="op">,</span> <span class="st">&quot;Date cannot be in the future&quot;</span>)<span class="op">,</span></span>
<span id="cb154-6"><a href="#cb154-6" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h3 id="array-ranges">Array Ranges</h3>
<div class="sourceCode" id="cb155"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> cartSchema <span class="op">=</span> z<span class="op">.</span><span class="fu">object</span>({</span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>  products<span class="op">:</span> z</span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">array</span>(z<span class="op">.</span><span class="fu">object</span>({</span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a>      id<span class="op">:</span> z<span class="op">.</span><span class="fu">string</span>()<span class="op">,</span></span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a>      quantity<span class="op">:</span> z<span class="op">.</span><span class="fu">number</span>()<span class="op">.</span><span class="fu">min</span>(<span class="dv">1</span>)<span class="op">.</span><span class="fu">max</span>(<span class="dv">100</span>)<span class="op">,</span></span>
<span id="cb155-6"><a href="#cb155-6" aria-hidden="true" tabindex="-1"></a>    }))</span>
<span id="cb155-7"><a href="#cb155-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">min</span>(<span class="dv">1</span><span class="op">,</span> <span class="st">&quot;Cart cannot be empty&quot;</span>)</span>
<span id="cb155-8"><a href="#cb155-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">max</span>(<span class="dv">50</span><span class="op">,</span> <span class="st">&quot;Too many items in cart&quot;</span>)<span class="op">,</span></span>
<span id="cb155-9"><a href="#cb155-9" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h3 id="validation-in-server-side-node.js">Validation in Server-Side
(Node.js)</h3>
<p><strong>Lokasi:</strong> <code>server/utills/validation.js</code></p>
<div class="sourceCode" id="cb156"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ValidationError <span class="kw">extends</span> <span class="bu">Error</span> {</span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>(message<span class="op">,</span> field <span class="op">=</span> <span class="kw">null</span>) {</span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span>(message)<span class="op">;</span></span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">name</span> <span class="op">=</span> <span class="st">&#39;ValidationError&#39;</span><span class="op">;</span></span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">field</span> <span class="op">=</span> field<span class="op">;</span></span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb156-8"><a href="#cb156-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-9"><a href="#cb156-9" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> orderValidation <span class="op">=</span> {</span>
<span id="cb156-10"><a href="#cb156-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Name validation (2-50 chars)</span></span>
<span id="cb156-11"><a href="#cb156-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">validateName</span><span class="op">:</span> (name<span class="op">,</span> fieldName <span class="op">=</span> <span class="st">&#39;name&#39;</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb156-12"><a href="#cb156-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>name <span class="op">||</span> <span class="kw">typeof</span> name <span class="op">!==</span> <span class="st">&#39;string&#39;</span>) {</span>
<span id="cb156-13"><a href="#cb156-13" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="fu">ValidationError</span>(<span class="vs">`</span><span class="sc">${</span>fieldName<span class="sc">}</span><span class="vs"> is required`</span><span class="op">,</span> fieldName)<span class="op">;</span></span>
<span id="cb156-14"><a href="#cb156-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb156-15"><a href="#cb156-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-16"><a href="#cb156-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> trimmedName <span class="op">=</span> name<span class="op">.</span><span class="fu">trim</span>()<span class="op">;</span></span>
<span id="cb156-17"><a href="#cb156-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb156-18"><a href="#cb156-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (trimmedName<span class="op">.</span><span class="at">length</span> <span class="op">&lt;</span> <span class="dv">2</span>) {</span>
<span id="cb156-19"><a href="#cb156-19" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="fu">ValidationError</span>(</span>
<span id="cb156-20"><a href="#cb156-20" aria-hidden="true" tabindex="-1"></a>        <span class="vs">`</span><span class="sc">${</span>fieldName<span class="sc">}</span><span class="vs"> must be at least 2 characters`</span><span class="op">,</span></span>
<span id="cb156-21"><a href="#cb156-21" aria-hidden="true" tabindex="-1"></a>        fieldName</span>
<span id="cb156-22"><a href="#cb156-22" aria-hidden="true" tabindex="-1"></a>      )<span class="op">;</span></span>
<span id="cb156-23"><a href="#cb156-23" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb156-24"><a href="#cb156-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-25"><a href="#cb156-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (trimmedName<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">50</span>) {</span>
<span id="cb156-26"><a href="#cb156-26" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="fu">ValidationError</span>(</span>
<span id="cb156-27"><a href="#cb156-27" aria-hidden="true" tabindex="-1"></a>        <span class="vs">`</span><span class="sc">${</span>fieldName<span class="sc">}</span><span class="vs"> must be less than 50 characters`</span><span class="op">,</span></span>
<span id="cb156-28"><a href="#cb156-28" aria-hidden="true" tabindex="-1"></a>        fieldName</span>
<span id="cb156-29"><a href="#cb156-29" aria-hidden="true" tabindex="-1"></a>      )<span class="op">;</span></span>
<span id="cb156-30"><a href="#cb156-30" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb156-31"><a href="#cb156-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-32"><a href="#cb156-32" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Allow letters, spaces, hyphens, apostrophes</span></span>
<span id="cb156-33"><a href="#cb156-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="ss">/</span><span class="sc">^[a-zA-Z\s\-&#39;]+$</span><span class="ss">/</span><span class="op">.</span><span class="fu">test</span>(trimmedName)) {</span>
<span id="cb156-34"><a href="#cb156-34" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="fu">ValidationError</span>(</span>
<span id="cb156-35"><a href="#cb156-35" aria-hidden="true" tabindex="-1"></a>        <span class="vs">`</span><span class="sc">${</span>fieldName<span class="sc">}</span><span class="vs"> contains invalid characters`</span><span class="op">,</span></span>
<span id="cb156-36"><a href="#cb156-36" aria-hidden="true" tabindex="-1"></a>        fieldName</span>
<span id="cb156-37"><a href="#cb156-37" aria-hidden="true" tabindex="-1"></a>      )<span class="op">;</span></span>
<span id="cb156-38"><a href="#cb156-38" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb156-39"><a href="#cb156-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-40"><a href="#cb156-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> trimmedName<span class="op">;</span></span>
<span id="cb156-41"><a href="#cb156-41" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb156-42"><a href="#cb156-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-43"><a href="#cb156-43" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Phone validation (10-20 chars)</span></span>
<span id="cb156-44"><a href="#cb156-44" aria-hidden="true" tabindex="-1"></a>  <span class="dt">validatePhone</span><span class="op">:</span> (phone) <span class="kw">=&gt;</span> {</span>
<span id="cb156-45"><a href="#cb156-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>phone <span class="op">||</span> <span class="kw">typeof</span> phone <span class="op">!==</span> <span class="st">&#39;string&#39;</span>) {</span>
<span id="cb156-46"><a href="#cb156-46" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="fu">ValidationError</span>(<span class="st">&#39;Phone number is required&#39;</span><span class="op">,</span> <span class="st">&#39;phone&#39;</span>)<span class="op">;</span></span>
<span id="cb156-47"><a href="#cb156-47" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb156-48"><a href="#cb156-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-49"><a href="#cb156-49" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> cleanedPhone <span class="op">=</span> phone<span class="op">.</span><span class="fu">replace</span>(<span class="ss">/</span><span class="sc">[^0-9+\-\(\)\s]</span><span class="ss">/g</span><span class="op">,</span> <span class="st">&#39;&#39;</span>)<span class="op">;</span></span>
<span id="cb156-50"><a href="#cb156-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb156-51"><a href="#cb156-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (cleanedPhone<span class="op">.</span><span class="at">length</span> <span class="op">&lt;</span> <span class="dv">10</span>) {</span>
<span id="cb156-52"><a href="#cb156-52" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="fu">ValidationError</span>(</span>
<span id="cb156-53"><a href="#cb156-53" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;Phone number must be at least 10 digits&#39;</span><span class="op">,</span></span>
<span id="cb156-54"><a href="#cb156-54" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;phone&#39;</span></span>
<span id="cb156-55"><a href="#cb156-55" aria-hidden="true" tabindex="-1"></a>      )<span class="op">;</span></span>
<span id="cb156-56"><a href="#cb156-56" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb156-57"><a href="#cb156-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-58"><a href="#cb156-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (cleanedPhone<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">20</span>) {</span>
<span id="cb156-59"><a href="#cb156-59" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="fu">ValidationError</span>(</span>
<span id="cb156-60"><a href="#cb156-60" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;Phone number must be less than 20 characters&#39;</span><span class="op">,</span></span>
<span id="cb156-61"><a href="#cb156-61" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;phone&#39;</span></span>
<span id="cb156-62"><a href="#cb156-62" aria-hidden="true" tabindex="-1"></a>      )<span class="op">;</span></span>
<span id="cb156-63"><a href="#cb156-63" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb156-64"><a href="#cb156-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-65"><a href="#cb156-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> cleanedPhone<span class="op">;</span></span>
<span id="cb156-66"><a href="#cb156-66" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb156-67"><a href="#cb156-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-68"><a href="#cb156-68" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Address validation (min 5 chars, apartment min 1 char)</span></span>
<span id="cb156-69"><a href="#cb156-69" aria-hidden="true" tabindex="-1"></a>  <span class="dt">validateAddress</span><span class="op">:</span> (address<span class="op">,</span> fieldName <span class="op">=</span> <span class="st">&#39;address&#39;</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb156-70"><a href="#cb156-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>address <span class="op">||</span> <span class="kw">typeof</span> address <span class="op">!==</span> <span class="st">&#39;string&#39;</span>) {</span>
<span id="cb156-71"><a href="#cb156-71" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="fu">ValidationError</span>(<span class="vs">`</span><span class="sc">${</span>fieldName<span class="sc">}</span><span class="vs"> is required`</span><span class="op">,</span> fieldName)<span class="op">;</span></span>
<span id="cb156-72"><a href="#cb156-72" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb156-73"><a href="#cb156-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-74"><a href="#cb156-74" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> trimmedAddress <span class="op">=</span> address<span class="op">.</span><span class="fu">trim</span>()<span class="op">;</span></span>
<span id="cb156-75"><a href="#cb156-75" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb156-76"><a href="#cb156-76" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Special case for apartment - only 1 character minimum</span></span>
<span id="cb156-77"><a href="#cb156-77" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> minLength <span class="op">=</span> fieldName <span class="op">===</span> <span class="st">&#39;apartment&#39;</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb156-78"><a href="#cb156-78" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb156-79"><a href="#cb156-79" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (trimmedAddress<span class="op">.</span><span class="at">length</span> <span class="op">&lt;</span> minLength) {</span>
<span id="cb156-80"><a href="#cb156-80" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="fu">ValidationError</span>(</span>
<span id="cb156-81"><a href="#cb156-81" aria-hidden="true" tabindex="-1"></a>        <span class="vs">`</span><span class="sc">${</span>fieldName<span class="sc">}</span><span class="vs"> must be at least </span><span class="sc">${</span>minLength<span class="sc">}</span><span class="vs"> character</span><span class="sc">${</span>minLength <span class="op">&gt;</span> <span class="dv">1</span> <span class="op">?</span> <span class="st">&#39;s&#39;</span> <span class="op">:</span> <span class="st">&#39;&#39;</span><span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb156-82"><a href="#cb156-82" aria-hidden="true" tabindex="-1"></a>        fieldName</span>
<span id="cb156-83"><a href="#cb156-83" aria-hidden="true" tabindex="-1"></a>      )<span class="op">;</span></span>
<span id="cb156-84"><a href="#cb156-84" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb156-85"><a href="#cb156-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-86"><a href="#cb156-86" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (trimmedAddress<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">200</span>) {</span>
<span id="cb156-87"><a href="#cb156-87" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="fu">ValidationError</span>(</span>
<span id="cb156-88"><a href="#cb156-88" aria-hidden="true" tabindex="-1"></a>        <span class="vs">`</span><span class="sc">${</span>fieldName<span class="sc">}</span><span class="vs"> must be less than 200 characters`</span><span class="op">,</span></span>
<span id="cb156-89"><a href="#cb156-89" aria-hidden="true" tabindex="-1"></a>        fieldName</span>
<span id="cb156-90"><a href="#cb156-90" aria-hidden="true" tabindex="-1"></a>      )<span class="op">;</span></span>
<span id="cb156-91"><a href="#cb156-91" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb156-92"><a href="#cb156-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-93"><a href="#cb156-93" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> trimmedAddress<span class="op">;</span></span>
<span id="cb156-94"><a href="#cb156-94" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb156-95"><a href="#cb156-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-96"><a href="#cb156-96" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Email validation</span></span>
<span id="cb156-97"><a href="#cb156-97" aria-hidden="true" tabindex="-1"></a>  <span class="dt">validateEmail</span><span class="op">:</span> (email) <span class="kw">=&gt;</span> {</span>
<span id="cb156-98"><a href="#cb156-98" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>email <span class="op">||</span> <span class="kw">typeof</span> email <span class="op">!==</span> <span class="st">&#39;string&#39;</span>) {</span>
<span id="cb156-99"><a href="#cb156-99" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="fu">ValidationError</span>(<span class="st">&#39;Email is required&#39;</span><span class="op">,</span> <span class="st">&#39;email&#39;</span>)<span class="op">;</span></span>
<span id="cb156-100"><a href="#cb156-100" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb156-101"><a href="#cb156-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-102"><a href="#cb156-102" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> trimmedEmail <span class="op">=</span> email<span class="op">.</span><span class="fu">trim</span>()<span class="op">.</span><span class="fu">toLowerCase</span>()<span class="op">;</span></span>
<span id="cb156-103"><a href="#cb156-103" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb156-104"><a href="#cb156-104" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (trimmedEmail<span class="op">.</span><span class="at">length</span> <span class="op">&lt;</span> <span class="dv">5</span>) {</span>
<span id="cb156-105"><a href="#cb156-105" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="fu">ValidationError</span>(<span class="st">&#39;Email is too short&#39;</span><span class="op">,</span> <span class="st">&#39;email&#39;</span>)<span class="op">;</span></span>
<span id="cb156-106"><a href="#cb156-106" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb156-107"><a href="#cb156-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-108"><a href="#cb156-108" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (trimmedEmail<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">254</span>) {</span>
<span id="cb156-109"><a href="#cb156-109" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="fu">ValidationError</span>(<span class="st">&#39;Email is too long&#39;</span><span class="op">,</span> <span class="st">&#39;email&#39;</span>)<span class="op">;</span></span>
<span id="cb156-110"><a href="#cb156-110" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb156-111"><a href="#cb156-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-112"><a href="#cb156-112" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Simple email regex</span></span>
<span id="cb156-113"><a href="#cb156-113" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="ss">/</span><span class="sc">^\S+</span><span class="ss">@</span><span class="sc">\S+\.\S+$</span><span class="ss">/</span><span class="op">.</span><span class="fu">test</span>(trimmedEmail)) {</span>
<span id="cb156-114"><a href="#cb156-114" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="fu">ValidationError</span>(<span class="st">&#39;Invalid email format&#39;</span><span class="op">,</span> <span class="st">&#39;email&#39;</span>)<span class="op">;</span></span>
<span id="cb156-115"><a href="#cb156-115" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb156-116"><a href="#cb156-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-117"><a href="#cb156-117" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> trimmedEmail<span class="op">;</span></span>
<span id="cb156-118"><a href="#cb156-118" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb156-119"><a href="#cb156-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-120"><a href="#cb156-120" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Postal code validation (3-10 chars)</span></span>
<span id="cb156-121"><a href="#cb156-121" aria-hidden="true" tabindex="-1"></a>  <span class="dt">validatePostalCode</span><span class="op">:</span> (postalCode) <span class="kw">=&gt;</span> {</span>
<span id="cb156-122"><a href="#cb156-122" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>postalCode <span class="op">||</span> <span class="kw">typeof</span> postalCode <span class="op">!==</span> <span class="st">&#39;string&#39;</span>) {</span>
<span id="cb156-123"><a href="#cb156-123" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="fu">ValidationError</span>(<span class="st">&#39;Postal code is required&#39;</span><span class="op">,</span> <span class="st">&#39;postalCode&#39;</span>)<span class="op">;</span></span>
<span id="cb156-124"><a href="#cb156-124" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb156-125"><a href="#cb156-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-126"><a href="#cb156-126" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> cleaned <span class="op">=</span> postalCode<span class="op">.</span><span class="fu">trim</span>()<span class="op">;</span></span>
<span id="cb156-127"><a href="#cb156-127" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb156-128"><a href="#cb156-128" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (cleaned<span class="op">.</span><span class="at">length</span> <span class="op">&lt;</span> <span class="dv">3</span>) {</span>
<span id="cb156-129"><a href="#cb156-129" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="fu">ValidationError</span>(</span>
<span id="cb156-130"><a href="#cb156-130" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;Postal code must be at least 3 characters&#39;</span><span class="op">,</span></span>
<span id="cb156-131"><a href="#cb156-131" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;postalCode&#39;</span></span>
<span id="cb156-132"><a href="#cb156-132" aria-hidden="true" tabindex="-1"></a>      )<span class="op">;</span></span>
<span id="cb156-133"><a href="#cb156-133" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb156-134"><a href="#cb156-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-135"><a href="#cb156-135" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (cleaned<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">10</span>) {</span>
<span id="cb156-136"><a href="#cb156-136" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="fu">ValidationError</span>(</span>
<span id="cb156-137"><a href="#cb156-137" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;Postal code must be less than 10 characters&#39;</span><span class="op">,</span></span>
<span id="cb156-138"><a href="#cb156-138" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;postalCode&#39;</span></span>
<span id="cb156-139"><a href="#cb156-139" aria-hidden="true" tabindex="-1"></a>      )<span class="op">;</span></span>
<span id="cb156-140"><a href="#cb156-140" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb156-141"><a href="#cb156-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-142"><a href="#cb156-142" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> cleaned<span class="op">;</span></span>
<span id="cb156-143"><a href="#cb156-143" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb156-144"><a href="#cb156-144" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb156-145"><a href="#cb156-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-146"><a href="#cb156-146" aria-hidden="true" tabindex="-1"></a>module<span class="op">.</span><span class="at">exports</span> <span class="op">=</span> { ValidationError<span class="op">,</span> orderValidation }<span class="op">;</span></span></code></pre></div>
<hr />
<h2 id="validation-patterns">🎯 Validation Patterns</h2>
<h3 id="pattern-1-form-validation">Pattern 1: Form Validation</h3>
<pre class="tsx"><code>&quot;use client&quot;;
import { z } from &quot;zod&quot;;
import { useState } from &quot;react&quot;;
import toast from &quot;react-hot-toast&quot;;

const formSchema = z.object({
  title: z.string().min(3).max(100),
  price: z.number().min(0).max(1000000),
});

const ProductForm = () =&gt; {
  const [errors, setErrors] = useState&lt;Record&lt;string, string&gt;&gt;({});
  
  const handleSubmit = (e: React.FormEvent) =&gt; {
    e.preventDefault();
    
    const formData = new FormData(e.target as HTMLFormElement);
    const data = {
      title: formData.get(&quot;title&quot;) as string,
      price: parseFloat(formData.get(&quot;price&quot;) as string),
    };
    
    // Validate
    const result = formSchema.safeParse(data);
    
    if (!result.success) {
      // Show errors
      const fieldErrors: Record&lt;string, string&gt; = {};
      result.error.errors.forEach((err) =&gt; {
        fieldErrors[err.path[0] as string] = err.message;
      });
      setErrors(fieldErrors);
      return;
    }
    
    // Submit to API
    toast.success(&quot;Valid!&quot;);
    setErrors({});
  };
  
  return (
    &lt;form onSubmit={handleSubmit}&gt;
      &lt;input name=&quot;title&quot; /&gt;
      {errors.title &amp;&amp; &lt;p className=&quot;error&quot;&gt;{errors.title}&lt;/p&gt;}
      
      &lt;input name=&quot;price&quot; type=&quot;number&quot; /&gt;
      {errors.price &amp;&amp; &lt;p className=&quot;error&quot;&gt;{errors.price}&lt;/p&gt;}
      
      &lt;button type=&quot;submit&quot;&gt;Submit&lt;/button&gt;
    &lt;/form&gt;
  );
};</code></pre>
<h3 id="pattern-2-api-route-validation">Pattern 2: API Route
Validation</h3>
<div class="sourceCode" id="cb158"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="co">// app/api/products/route.ts</span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { NextRequest<span class="op">,</span> NextResponse } <span class="im">from</span> <span class="st">&quot;next/server&quot;</span><span class="op">;</span></span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { z } <span class="im">from</span> <span class="st">&quot;zod&quot;</span><span class="op">;</span></span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { handleApiError } <span class="im">from</span> <span class="st">&quot;@/utils/errorHandler&quot;</span><span class="op">;</span></span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { sanitizeInput } <span class="im">from</span> <span class="st">&quot;@/utils/validation&quot;</span><span class="op">;</span></span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> prisma <span class="im">from</span> <span class="st">&quot;@/utils/db&quot;</span><span class="op">;</span></span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-8"><a href="#cb158-8" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> productSchema <span class="op">=</span> z<span class="op">.</span><span class="fu">object</span>({</span>
<span id="cb158-9"><a href="#cb158-9" aria-hidden="true" tabindex="-1"></a>  title<span class="op">:</span> z<span class="op">.</span><span class="fu">string</span>()<span class="op">.</span><span class="fu">min</span>(<span class="dv">3</span>)<span class="op">.</span><span class="fu">max</span>(<span class="dv">100</span>)<span class="op">,</span></span>
<span id="cb158-10"><a href="#cb158-10" aria-hidden="true" tabindex="-1"></a>  price<span class="op">:</span> z<span class="op">.</span><span class="fu">number</span>()<span class="op">.</span><span class="fu">min</span>(<span class="dv">0</span>)<span class="op">,</span></span>
<span id="cb158-11"><a href="#cb158-11" aria-hidden="true" tabindex="-1"></a>  description<span class="op">:</span> z<span class="op">.</span><span class="fu">string</span>()<span class="op">.</span><span class="fu">min</span>(<span class="dv">10</span>)<span class="op">.</span><span class="fu">max</span>(<span class="dv">5000</span>)<span class="op">,</span></span>
<span id="cb158-12"><a href="#cb158-12" aria-hidden="true" tabindex="-1"></a>  categoryId<span class="op">:</span> z<span class="op">.</span><span class="fu">string</span>()<span class="op">.</span><span class="fu">uuid</span>()<span class="op">,</span></span>
<span id="cb158-13"><a href="#cb158-13" aria-hidden="true" tabindex="-1"></a>  inStock<span class="op">:</span> z<span class="op">.</span><span class="fu">number</span>()<span class="op">.</span><span class="fu">int</span>()<span class="op">.</span><span class="fu">min</span>(<span class="dv">0</span>)<span class="op">,</span></span>
<span id="cb158-14"><a href="#cb158-14" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb158-15"><a href="#cb158-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-16"><a href="#cb158-16" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">async</span> <span class="kw">function</span> <span class="fu">POST</span>(request<span class="op">:</span> NextRequest) {</span>
<span id="cb158-17"><a href="#cb158-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span> {</span>
<span id="cb158-18"><a href="#cb158-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 1. Parse JSON</span></span>
<span id="cb158-19"><a href="#cb158-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> body <span class="op">=</span> <span class="cf">await</span> sanitizeInput<span class="op">.</span><span class="fu">validateJsonInput</span>(request)<span class="op">;</span></span>
<span id="cb158-20"><a href="#cb158-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb158-21"><a href="#cb158-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 2. Validate with Zod</span></span>
<span id="cb158-22"><a href="#cb158-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> validatedData <span class="op">=</span> productSchema<span class="op">.</span><span class="fu">parse</span>(body)<span class="op">;</span></span>
<span id="cb158-23"><a href="#cb158-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb158-24"><a href="#cb158-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 3. Sanitize strings</span></span>
<span id="cb158-25"><a href="#cb158-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> sanitized <span class="op">=</span> {</span>
<span id="cb158-26"><a href="#cb158-26" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span>validatedData<span class="op">,</span></span>
<span id="cb158-27"><a href="#cb158-27" aria-hidden="true" tabindex="-1"></a>      title<span class="op">:</span> sanitizeInput<span class="op">.</span><span class="fu">sanitizeString</span>(validatedData<span class="op">.</span><span class="at">title</span>)<span class="op">,</span></span>
<span id="cb158-28"><a href="#cb158-28" aria-hidden="true" tabindex="-1"></a>      description<span class="op">:</span> sanitizeInput<span class="op">.</span><span class="fu">sanitizeString</span>(validatedData<span class="op">.</span><span class="at">description</span>)<span class="op">,</span></span>
<span id="cb158-29"><a href="#cb158-29" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb158-30"><a href="#cb158-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb158-31"><a href="#cb158-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 4. Create product</span></span>
<span id="cb158-32"><a href="#cb158-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> product <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="fu">create</span>({</span>
<span id="cb158-33"><a href="#cb158-33" aria-hidden="true" tabindex="-1"></a>      data<span class="op">:</span> sanitized<span class="op">,</span></span>
<span id="cb158-34"><a href="#cb158-34" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb158-35"><a href="#cb158-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb158-36"><a href="#cb158-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">json</span>(product<span class="op">,</span> { status<span class="op">:</span> <span class="dv">201</span> })<span class="op">;</span></span>
<span id="cb158-37"><a href="#cb158-37" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">catch</span> (error) {</span>
<span id="cb158-38"><a href="#cb158-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">handleApiError</span>(error)<span class="op">;</span></span>
<span id="cb158-39"><a href="#cb158-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb158-40"><a href="#cb158-40" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="pattern-3-nested-object-validation">Pattern 3: Nested Object
Validation</h3>
<div class="sourceCode" id="cb159"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> orderSchema <span class="op">=</span> z<span class="op">.</span><span class="fu">object</span>({</span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>  customer<span class="op">:</span> z<span class="op">.</span><span class="fu">object</span>({</span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>    name<span class="op">:</span> z<span class="op">.</span><span class="fu">string</span>()<span class="op">.</span><span class="fu">min</span>(<span class="dv">2</span>)<span class="op">.</span><span class="fu">max</span>(<span class="dv">50</span>)<span class="op">,</span></span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a>    email<span class="op">:</span> z<span class="op">.</span><span class="fu">string</span>()<span class="op">.</span><span class="fu">email</span>()<span class="op">,</span></span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a>    phone<span class="op">:</span> z<span class="op">.</span><span class="fu">string</span>()<span class="op">.</span><span class="fu">min</span>(<span class="dv">10</span>)<span class="op">.</span><span class="fu">max</span>(<span class="dv">20</span>)<span class="op">,</span></span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a>  })<span class="op">,</span></span>
<span id="cb159-7"><a href="#cb159-7" aria-hidden="true" tabindex="-1"></a>  shipping<span class="op">:</span> z<span class="op">.</span><span class="fu">object</span>({</span>
<span id="cb159-8"><a href="#cb159-8" aria-hidden="true" tabindex="-1"></a>    address<span class="op">:</span> z<span class="op">.</span><span class="fu">string</span>()<span class="op">.</span><span class="fu">min</span>(<span class="dv">5</span>)<span class="op">,</span></span>
<span id="cb159-9"><a href="#cb159-9" aria-hidden="true" tabindex="-1"></a>    city<span class="op">:</span> z<span class="op">.</span><span class="fu">string</span>()<span class="op">.</span><span class="fu">min</span>(<span class="dv">2</span>)<span class="op">,</span></span>
<span id="cb159-10"><a href="#cb159-10" aria-hidden="true" tabindex="-1"></a>    postalCode<span class="op">:</span> z<span class="op">.</span><span class="fu">string</span>()<span class="op">.</span><span class="fu">min</span>(<span class="dv">3</span>)<span class="op">.</span><span class="fu">max</span>(<span class="dv">10</span>)<span class="op">,</span></span>
<span id="cb159-11"><a href="#cb159-11" aria-hidden="true" tabindex="-1"></a>    country<span class="op">:</span> z<span class="op">.</span><span class="fu">string</span>()<span class="op">.</span><span class="fu">min</span>(<span class="dv">2</span>)<span class="op">,</span></span>
<span id="cb159-12"><a href="#cb159-12" aria-hidden="true" tabindex="-1"></a>  })<span class="op">,</span></span>
<span id="cb159-13"><a href="#cb159-13" aria-hidden="true" tabindex="-1"></a>  items<span class="op">:</span> z<span class="op">.</span><span class="fu">array</span>(</span>
<span id="cb159-14"><a href="#cb159-14" aria-hidden="true" tabindex="-1"></a>    z<span class="op">.</span><span class="fu">object</span>({</span>
<span id="cb159-15"><a href="#cb159-15" aria-hidden="true" tabindex="-1"></a>      productId<span class="op">:</span> z<span class="op">.</span><span class="fu">string</span>()<span class="op">.</span><span class="fu">uuid</span>()<span class="op">,</span></span>
<span id="cb159-16"><a href="#cb159-16" aria-hidden="true" tabindex="-1"></a>      quantity<span class="op">:</span> z<span class="op">.</span><span class="fu">number</span>()<span class="op">.</span><span class="fu">int</span>()<span class="op">.</span><span class="fu">min</span>(<span class="dv">1</span>)<span class="op">.</span><span class="fu">max</span>(<span class="dv">100</span>)<span class="op">,</span></span>
<span id="cb159-17"><a href="#cb159-17" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb159-18"><a href="#cb159-18" aria-hidden="true" tabindex="-1"></a>  )<span class="op">.</span><span class="fu">min</span>(<span class="dv">1</span><span class="op">,</span> <span class="st">&quot;Order must have at least one item&quot;</span>)<span class="op">,</span></span>
<span id="cb159-19"><a href="#cb159-19" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb159-20"><a href="#cb159-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-21"><a href="#cb159-21" aria-hidden="true" tabindex="-1"></a><span class="co">// Type inference</span></span>
<span id="cb159-22"><a href="#cb159-22" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Order <span class="op">=</span> z<span class="op">.</span><span class="at">infer</span><span class="op">&lt;</span><span class="kw">typeof</span> orderSchema<span class="op">&gt;;</span></span></code></pre></div>
<hr />
<h2 id="custom-validators">🛠️ Custom Validators</h2>
<h3 id="custom-zod-validator">Custom Zod Validator</h3>
<div class="sourceCode" id="cb160"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { z } <span class="im">from</span> <span class="st">&quot;zod&quot;</span><span class="op">;</span></span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Custom credit card validator</span></span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> creditCardSchema <span class="op">=</span> z</span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">string</span>()</span>
<span id="cb160-6"><a href="#cb160-6" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">min</span>(<span class="dv">13</span>)</span>
<span id="cb160-7"><a href="#cb160-7" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">max</span>(<span class="dv">19</span>)</span>
<span id="cb160-8"><a href="#cb160-8" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">refine</span>(</span>
<span id="cb160-9"><a href="#cb160-9" aria-hidden="true" tabindex="-1"></a>    (value) <span class="kw">=&gt;</span> {</span>
<span id="cb160-10"><a href="#cb160-10" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Luhn algorithm for credit card validation</span></span>
<span id="cb160-11"><a href="#cb160-11" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> digits <span class="op">=</span> value<span class="op">.</span><span class="fu">replace</span>(<span class="ss">/</span><span class="sc">\D</span><span class="ss">/g</span><span class="op">,</span> <span class="st">&quot;&quot;</span>)<span class="op">;</span></span>
<span id="cb160-12"><a href="#cb160-12" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> sum <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb160-13"><a href="#cb160-13" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> isEven <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb160-14"><a href="#cb160-14" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb160-15"><a href="#cb160-15" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> digits<span class="op">.</span><span class="at">length</span> <span class="op">-</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&gt;=</span> <span class="dv">0</span><span class="op">;</span> i<span class="op">--</span>) {</span>
<span id="cb160-16"><a href="#cb160-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> digit <span class="op">=</span> <span class="pp">parseInt</span>(digits[i])<span class="op">;</span></span>
<span id="cb160-17"><a href="#cb160-17" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb160-18"><a href="#cb160-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (isEven) {</span>
<span id="cb160-19"><a href="#cb160-19" aria-hidden="true" tabindex="-1"></a>          digit <span class="op">*=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb160-20"><a href="#cb160-20" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (digit <span class="op">&gt;</span> <span class="dv">9</span>) {</span>
<span id="cb160-21"><a href="#cb160-21" aria-hidden="true" tabindex="-1"></a>            digit <span class="op">-=</span> <span class="dv">9</span><span class="op">;</span></span>
<span id="cb160-22"><a href="#cb160-22" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb160-23"><a href="#cb160-23" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb160-24"><a href="#cb160-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb160-25"><a href="#cb160-25" aria-hidden="true" tabindex="-1"></a>        sum <span class="op">+=</span> digit<span class="op">;</span></span>
<span id="cb160-26"><a href="#cb160-26" aria-hidden="true" tabindex="-1"></a>        isEven <span class="op">=</span> <span class="op">!</span>isEven<span class="op">;</span></span>
<span id="cb160-27"><a href="#cb160-27" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb160-28"><a href="#cb160-28" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb160-29"><a href="#cb160-29" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> sum <span class="op">%</span> <span class="dv">10</span> <span class="op">===</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb160-30"><a href="#cb160-30" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb160-31"><a href="#cb160-31" aria-hidden="true" tabindex="-1"></a>    { message<span class="op">:</span> <span class="st">&quot;Invalid credit card number&quot;</span> }</span>
<span id="cb160-32"><a href="#cb160-32" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb160-33"><a href="#cb160-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-34"><a href="#cb160-34" aria-hidden="true" tabindex="-1"></a><span class="co">// Custom slug validator</span></span>
<span id="cb160-35"><a href="#cb160-35" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> slugSchema <span class="op">=</span> z</span>
<span id="cb160-36"><a href="#cb160-36" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">string</span>()</span>
<span id="cb160-37"><a href="#cb160-37" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">min</span>(<span class="dv">1</span>)</span>
<span id="cb160-38"><a href="#cb160-38" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">max</span>(<span class="dv">200</span>)</span>
<span id="cb160-39"><a href="#cb160-39" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">regex</span>(<span class="ss">/</span><span class="sc">^[a-z0-9]+(?</span><span class="ss">:-</span><span class="sc">[a-z0-9]+)*$</span><span class="ss">/</span><span class="op">,</span> <span class="st">&quot;Invalid slug format&quot;</span>)</span>
<span id="cb160-40"><a href="#cb160-40" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">refine</span>(</span>
<span id="cb160-41"><a href="#cb160-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">async</span> (slug) <span class="kw">=&gt;</span> {</span>
<span id="cb160-42"><a href="#cb160-42" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Check if slug already exists in database</span></span>
<span id="cb160-43"><a href="#cb160-43" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> existing <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="fu">findUnique</span>({</span>
<span id="cb160-44"><a href="#cb160-44" aria-hidden="true" tabindex="-1"></a>        where<span class="op">:</span> { slug }<span class="op">,</span></span>
<span id="cb160-45"><a href="#cb160-45" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb160-46"><a href="#cb160-46" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="op">!</span>existing<span class="op">;</span></span>
<span id="cb160-47"><a href="#cb160-47" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb160-48"><a href="#cb160-48" aria-hidden="true" tabindex="-1"></a>    { message<span class="op">:</span> <span class="st">&quot;Slug already exists&quot;</span> }</span>
<span id="cb160-49"><a href="#cb160-49" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span></code></pre></div>
<h3 id="custom-function-validator">Custom Function Validator</h3>
<div class="sourceCode" id="cb161"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="co">// utils/customValidators.ts</span></span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> validatePassword <span class="op">=</span> (password<span class="op">:</span> <span class="dt">string</span>)<span class="op">:</span> {</span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a>  isValid<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb161-5"><a href="#cb161-5" aria-hidden="true" tabindex="-1"></a>  errors<span class="op">:</span> <span class="dt">string</span>[]<span class="op">;</span></span>
<span id="cb161-6"><a href="#cb161-6" aria-hidden="true" tabindex="-1"></a>} <span class="kw">=&gt;</span> {</span>
<span id="cb161-7"><a href="#cb161-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> errors<span class="op">:</span> <span class="dt">string</span>[] <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb161-8"><a href="#cb161-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb161-9"><a href="#cb161-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (password<span class="op">.</span><span class="at">length</span> <span class="op">&lt;</span> <span class="dv">8</span>) {</span>
<span id="cb161-10"><a href="#cb161-10" aria-hidden="true" tabindex="-1"></a>    errors<span class="op">.</span><span class="fu">push</span>(<span class="st">&quot;Password must be at least 8 characters&quot;</span>)<span class="op">;</span></span>
<span id="cb161-11"><a href="#cb161-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb161-12"><a href="#cb161-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb161-13"><a href="#cb161-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span><span class="ss">/</span><span class="sc">[A-Z]</span><span class="ss">/</span><span class="op">.</span><span class="fu">test</span>(password)) {</span>
<span id="cb161-14"><a href="#cb161-14" aria-hidden="true" tabindex="-1"></a>    errors<span class="op">.</span><span class="fu">push</span>(<span class="st">&quot;Password must contain uppercase letter&quot;</span>)<span class="op">;</span></span>
<span id="cb161-15"><a href="#cb161-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb161-16"><a href="#cb161-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb161-17"><a href="#cb161-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span><span class="ss">/</span><span class="sc">[a-z]</span><span class="ss">/</span><span class="op">.</span><span class="fu">test</span>(password)) {</span>
<span id="cb161-18"><a href="#cb161-18" aria-hidden="true" tabindex="-1"></a>    errors<span class="op">.</span><span class="fu">push</span>(<span class="st">&quot;Password must contain lowercase letter&quot;</span>)<span class="op">;</span></span>
<span id="cb161-19"><a href="#cb161-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb161-20"><a href="#cb161-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb161-21"><a href="#cb161-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span><span class="ss">/</span><span class="sc">[0-9]</span><span class="ss">/</span><span class="op">.</span><span class="fu">test</span>(password)) {</span>
<span id="cb161-22"><a href="#cb161-22" aria-hidden="true" tabindex="-1"></a>    errors<span class="op">.</span><span class="fu">push</span>(<span class="st">&quot;Password must contain number&quot;</span>)<span class="op">;</span></span>
<span id="cb161-23"><a href="#cb161-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb161-24"><a href="#cb161-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb161-25"><a href="#cb161-25" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span><span class="ss">/</span><span class="sc">[@$!%*?&amp;]</span><span class="ss">/</span><span class="op">.</span><span class="fu">test</span>(password)) {</span>
<span id="cb161-26"><a href="#cb161-26" aria-hidden="true" tabindex="-1"></a>    errors<span class="op">.</span><span class="fu">push</span>(<span class="st">&quot;Password must contain special character&quot;</span>)<span class="op">;</span></span>
<span id="cb161-27"><a href="#cb161-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb161-28"><a href="#cb161-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb161-29"><a href="#cb161-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb161-30"><a href="#cb161-30" aria-hidden="true" tabindex="-1"></a>    isValid<span class="op">:</span> errors<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb161-31"><a href="#cb161-31" aria-hidden="true" tabindex="-1"></a>    errors<span class="op">,</span></span>
<span id="cb161-32"><a href="#cb161-32" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb161-33"><a href="#cb161-33" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb161-34"><a href="#cb161-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-35"><a href="#cb161-35" aria-hidden="true" tabindex="-1"></a><span class="co">// Usage</span></span>
<span id="cb161-36"><a href="#cb161-36" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> result <span class="op">=</span> <span class="fu">validatePassword</span>(<span class="st">&quot;weak&quot;</span>)<span class="op">;</span></span>
<span id="cb161-37"><a href="#cb161-37" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="op">!</span>result<span class="op">.</span><span class="at">isValid</span>) {</span>
<span id="cb161-38"><a href="#cb161-38" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;Errors:&quot;</span><span class="op">,</span> result<span class="op">.</span><span class="at">errors</span>)<span class="op">;</span></span>
<span id="cb161-39"><a href="#cb161-39" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<hr />
<h2 id="security-best-practices-1">🔒 Security Best Practices</h2>
<h3 id="input-validation">1. Input Validation</h3>
<p>✅ <strong>DO:</strong> - Always validate on server-side - Use strong
validation libraries (Zod) - Whitelist allowed characters - Set min/max
length limits - Validate data types</p>
<p>❌ <strong>DON’T:</strong> - Trust client-side validation alone -
Allow arbitrary input - Use regex only (combine with type checking)</p>
<h3 id="sanitization">2. Sanitization</h3>
<p>✅ <strong>DO:</strong> - Sanitize all user inputs - Use DOMPurify
for HTML - Remove XSS patterns - Encode special characters</p>
<p>❌ <strong>DON’T:</strong> - Store unsanitized data - Trust user
input - Use innerHTML without sanitization</p>
<h3 id="error-messages">3. Error Messages</h3>
<p>✅ <strong>DO:</strong> - Show clear, helpful errors - Log detailed
errors on server - Return generic errors to client</p>
<p>❌ <strong>DON’T:</strong> - Expose stack traces to client - Reveal
database structure - Show sensitive information</p>
<h3 id="rate-limiting">4. Rate Limiting</h3>
<div class="sourceCode" id="cb162"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Implement rate limiting for API routes</span></span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { commonValidations } <span class="im">from</span> <span class="st">&quot;@/utils/validation&quot;</span><span class="op">;</span></span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">async</span> <span class="kw">function</span> <span class="fu">POST</span>(request<span class="op">:</span> Request) {</span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ip <span class="op">=</span> request<span class="op">.</span><span class="at">headers</span><span class="op">.</span><span class="fu">get</span>(<span class="st">&quot;x-forwarded-for&quot;</span>) <span class="op">||</span> <span class="st">&quot;unknown&quot;</span><span class="op">;</span></span>
<span id="cb162-6"><a href="#cb162-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb162-7"><a href="#cb162-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Check rate limit</span></span>
<span id="cb162-8"><a href="#cb162-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>commonValidations<span class="op">.</span><span class="fu">checkRateLimit</span>(ip<span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">15</span> <span class="op">*</span> <span class="dv">60</span> <span class="op">*</span> <span class="dv">1000</span>)) {</span>
<span id="cb162-9"><a href="#cb162-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">json</span>(</span>
<span id="cb162-10"><a href="#cb162-10" aria-hidden="true" tabindex="-1"></a>      { message<span class="op">:</span> <span class="st">&quot;Too many requests. Please try again later.&quot;</span> }<span class="op">,</span></span>
<span id="cb162-11"><a href="#cb162-11" aria-hidden="true" tabindex="-1"></a>      { status<span class="op">:</span> <span class="dv">429</span> }</span>
<span id="cb162-12"><a href="#cb162-12" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb162-13"><a href="#cb162-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb162-14"><a href="#cb162-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb162-15"><a href="#cb162-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Process request...</span></span>
<span id="cb162-16"><a href="#cb162-16" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="https-only">5. HTTPS Only</h3>
<div class="sourceCode" id="cb163"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="co">// next.config.mjs</span></span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> nextConfig <span class="op">=</span> {</span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">headers</span>() {</span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [</span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a>        source<span class="op">:</span> <span class="st">&#39;/(.*)&#39;</span><span class="op">,</span></span>
<span id="cb163-7"><a href="#cb163-7" aria-hidden="true" tabindex="-1"></a>        headers<span class="op">:</span> [</span>
<span id="cb163-8"><a href="#cb163-8" aria-hidden="true" tabindex="-1"></a>          {</span>
<span id="cb163-9"><a href="#cb163-9" aria-hidden="true" tabindex="-1"></a>            key<span class="op">:</span> <span class="st">&#39;Strict-Transport-Security&#39;</span><span class="op">,</span></span>
<span id="cb163-10"><a href="#cb163-10" aria-hidden="true" tabindex="-1"></a>            value<span class="op">:</span> <span class="st">&#39;max-age=31536000; includeSubDomains&#39;</span><span class="op">,</span></span>
<span id="cb163-11"><a href="#cb163-11" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb163-12"><a href="#cb163-12" aria-hidden="true" tabindex="-1"></a>        ]<span class="op">,</span></span>
<span id="cb163-13"><a href="#cb163-13" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb163-14"><a href="#cb163-14" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">;</span></span>
<span id="cb163-15"><a href="#cb163-15" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb163-16"><a href="#cb163-16" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<hr />
<h2 id="summary-validation-checklist">📊 Summary: Validation
Checklist</h2>
<h3 id="client-side">Client-Side</h3>
<ul class="task-list">
<li><label><input type="checkbox" />HTML5 validation (required,
minLength, maxLength)</label></li>
<li><label><input type="checkbox" />Real-time validation
feedback</label></li>
<li><label><input type="checkbox" />Clear error messages</label></li>
<li><label><input type="checkbox" />Disabled submit during
validation</label></li>
</ul>
<h3 id="server-side">Server-Side</h3>
<ul class="task-list">
<li><label><input type="checkbox" />Zod schema validation</label></li>
<li><label><input type="checkbox" />Sanitization (XSS
protection)</label></li>
<li><label><input type="checkbox" />Business logic
validation</label></li>
<li><label><input type="checkbox" />Error handling</label></li>
<li><label><input type="checkbox" />Rate limiting</label></li>
<li><label><input type="checkbox" />Request size limits</label></li>
</ul>
<h3 id="security">Security</h3>
<ul class="task-list">
<li><label><input type="checkbox" />Never trust client
input</label></li>
<li><label><input type="checkbox" />Always validate on
server</label></li>
<li><label><input type="checkbox" />Sanitize all inputs</label></li>
<li><label><input type="checkbox" />Use prepared statements
(Prisma)</label></li>
<li><label><input type="checkbox" />Implement rate limiting</label></li>
<li><label><input type="checkbox" />Use HTTPS in production</label></li>
</ul>
<hr />
<h1 id="database-prisma---panduan-lengkap">📊 DATABASE &amp; PRISMA -
PANDUAN LENGKAP</h1>
<p><strong>Dokumentasi Database dan ORM Prisma untuk Project
eCommerce</strong></p>
<hr />
<h2 id="daftar-isi-4">📑 Daftar Isi</h2>
<ol type="1">
<li><a href="#1-pengenalan-prisma">Pengenalan Prisma</a></li>
<li><a href="#2-database-schema">Database Schema</a></li>
<li><a href="#3-model--field-types">Model &amp; Field Types</a></li>
<li><a href="#4-relationships">Relationships</a></li>
<li><a href="#5-prisma-client">Prisma Client</a></li>
<li><a href="#6-migrations">Migrations</a></li>
<li><a href="#7-seeding">Seeding</a></li>
<li><a href="#8-query--operations">Query &amp; Operations</a></li>
<li><a href="#9-cara-menambah-field-baru">Cara Menambah Field
Baru</a></li>
<li><a href="#10-prisma-studio">Prisma Studio</a></li>
<li><a href="#11-best-practices">Best Practices</a></li>
<li><a href="#12-troubleshooting">Troubleshooting</a></li>
</ol>
<hr />
<h2 id="pengenalan-prisma">1. Pengenalan Prisma</h2>
<h3 id="apa-itu-prisma">1.1 Apa itu Prisma?</h3>
<p><strong>Prisma</strong> adalah <strong>Next-generation ORM
(Object-Relational Mapping)</strong> untuk Node.js dan TypeScript yang
mempermudah interaksi dengan database.</p>
<h4 id="keunggulan-prisma">🎯 Keunggulan Prisma:</h4>
<ol type="1">
<li><strong>Type-Safe</strong> - Auto-generated TypeScript types</li>
<li><strong>Auto-Completion</strong> - IntelliSense untuk semua
query</li>
<li><strong>Migrasi Otomatis</strong> - Version control untuk database
schema</li>
<li><strong>Prisma Studio</strong> - GUI untuk mengelola data</li>
<li><strong>Multi-Database</strong> - Support MySQL, PostgreSQL, SQLite,
MongoDB, dll.</li>
</ol>
<h4 id="komponen-prisma">📦 Komponen Prisma:</h4>
<pre><code>┌─────────────────────────────────────────────────┐
│              Prisma Ecosystem                   │
├─────────────────────────────────────────────────┤
│                                                 │
│  1. Prisma Schema (schema.prisma)              │
│     └─ Definisi models, fields, relationships  │
│                                                 │
│  2. Prisma Client                              │
│     └─ Auto-generated query builder            │
│                                                 │
│  3. Prisma Migrate                             │
│     └─ Database migration tool                 │
│                                                 │
│  4. Prisma Studio                              │
│     └─ Visual database editor                  │
│                                                 │
└─────────────────────────────────────────────────┘</code></pre>
<h3 id="instalasi-setup">1.2 Instalasi &amp; Setup</h3>
<h4 id="lokasi-file-konfigurasi">Lokasi File Konfigurasi:</h4>
<pre><code>prisma/
├── schema.prisma        # Schema definition
├── seed.js             # Data seeding script
└── migrations/         # Migration history
    ├── migration_lock.toml
    └── [timestamp]_[name]/
        └── migration.sql</code></pre>
<h4 id="commands-penting">Commands Penting:</h4>
<div class="sourceCode" id="cb166"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate Prisma Client (wajib setelah ubah schema)</span></span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma generate</span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Buat migration baru</span></span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma migrate dev <span class="at">--name</span> nama_migration</span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-7"><a href="#cb166-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Deploy migrations ke production</span></span>
<span id="cb166-8"><a href="#cb166-8" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma migrate deploy</span>
<span id="cb166-9"><a href="#cb166-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-10"><a href="#cb166-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Reset database (hati-hati!)</span></span>
<span id="cb166-11"><a href="#cb166-11" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma migrate reset</span>
<span id="cb166-12"><a href="#cb166-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-13"><a href="#cb166-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Buka Prisma Studio</span></span>
<span id="cb166-14"><a href="#cb166-14" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma studio</span>
<span id="cb166-15"><a href="#cb166-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-16"><a href="#cb166-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Sinkronkan schema dengan database existing</span></span>
<span id="cb166-17"><a href="#cb166-17" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma db pull</span>
<span id="cb166-18"><a href="#cb166-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-19"><a href="#cb166-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Push schema tanpa migration (prototyping)</span></span>
<span id="cb166-20"><a href="#cb166-20" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma db push</span></code></pre></div>
<hr />
<h2 id="database-schema-1">2. Database Schema</h2>
<h3 id="konfigurasi-prisma">2.1 Konfigurasi Prisma</h3>
<p><strong>📁 Lokasi:</strong> <code>prisma/schema.prisma</code></p>
<pre class="prisma"><code>// Generator: Menentukan client yang di-generate
generator client {
  provider = &quot;prisma-client-js&quot;
}

// Datasource: Koneksi database
datasource db {
  provider = &quot;mysql&quot;              // Tipe database
  url      = env(&quot;DATABASE_URL&quot;)  // Ambil dari .env
}</code></pre>
<h3 id="environment-variable">2.2 Environment Variable</h3>
<p><strong>📁 Lokasi:</strong> <code>.env</code></p>
<pre class="env"><code># Format: mysql://USER:PASSWORD@HOST:PORT/DATABASE
DATABASE_URL=&quot;mysql://root:password@localhost:3306/ecommerce_db&quot;

# Atau dengan options tambahan:
DATABASE_URL=&quot;mysql://user:pass@localhost:3306/db?schema=public&amp;connection_limit=5&quot;</code></pre>
<h4 id="parameter-connection-string">🔑 Parameter Connection
String:</h4>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Deskripsi</th>
<th>Contoh</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>user</code></td>
<td>Username MySQL</td>
<td><code>root</code></td>
</tr>
<tr>
<td><code>password</code></td>
<td>Password MySQL</td>
<td><code>secretPass123</code></td>
</tr>
<tr>
<td><code>host</code></td>
<td>Server host</td>
<td><code>localhost</code> atau <code>127.0.0.1</code></td>
</tr>
<tr>
<td><code>port</code></td>
<td>Port MySQL</td>
<td><code>3306</code> (default)</td>
</tr>
<tr>
<td><code>database</code></td>
<td>Nama database</td>
<td><code>ecommerce_db</code></td>
</tr>
<tr>
<td><code>schema</code></td>
<td>Schema name</td>
<td><code>public</code></td>
</tr>
<tr>
<td><code>connection_limit</code></td>
<td>Max connections</td>
<td><code>5</code></td>
</tr>
<tr>
<td><code>pool_timeout</code></td>
<td>Timeout (detik)</td>
<td><code>10</code></td>
</tr>
</tbody>
</table>
<hr />
<h2 id="model-field-types">3. Model &amp; Field Types</h2>
<h3 id="overview-semua-models">3.1 Overview Semua Models</h3>
<p>Project ini memiliki <strong>8 models</strong> dalam database:</p>
<pre><code>1. Product              - Produk yang dijual
2. Image                - Gambar produk (multiple images)
3. Category             - Kategori produk
4. User                 - User &amp; Admin
5. Customer_order       - Order pelanggan
6. customer_order_product - Join table (Order ↔ Product)
7. Wishlist             - Daftar keinginan user
8. Feedback             - Review/rating produk</code></pre>
<h3 id="model-product">3.2 Model: Product</h3>
<p><strong>📁 Lokasi Schema:</strong> <code>prisma/schema.prisma</code>
(baris 16-30)</p>
<pre class="prisma"><code>model Product {
  id             String                   @id @default(uuid())
  slug           String                   @unique
  title          String
  mainImage      String
  price          Int                      @default(0)
  rating         Int                      @default(0)
  description    String
  manufacturer   String
  inStock        Int                      @default(1)
  categoryId     String
  category       Category                 @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  customerOrders customer_order_product[]
  Wishlist       Wishlist[]
  feedbacks      Feedback[]
}</code></pre>
<h4 id="penjelasan-field">📊 Penjelasan Field:</h4>
<table>
<colgroup>
<col style="width: 19%" />
<col style="width: 16%" />
<col style="width: 33%" />
<col style="width: 30%" />
</colgroup>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Constraint</th>
<th>Deskripsi</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>String</td>
<td><code>@id</code> <code>@default(uuid())</code></td>
<td>Primary key, auto-generate UUID</td>
</tr>
<tr>
<td><code>slug</code></td>
<td>String</td>
<td><code>@unique</code></td>
<td>URL-friendly identifier (harus unik)</td>
</tr>
<tr>
<td><code>title</code></td>
<td>String</td>
<td>-</td>
<td>Nama produk</td>
</tr>
<tr>
<td><code>mainImage</code></td>
<td>String</td>
<td>-</td>
<td>URL gambar utama</td>
</tr>
<tr>
<td><code>price</code></td>
<td>Int</td>
<td><code>@default(0)</code></td>
<td>Harga dalam <strong>integer</strong> (rupiah × 100)</td>
</tr>
<tr>
<td><code>rating</code></td>
<td>Int</td>
<td><code>@default(0)</code></td>
<td>Rating aggregate (dihitung dari feedback)</td>
</tr>
<tr>
<td><code>description</code></td>
<td>String</td>
<td>-</td>
<td>Deskripsi produk (TEXT di MySQL)</td>
</tr>
<tr>
<td><code>manufacturer</code></td>
<td>String</td>
<td>-</td>
<td>Nama brand/pembuat</td>
</tr>
<tr>
<td><code>inStock</code></td>
<td>Int</td>
<td><code>@default(1)</code></td>
<td>Jumlah stok tersedia</td>
</tr>
<tr>
<td><code>categoryId</code></td>
<td>String</td>
<td>Foreign Key</td>
<td>ID kategori (relasi ke Category)</td>
</tr>
</tbody>
</table>
<h4 id="relasi-product">🔗 Relasi Product:</h4>
<ol type="1">
<li><strong>Category</strong> (Many-to-One) - Setiap product punya 1
category</li>
<li><strong>customerOrders</strong> (Many-to-Many) - Product bisa ada di
banyak order</li>
<li><strong>Wishlist</strong> (One-to-Many) - Product bisa ada di banyak
wishlist</li>
<li><strong>feedbacks</strong> (One-to-Many) - Product bisa punya banyak
feedback</li>
</ol>
<h4 id="kenapa-price-pakai-int-bukan-float">💡 Kenapa Price pakai Int,
bukan Float?</h4>
<div class="sourceCode" id="cb171"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ❌ SALAH: Float tidak akurat untuk uang</span></span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a>price<span class="op">:</span> <span class="fl">19.99</span>  <span class="co">// Bisa jadi 19.989999999</span></span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-4"><a href="#cb171-4" aria-hidden="true" tabindex="-1"></a><span class="co">// ✅ BENAR: Simpan dalam cent/sen</span></span>
<span id="cb171-5"><a href="#cb171-5" aria-hidden="true" tabindex="-1"></a>price<span class="op">:</span> <span class="dv">1999</span>   <span class="co">// Representasi 19.99</span></span>
<span id="cb171-6"><a href="#cb171-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-7"><a href="#cb171-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Tampilkan di frontend:</span></span>
<span id="cb171-8"><a href="#cb171-8" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> displayPrice <span class="op">=</span> (price <span class="op">/</span> <span class="dv">100</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>) <span class="op">+</span> <span class="st">&quot; USD&quot;</span></span>
<span id="cb171-9"><a href="#cb171-9" aria-hidden="true" tabindex="-1"></a><span class="co">// Output: &quot;19.99 USD&quot;</span></span></code></pre></div>
<h3 id="model-image">3.3 Model: Image</h3>
<pre class="prisma"><code>model Image {
  imageID   String @id @default(uuid())
  productID String
  image     String
}</code></pre>
<h4 id="catatan-penting">⚠️ Catatan Penting:</h4>
<p>Model ini <strong>tidak punya relasi eksplisit</strong> ke Product!
Seharusnya:</p>
<pre class="prisma"><code>model Image {
  imageID   String  @id @default(uuid())
  productId String
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  image     String

  @@map(&quot;Image&quot;) // Nama table di database
}</code></pre>
<p>Dan tambahkan di Product:</p>
<pre class="prisma"><code>model Product {
  // ... field lain
  images Image[] // Relasi one-to-many
}</code></pre>
<h3 id="model-user">3.4 Model: User</h3>
<pre class="prisma"><code>model User {
  id        String     @id @default(uuid())
  email     String     @unique
  password  String?    // Optional (untuk OAuth users)
  role      String?    @default(&quot;user&quot;)
  Wishlist  Wishlist[]
  feedbacks Feedback[]
}</code></pre>
<h4 id="penjelasan-field-1">📊 Penjelasan Field:</h4>
<table>
<colgroup>
<col style="width: 19%" />
<col style="width: 16%" />
<col style="width: 33%" />
<col style="width: 30%" />
</colgroup>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Constraint</th>
<th>Deskripsi</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>String</td>
<td><code>@id</code></td>
<td>UUID primary key</td>
</tr>
<tr>
<td><code>email</code></td>
<td>String</td>
<td><code>@unique</code></td>
<td>Email user (harus unik)</td>
</tr>
<tr>
<td><code>password</code></td>
<td>String?</td>
<td>Optional</td>
<td>Hash bcrypt (null untuk OAuth)</td>
</tr>
<tr>
<td><code>role</code></td>
<td>String?</td>
<td><code>@default("user")</code></td>
<td>Role: <code>"user"</code> atau <code>"admin"</code></td>
</tr>
</tbody>
</table>
<h4 id="kenapa-password-optional-string">🔐 Kenapa Password Optional
(<code>String?</code>)?</h4>
<p>Karena support <strong>OAuth login</strong> (Google/GitHub) yang
tidak memerlukan password:</p>
<div class="sourceCode" id="cb176"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="co">// User dengan password (credentials login)</span></span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">email</span><span class="op">:</span> <span class="st">&quot;user@example.com&quot;</span><span class="op">,</span></span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">password</span><span class="op">:</span> <span class="st">&quot;$2a$10$hashedPasswordHere&quot;</span><span class="op">,</span></span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">role</span><span class="op">:</span> <span class="st">&quot;user&quot;</span></span>
<span id="cb176-6"><a href="#cb176-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb176-7"><a href="#cb176-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-8"><a href="#cb176-8" aria-hidden="true" tabindex="-1"></a><span class="co">// User OAuth (tanpa password)</span></span>
<span id="cb176-9"><a href="#cb176-9" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb176-10"><a href="#cb176-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">email</span><span class="op">:</span> <span class="st">&quot;user@gmail.com&quot;</span><span class="op">,</span></span>
<span id="cb176-11"><a href="#cb176-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">password</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span>  <span class="co">// ← OAuth users</span></span>
<span id="cb176-12"><a href="#cb176-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">role</span><span class="op">:</span> <span class="st">&quot;user&quot;</span></span>
<span id="cb176-13"><a href="#cb176-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="model-category">3.5 Model: Category</h3>
<pre class="prisma"><code>model Category {
  id       String    @id @default(uuid())
  name     String    @unique
  products Product[] // One-to-many relationship
}</code></pre>
<h4 id="contoh-data">💡 Contoh Data:</h4>
<div class="sourceCode" id="cb178"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a>[</span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">id</span><span class="op">:</span> <span class="st">&quot;uuid-1&quot;</span><span class="op">,</span> <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Electronics&quot;</span> }<span class="op">,</span></span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">id</span><span class="op">:</span> <span class="st">&quot;uuid-2&quot;</span><span class="op">,</span> <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Laptops&quot;</span> }<span class="op">,</span></span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">id</span><span class="op">:</span> <span class="st">&quot;uuid-3&quot;</span><span class="op">,</span> <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Smartphones&quot;</span> }<span class="op">,</span></span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">id</span><span class="op">:</span> <span class="st">&quot;uuid-4&quot;</span><span class="op">,</span> <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Cameras&quot;</span> }</span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a>]</span></code></pre></div>
<h3 id="model-customer_order">3.6 Model: Customer_order</h3>
<pre class="prisma"><code>model Customer_order {
  id          String                   @id @default(uuid())
  name        String
  lastname    String
  phone       String
  email       String
  company     String
  adress      String                    // Typo: seharusnya &quot;address&quot;
  apartment   String
  postalCode  String
  dateTime    DateTime?                 @default(now())
  status      String
  city        String
  country     String
  orderNotice String?                   // Optional: catatan order
  total       Int
  products    customer_order_product[]  // Relasi many-to-many
}</code></pre>
<h4 id="status-order">📦 Status Order:</h4>
<div class="sourceCode" id="cb180"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> ORDER_STATUS <span class="op">=</span> {</span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">PENDING</span><span class="op">:</span> <span class="st">&quot;pending&quot;</span><span class="op">,</span>        <span class="co">// Menunggu pembayaran</span></span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">PROCESSING</span><span class="op">:</span> <span class="st">&quot;processing&quot;</span><span class="op">,</span>  <span class="co">// Sedang diproses</span></span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">SHIPPED</span><span class="op">:</span> <span class="st">&quot;shipped&quot;</span><span class="op">,</span>        <span class="co">// Dikirim</span></span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">DELIVERED</span><span class="op">:</span> <span class="st">&quot;delivered&quot;</span><span class="op">,</span>    <span class="co">// Sampai</span></span>
<span id="cb180-6"><a href="#cb180-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">CANCELLED</span><span class="op">:</span> <span class="st">&quot;cancelled&quot;</span>     <span class="co">// Dibatalkan</span></span>
<span id="cb180-7"><a href="#cb180-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="model-customer_order_product-join-table">3.7 Model:
customer_order_product (Join Table)</h3>
<pre class="prisma"><code>model customer_order_product {
  id              String         @id @default(uuid())
  customerOrder   Customer_order @relation(fields: [customerOrderId], references: [id])
  customerOrderId String
  product         Product        @relation(fields: [productId], references: [id])
  productId       String
  quantity        Int
}</code></pre>
<h4 id="fungsi-join-table">🎯 Fungsi Join Table:</h4>
<p>Menghubungkan <strong>Many-to-Many</strong> antara Order dan
Product:</p>
<pre><code>Customer_order (1) ←→ (N) customer_order_product (N) ←→ (1) Product</code></pre>
<p>Contoh data:</p>
<div class="sourceCode" id="cb183"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Order #1 punya 2 produk:</span></span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">id</span><span class="op">:</span> <span class="st">&quot;order-1&quot;</span><span class="op">,</span></span>
<span id="cb183-4"><a href="#cb183-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">total</span><span class="op">:</span> <span class="dv">5000</span><span class="op">,</span></span>
<span id="cb183-5"><a href="#cb183-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">products</span><span class="op">:</span> [</span>
<span id="cb183-6"><a href="#cb183-6" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">productId</span><span class="op">:</span> <span class="st">&quot;prod-a&quot;</span><span class="op">,</span> <span class="dt">quantity</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span> <span class="co">// 2x Product A</span></span>
<span id="cb183-7"><a href="#cb183-7" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">productId</span><span class="op">:</span> <span class="st">&quot;prod-b&quot;</span><span class="op">,</span> <span class="dt">quantity</span><span class="op">:</span> <span class="dv">1</span> }  <span class="co">// 1x Product B</span></span>
<span id="cb183-8"><a href="#cb183-8" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb183-9"><a href="#cb183-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="model-wishlist">3.8 Model: Wishlist</h3>
<pre class="prisma"><code>model Wishlist {
  id        String  @id @default(uuid())
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId String
  user      User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
}</code></pre>
<h4 id="cascade-delete">🔄 Cascade Delete:</h4>
<p><code>onDelete: Cascade</code> artinya: - Jika <strong>Product
dihapus</strong> → Wishlist items ikut terhapus - Jika <strong>User
dihapus</strong> → Wishlist items ikut terhapus</p>
<h3 id="model-feedback">3.9 Model: Feedback</h3>
<pre class="prisma"><code>model Feedback {
  id        String   @id @default(uuid())
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
  comment   String
  rating    Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([productId, userId]) // Satu user hanya bisa beri satu feedback per produk
}</code></pre>
<h4 id="rating-system">🌟 Rating System:</h4>
<div class="sourceCode" id="cb186"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Validasi rating (1-5)</span></span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a>rating<span class="op">:</span> z<span class="op">.</span><span class="fu">number</span>()<span class="op">.</span><span class="fu">int</span>()<span class="op">.</span><span class="fu">min</span>(<span class="dv">1</span>)<span class="op">.</span><span class="fu">max</span>(<span class="dv">5</span>)</span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-4"><a href="#cb186-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Hitung average rating:</span></span>
<span id="cb186-5"><a href="#cb186-5" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> avgRating <span class="op">=</span> feedbacks<span class="op">.</span><span class="fu">reduce</span>((sum<span class="op">,</span> f) <span class="kw">=&gt;</span> sum <span class="op">+</span> f<span class="op">.</span><span class="at">rating</span><span class="op">,</span> <span class="dv">0</span>) <span class="op">/</span> feedbacks<span class="op">.</span><span class="at">length</span></span></code></pre></div>
<h4 id="unique-constraint">🔒 Unique Constraint:</h4>
<pre class="prisma"><code>@@unique([productId, userId])</code></pre>
<p>Artinya: <strong>1 user hanya bisa kasih 1 feedback untuk 1
produk</strong>.</p>
<p>❌ Tidak bisa:</p>
<div class="sourceCode" id="cb188"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="co">// User &quot;user-1&quot; kasih 2 feedback untuk &quot;product-a&quot;</span></span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">userId</span><span class="op">:</span> <span class="st">&quot;user-1&quot;</span><span class="op">,</span> <span class="dt">productId</span><span class="op">:</span> <span class="st">&quot;product-a&quot;</span><span class="op">,</span> <span class="dt">rating</span><span class="op">:</span> <span class="dv">5</span> }</span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">userId</span><span class="op">:</span> <span class="st">&quot;user-1&quot;</span><span class="op">,</span> <span class="dt">productId</span><span class="op">:</span> <span class="st">&quot;product-a&quot;</span><span class="op">,</span> <span class="dt">rating</span><span class="op">:</span> <span class="dv">4</span> } <span class="co">// ERROR!</span></span></code></pre></div>
<p>✅ Bisa:</p>
<div class="sourceCode" id="cb189"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="co">// User &quot;user-1&quot; kasih feedback untuk 2 produk berbeda</span></span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">userId</span><span class="op">:</span> <span class="st">&quot;user-1&quot;</span><span class="op">,</span> <span class="dt">productId</span><span class="op">:</span> <span class="st">&quot;product-a&quot;</span><span class="op">,</span> <span class="dt">rating</span><span class="op">:</span> <span class="dv">5</span> }</span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a>{ <span class="dt">userId</span><span class="op">:</span> <span class="st">&quot;user-1&quot;</span><span class="op">,</span> <span class="dt">productId</span><span class="op">:</span> <span class="st">&quot;product-b&quot;</span><span class="op">,</span> <span class="dt">rating</span><span class="op">:</span> <span class="dv">4</span> }</span></code></pre></div>
<hr />
<h2 id="relationships">4. Relationships</h2>
<h3 id="jenis-relasi">4.1 Jenis Relasi</h3>
<p>Prisma mendukung 3 jenis relasi:</p>
<pre><code>1. One-to-One   (1:1)   - Jarang dipakai
2. One-to-Many  (1:N)   - Paling umum
3. Many-to-Many (M:N)   - Butuh join table</code></pre>
<h3 id="one-to-many-1n">4.2 One-to-Many (1:N)</h3>
<h4 id="contoh-category-products">Contoh: Category → Products</h4>
<pre class="prisma"><code>model Category {
  id       String    @id @default(uuid())
  name     String    @unique
  products Product[] // ← Array = &quot;banyak products&quot;
}

model Product {
  id         String   @id @default(uuid())
  categoryId String   // ← Foreign key
  category   Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  // ... field lain
}</code></pre>
<h4 id="visual">📊 Visual:</h4>
<pre><code>Category (1)
    │
    ├─ Product 1
    ├─ Product 2
    ├─ Product 3
    └─ Product 4</code></pre>
<h4 id="query-example">💻 Query Example:</h4>
<div class="sourceCode" id="cb193"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Get category dengan semua products-nya</span></span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> category <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">category</span><span class="op">.</span><span class="fu">findUnique</span>({</span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">where</span><span class="op">:</span> { <span class="dt">id</span><span class="op">:</span> <span class="st">&quot;category-id&quot;</span> }<span class="op">,</span></span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">include</span><span class="op">:</span> { <span class="dt">products</span><span class="op">:</span> <span class="kw">true</span> }</span>
<span id="cb193-5"><a href="#cb193-5" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb193-6"><a href="#cb193-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-7"><a href="#cb193-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Output:</span></span>
<span id="cb193-8"><a href="#cb193-8" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb193-9"><a href="#cb193-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">id</span><span class="op">:</span> <span class="st">&quot;category-id&quot;</span><span class="op">,</span></span>
<span id="cb193-10"><a href="#cb193-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Electronics&quot;</span><span class="op">,</span></span>
<span id="cb193-11"><a href="#cb193-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">products</span><span class="op">:</span> [</span>
<span id="cb193-12"><a href="#cb193-12" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">id</span><span class="op">:</span> <span class="st">&quot;prod-1&quot;</span><span class="op">,</span> <span class="dt">title</span><span class="op">:</span> <span class="st">&quot;Laptop&quot;</span><span class="op">,</span> <span class="op">...</span> }<span class="op">,</span></span>
<span id="cb193-13"><a href="#cb193-13" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">id</span><span class="op">:</span> <span class="st">&quot;prod-2&quot;</span><span class="op">,</span> <span class="dt">title</span><span class="op">:</span> <span class="st">&quot;Phone&quot;</span><span class="op">,</span> <span class="op">...</span> }</span>
<span id="cb193-14"><a href="#cb193-14" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb193-15"><a href="#cb193-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="many-to-many-mn">4.3 Many-to-Many (M:N)</h3>
<h4 id="contoh-orders-products">Contoh: Orders ↔︎ Products</h4>
<pre class="prisma"><code>model Customer_order {
  id       String                   @id
  products customer_order_product[] // ← Join table
}

model Product {
  id             String                   @id
  customerOrders customer_order_product[] // ← Join table
}

// Join table (explicit many-to-many)
model customer_order_product {
  id              String         @id @default(uuid())
  customerOrder   Customer_order @relation(fields: [customerOrderId], references: [id])
  customerOrderId String
  product         Product        @relation(fields: [productId], references: [id])
  productId       String
  quantity        Int           // ← Extra data di join table
}</code></pre>
<h4 id="visual-1">📊 Visual:</h4>
<pre><code>Order #1 ←→ [Join: 2x Laptop] ←→ Product: Laptop
Order #1 ←→ [Join: 1x Mouse]  ←→ Product: Mouse
Order #2 ←→ [Join: 1x Laptop] ←→ Product: Laptop</code></pre>
<h4 id="query-example-1">💻 Query Example:</h4>
<div class="sourceCode" id="cb196"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Get order dengan products-nya</span></span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> order <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">customer_order</span><span class="op">.</span><span class="fu">findUnique</span>({</span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">where</span><span class="op">:</span> { <span class="dt">id</span><span class="op">:</span> <span class="st">&quot;order-id&quot;</span> }<span class="op">,</span></span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">include</span><span class="op">:</span> {</span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">products</span><span class="op">:</span> {</span>
<span id="cb196-6"><a href="#cb196-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">include</span><span class="op">:</span> {</span>
<span id="cb196-7"><a href="#cb196-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">product</span><span class="op">:</span> <span class="kw">true</span> <span class="co">// Nested include</span></span>
<span id="cb196-8"><a href="#cb196-8" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb196-9"><a href="#cb196-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb196-10"><a href="#cb196-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb196-11"><a href="#cb196-11" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb196-12"><a href="#cb196-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-13"><a href="#cb196-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Output:</span></span>
<span id="cb196-14"><a href="#cb196-14" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb196-15"><a href="#cb196-15" aria-hidden="true" tabindex="-1"></a>  <span class="dt">id</span><span class="op">:</span> <span class="st">&quot;order-id&quot;</span><span class="op">,</span></span>
<span id="cb196-16"><a href="#cb196-16" aria-hidden="true" tabindex="-1"></a>  <span class="dt">total</span><span class="op">:</span> <span class="dv">5000</span><span class="op">,</span></span>
<span id="cb196-17"><a href="#cb196-17" aria-hidden="true" tabindex="-1"></a>  <span class="dt">products</span><span class="op">:</span> [</span>
<span id="cb196-18"><a href="#cb196-18" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb196-19"><a href="#cb196-19" aria-hidden="true" tabindex="-1"></a>      <span class="dt">id</span><span class="op">:</span> <span class="st">&quot;join-1&quot;</span><span class="op">,</span></span>
<span id="cb196-20"><a href="#cb196-20" aria-hidden="true" tabindex="-1"></a>      <span class="dt">quantity</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb196-21"><a href="#cb196-21" aria-hidden="true" tabindex="-1"></a>      <span class="dt">product</span><span class="op">:</span> { <span class="dt">id</span><span class="op">:</span> <span class="st">&quot;prod-1&quot;</span><span class="op">,</span> <span class="dt">title</span><span class="op">:</span> <span class="st">&quot;Laptop&quot;</span><span class="op">,</span> <span class="dt">price</span><span class="op">:</span> <span class="dv">2000</span> }</span>
<span id="cb196-22"><a href="#cb196-22" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb196-23"><a href="#cb196-23" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb196-24"><a href="#cb196-24" aria-hidden="true" tabindex="-1"></a>      <span class="dt">id</span><span class="op">:</span> <span class="st">&quot;join-2&quot;</span><span class="op">,</span></span>
<span id="cb196-25"><a href="#cb196-25" aria-hidden="true" tabindex="-1"></a>      <span class="dt">quantity</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb196-26"><a href="#cb196-26" aria-hidden="true" tabindex="-1"></a>      <span class="dt">product</span><span class="op">:</span> { <span class="dt">id</span><span class="op">:</span> <span class="st">&quot;prod-2&quot;</span><span class="op">,</span> <span class="dt">title</span><span class="op">:</span> <span class="st">&quot;Mouse&quot;</span><span class="op">,</span> <span class="dt">price</span><span class="op">:</span> <span class="dv">1000</span> }</span>
<span id="cb196-27"><a href="#cb196-27" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb196-28"><a href="#cb196-28" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb196-29"><a href="#cb196-29" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="referential-actions">4.4 Referential Actions</h3>
<h4 id="ondelete-options">onDelete Options:</h4>
<table>
<colgroup>
<col style="width: 29%" />
<col style="width: 40%" />
<col style="width: 29%" />
</colgroup>
<thead>
<tr>
<th>Action</th>
<th>Deskripsi</th>
<th>Contoh</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Cascade</code></td>
<td>Hapus child jika parent dihapus</td>
<td>Hapus Product → Hapus Wishlist</td>
</tr>
<tr>
<td><code>Restrict</code></td>
<td>Cegah hapus parent jika punya child</td>
<td>Tidak bisa hapus Category jika masih punya Product</td>
</tr>
<tr>
<td><code>SetNull</code></td>
<td>Set foreign key jadi NULL</td>
<td>Hapus Category → Product.categoryId = NULL</td>
</tr>
<tr>
<td><code>NoAction</code></td>
<td>Database handle sendiri</td>
<td>Default MySQL behavior</td>
</tr>
</tbody>
</table>
<h4 id="contoh-di-schema">Contoh di Schema:</h4>
<pre class="prisma"><code>model Wishlist {
  id        String  @id @default(uuid())
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  //                                                                 ^^^^^^^^^^^^^^^^
  productId String
}</code></pre>
<p>Artinya:</p>
<div class="sourceCode" id="cb198"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Jika hapus product...</span></span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> prisma<span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="fu">delete</span>({ <span class="dt">where</span><span class="op">:</span> { <span class="dt">id</span><span class="op">:</span> <span class="st">&quot;prod-1&quot;</span> } })</span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a><span class="co">// ...wishlist items dengan productId &quot;prod-1&quot; ikut terhapus otomatis!</span></span></code></pre></div>
<hr />
<h2 id="prisma-client">5. Prisma Client</h2>
<h3 id="generate-client">5.1 Generate Client</h3>
<p>Setiap kali ubah <code>schema.prisma</code>, <strong>wajib</strong>
jalankan:</p>
<div class="sourceCode" id="cb199"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma generate</span></code></pre></div>
<p>Ini akan: 1. Generate TypeScript types di
<code>node_modules/.prisma/client</code> 2. Update auto-completion di
IDE 3. Membuat query builder yang type-safe</p>
<h3 id="import-initialize">5.2 Import &amp; Initialize</h3>
<p><strong>📁 Cara Pakai di Next.js:</strong></p>
<div class="sourceCode" id="cb200"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="co">// lib/prisma.ts (Singleton pattern)</span></span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { PrismaClient } <span class="im">from</span> <span class="st">&#39;@prisma/client&#39;</span></span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-4"><a href="#cb200-4" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> globalForPrisma <span class="op">=</span> <span class="bu">global</span> <span class="im">as</span> unknown <span class="im">as</span> { <span class="dt">prisma</span><span class="op">:</span> PrismaClient }</span>
<span id="cb200-5"><a href="#cb200-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-6"><a href="#cb200-6" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> prisma <span class="op">=</span></span>
<span id="cb200-7"><a href="#cb200-7" aria-hidden="true" tabindex="-1"></a>  globalForPrisma<span class="op">.</span><span class="at">prisma</span> <span class="op">||</span></span>
<span id="cb200-8"><a href="#cb200-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">new</span> <span class="fu">PrismaClient</span>({</span>
<span id="cb200-9"><a href="#cb200-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">log</span><span class="op">:</span> [<span class="st">&#39;query&#39;</span><span class="op">,</span> <span class="st">&#39;error&#39;</span><span class="op">,</span> <span class="st">&#39;warn&#39;</span>]<span class="op">,</span> <span class="co">// Log queries di development</span></span>
<span id="cb200-10"><a href="#cb200-10" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb200-11"><a href="#cb200-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-12"><a href="#cb200-12" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="bu">process</span><span class="op">.</span><span class="at">env</span><span class="op">.</span><span class="at">NODE_ENV</span> <span class="op">!==</span> <span class="st">&#39;production&#39;</span>) globalForPrisma<span class="op">.</span><span class="at">prisma</span> <span class="op">=</span> prisma</span></code></pre></div>
<p><strong>📁 Pakai di API Route:</strong></p>
<div class="sourceCode" id="cb201"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="co">// app/api/products/route.ts</span></span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { prisma } <span class="im">from</span> <span class="st">&#39;@/lib/prisma&#39;</span></span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-4"><a href="#cb201-4" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">async</span> <span class="kw">function</span> <span class="fu">GET</span>() {</span>
<span id="cb201-5"><a href="#cb201-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> products <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="fu">findMany</span>()</span>
<span id="cb201-6"><a href="#cb201-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Response<span class="op">.</span><span class="fu">json</span>(products)</span>
<span id="cb201-7"><a href="#cb201-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="query-methods">5.3 Query Methods</h3>
<h4 id="crud-operations">CRUD Operations:</h4>
<table>
<colgroup>
<col style="width: 22%" />
<col style="width: 45%" />
<col style="width: 31%" />
</colgroup>
<thead>
<tr>
<th>Method</th>
<th>SQL Equivalent</th>
<th>Deskripsi</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>findMany()</code></td>
<td><code>SELECT *</code></td>
<td>Ambil banyak record</td>
</tr>
<tr>
<td><code>findUnique()</code></td>
<td><code>SELECT * WHERE id = ?</code></td>
<td>Ambil 1 record by unique field</td>
</tr>
<tr>
<td><code>findFirst()</code></td>
<td><code>SELECT * LIMIT 1</code></td>
<td>Ambil 1 record pertama</td>
</tr>
<tr>
<td><code>create()</code></td>
<td><code>INSERT INTO</code></td>
<td>Buat record baru</td>
</tr>
<tr>
<td><code>update()</code></td>
<td><code>UPDATE</code></td>
<td>Update record</td>
</tr>
<tr>
<td><code>delete()</code></td>
<td><code>DELETE</code></td>
<td>Hapus record</td>
</tr>
<tr>
<td><code>upsert()</code></td>
<td><code>INSERT ... ON DUPLICATE KEY UPDATE</code></td>
<td>Create atau update</td>
</tr>
<tr>
<td><code>count()</code></td>
<td><code>SELECT COUNT(*)</code></td>
<td>Hitung jumlah record</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="migrations">6. Migrations</h2>
<h3 id="apa-itu-migration">6.1 Apa itu Migration?</h3>
<p><strong>Migration</strong> = Version control untuk database
schema.</p>
<h4 id="lokasi-migrations">📁 Lokasi Migrations:</h4>
<pre><code>prisma/migrations/
├── 20240101000000_init/
│   └── migration.sql
├── 20240102000000_add_feedback/
│   └── migration.sql
└── migration_lock.toml</code></pre>
<h3 id="development-workflow">6.2 Development Workflow</h3>
<h4 id="ubah-schema">1️⃣ Ubah Schema</h4>
<p>Edit <code>prisma/schema.prisma</code>:</p>
<pre class="prisma"><code>model Product {
  // Tambah field baru:
  discount Float? @default(0)
}</code></pre>
<h4 id="buat-migration">2️⃣ Buat Migration</h4>
<div class="sourceCode" id="cb204"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma migrate dev <span class="at">--name</span> add_discount_field</span></code></pre></div>
<p>Output:</p>
<pre><code>✔ Migration created: 20240315120000_add_discount_field
✔ Applied migration: 20240315120000_add_discount_field
✔ Generated Prisma Client</code></pre>
<h4 id="file-migration-dibuat">3️⃣ File Migration Dibuat</h4>
<p><code>prisma/migrations/20240315120000_add_discount_field/migration.sql</code>:</p>
<div class="sourceCode" id="cb206"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- AlterTable</span></span>
<span id="cb206-2"><a href="#cb206-2" aria-hidden="true" tabindex="-1"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> `Product` <span class="kw">ADD</span> <span class="kw">COLUMN</span> `discount` <span class="dt">DOUBLE</span> <span class="kw">NULL</span> <span class="kw">DEFAULT</span> <span class="dv">0</span>;</span></code></pre></div>
<h3 id="production-deployment">6.3 Production Deployment</h3>
<p><strong>❌ JANGAN</strong> pakai <code>prisma migrate dev</code> di
production!</p>
<p><strong>✅ GUNAKAN:</strong></p>
<div class="sourceCode" id="cb207"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Deploy pending migrations</span></span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma migrate deploy</span></code></pre></div>
<h3 id="migration-commands-lengkap">6.4 Migration Commands Lengkap</h3>
<div class="sourceCode" id="cb208"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Buat migration baru (development)</span></span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma migrate dev <span class="at">--name</span> nama_migration</span>
<span id="cb208-3"><a href="#cb208-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-4"><a href="#cb208-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Deploy migrations (production)</span></span>
<span id="cb208-5"><a href="#cb208-5" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma migrate deploy</span>
<span id="cb208-6"><a href="#cb208-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-7"><a href="#cb208-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Check migration status</span></span>
<span id="cb208-8"><a href="#cb208-8" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma migrate status</span>
<span id="cb208-9"><a href="#cb208-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-10"><a href="#cb208-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Reset database (HAPUS SEMUA DATA!)</span></span>
<span id="cb208-11"><a href="#cb208-11" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma migrate reset</span>
<span id="cb208-12"><a href="#cb208-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-13"><a href="#cb208-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Resolve migration conflicts</span></span>
<span id="cb208-14"><a href="#cb208-14" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma migrate resolve <span class="at">--applied</span> <span class="st">&quot;20240315120000_migration_name&quot;</span></span></code></pre></div>
<h3 id="rollback-migration">6.5 Rollback Migration</h3>
<p>⚠️ Prisma <strong>tidak support rollback otomatis</strong>!</p>
<p><strong>Manual rollback:</strong></p>
<ol type="1">
<li>Hapus migration file terakhir</li>
<li>Edit schema.prisma (kembalikan ke state sebelumnya)</li>
<li>Jalankan SQL manual untuk undo changes:</li>
</ol>
<div class="sourceCode" id="cb209"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Contoh: hapus field discount</span></span>
<span id="cb209-2"><a href="#cb209-2" aria-hidden="true" tabindex="-1"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> `Product` <span class="kw">DROP</span> <span class="kw">COLUMN</span> `discount`;</span></code></pre></div>
<ol start="4" type="1">
<li>Mark migration sebagai resolved:</li>
</ol>
<div class="sourceCode" id="cb210"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma migrate resolve <span class="at">--rolled-back</span> <span class="st">&quot;20240315120000_add_discount_field&quot;</span></span></code></pre></div>
<hr />
<h2 id="seeding">7. Seeding</h2>
<h3 id="apa-itu-seeding">7.1 Apa itu Seeding?</h3>
<p><strong>Seeding</strong> = Isi database dengan data awal (dummy data
untuk testing).</p>
<p><strong>📁 Lokasi:</strong> <code>prisma/seed.js</code></p>
<h3 id="seed-script">7.2 Seed Script</h3>
<div class="sourceCode" id="cb211"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> { PrismaClient } <span class="op">=</span> <span class="pp">require</span>(<span class="st">&quot;@prisma/client&quot;</span>)<span class="op">;</span></span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> bcrypt <span class="op">=</span> <span class="pp">require</span>(<span class="st">&quot;bcryptjs&quot;</span>)<span class="op">;</span></span>
<span id="cb211-3"><a href="#cb211-3" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> { nanoid } <span class="op">=</span> <span class="pp">require</span>(<span class="st">&quot;nanoid&quot;</span>)<span class="op">;</span></span>
<span id="cb211-4"><a href="#cb211-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-5"><a href="#cb211-5" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> prisma <span class="op">=</span> <span class="kw">new</span> <span class="fu">PrismaClient</span>()<span class="op">;</span></span>
<span id="cb211-6"><a href="#cb211-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-7"><a href="#cb211-7" aria-hidden="true" tabindex="-1"></a><span class="kw">async</span> <span class="kw">function</span> <span class="fu">main</span>() {</span>
<span id="cb211-8"><a href="#cb211-8" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;🌱 Seeding database...&quot;</span>)<span class="op">;</span></span>
<span id="cb211-9"><a href="#cb211-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-10"><a href="#cb211-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 1. Create admin user</span></span>
<span id="cb211-11"><a href="#cb211-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> hashedPassword <span class="op">=</span> <span class="cf">await</span> bcrypt<span class="op">.</span><span class="fu">hash</span>(<span class="st">&quot;admin123456&quot;</span><span class="op">,</span> <span class="dv">14</span>)<span class="op">;</span></span>
<span id="cb211-12"><a href="#cb211-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-13"><a href="#cb211-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> adminUser <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">user</span><span class="op">.</span><span class="fu">upsert</span>({</span>
<span id="cb211-14"><a href="#cb211-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">where</span><span class="op">:</span> { <span class="dt">email</span><span class="op">:</span> <span class="st">&quot;admin@singitronic.com&quot;</span> }<span class="op">,</span></span>
<span id="cb211-15"><a href="#cb211-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">update</span><span class="op">:</span> {}<span class="op">,</span></span>
<span id="cb211-16"><a href="#cb211-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">create</span><span class="op">:</span> {</span>
<span id="cb211-17"><a href="#cb211-17" aria-hidden="true" tabindex="-1"></a>      <span class="dt">id</span><span class="op">:</span> <span class="fu">nanoid</span>()<span class="op">,</span></span>
<span id="cb211-18"><a href="#cb211-18" aria-hidden="true" tabindex="-1"></a>      <span class="dt">email</span><span class="op">:</span> <span class="st">&quot;admin@singitronic.com&quot;</span><span class="op">,</span></span>
<span id="cb211-19"><a href="#cb211-19" aria-hidden="true" tabindex="-1"></a>      <span class="dt">password</span><span class="op">:</span> hashedPassword<span class="op">,</span></span>
<span id="cb211-20"><a href="#cb211-20" aria-hidden="true" tabindex="-1"></a>      <span class="dt">role</span><span class="op">:</span> <span class="st">&quot;admin&quot;</span><span class="op">,</span></span>
<span id="cb211-21"><a href="#cb211-21" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb211-22"><a href="#cb211-22" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb211-23"><a href="#cb211-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-24"><a href="#cb211-24" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 2. Create categories</span></span>
<span id="cb211-25"><a href="#cb211-25" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> category <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">category</span><span class="op">.</span><span class="fu">upsert</span>({</span>
<span id="cb211-26"><a href="#cb211-26" aria-hidden="true" tabindex="-1"></a>    <span class="dt">where</span><span class="op">:</span> { <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Electronics&quot;</span> }<span class="op">,</span></span>
<span id="cb211-27"><a href="#cb211-27" aria-hidden="true" tabindex="-1"></a>    <span class="dt">update</span><span class="op">:</span> {}<span class="op">,</span></span>
<span id="cb211-28"><a href="#cb211-28" aria-hidden="true" tabindex="-1"></a>    <span class="dt">create</span><span class="op">:</span> {</span>
<span id="cb211-29"><a href="#cb211-29" aria-hidden="true" tabindex="-1"></a>      <span class="dt">id</span><span class="op">:</span> <span class="fu">nanoid</span>()<span class="op">,</span></span>
<span id="cb211-30"><a href="#cb211-30" aria-hidden="true" tabindex="-1"></a>      <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Electronics&quot;</span><span class="op">,</span></span>
<span id="cb211-31"><a href="#cb211-31" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb211-32"><a href="#cb211-32" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb211-33"><a href="#cb211-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-34"><a href="#cb211-34" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 3. Create products</span></span>
<span id="cb211-35"><a href="#cb211-35" aria-hidden="true" tabindex="-1"></a>  <span class="cf">await</span> prisma<span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="fu">create</span>({</span>
<span id="cb211-36"><a href="#cb211-36" aria-hidden="true" tabindex="-1"></a>    <span class="dt">data</span><span class="op">:</span> {</span>
<span id="cb211-37"><a href="#cb211-37" aria-hidden="true" tabindex="-1"></a>      <span class="dt">id</span><span class="op">:</span> <span class="fu">nanoid</span>()<span class="op">,</span></span>
<span id="cb211-38"><a href="#cb211-38" aria-hidden="true" tabindex="-1"></a>      <span class="dt">slug</span><span class="op">:</span> <span class="st">&quot;laptop-asus-rog&quot;</span><span class="op">,</span></span>
<span id="cb211-39"><a href="#cb211-39" aria-hidden="true" tabindex="-1"></a>      <span class="dt">title</span><span class="op">:</span> <span class="st">&quot;ASUS ROG Gaming Laptop&quot;</span><span class="op">,</span></span>
<span id="cb211-40"><a href="#cb211-40" aria-hidden="true" tabindex="-1"></a>      <span class="dt">mainImage</span><span class="op">:</span> <span class="st">&quot;/laptop.png&quot;</span><span class="op">,</span></span>
<span id="cb211-41"><a href="#cb211-41" aria-hidden="true" tabindex="-1"></a>      <span class="dt">price</span><span class="op">:</span> <span class="dv">15000000</span><span class="op">,</span> <span class="co">// 15 juta rupiah</span></span>
<span id="cb211-42"><a href="#cb211-42" aria-hidden="true" tabindex="-1"></a>      <span class="dt">rating</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb211-43"><a href="#cb211-43" aria-hidden="true" tabindex="-1"></a>      <span class="dt">description</span><span class="op">:</span> <span class="st">&quot;Gaming laptop with RTX 4060&quot;</span><span class="op">,</span></span>
<span id="cb211-44"><a href="#cb211-44" aria-hidden="true" tabindex="-1"></a>      <span class="dt">manufacturer</span><span class="op">:</span> <span class="st">&quot;ASUS&quot;</span><span class="op">,</span></span>
<span id="cb211-45"><a href="#cb211-45" aria-hidden="true" tabindex="-1"></a>      <span class="dt">inStock</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb211-46"><a href="#cb211-46" aria-hidden="true" tabindex="-1"></a>      <span class="dt">categoryId</span><span class="op">:</span> category<span class="op">.</span><span class="at">id</span><span class="op">,</span></span>
<span id="cb211-47"><a href="#cb211-47" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb211-48"><a href="#cb211-48" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb211-49"><a href="#cb211-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-50"><a href="#cb211-50" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;✅ Seeding completed!&quot;</span>)<span class="op">;</span></span>
<span id="cb211-51"><a href="#cb211-51" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb211-52"><a href="#cb211-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-53"><a href="#cb211-53" aria-hidden="true" tabindex="-1"></a><span class="fu">main</span>()</span>
<span id="cb211-54"><a href="#cb211-54" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">catch</span>((e) <span class="kw">=&gt;</span> {</span>
<span id="cb211-55"><a href="#cb211-55" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">error</span>(<span class="st">&quot;❌ Seeding failed:&quot;</span><span class="op">,</span> e)<span class="op">;</span></span>
<span id="cb211-56"><a href="#cb211-56" aria-hidden="true" tabindex="-1"></a>    <span class="bu">process</span><span class="op">.</span><span class="fu">exit</span>(<span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb211-57"><a href="#cb211-57" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb211-58"><a href="#cb211-58" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">finally</span>(<span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb211-59"><a href="#cb211-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> prisma<span class="op">.</span><span class="fu">$disconnect</span>()<span class="op">;</span></span>
<span id="cb211-60"><a href="#cb211-60" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span></code></pre></div>
<h3 id="konfigurasi-package.json">7.3 Konfigurasi package.json</h3>
<p>Tambahkan:</p>
<div class="sourceCode" id="cb212"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;prisma&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb212-3"><a href="#cb212-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;seed&quot;</span><span class="fu">:</span> <span class="st">&quot;node prisma/seed.js&quot;</span></span>
<span id="cb212-4"><a href="#cb212-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb212-5"><a href="#cb212-5" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h3 id="jalankan-seeding">7.4 Jalankan Seeding</h3>
<div class="sourceCode" id="cb213"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Jalankan seed script</span></span>
<span id="cb213-2"><a href="#cb213-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma db seed</span>
<span id="cb213-3"><a href="#cb213-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-4"><a href="#cb213-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Atau reset + seed sekaligus</span></span>
<span id="cb213-5"><a href="#cb213-5" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma migrate reset</span></code></pre></div>
<p>Output:</p>
<pre><code>🌱 Seeding database...
👤 Created users: { admin: &#39;admin@singitronic.com&#39;, testUser: &#39;testuser@example.com&#39; }
✅ Seeding completed!</code></pre>
<hr />
<h2 id="query-operations">8. Query &amp; Operations</h2>
<h3 id="find-operations">8.1 Find Operations</h3>
<h4 id="find-many-ambil-banyak-data">Find Many (Ambil banyak data):</h4>
<div class="sourceCode" id="cb215"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Ambil semua products</span></span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> products <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="fu">findMany</span>()</span>
<span id="cb215-3"><a href="#cb215-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-4"><a href="#cb215-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Dengan filter</span></span>
<span id="cb215-5"><a href="#cb215-5" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> electronicProducts <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="fu">findMany</span>({</span>
<span id="cb215-6"><a href="#cb215-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">where</span><span class="op">:</span> {</span>
<span id="cb215-7"><a href="#cb215-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">category</span><span class="op">:</span> {</span>
<span id="cb215-8"><a href="#cb215-8" aria-hidden="true" tabindex="-1"></a>      <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Electronics&quot;</span></span>
<span id="cb215-9"><a href="#cb215-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb215-10"><a href="#cb215-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb215-11"><a href="#cb215-11" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb215-12"><a href="#cb215-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-13"><a href="#cb215-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Dengan pagination</span></span>
<span id="cb215-14"><a href="#cb215-14" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> paginatedProducts <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="fu">findMany</span>({</span>
<span id="cb215-15"><a href="#cb215-15" aria-hidden="true" tabindex="-1"></a>  <span class="dt">skip</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span>    <span class="co">// Offset</span></span>
<span id="cb215-16"><a href="#cb215-16" aria-hidden="true" tabindex="-1"></a>  <span class="dt">take</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span>   <span class="co">// Limit</span></span>
<span id="cb215-17"><a href="#cb215-17" aria-hidden="true" tabindex="-1"></a>  <span class="dt">orderBy</span><span class="op">:</span> {</span>
<span id="cb215-18"><a href="#cb215-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">createdAt</span><span class="op">:</span> <span class="st">&#39;desc&#39;</span></span>
<span id="cb215-19"><a href="#cb215-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb215-20"><a href="#cb215-20" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb215-21"><a href="#cb215-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-22"><a href="#cb215-22" aria-hidden="true" tabindex="-1"></a><span class="co">// Dengan select specific fields</span></span>
<span id="cb215-23"><a href="#cb215-23" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> productTitles <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="fu">findMany</span>({</span>
<span id="cb215-24"><a href="#cb215-24" aria-hidden="true" tabindex="-1"></a>  <span class="dt">select</span><span class="op">:</span> {</span>
<span id="cb215-25"><a href="#cb215-25" aria-hidden="true" tabindex="-1"></a>    <span class="dt">id</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb215-26"><a href="#cb215-26" aria-hidden="true" tabindex="-1"></a>    <span class="dt">title</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb215-27"><a href="#cb215-27" aria-hidden="true" tabindex="-1"></a>    <span class="dt">price</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb215-28"><a href="#cb215-28" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb215-29"><a href="#cb215-29" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<h4 id="find-unique-by-id-atau-unique-field">Find Unique (By ID atau
unique field):</h4>
<div class="sourceCode" id="cb216"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="co">// By ID</span></span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> product <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="fu">findUnique</span>({</span>
<span id="cb216-3"><a href="#cb216-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">where</span><span class="op">:</span> { <span class="dt">id</span><span class="op">:</span> <span class="st">&quot;product-id&quot;</span> }</span>
<span id="cb216-4"><a href="#cb216-4" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb216-5"><a href="#cb216-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-6"><a href="#cb216-6" aria-hidden="true" tabindex="-1"></a><span class="co">// By slug (unique field)</span></span>
<span id="cb216-7"><a href="#cb216-7" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> product <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="fu">findUnique</span>({</span>
<span id="cb216-8"><a href="#cb216-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">where</span><span class="op">:</span> { <span class="dt">slug</span><span class="op">:</span> <span class="st">&quot;laptop-asus-rog&quot;</span> }</span>
<span id="cb216-9"><a href="#cb216-9" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb216-10"><a href="#cb216-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-11"><a href="#cb216-11" aria-hidden="true" tabindex="-1"></a><span class="co">// Dengan relasi</span></span>
<span id="cb216-12"><a href="#cb216-12" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> product <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="fu">findUnique</span>({</span>
<span id="cb216-13"><a href="#cb216-13" aria-hidden="true" tabindex="-1"></a>  <span class="dt">where</span><span class="op">:</span> { <span class="dt">id</span><span class="op">:</span> <span class="st">&quot;product-id&quot;</span> }<span class="op">,</span></span>
<span id="cb216-14"><a href="#cb216-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">include</span><span class="op">:</span> {</span>
<span id="cb216-15"><a href="#cb216-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">category</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb216-16"><a href="#cb216-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">feedbacks</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb216-17"><a href="#cb216-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb216-18"><a href="#cb216-18" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<h3 id="create-operations">8.2 Create Operations</h3>
<h4 id="create-single-record">Create Single Record:</h4>
<div class="sourceCode" id="cb217"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> newProduct <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="fu">create</span>({</span>
<span id="cb217-2"><a href="#cb217-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">data</span><span class="op">:</span> {</span>
<span id="cb217-3"><a href="#cb217-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">slug</span><span class="op">:</span> <span class="st">&quot;iphone-15-pro&quot;</span><span class="op">,</span></span>
<span id="cb217-4"><a href="#cb217-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">title</span><span class="op">:</span> <span class="st">&quot;iPhone 15 Pro&quot;</span><span class="op">,</span></span>
<span id="cb217-5"><a href="#cb217-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">mainImage</span><span class="op">:</span> <span class="st">&quot;/iphone.png&quot;</span><span class="op">,</span></span>
<span id="cb217-6"><a href="#cb217-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">price</span><span class="op">:</span> <span class="dv">17000000</span><span class="op">,</span></span>
<span id="cb217-7"><a href="#cb217-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">description</span><span class="op">:</span> <span class="st">&quot;Latest iPhone&quot;</span><span class="op">,</span></span>
<span id="cb217-8"><a href="#cb217-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">manufacturer</span><span class="op">:</span> <span class="st">&quot;Apple&quot;</span><span class="op">,</span></span>
<span id="cb217-9"><a href="#cb217-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">inStock</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb217-10"><a href="#cb217-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">categoryId</span><span class="op">:</span> <span class="st">&quot;category-id&quot;</span></span>
<span id="cb217-11"><a href="#cb217-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb217-12"><a href="#cb217-12" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<h4 id="create-dengan-relasi-nested-create">Create dengan Relasi (Nested
Create):</h4>
<div class="sourceCode" id="cb218"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Buat product + feedback sekaligus</span></span>
<span id="cb218-2"><a href="#cb218-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> product <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="fu">create</span>({</span>
<span id="cb218-3"><a href="#cb218-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">data</span><span class="op">:</span> {</span>
<span id="cb218-4"><a href="#cb218-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">slug</span><span class="op">:</span> <span class="st">&quot;samsung-s24&quot;</span><span class="op">,</span></span>
<span id="cb218-5"><a href="#cb218-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">title</span><span class="op">:</span> <span class="st">&quot;Samsung Galaxy S24&quot;</span><span class="op">,</span></span>
<span id="cb218-6"><a href="#cb218-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">mainImage</span><span class="op">:</span> <span class="st">&quot;/s24.png&quot;</span><span class="op">,</span></span>
<span id="cb218-7"><a href="#cb218-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">price</span><span class="op">:</span> <span class="dv">12000000</span><span class="op">,</span></span>
<span id="cb218-8"><a href="#cb218-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">description</span><span class="op">:</span> <span class="st">&quot;Flagship Samsung&quot;</span><span class="op">,</span></span>
<span id="cb218-9"><a href="#cb218-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">manufacturer</span><span class="op">:</span> <span class="st">&quot;Samsung&quot;</span><span class="op">,</span></span>
<span id="cb218-10"><a href="#cb218-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">inStock</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb218-11"><a href="#cb218-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">category</span><span class="op">:</span> {</span>
<span id="cb218-12"><a href="#cb218-12" aria-hidden="true" tabindex="-1"></a>      <span class="dt">connect</span><span class="op">:</span> { <span class="dt">id</span><span class="op">:</span> <span class="st">&quot;category-id&quot;</span> } <span class="co">// Connect ke category existing</span></span>
<span id="cb218-13"><a href="#cb218-13" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb218-14"><a href="#cb218-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">feedbacks</span><span class="op">:</span> {</span>
<span id="cb218-15"><a href="#cb218-15" aria-hidden="true" tabindex="-1"></a>      <span class="dt">create</span><span class="op">:</span> [</span>
<span id="cb218-16"><a href="#cb218-16" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb218-17"><a href="#cb218-17" aria-hidden="true" tabindex="-1"></a>          <span class="dt">userId</span><span class="op">:</span> <span class="st">&quot;user-id&quot;</span><span class="op">,</span></span>
<span id="cb218-18"><a href="#cb218-18" aria-hidden="true" tabindex="-1"></a>          <span class="dt">comment</span><span class="op">:</span> <span class="st">&quot;Great phone!&quot;</span><span class="op">,</span></span>
<span id="cb218-19"><a href="#cb218-19" aria-hidden="true" tabindex="-1"></a>          <span class="dt">rating</span><span class="op">:</span> <span class="dv">5</span></span>
<span id="cb218-20"><a href="#cb218-20" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb218-21"><a href="#cb218-21" aria-hidden="true" tabindex="-1"></a>      ]</span>
<span id="cb218-22"><a href="#cb218-22" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb218-23"><a href="#cb218-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb218-24"><a href="#cb218-24" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<h3 id="update-operations">8.3 Update Operations</h3>
<div class="sourceCode" id="cb219"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Update single field</span></span>
<span id="cb219-2"><a href="#cb219-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> updatedProduct <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="fu">update</span>({</span>
<span id="cb219-3"><a href="#cb219-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">where</span><span class="op">:</span> { <span class="dt">id</span><span class="op">:</span> <span class="st">&quot;product-id&quot;</span> }<span class="op">,</span></span>
<span id="cb219-4"><a href="#cb219-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">data</span><span class="op">:</span> {</span>
<span id="cb219-5"><a href="#cb219-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">price</span><span class="op">:</span> <span class="dv">15500000</span> <span class="co">// Update harga</span></span>
<span id="cb219-6"><a href="#cb219-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb219-7"><a href="#cb219-7" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb219-8"><a href="#cb219-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-9"><a href="#cb219-9" aria-hidden="true" tabindex="-1"></a><span class="co">// Update multiple fields</span></span>
<span id="cb219-10"><a href="#cb219-10" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> updatedProduct <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="fu">update</span>({</span>
<span id="cb219-11"><a href="#cb219-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">where</span><span class="op">:</span> { <span class="dt">id</span><span class="op">:</span> <span class="st">&quot;product-id&quot;</span> }<span class="op">,</span></span>
<span id="cb219-12"><a href="#cb219-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">data</span><span class="op">:</span> {</span>
<span id="cb219-13"><a href="#cb219-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">inStock</span><span class="op">:</span> <span class="dv">20</span><span class="op">,</span></span>
<span id="cb219-14"><a href="#cb219-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">price</span><span class="op">:</span> <span class="dv">14000000</span></span>
<span id="cb219-15"><a href="#cb219-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb219-16"><a href="#cb219-16" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb219-17"><a href="#cb219-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-18"><a href="#cb219-18" aria-hidden="true" tabindex="-1"></a><span class="co">// Increment value</span></span>
<span id="cb219-19"><a href="#cb219-19" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> updatedProduct <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="fu">update</span>({</span>
<span id="cb219-20"><a href="#cb219-20" aria-hidden="true" tabindex="-1"></a>  <span class="dt">where</span><span class="op">:</span> { <span class="dt">id</span><span class="op">:</span> <span class="st">&quot;product-id&quot;</span> }<span class="op">,</span></span>
<span id="cb219-21"><a href="#cb219-21" aria-hidden="true" tabindex="-1"></a>  <span class="dt">data</span><span class="op">:</span> {</span>
<span id="cb219-22"><a href="#cb219-22" aria-hidden="true" tabindex="-1"></a>    <span class="dt">inStock</span><span class="op">:</span> {</span>
<span id="cb219-23"><a href="#cb219-23" aria-hidden="true" tabindex="-1"></a>      <span class="dt">increment</span><span class="op">:</span> <span class="dv">10</span> <span class="co">// Tambah stok 10</span></span>
<span id="cb219-24"><a href="#cb219-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb219-25"><a href="#cb219-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb219-26"><a href="#cb219-26" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<h3 id="delete-operations">8.4 Delete Operations</h3>
<div class="sourceCode" id="cb220"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Delete single record</span></span>
<span id="cb220-2"><a href="#cb220-2" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> prisma<span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="fu">delete</span>({</span>
<span id="cb220-3"><a href="#cb220-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">where</span><span class="op">:</span> { <span class="dt">id</span><span class="op">:</span> <span class="st">&quot;product-id&quot;</span> }</span>
<span id="cb220-4"><a href="#cb220-4" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb220-5"><a href="#cb220-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-6"><a href="#cb220-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Delete many (with filter)</span></span>
<span id="cb220-7"><a href="#cb220-7" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> prisma<span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="fu">deleteMany</span>({</span>
<span id="cb220-8"><a href="#cb220-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">where</span><span class="op">:</span> {</span>
<span id="cb220-9"><a href="#cb220-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">inStock</span><span class="op">:</span> <span class="dv">0</span> <span class="co">// Hapus produk yang habis</span></span>
<span id="cb220-10"><a href="#cb220-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb220-11"><a href="#cb220-11" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<h3 id="upsert-create-or-update">8.5 Upsert (Create or Update)</h3>
<div class="sourceCode" id="cb221"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> user <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">user</span><span class="op">.</span><span class="fu">upsert</span>({</span>
<span id="cb221-2"><a href="#cb221-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">where</span><span class="op">:</span> { <span class="dt">email</span><span class="op">:</span> <span class="st">&quot;user@example.com&quot;</span> }<span class="op">,</span></span>
<span id="cb221-3"><a href="#cb221-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">update</span><span class="op">:</span> {</span>
<span id="cb221-4"><a href="#cb221-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Jika ada, update ini</span></span>
<span id="cb221-5"><a href="#cb221-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">role</span><span class="op">:</span> <span class="st">&quot;admin&quot;</span></span>
<span id="cb221-6"><a href="#cb221-6" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb221-7"><a href="#cb221-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">create</span><span class="op">:</span> {</span>
<span id="cb221-8"><a href="#cb221-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Jika tidak ada, create baru</span></span>
<span id="cb221-9"><a href="#cb221-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">email</span><span class="op">:</span> <span class="st">&quot;user@example.com&quot;</span><span class="op">,</span></span>
<span id="cb221-10"><a href="#cb221-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">password</span><span class="op">:</span> <span class="st">&quot;hashedPassword&quot;</span><span class="op">,</span></span>
<span id="cb221-11"><a href="#cb221-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">role</span><span class="op">:</span> <span class="st">&quot;admin&quot;</span></span>
<span id="cb221-12"><a href="#cb221-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb221-13"><a href="#cb221-13" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<h3 id="count-aggregate">8.6 Count &amp; Aggregate</h3>
<div class="sourceCode" id="cb222"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Count total products</span></span>
<span id="cb222-2"><a href="#cb222-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> count <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="fu">count</span>()</span>
<span id="cb222-3"><a href="#cb222-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-4"><a href="#cb222-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Count dengan filter</span></span>
<span id="cb222-5"><a href="#cb222-5" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> inStockCount <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="fu">count</span>({</span>
<span id="cb222-6"><a href="#cb222-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">where</span><span class="op">:</span> {</span>
<span id="cb222-7"><a href="#cb222-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">inStock</span><span class="op">:</span> {</span>
<span id="cb222-8"><a href="#cb222-8" aria-hidden="true" tabindex="-1"></a>      <span class="dt">gt</span><span class="op">:</span> <span class="dv">0</span> <span class="co">// Greater than 0</span></span>
<span id="cb222-9"><a href="#cb222-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb222-10"><a href="#cb222-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb222-11"><a href="#cb222-11" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb222-12"><a href="#cb222-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-13"><a href="#cb222-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Aggregate (sum, avg, min, max)</span></span>
<span id="cb222-14"><a href="#cb222-14" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> stats <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="fu">aggregate</span>({</span>
<span id="cb222-15"><a href="#cb222-15" aria-hidden="true" tabindex="-1"></a>  <span class="dt">_avg</span><span class="op">:</span> { <span class="dt">price</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb222-16"><a href="#cb222-16" aria-hidden="true" tabindex="-1"></a>  <span class="dt">_sum</span><span class="op">:</span> { <span class="dt">inStock</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb222-17"><a href="#cb222-17" aria-hidden="true" tabindex="-1"></a>  <span class="dt">_min</span><span class="op">:</span> { <span class="dt">price</span><span class="op">:</span> <span class="kw">true</span> }<span class="op">,</span></span>
<span id="cb222-18"><a href="#cb222-18" aria-hidden="true" tabindex="-1"></a>  <span class="dt">_max</span><span class="op">:</span> { <span class="dt">price</span><span class="op">:</span> <span class="kw">true</span> }</span>
<span id="cb222-19"><a href="#cb222-19" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb222-20"><a href="#cb222-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-21"><a href="#cb222-21" aria-hidden="true" tabindex="-1"></a><span class="co">// Output:</span></span>
<span id="cb222-22"><a href="#cb222-22" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb222-23"><a href="#cb222-23" aria-hidden="true" tabindex="-1"></a>  <span class="dt">_avg</span><span class="op">:</span> { <span class="dt">price</span><span class="op">:</span> <span class="dv">12500000</span> }<span class="op">,</span></span>
<span id="cb222-24"><a href="#cb222-24" aria-hidden="true" tabindex="-1"></a>  <span class="dt">_sum</span><span class="op">:</span> { <span class="dt">inStock</span><span class="op">:</span> <span class="dv">150</span> }<span class="op">,</span></span>
<span id="cb222-25"><a href="#cb222-25" aria-hidden="true" tabindex="-1"></a>  <span class="dt">_min</span><span class="op">:</span> { <span class="dt">price</span><span class="op">:</span> <span class="dv">5000000</span> }<span class="op">,</span></span>
<span id="cb222-26"><a href="#cb222-26" aria-hidden="true" tabindex="-1"></a>  <span class="dt">_max</span><span class="op">:</span> { <span class="dt">price</span><span class="op">:</span> <span class="dv">20000000</span> }</span>
<span id="cb222-27"><a href="#cb222-27" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<hr />
<h2 id="cara-menambah-field-baru">9. Cara Menambah Field Baru</h2>
<h3 id="langkah-langkah-lengkap">9.1 Langkah-langkah Lengkap</h3>
<p>Contoh: Tambah field <strong><code>discount</code></strong> (diskon
dalam persen) ke model Product.</p>
<h4 id="checklist">✅ Checklist:</h4>
<ul class="task-list">
<li><label><input type="checkbox" />Edit Prisma Schema</label></li>
<li><label><input type="checkbox" />Buat &amp; Jalankan
Migration</label></li>
<li><label><input type="checkbox" />Update TypeScript Types
(auto)</label></li>
<li><label><input type="checkbox" />Update API Routes</label></li>
<li><label><input type="checkbox" />Update Validasi (Zod)</label></li>
<li><label><input type="checkbox" />Update UI Components</label></li>
<li><label><input type="checkbox" />Testing</label></li>
</ul>
<h3 id="step-1-edit-prisma-schema">9.2 Step 1: Edit Prisma Schema</h3>
<p><strong>📁 File:</strong> <code>prisma/schema.prisma</code></p>
<pre class="prisma"><code>model Product {
  id             String                   @id @default(uuid())
  slug           String                   @unique
  title          String
  mainImage      String
  price          Int                      @default(0)
  rating         Int                      @default(0)
  
  // ✨ TAMBAH FIELD BARU
  discount       Float?                   @default(0)  // Diskon 0-100%
  
  description    String
  manufacturer   String
  inStock        Int                      @default(1)
  categoryId     String
  category       Category                 @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  customerOrders customer_order_product[]
  Wishlist       Wishlist[]
  feedbacks      Feedback[]
}</code></pre>
<h4 id="penjelasan">🔍 Penjelasan:</h4>
<ul>
<li><strong><code>Float?</code></strong> = Tipe data decimal, nullable
(optional)</li>
<li><strong><code>@default(0)</code></strong> = Default value 0% (tidak
ada diskon)</li>
<li><strong>Bisa juga:</strong> <code>Float</code> (non-nullable) atau
<code>Int</code> (untuk persentase bulat)</li>
</ul>
<h3 id="step-2-buat-migration">9.3 Step 2: Buat Migration</h3>
<div class="sourceCode" id="cb224"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma migrate dev <span class="at">--name</span> add_discount_to_product</span></code></pre></div>
<p>Output:</p>
<pre><code>Prisma schema loaded from prisma\schema.prisma
Datasource &quot;db&quot;: MySQL database &quot;ecommerce_db&quot; at &quot;localhost:3306&quot;

✔ Migration created: 20240315120000_add_discount_to_product

Applying migration `20240315120000_add_discount_to_product`

The following migration(s) have been applied:

migrations/
  └─ 20240315120000_add_discount_to_product/
    └─ migration.sql

✔ Generated Prisma Client (v6.16.1)</code></pre>
<p><strong>File yang dibuat:</strong>
<code>prisma/migrations/20240315120000_add_discount_to_product/migration.sql</code></p>
<div class="sourceCode" id="cb226"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- AlterTable</span></span>
<span id="cb226-2"><a href="#cb226-2" aria-hidden="true" tabindex="-1"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> `Product` <span class="kw">ADD</span> <span class="kw">COLUMN</span> `discount` <span class="dt">DOUBLE</span> <span class="kw">NULL</span> <span class="kw">DEFAULT</span> <span class="dv">0</span>;</span></code></pre></div>
<h3 id="step-3-update-api-routes">9.4 Step 3: Update API Routes</h3>
<p><strong>📁 File:</strong> <code>app/api/products/route.ts</code></p>
<h4 id="get-read">GET (Read):</h4>
<div class="sourceCode" id="cb227"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">async</span> <span class="kw">function</span> <span class="fu">GET</span>() {</span>
<span id="cb227-2"><a href="#cb227-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> products <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="fu">findMany</span>({</span>
<span id="cb227-3"><a href="#cb227-3" aria-hidden="true" tabindex="-1"></a>    select<span class="op">:</span> {</span>
<span id="cb227-4"><a href="#cb227-4" aria-hidden="true" tabindex="-1"></a>      id<span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb227-5"><a href="#cb227-5" aria-hidden="true" tabindex="-1"></a>      slug<span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb227-6"><a href="#cb227-6" aria-hidden="true" tabindex="-1"></a>      title<span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb227-7"><a href="#cb227-7" aria-hidden="true" tabindex="-1"></a>      price<span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb227-8"><a href="#cb227-8" aria-hidden="true" tabindex="-1"></a>      discount<span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="co">// ✨ Tambahkan discount</span></span>
<span id="cb227-9"><a href="#cb227-9" aria-hidden="true" tabindex="-1"></a>      inStock<span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb227-10"><a href="#cb227-10" aria-hidden="true" tabindex="-1"></a>      <span class="co">// ... field lain</span></span>
<span id="cb227-11"><a href="#cb227-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb227-12"><a href="#cb227-12" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb227-13"><a href="#cb227-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-14"><a href="#cb227-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Response<span class="op">.</span><span class="fu">json</span>(products)</span>
<span id="cb227-15"><a href="#cb227-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h4 id="post-create">POST (Create):</h4>
<div class="sourceCode" id="cb228"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">async</span> <span class="kw">function</span> <span class="fu">POST</span>(request<span class="op">:</span> Request) {</span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> body <span class="op">=</span> <span class="cf">await</span> request<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb228-3"><a href="#cb228-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb228-4"><a href="#cb228-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> product <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="fu">create</span>({</span>
<span id="cb228-5"><a href="#cb228-5" aria-hidden="true" tabindex="-1"></a>    data<span class="op">:</span> {</span>
<span id="cb228-6"><a href="#cb228-6" aria-hidden="true" tabindex="-1"></a>      slug<span class="op">:</span> body<span class="op">.</span><span class="at">slug</span><span class="op">,</span></span>
<span id="cb228-7"><a href="#cb228-7" aria-hidden="true" tabindex="-1"></a>      title<span class="op">:</span> body<span class="op">.</span><span class="at">title</span><span class="op">,</span></span>
<span id="cb228-8"><a href="#cb228-8" aria-hidden="true" tabindex="-1"></a>      price<span class="op">:</span> body<span class="op">.</span><span class="at">price</span><span class="op">,</span></span>
<span id="cb228-9"><a href="#cb228-9" aria-hidden="true" tabindex="-1"></a>      discount<span class="op">:</span> body<span class="op">.</span><span class="at">discount</span> <span class="op">||</span> <span class="dv">0</span><span class="op">,</span> <span class="co">// ✨ Default 0</span></span>
<span id="cb228-10"><a href="#cb228-10" aria-hidden="true" tabindex="-1"></a>      description<span class="op">:</span> body<span class="op">.</span><span class="at">description</span><span class="op">,</span></span>
<span id="cb228-11"><a href="#cb228-11" aria-hidden="true" tabindex="-1"></a>      manufacturer<span class="op">:</span> body<span class="op">.</span><span class="at">manufacturer</span><span class="op">,</span></span>
<span id="cb228-12"><a href="#cb228-12" aria-hidden="true" tabindex="-1"></a>      inStock<span class="op">:</span> body<span class="op">.</span><span class="at">inStock</span><span class="op">,</span></span>
<span id="cb228-13"><a href="#cb228-13" aria-hidden="true" tabindex="-1"></a>      categoryId<span class="op">:</span> body<span class="op">.</span><span class="at">categoryId</span><span class="op">,</span></span>
<span id="cb228-14"><a href="#cb228-14" aria-hidden="true" tabindex="-1"></a>      mainImage<span class="op">:</span> body<span class="op">.</span><span class="at">mainImage</span></span>
<span id="cb228-15"><a href="#cb228-15" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb228-16"><a href="#cb228-16" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb228-17"><a href="#cb228-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-18"><a href="#cb228-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Response<span class="op">.</span><span class="fu">json</span>(product)</span>
<span id="cb228-19"><a href="#cb228-19" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h4 id="put-update">PUT (Update):</h4>
<div class="sourceCode" id="cb229"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">async</span> <span class="kw">function</span> <span class="fu">PUT</span>(request<span class="op">:</span> Request) {</span>
<span id="cb229-2"><a href="#cb229-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> body <span class="op">=</span> <span class="cf">await</span> request<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb229-3"><a href="#cb229-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb229-4"><a href="#cb229-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> product <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="fu">update</span>({</span>
<span id="cb229-5"><a href="#cb229-5" aria-hidden="true" tabindex="-1"></a>    where<span class="op">:</span> { id<span class="op">:</span> body<span class="op">.</span><span class="at">id</span> }<span class="op">,</span></span>
<span id="cb229-6"><a href="#cb229-6" aria-hidden="true" tabindex="-1"></a>    data<span class="op">:</span> {</span>
<span id="cb229-7"><a href="#cb229-7" aria-hidden="true" tabindex="-1"></a>      discount<span class="op">:</span> body<span class="op">.</span><span class="at">discount</span> <span class="co">// ✨ Update discount</span></span>
<span id="cb229-8"><a href="#cb229-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb229-9"><a href="#cb229-9" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb229-10"><a href="#cb229-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-11"><a href="#cb229-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Response<span class="op">.</span><span class="fu">json</span>(product)</span>
<span id="cb229-12"><a href="#cb229-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="step-4-update-validasi-zod">9.5 Step 4: Update Validasi
(Zod)</h3>
<p><strong>📁 File:</strong> <code>utils/schema.ts</code></p>
<div class="sourceCode" id="cb230"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { z } <span class="im">from</span> <span class="st">&#39;zod&#39;</span></span>
<span id="cb230-2"><a href="#cb230-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-3"><a href="#cb230-3" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> ProductSchema <span class="op">=</span> z<span class="op">.</span><span class="fu">object</span>({</span>
<span id="cb230-4"><a href="#cb230-4" aria-hidden="true" tabindex="-1"></a>  slug<span class="op">:</span> z<span class="op">.</span><span class="fu">string</span>()<span class="op">.</span><span class="fu">min</span>(<span class="dv">1</span><span class="op">,</span> <span class="st">&quot;Slug required&quot;</span>)<span class="op">,</span></span>
<span id="cb230-5"><a href="#cb230-5" aria-hidden="true" tabindex="-1"></a>  title<span class="op">:</span> z<span class="op">.</span><span class="fu">string</span>()<span class="op">.</span><span class="fu">min</span>(<span class="dv">3</span><span class="op">,</span> <span class="st">&quot;Title min 3 chars&quot;</span>)<span class="op">,</span></span>
<span id="cb230-6"><a href="#cb230-6" aria-hidden="true" tabindex="-1"></a>  price<span class="op">:</span> z<span class="op">.</span><span class="fu">number</span>()<span class="op">.</span><span class="fu">int</span>()<span class="op">.</span><span class="fu">positive</span>(<span class="st">&quot;Price must be positive&quot;</span>)<span class="op">,</span></span>
<span id="cb230-7"><a href="#cb230-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb230-8"><a href="#cb230-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ✨ TAMBAH VALIDASI DISCOUNT</span></span>
<span id="cb230-9"><a href="#cb230-9" aria-hidden="true" tabindex="-1"></a>  discount<span class="op">:</span> z<span class="op">.</span><span class="fu">number</span>()</span>
<span id="cb230-10"><a href="#cb230-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">min</span>(<span class="dv">0</span><span class="op">,</span> <span class="st">&quot;Discount tidak boleh negatif&quot;</span>)</span>
<span id="cb230-11"><a href="#cb230-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">max</span>(<span class="dv">100</span><span class="op">,</span> <span class="st">&quot;Discount maksimal 100%&quot;</span>)</span>
<span id="cb230-12"><a href="#cb230-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">optional</span>()</span>
<span id="cb230-13"><a href="#cb230-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">default</span>(<span class="dv">0</span>)<span class="op">,</span></span>
<span id="cb230-14"><a href="#cb230-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb230-15"><a href="#cb230-15" aria-hidden="true" tabindex="-1"></a>  description<span class="op">:</span> z<span class="op">.</span><span class="fu">string</span>()<span class="op">.</span><span class="fu">min</span>(<span class="dv">10</span>)<span class="op">,</span></span>
<span id="cb230-16"><a href="#cb230-16" aria-hidden="true" tabindex="-1"></a>  manufacturer<span class="op">:</span> z<span class="op">.</span><span class="fu">string</span>()<span class="op">,</span></span>
<span id="cb230-17"><a href="#cb230-17" aria-hidden="true" tabindex="-1"></a>  inStock<span class="op">:</span> z<span class="op">.</span><span class="fu">number</span>()<span class="op">.</span><span class="fu">int</span>()<span class="op">.</span><span class="fu">min</span>(<span class="dv">0</span>)<span class="op">,</span></span>
<span id="cb230-18"><a href="#cb230-18" aria-hidden="true" tabindex="-1"></a>  categoryId<span class="op">:</span> z<span class="op">.</span><span class="fu">string</span>()<span class="op">.</span><span class="fu">uuid</span>()<span class="op">,</span></span>
<span id="cb230-19"><a href="#cb230-19" aria-hidden="true" tabindex="-1"></a>  mainImage<span class="op">:</span> z<span class="op">.</span><span class="fu">string</span>()<span class="op">.</span><span class="fu">url</span>()</span>
<span id="cb230-20"><a href="#cb230-20" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p><strong>Pakai di API:</strong></p>
<div class="sourceCode" id="cb231"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">async</span> <span class="kw">function</span> <span class="fu">POST</span>(request<span class="op">:</span> Request) {</span>
<span id="cb231-2"><a href="#cb231-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> body <span class="op">=</span> <span class="cf">await</span> request<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb231-3"><a href="#cb231-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb231-4"><a href="#cb231-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Validasi dengan Zod</span></span>
<span id="cb231-5"><a href="#cb231-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> validated <span class="op">=</span> ProductSchema<span class="op">.</span><span class="fu">parse</span>(body)</span>
<span id="cb231-6"><a href="#cb231-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb231-7"><a href="#cb231-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> product <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="fu">create</span>({</span>
<span id="cb231-8"><a href="#cb231-8" aria-hidden="true" tabindex="-1"></a>    data<span class="op">:</span> validated</span>
<span id="cb231-9"><a href="#cb231-9" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb231-10"><a href="#cb231-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-11"><a href="#cb231-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Response<span class="op">.</span><span class="fu">json</span>(product)</span>
<span id="cb231-12"><a href="#cb231-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="step-5-update-ui-components">9.6 Step 5: Update UI
Components</h3>
<h4 id="admin-form-tambahedit-product">Admin Form (Tambah/Edit
Product):</h4>
<p><strong>📁 File:</strong>
<code>app/(dashboard)/admin/products/add/page.tsx</code></p>
<pre class="tsx"><code>&quot;use client&quot;
import { useState } from &#39;react&#39;

export default function AddProductPage() {
  const [formData, setFormData] = useState({
    title: &#39;&#39;,
    price: 0,
    discount: 0, // ✨ State untuk discount
    description: &#39;&#39;,
    // ... field lain
  })

  return (
    &lt;form&gt;
      {/* Field lain... */}
      
      {/* ✨ INPUT DISCOUNT */}
      &lt;div&gt;
        &lt;label htmlFor=&quot;discount&quot;&gt;Diskon (%)&lt;/label&gt;
        &lt;input
          type=&quot;number&quot;
          id=&quot;discount&quot;
          min=&quot;0&quot;
          max=&quot;100&quot;
          step=&quot;0.1&quot;
          value={formData.discount}
          onChange={(e) =&gt; setFormData({
            ...formData,
            discount: parseFloat(e.target.value)
          })}
        /&gt;
      &lt;/div&gt;

      &lt;button type=&quot;submit&quot;&gt;Simpan&lt;/button&gt;
    &lt;/form&gt;
  )
}</code></pre>
<h4 id="product-card-tampilkan-diskon">Product Card (Tampilkan
Diskon):</h4>
<p><strong>📁 File:</strong> <code>components/ProductItem.tsx</code></p>
<pre class="tsx"><code>interface ProductItemProps {
  product: {
    id: string
    title: string
    price: number
    discount?: number // ✨ Tambah prop discount
    mainImage: string
  }
}

export default function ProductItem({ product }: ProductItemProps) {
  // Hitung harga setelah diskon
  const discountedPrice = product.discount 
    ? product.price * (1 - product.discount / 100)
    : product.price

  return (
    &lt;div className=&quot;product-card&quot;&gt;
      &lt;img src={product.mainImage} alt={product.title} /&gt;
      &lt;h3&gt;{product.title}&lt;/h3&gt;
      
      {/* ✨ TAMPILKAN DISKON */}
      {product.discount &gt; 0 &amp;&amp; (
        &lt;div className=&quot;discount-badge&quot;&gt;
          -{product.discount}%
        &lt;/div&gt;
      )}

      &lt;div className=&quot;price&quot;&gt;
        {product.discount &gt; 0 ? (
          &lt;&gt;
            &lt;span className=&quot;original-price line-through&quot;&gt;
              Rp {product.price.toLocaleString()}
            &lt;/span&gt;
            &lt;span className=&quot;discounted-price&quot;&gt;
              Rp {discountedPrice.toLocaleString()}
            &lt;/span&gt;
          &lt;/&gt;
        ) : (
          &lt;span&gt;Rp {product.price.toLocaleString()}&lt;/span&gt;
        )}
      &lt;/div&gt;
    &lt;/div&gt;
  )
}</code></pre>
<h3 id="step-6-update-seed-data-optional">9.7 Step 6: Update Seed Data
(Optional)</h3>
<p><strong>📁 File:</strong> <code>prisma/seed.js</code></p>
<div class="sourceCode" id="cb234"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> prisma<span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="fu">create</span>({</span>
<span id="cb234-2"><a href="#cb234-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">data</span><span class="op">:</span> {</span>
<span id="cb234-3"><a href="#cb234-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">slug</span><span class="op">:</span> <span class="st">&quot;laptop-asus-rog&quot;</span><span class="op">,</span></span>
<span id="cb234-4"><a href="#cb234-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">title</span><span class="op">:</span> <span class="st">&quot;ASUS ROG Gaming Laptop&quot;</span><span class="op">,</span></span>
<span id="cb234-5"><a href="#cb234-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">price</span><span class="op">:</span> <span class="dv">15000000</span><span class="op">,</span></span>
<span id="cb234-6"><a href="#cb234-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">discount</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="co">// ✨ Diskon 10%</span></span>
<span id="cb234-7"><a href="#cb234-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">description</span><span class="op">:</span> <span class="st">&quot;Gaming laptop&quot;</span><span class="op">,</span></span>
<span id="cb234-8"><a href="#cb234-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">manufacturer</span><span class="op">:</span> <span class="st">&quot;ASUS&quot;</span><span class="op">,</span></span>
<span id="cb234-9"><a href="#cb234-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">inStock</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb234-10"><a href="#cb234-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">categoryId</span><span class="op">:</span> category<span class="op">.</span><span class="at">id</span><span class="op">,</span></span>
<span id="cb234-11"><a href="#cb234-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">mainImage</span><span class="op">:</span> <span class="st">&quot;/laptop.png&quot;</span></span>
<span id="cb234-12"><a href="#cb234-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb234-13"><a href="#cb234-13" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<h3 id="step-7-testing">9.8 Step 7: Testing</h3>
<div class="sourceCode" id="cb235"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Test migration</span></span>
<span id="cb235-2"><a href="#cb235-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma migrate dev</span>
<span id="cb235-3"><a href="#cb235-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-4"><a href="#cb235-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Jalankan seed</span></span>
<span id="cb235-5"><a href="#cb235-5" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma db seed</span>
<span id="cb235-6"><a href="#cb235-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-7"><a href="#cb235-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Check di Prisma Studio</span></span>
<span id="cb235-8"><a href="#cb235-8" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma studio</span>
<span id="cb235-9"><a href="#cb235-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-10"><a href="#cb235-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Test API</span></span>
<span id="cb235-11"><a href="#cb235-11" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> run dev</span>
<span id="cb235-12"><a href="#cb235-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Buka browser: http://localhost:3000/api/products</span></span></code></pre></div>
<hr />
<h2 id="prisma-studio">10. Prisma Studio</h2>
<h3 id="apa-itu-prisma-studio">10.1 Apa itu Prisma Studio?</h3>
<p><strong>Prisma Studio</strong> = GUI visual untuk manage database
(seperti phpMyAdmin).</p>
<div class="sourceCode" id="cb236"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Buka Prisma Studio</span></span>
<span id="cb236-2"><a href="#cb236-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma studio</span></code></pre></div>
<p>Output:</p>
<pre><code>Prisma Studio is up on http://localhost:5555</code></pre>
<h3 id="fitur-prisma-studio">10.2 Fitur Prisma Studio</h3>
<p>✅ <strong>Lihat semua data</strong> dalam table ✅ <strong>CRUD
operations</strong> (Create, Read, Update, Delete) ✅ <strong>Filter
&amp; Search</strong> data ✅ <strong>Edit relasi</strong> antar table
✅ <strong>Export data</strong> ke JSON/CSV</p>
<h3 id="cara-pakai">10.3 Cara Pakai</h3>
<ol type="1">
<li>Jalankan <code>npx prisma studio</code></li>
<li>Buka browser: <code>http://localhost:5555</code></li>
<li>Pilih model (Product, User, Order, dll.)</li>
<li>Click row untuk edit</li>
<li>Click “Add record” untuk insert baru</li>
</ol>
<h3 id="shortcuts">10.4 Shortcuts</h3>
<table>
<thead>
<tr>
<th>Action</th>
<th>Shortcut</th>
</tr>
</thead>
<tbody>
<tr>
<td>Save changes</td>
<td><code>Ctrl + S</code> atau <code>Cmd + S</code></td>
</tr>
<tr>
<td>Add record</td>
<td><code>Ctrl + N</code> atau <code>Cmd + N</code></td>
</tr>
<tr>
<td>Delete record</td>
<td><code>Ctrl + D</code> atau <code>Cmd + D</code></td>
</tr>
<tr>
<td>Search</td>
<td><code>Ctrl + F</code> atau <code>Cmd + F</code></td>
</tr>
</tbody>
</table>
<hr />
<h2 id="best-practices-1">11. Best Practices</h2>
<h3 id="dos-lakukan">11.1 ✅ DO’s (Lakukan)</h3>
<h4 id="selalu-generate-client-setelah-ubah-schema">1. Selalu Generate
Client Setelah Ubah Schema</h4>
<div class="sourceCode" id="cb238"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Setelah edit schema.prisma:</span></span>
<span id="cb238-2"><a href="#cb238-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma generate</span></code></pre></div>
<h4 id="gunakan-transactions-untuk-multiple-operations">2. Gunakan
Transactions untuk Multiple Operations</h4>
<div class="sourceCode" id="cb239"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ❌ SALAH: Tidak atomic</span></span>
<span id="cb239-2"><a href="#cb239-2" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> prisma<span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="fu">update</span>({ <span class="dt">where</span><span class="op">:</span> { id }<span class="op">,</span> <span class="dt">data</span><span class="op">:</span> { <span class="dt">inStock</span><span class="op">:</span> { <span class="dt">decrement</span><span class="op">:</span> <span class="dv">1</span> } } })</span>
<span id="cb239-3"><a href="#cb239-3" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> prisma<span class="op">.</span><span class="at">customer_order</span><span class="op">.</span><span class="fu">create</span>({ <span class="dt">data</span><span class="op">:</span> orderData })</span>
<span id="cb239-4"><a href="#cb239-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb239-5"><a href="#cb239-5" aria-hidden="true" tabindex="-1"></a><span class="co">// ✅ BENAR: Gunakan transaction</span></span>
<span id="cb239-6"><a href="#cb239-6" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> prisma<span class="op">.</span><span class="fu">$transaction</span>([</span>
<span id="cb239-7"><a href="#cb239-7" aria-hidden="true" tabindex="-1"></a>  prisma<span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="fu">update</span>({ <span class="dt">where</span><span class="op">:</span> { id }<span class="op">,</span> <span class="dt">data</span><span class="op">:</span> { <span class="dt">inStock</span><span class="op">:</span> { <span class="dt">decrement</span><span class="op">:</span> <span class="dv">1</span> } } })<span class="op">,</span></span>
<span id="cb239-8"><a href="#cb239-8" aria-hidden="true" tabindex="-1"></a>  prisma<span class="op">.</span><span class="at">customer_order</span><span class="op">.</span><span class="fu">create</span>({ <span class="dt">data</span><span class="op">:</span> orderData })</span>
<span id="cb239-9"><a href="#cb239-9" aria-hidden="true" tabindex="-1"></a>])</span></code></pre></div>
<h4 id="gunakan-select-untuk-optimize-query">3. Gunakan Select untuk
Optimize Query</h4>
<div class="sourceCode" id="cb240"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ❌ Ambil semua fields (lambat)</span></span>
<span id="cb240-2"><a href="#cb240-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> products <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="fu">findMany</span>()</span>
<span id="cb240-3"><a href="#cb240-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-4"><a href="#cb240-4" aria-hidden="true" tabindex="-1"></a><span class="co">// ✅ Ambil hanya yang diperlukan</span></span>
<span id="cb240-5"><a href="#cb240-5" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> products <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="fu">findMany</span>({</span>
<span id="cb240-6"><a href="#cb240-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">select</span><span class="op">:</span> {</span>
<span id="cb240-7"><a href="#cb240-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">id</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb240-8"><a href="#cb240-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">title</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb240-9"><a href="#cb240-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">price</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb240-10"><a href="#cb240-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">mainImage</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb240-11"><a href="#cb240-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb240-12"><a href="#cb240-12" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<h4 id="gunakan-pagination">4. Gunakan Pagination</h4>
<div class="sourceCode" id="cb241"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ✅ Pagination untuk data besar</span></span>
<span id="cb241-2"><a href="#cb241-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> products <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="fu">findMany</span>({</span>
<span id="cb241-3"><a href="#cb241-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">skip</span><span class="op">:</span> (page <span class="op">-</span> <span class="dv">1</span>) <span class="op">*</span> pageSize<span class="op">,</span></span>
<span id="cb241-4"><a href="#cb241-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">take</span><span class="op">:</span> pageSize<span class="op">,</span></span>
<span id="cb241-5"><a href="#cb241-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">orderBy</span><span class="op">:</span> { <span class="dt">createdAt</span><span class="op">:</span> <span class="st">&#39;desc&#39;</span> }</span>
<span id="cb241-6"><a href="#cb241-6" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<h4 id="handle-errors-dengan-baik">5. Handle Errors dengan Baik</h4>
<div class="sourceCode" id="cb242"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span> {</span>
<span id="cb242-2"><a href="#cb242-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> product <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="fu">create</span>({ data })</span>
<span id="cb242-3"><a href="#cb242-3" aria-hidden="true" tabindex="-1"></a>} <span class="cf">catch</span> (error) {</span>
<span id="cb242-4"><a href="#cb242-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (error<span class="op">.</span><span class="at">code</span> <span class="op">===</span> <span class="st">&#39;P2002&#39;</span>) {</span>
<span id="cb242-5"><a href="#cb242-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Unique constraint violation</span></span>
<span id="cb242-6"><a href="#cb242-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">error</span>(<span class="st">&quot;Product dengan slug ini sudah ada!&quot;</span>)</span>
<span id="cb242-7"><a href="#cb242-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb242-8"><a href="#cb242-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">throw</span> error</span>
<span id="cb242-9"><a href="#cb242-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="donts-jangan">11.2 ❌ DON’Ts (Jangan)</h3>
<h4 id="jangan-query-di-loop">1. Jangan Query di Loop</h4>
<div class="sourceCode" id="cb243"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ❌ SALAH: N+1 query problem</span></span>
<span id="cb243-2"><a href="#cb243-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> orders <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">customer_order</span><span class="op">.</span><span class="fu">findMany</span>()</span>
<span id="cb243-3"><a href="#cb243-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (<span class="kw">const</span> order <span class="kw">of</span> orders) {</span>
<span id="cb243-4"><a href="#cb243-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> products <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">customer_order_product</span><span class="op">.</span><span class="fu">findMany</span>({</span>
<span id="cb243-5"><a href="#cb243-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">where</span><span class="op">:</span> { <span class="dt">customerOrderId</span><span class="op">:</span> order<span class="op">.</span><span class="at">id</span> }</span>
<span id="cb243-6"><a href="#cb243-6" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb243-7"><a href="#cb243-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb243-8"><a href="#cb243-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-9"><a href="#cb243-9" aria-hidden="true" tabindex="-1"></a><span class="co">// ✅ BENAR: Use include</span></span>
<span id="cb243-10"><a href="#cb243-10" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> orders <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">customer_order</span><span class="op">.</span><span class="fu">findMany</span>({</span>
<span id="cb243-11"><a href="#cb243-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">include</span><span class="op">:</span> { <span class="dt">products</span><span class="op">:</span> <span class="kw">true</span> }</span>
<span id="cb243-12"><a href="#cb243-12" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<h4 id="jangan-hardcode-connection-string">2. Jangan Hardcode Connection
String</h4>
<div class="sourceCode" id="cb244"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ❌ SALAH</span></span>
<span id="cb244-2"><a href="#cb244-2" aria-hidden="true" tabindex="-1"></a>datasource db {</span>
<span id="cb244-3"><a href="#cb244-3" aria-hidden="true" tabindex="-1"></a>  url <span class="op">=</span> <span class="st">&quot;mysql://root:password@localhost:3306/db&quot;</span></span>
<span id="cb244-4"><a href="#cb244-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb244-5"><a href="#cb244-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-6"><a href="#cb244-6" aria-hidden="true" tabindex="-1"></a><span class="co">// ✅ BENAR</span></span>
<span id="cb244-7"><a href="#cb244-7" aria-hidden="true" tabindex="-1"></a>datasource db {</span>
<span id="cb244-8"><a href="#cb244-8" aria-hidden="true" tabindex="-1"></a>  url <span class="op">=</span> <span class="fu">env</span>(<span class="st">&quot;DATABASE_URL&quot;</span>)</span>
<span id="cb244-9"><a href="#cb244-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h4 id="jangan-pakai-migrate-dev-di-production">3. Jangan Pakai
<code>migrate dev</code> di Production</h4>
<div class="sourceCode" id="cb245"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ❌ SALAH (di production)</span></span>
<span id="cb245-2"><a href="#cb245-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma migrate dev</span>
<span id="cb245-3"><a href="#cb245-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb245-4"><a href="#cb245-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ✅ BENAR (di production)</span></span>
<span id="cb245-5"><a href="#cb245-5" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma migrate deploy</span></code></pre></div>
<hr />
<h2 id="troubleshooting-2">12. Troubleshooting</h2>
<h3 id="error-cant-reach-database-server">12.1 Error: “Can’t reach
database server”</h3>
<p><strong>Error:</strong></p>
<pre><code>Can&#39;t reach database server at `localhost:3306`</code></pre>
<p><strong>Solusi:</strong></p>
<ol type="1">
<li>Check MySQL running:</li>
</ol>
<div class="sourceCode" id="cb247"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Windows</span></span>
<span id="cb247-2"><a href="#cb247-2" aria-hidden="true" tabindex="-1"></a><span class="ex">net</span> start MySQL80</span>
<span id="cb247-3"><a href="#cb247-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-4"><a href="#cb247-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Linux/Mac</span></span>
<span id="cb247-5"><a href="#cb247-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> service mysql start</span></code></pre></div>
<ol start="2" type="1">
<li>Check <code>.env</code>:</li>
</ol>
<pre class="env"><code>DATABASE_URL=&quot;mysql://root:password@localhost:3306/ecommerce_db&quot;</code></pre>
<ol start="3" type="1">
<li>Test koneksi:</li>
</ol>
<div class="sourceCode" id="cb249"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma db pull</span></code></pre></div>
<h3 id="error-table-does-not-exist">12.2 Error: “Table does not
exist”</h3>
<p><strong>Error:</strong></p>
<pre><code>The table `main.Product` does not exist in the current database.</code></pre>
<p><strong>Solusi:</strong></p>
<div class="sourceCode" id="cb251"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Jalankan migrations</span></span>
<span id="cb251-2"><a href="#cb251-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma migrate dev</span>
<span id="cb251-3"><a href="#cb251-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-4"><a href="#cb251-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Atau push schema</span></span>
<span id="cb251-5"><a href="#cb251-5" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma db push</span></code></pre></div>
<h3 id="error-migration-is-in-a-failed-state">12.3 Error: “Migration is
in a failed state”</h3>
<p><strong>Error:</strong></p>
<pre><code>Migration `20240315_add_field` failed to apply</code></pre>
<p><strong>Solusi:</strong></p>
<div class="sourceCode" id="cb253"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 1: Resolve as applied</span></span>
<span id="cb253-2"><a href="#cb253-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma migrate resolve <span class="at">--applied</span> <span class="st">&quot;20240315_add_field&quot;</span></span>
<span id="cb253-3"><a href="#cb253-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-4"><a href="#cb253-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 2: Resolve as rolled back</span></span>
<span id="cb253-5"><a href="#cb253-5" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma migrate resolve <span class="at">--rolled-back</span> <span class="st">&quot;20240315_add_field&quot;</span></span>
<span id="cb253-6"><a href="#cb253-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-7"><a href="#cb253-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 3: Reset database (HAPUS DATA!)</span></span>
<span id="cb253-8"><a href="#cb253-8" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma migrate reset</span></code></pre></div>
<h3 id="error-type-product-is-not-assignable">12.4 Error: “Type
‘Product’ is not assignable”</h3>
<p><strong>Error:</strong></p>
<pre><code>Type &#39;Product&#39; is not assignable to type &#39;...&#39;</code></pre>
<p><strong>Solusi:</strong></p>
<div class="sourceCode" id="cb255"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Regenerate Prisma Client</span></span>
<span id="cb255-2"><a href="#cb255-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma generate</span>
<span id="cb255-3"><a href="#cb255-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb255-4"><a href="#cb255-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Restart TypeScript server di VSCode</span></span>
<span id="cb255-5"><a href="#cb255-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Ctrl+Shift+P → &quot;TypeScript: Restart TS Server&quot;</span></span></code></pre></div>
<h3 id="error-unique-constraint-failed">12.5 Error: “Unique constraint
failed”</h3>
<p><strong>Error:</strong></p>
<pre><code>Unique constraint failed on the fields: (`email`)</code></pre>
<p><strong>Solusi:</strong></p>
<div class="sourceCode" id="cb257"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Gunakan upsert atau check dulu</span></span>
<span id="cb257-2"><a href="#cb257-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> existing <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">user</span><span class="op">.</span><span class="fu">findUnique</span>({</span>
<span id="cb257-3"><a href="#cb257-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">where</span><span class="op">:</span> { email }</span>
<span id="cb257-4"><a href="#cb257-4" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb257-5"><a href="#cb257-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-6"><a href="#cb257-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (existing) {</span>
<span id="cb257-7"><a href="#cb257-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">&quot;Email already exists&quot;</span>)</span>
<span id="cb257-8"><a href="#cb257-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb257-9"><a href="#cb257-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-10"><a href="#cb257-10" aria-hidden="true" tabindex="-1"></a><span class="co">// Atau gunakan upsert</span></span>
<span id="cb257-11"><a href="#cb257-11" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> prisma<span class="op">.</span><span class="at">user</span><span class="op">.</span><span class="fu">upsert</span>({</span>
<span id="cb257-12"><a href="#cb257-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">where</span><span class="op">:</span> { email }<span class="op">,</span></span>
<span id="cb257-13"><a href="#cb257-13" aria-hidden="true" tabindex="-1"></a>  <span class="dt">update</span><span class="op">:</span> { <span class="co">/* update data */</span> }<span class="op">,</span></span>
<span id="cb257-14"><a href="#cb257-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">create</span><span class="op">:</span> { <span class="co">/* create data */</span> }</span>
<span id="cb257-15"><a href="#cb257-15" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<hr />
<h2 id="referensi-1">📚 Referensi</h2>
<h3 id="official-documentation">Official Documentation:</h3>
<ul>
<li><a href="https://www.prisma.io/docs">Prisma Docs</a></li>
<li><a
href="https://www.prisma.io/docs/reference/api-reference/prisma-schema-reference">Prisma
Schema Reference</a></li>
<li><a
href="https://www.prisma.io/docs/reference/api-reference/prisma-client-reference">Prisma
Client API</a></li>
</ul>
<hr />
<h1 id="upgrade-libraries---panduan-lengkap">🔄 UPGRADE LIBRARIES -
PANDUAN LENGKAP</h1>
<p><strong>Panduan Upgrade React, Next.js, Prisma, NextAuth, TailwindCSS
&amp; Dependencies Lainnya</strong></p>
<hr />
<h2 id="daftar-isi-5">📑 Daftar Isi</h2>
<ol type="1">
<li><a href="#1-persiapan-upgrade">Persiapan Upgrade</a></li>
<li><a href="#2-cek-versi-saat-ini">Cek Versi Saat Ini</a></li>
<li><a href="#3-upgrade-react">Upgrade React</a></li>
<li><a href="#4-upgrade-nextjs">Upgrade Next.js</a></li>
<li><a href="#5-upgrade-prisma">Upgrade Prisma</a></li>
<li><a href="#6-upgrade-nextauth">Upgrade NextAuth</a></li>
<li><a href="#7-upgrade-tailwindcss">Upgrade TailwindCSS</a></li>
<li><a href="#8-upgrade-dependencies-lainnya">Upgrade Dependencies
Lainnya</a></li>
<li><a href="#9-testing-setelah-upgrade">Testing Setelah
Upgrade</a></li>
<li><a href="#10-rollback-strategy">Rollback Strategy</a></li>
<li><a href="#11-troubleshooting">Troubleshooting</a></li>
</ol>
<hr />
<h2 id="persiapan-upgrade">1. Persiapan Upgrade</h2>
<h3 id="checklist-sebelum-upgrade">1.1 Checklist Sebelum Upgrade</h3>
<p><strong>✅ Wajib Dilakukan:</strong></p>
<ul class="task-list">
<li><label><input type="checkbox" /><strong>Backup database</strong>
(export SQL)</label></li>
<li><label><input type="checkbox" /><strong>Commit semua
perubahan</strong> ke Git</label></li>
<li><label><input type="checkbox" /><strong>Buat branch baru</strong>
untuk upgrade</label></li>
<li><label><input type="checkbox" /><strong>Baca changelog</strong>
library yang akan diupgrade</label></li>
<li><label><input type="checkbox" /><strong>Test di development</strong>
dulu, <strong>jangan langsung production</strong></label></li>
<li><label><input type="checkbox" /><strong>Catat versi
sekarang</strong> (untuk rollback)</label></li>
</ul>
<h3 id="backup-database">1.2 Backup Database</h3>
<div class="sourceCode" id="cb258"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="co"># MySQL dump</span></span>
<span id="cb258-2"><a href="#cb258-2" aria-hidden="true" tabindex="-1"></a><span class="ex">mysqldump</span> <span class="at">-u</span> root <span class="at">-p</span> ecommerce_db <span class="op">&gt;</span> backup_<span class="va">$(</span><span class="fu">date</span> +%Y%m%d<span class="va">)</span>.sql</span>
<span id="cb258-3"><a href="#cb258-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-4"><a href="#cb258-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Atau pakai Prisma Studio</span></span>
<span id="cb258-5"><a href="#cb258-5" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma studio</span>
<span id="cb258-6"><a href="#cb258-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Manual export data</span></span></code></pre></div>
<h3 id="git-workflow">1.3 Git Workflow</h3>
<div class="sourceCode" id="cb259"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Commit current state</span></span>
<span id="cb259-2"><a href="#cb259-2" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> add .</span>
<span id="cb259-3"><a href="#cb259-3" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> commit <span class="at">-m</span> <span class="st">&quot;chore: backup before upgrade libraries&quot;</span></span>
<span id="cb259-4"><a href="#cb259-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-5"><a href="#cb259-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Buat branch upgrade</span></span>
<span id="cb259-6"><a href="#cb259-6" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> checkout <span class="at">-b</span> feature/upgrade-libraries</span>
<span id="cb259-7"><a href="#cb259-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-8"><a href="#cb259-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Push ke remote</span></span>
<span id="cb259-9"><a href="#cb259-9" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> push <span class="at">-u</span> origin feature/upgrade-libraries</span></code></pre></div>
<h3 id="catat-versi-sekarang">1.4 Catat Versi Sekarang</h3>
<p><strong>📁 File:</strong> <code>package.json</code></p>
<div class="sourceCode" id="cb260"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb260-2"><a href="#cb260-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;dependencies&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb260-3"><a href="#cb260-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;next&quot;</span><span class="fu">:</span> <span class="st">&quot;^15.5.3&quot;</span><span class="fu">,</span></span>
<span id="cb260-4"><a href="#cb260-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;react&quot;</span><span class="fu">:</span> <span class="st">&quot;^18.3.1&quot;</span><span class="fu">,</span></span>
<span id="cb260-5"><a href="#cb260-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;react-dom&quot;</span><span class="fu">:</span> <span class="st">&quot;^18.3.1&quot;</span><span class="fu">,</span></span>
<span id="cb260-6"><a href="#cb260-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;@prisma/client&quot;</span><span class="fu">:</span> <span class="st">&quot;^6.16.1&quot;</span><span class="fu">,</span></span>
<span id="cb260-7"><a href="#cb260-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;next-auth&quot;</span><span class="fu">:</span> <span class="st">&quot;^4.24.11&quot;</span><span class="fu">,</span></span>
<span id="cb260-8"><a href="#cb260-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;tailwindcss&quot;</span><span class="fu">:</span> <span class="st">&quot;^3.3.0&quot;</span></span>
<span id="cb260-9"><a href="#cb260-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb260-10"><a href="#cb260-10" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p><strong>💾 Simpan info ini untuk rollback!</strong></p>
<hr />
<h2 id="cek-versi-saat-ini">2. Cek Versi Saat Ini</h2>
<h3 id="versi-library-di-package.json">2.1 Versi Library di
Package.json</h3>
<p><strong>Versi Saat Ini (Project Ini):</strong></p>
<table>
<thead>
<tr>
<th>Library</th>
<th>Versi Sekarang</th>
<th>Kategori</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>React</strong></td>
<td>18.3.1</td>
<td>Frontend Framework</td>
</tr>
<tr>
<td><strong>Next.js</strong></td>
<td>15.5.3</td>
<td>Full-stack Framework</td>
</tr>
<tr>
<td><strong>Prisma</strong></td>
<td>6.16.1</td>
<td>ORM</td>
</tr>
<tr>
<td><strong>NextAuth</strong></td>
<td>4.24.11</td>
<td>Authentication</td>
</tr>
<tr>
<td><strong>TailwindCSS</strong></td>
<td>3.3.0</td>
<td>CSS Framework</td>
</tr>
<tr>
<td><strong>Zod</strong></td>
<td>3.22.4</td>
<td>Validation</td>
</tr>
<tr>
<td><strong>Zustand</strong></td>
<td>4.5.1</td>
<td>State Management</td>
</tr>
<tr>
<td><strong>TypeScript</strong></td>
<td>5.9.2</td>
<td>Language</td>
</tr>
</tbody>
</table>
<h3 id="cek-versi-terbaru">2.2 Cek Versi Terbaru</h3>
<div class="sourceCode" id="cb261"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cek semua outdated packages</span></span>
<span id="cb261-2"><a href="#cb261-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> outdated</span>
<span id="cb261-3"><a href="#cb261-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-4"><a href="#cb261-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Atau pakai Yarn</span></span>
<span id="cb261-5"><a href="#cb261-5" aria-hidden="true" tabindex="-1"></a><span class="ex">yarn</span> outdated</span>
<span id="cb261-6"><a href="#cb261-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-7"><a href="#cb261-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Output example:</span></span>
<span id="cb261-8"><a href="#cb261-8" aria-hidden="true" tabindex="-1"></a><span class="ex">Package</span>       Current  Wanted  Latest  Location</span>
<span id="cb261-9"><a href="#cb261-9" aria-hidden="true" tabindex="-1"></a><span class="ex">next</span>          15.5.3   15.5.3  16.0.2  node_modules/next</span>
<span id="cb261-10"><a href="#cb261-10" aria-hidden="true" tabindex="-1"></a><span class="ex">react</span>         18.3.1   18.3.1  19.0.0  node_modules/react</span>
<span id="cb261-11"><a href="#cb261-11" aria-hidden="true" tabindex="-1"></a><span class="ex">prisma</span>        6.16.1   6.16.1  7.2.0   node_modules/prisma</span></code></pre></div>
<h3 id="cek-breaking-changes">2.3 Cek Breaking Changes</h3>
<p>Sebelum upgrade, <strong>wajib</strong> baca:</p>
<ul>
<li><a
href="https://nextjs.org/docs/app/building-your-application/upgrading">Next.js
Upgrade Guide</a></li>
<li><a href="https://react.dev/blog/2024/04/25/react-19">React 19
Changelog</a></li>
<li><a href="https://github.com/prisma/prisma/releases">Prisma Release
Notes</a></li>
<li><a
href="https://authjs.dev/getting-started/migrating-to-v5">NextAuth.js
Migration</a></li>
<li><a href="https://tailwindcss.com/docs/upgrade-guide">TailwindCSS
Upgrade Guide</a></li>
</ul>
<hr />
<h2 id="upgrade-react">3. Upgrade React</h2>
<h3 id="react-18-react-19">3.1 React 18 → React 19</h3>
<p><strong>⚠️ React 19 masih dalam Beta (per 2024)!</strong> Tunggu
stable release.</p>
<p><strong>Jika tetap ingin upgrade:</strong></p>
<div class="sourceCode" id="cb262"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install react@rc react-dom@rc</span></code></pre></div>
<h3 id="breaking-changes-react-19">3.2 Breaking Changes React 19</h3>
<h4 id="automatic-batching">1️⃣ Automatic Batching</h4>
<div class="sourceCode" id="cb263"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a><span class="co">// React 18: Manual batching di event handler</span></span>
<span id="cb263-2"><a href="#cb263-2" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">handleClick</span>() {</span>
<span id="cb263-3"><a href="#cb263-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setCount</span>(c <span class="kw">=&gt;</span> c <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb263-4"><a href="#cb263-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setFlag</span>(f <span class="kw">=&gt;</span> <span class="op">!</span>f)</span>
<span id="cb263-5"><a href="#cb263-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Batched automatically</span></span>
<span id="cb263-6"><a href="#cb263-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb263-7"><a href="#cb263-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb263-8"><a href="#cb263-8" aria-hidden="true" tabindex="-1"></a><span class="co">// React 19: Batched di semua tempat (termasuk promises, setTimeout)</span></span>
<span id="cb263-9"><a href="#cb263-9" aria-hidden="true" tabindex="-1"></a><span class="fu">fetch</span>(<span class="st">&#39;/api&#39;</span>)<span class="op">.</span><span class="fu">then</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb263-10"><a href="#cb263-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setCount</span>(c <span class="kw">=&gt;</span> c <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb263-11"><a href="#cb263-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setFlag</span>(f <span class="kw">=&gt;</span> <span class="op">!</span>f)</span>
<span id="cb263-12"><a href="#cb263-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ✨ Auto-batched di React 19</span></span>
<span id="cb263-13"><a href="#cb263-13" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<h4 id="new-hook-use">2️⃣ New Hook: <code>use()</code></h4>
<div class="sourceCode" id="cb264"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="co">// React 19: Read context with use()</span></span>
<span id="cb264-2"><a href="#cb264-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { use } <span class="im">from</span> <span class="st">&#39;react&#39;</span></span>
<span id="cb264-3"><a href="#cb264-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-4"><a href="#cb264-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">Component</span>() {</span>
<span id="cb264-5"><a href="#cb264-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> theme <span class="op">=</span> <span class="fu">use</span>(ThemeContext) <span class="co">// ✨ New!</span></span>
<span id="cb264-6"><a href="#cb264-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="op">&lt;</span>div style<span class="op">=</span>{{ <span class="dt">color</span><span class="op">:</span> theme<span class="op">.</span><span class="at">color</span> }} <span class="op">/&gt;</span></span>
<span id="cb264-7"><a href="#cb264-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h4 id="server-components-improvements">3️⃣ Server Components
Improvements</h4>
<div class="sourceCode" id="cb265"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb265-1"><a href="#cb265-1" aria-hidden="true" tabindex="-1"></a><span class="co">// React 19: Better server component support</span></span>
<span id="cb265-2"><a href="#cb265-2" aria-hidden="true" tabindex="-1"></a><span class="kw">async</span> <span class="kw">function</span> <span class="fu">ServerComponent</span>() {</span>
<span id="cb265-3"><a href="#cb265-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(<span class="st">&#39;/api/data&#39;</span>)</span>
<span id="cb265-4"><a href="#cb265-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="op">&lt;</span>div<span class="op">&gt;</span>{data}<span class="op">&lt;/</span>div<span class="op">&gt;</span></span>
<span id="cb265-5"><a href="#cb265-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="upgrade-react-18.x-minor-versions">3.3 Upgrade React 18.x (Minor
Versions)</h3>
<p><strong>Aman untuk upgrade patch/minor versions:</strong></p>
<div class="sourceCode" id="cb266"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Dari 18.3.1 → 18.3.x (latest patch)</span></span>
<span id="cb266-2"><a href="#cb266-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install react@18 react-dom@18</span>
<span id="cb266-3"><a href="#cb266-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-4"><a href="#cb266-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Atau specific version</span></span>
<span id="cb266-5"><a href="#cb266-5" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install react@18.3.5 react-dom@18.3.5</span></code></pre></div>
<h3 id="update-react-types">3.4 Update React Types</h3>
<div class="sourceCode" id="cb267"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb267-1"><a href="#cb267-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Update React TypeScript types</span></span>
<span id="cb267-2"><a href="#cb267-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install <span class="at">--save-dev</span> @types/react@18 @types/react-dom@18</span>
<span id="cb267-3"><a href="#cb267-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb267-4"><a href="#cb267-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Atau latest</span></span>
<span id="cb267-5"><a href="#cb267-5" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install <span class="at">--save-dev</span> @types/react@latest @types/react-dom@latest</span></code></pre></div>
<h3 id="testing-react-upgrade">3.5 Testing React Upgrade</h3>
<div class="sourceCode" id="cb268"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Test file: __tests__/react-version.test.js</span></span>
<span id="cb268-2"><a href="#cb268-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> React <span class="im">from</span> <span class="st">&#39;react&#39;</span></span>
<span id="cb268-3"><a href="#cb268-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb268-4"><a href="#cb268-4" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;React version:&#39;</span><span class="op">,</span> React<span class="op">.</span><span class="at">version</span>)</span>
<span id="cb268-5"><a href="#cb268-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Output: &quot;18.3.1&quot;</span></span></code></pre></div>
<hr />
<h2 id="upgrade-next.js">4. Upgrade Next.js</h2>
<h3 id="next.js-15-next.js-16">4.1 Next.js 15 → Next.js 16</h3>
<p><strong>⚠️ Next.js 16 belum release (per early 2025).</strong></p>
<p><strong>Current stable:</strong> Next.js 15.5.x</p>
<h3 id="upgrade-minor-version-15.5.3-15.6.x">4.2 Upgrade Minor Version
(15.5.3 → 15.6.x)</h3>
<div class="sourceCode" id="cb269"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb269-1"><a href="#cb269-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Upgrade ke latest 15.x</span></span>
<span id="cb269-2"><a href="#cb269-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install next@15</span>
<span id="cb269-3"><a href="#cb269-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb269-4"><a href="#cb269-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Atau specific version</span></span>
<span id="cb269-5"><a href="#cb269-5" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install next@15.6.0</span></code></pre></div>
<h3 id="breaking-changes-next.js-15">4.3 Breaking Changes Next.js
15</h3>
<h4 id="async-request-apis-breaking-change">1️⃣ Async Request APIs
(Breaking Change!)</h4>
<p><strong>Next.js 15</strong> membuat beberapa API menjadi
<strong>async</strong>:</p>
<div class="sourceCode" id="cb270"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb270-1"><a href="#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ❌ LAMA (Next.js 14 dan sebelumnya):</span></span>
<span id="cb270-2"><a href="#cb270-2" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="im">default</span> <span class="kw">function</span> <span class="fu">Page</span>({ params<span class="op">,</span> searchParams }) {</span>
<span id="cb270-3"><a href="#cb270-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> { id } <span class="op">=</span> params        <span class="co">// Sync</span></span>
<span id="cb270-4"><a href="#cb270-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> { query } <span class="op">=</span> searchParams <span class="co">// Sync</span></span>
<span id="cb270-5"><a href="#cb270-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb270-6"><a href="#cb270-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb270-7"><a href="#cb270-7" aria-hidden="true" tabindex="-1"></a><span class="co">// ✅ BARU (Next.js 15+):</span></span>
<span id="cb270-8"><a href="#cb270-8" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="im">default</span> <span class="kw">async</span> <span class="kw">function</span> <span class="fu">Page</span>({ params<span class="op">,</span> searchParams }) {</span>
<span id="cb270-9"><a href="#cb270-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> { id } <span class="op">=</span> <span class="cf">await</span> params        <span class="co">// Async!</span></span>
<span id="cb270-10"><a href="#cb270-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> { query } <span class="op">=</span> <span class="cf">await</span> searchParams <span class="co">// Async!</span></span>
<span id="cb270-11"><a href="#cb270-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>📁 Update di Project:</strong></p>
<p>Cari semua file yang pakai <code>params</code> atau
<code>searchParams</code>:</p>
<div class="sourceCode" id="cb271"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb271-1"><a href="#cb271-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Search files</span></span>
<span id="cb271-2"><a href="#cb271-2" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> <span class="at">-r</span> <span class="st">&quot;params\|searchParams&quot;</span> app/</span></code></pre></div>
<p>Contoh update:</p>
<p><strong>📁 File:</strong>
<code>app/product/[slug]/page.tsx</code></p>
<div class="sourceCode" id="cb272"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ❌ LAMA:</span></span>
<span id="cb272-2"><a href="#cb272-2" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="im">default</span> <span class="kw">function</span> <span class="fu">ProductPage</span>({ params }<span class="op">:</span> { params<span class="op">:</span> { slug<span class="op">:</span> <span class="dt">string</span> } }) {</span>
<span id="cb272-3"><a href="#cb272-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> { slug } <span class="op">=</span> params</span>
<span id="cb272-4"><a href="#cb272-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb272-5"><a href="#cb272-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-6"><a href="#cb272-6" aria-hidden="true" tabindex="-1"></a><span class="co">// ✅ BARU:</span></span>
<span id="cb272-7"><a href="#cb272-7" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="im">default</span> <span class="kw">async</span> <span class="kw">function</span> <span class="fu">ProductPage</span>({ </span>
<span id="cb272-8"><a href="#cb272-8" aria-hidden="true" tabindex="-1"></a>  params </span>
<span id="cb272-9"><a href="#cb272-9" aria-hidden="true" tabindex="-1"></a>}<span class="op">:</span> { </span>
<span id="cb272-10"><a href="#cb272-10" aria-hidden="true" tabindex="-1"></a>  params<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>{ slug<span class="op">:</span> <span class="dt">string</span> }<span class="op">&gt;</span> </span>
<span id="cb272-11"><a href="#cb272-11" aria-hidden="true" tabindex="-1"></a>}) {</span>
<span id="cb272-12"><a href="#cb272-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> { slug } <span class="op">=</span> <span class="cf">await</span> params</span>
<span id="cb272-13"><a href="#cb272-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h4 id="caching-changes">2️⃣ Caching Changes</h4>
<div class="sourceCode" id="cb273"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb273-1"><a href="#cb273-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Next.js 15: fetch() tidak cached by default</span></span>
<span id="cb273-2"><a href="#cb273-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> data <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(<span class="st">&#39;/api/data&#39;</span>) <span class="co">// Not cached</span></span>
<span id="cb273-3"><a href="#cb273-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb273-4"><a href="#cb273-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Untuk cache, tambahkan option:</span></span>
<span id="cb273-5"><a href="#cb273-5" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> data <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(<span class="st">&#39;/api/data&#39;</span><span class="op">,</span> {</span>
<span id="cb273-6"><a href="#cb273-6" aria-hidden="true" tabindex="-1"></a>  cache<span class="op">:</span> <span class="st">&#39;force-cache&#39;</span> <span class="co">// Explicitly cache</span></span>
<span id="cb273-7"><a href="#cb273-7" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<h4 id="image-component-changes">3️⃣ Image Component Changes</h4>
<div class="sourceCode" id="cb274"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb274-1"><a href="#cb274-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Next.js 15: alt attribute wajib</span></span>
<span id="cb274-2"><a href="#cb274-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> Image <span class="im">from</span> <span class="st">&#39;next/image&#39;</span></span>
<span id="cb274-3"><a href="#cb274-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb274-4"><a href="#cb274-4" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>Image </span>
<span id="cb274-5"><a href="#cb274-5" aria-hidden="true" tabindex="-1"></a>  src<span class="op">=</span><span class="st">&quot;/photo.jpg&quot;</span> </span>
<span id="cb274-6"><a href="#cb274-6" aria-hidden="true" tabindex="-1"></a>  width<span class="op">=</span>{<span class="dv">500</span>} </span>
<span id="cb274-7"><a href="#cb274-7" aria-hidden="true" tabindex="-1"></a>  height<span class="op">=</span>{<span class="dv">300</span>}</span>
<span id="cb274-8"><a href="#cb274-8" aria-hidden="true" tabindex="-1"></a>  alt<span class="op">=</span><span class="st">&quot;Description&quot;</span> <span class="co">// ✅ Wajib!</span></span>
<span id="cb274-9"><a href="#cb274-9" aria-hidden="true" tabindex="-1"></a><span class="op">/&gt;</span></span></code></pre></div>
<h3 id="update-next.js-config">4.4 Update Next.js Config</h3>
<p><strong>📁 File:</strong> <code>next.config.mjs</code></p>
<div class="sourceCode" id="cb275"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb275-1"><a href="#cb275-1" aria-hidden="true" tabindex="-1"></a><span class="co">/** </span><span class="an">@type</span><span class="co"> {import(&#39;next&#39;).NextConfig} */</span></span>
<span id="cb275-2"><a href="#cb275-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> nextConfig <span class="op">=</span> {</span>
<span id="cb275-3"><a href="#cb275-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Next.js 15 config</span></span>
<span id="cb275-4"><a href="#cb275-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">reactStrictMode</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb275-5"><a href="#cb275-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb275-6"><a href="#cb275-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Experimental features (jika ada)</span></span>
<span id="cb275-7"><a href="#cb275-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">experimental</span><span class="op">:</span> {</span>
<span id="cb275-8"><a href="#cb275-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// serverActions: true, // Deprecated di Next.js 15</span></span>
<span id="cb275-9"><a href="#cb275-9" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb275-10"><a href="#cb275-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-11"><a href="#cb275-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Image optimization</span></span>
<span id="cb275-12"><a href="#cb275-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">images</span><span class="op">:</span> {</span>
<span id="cb275-13"><a href="#cb275-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">remotePatterns</span><span class="op">:</span> [</span>
<span id="cb275-14"><a href="#cb275-14" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb275-15"><a href="#cb275-15" aria-hidden="true" tabindex="-1"></a>        <span class="dt">protocol</span><span class="op">:</span> <span class="st">&#39;https&#39;</span><span class="op">,</span></span>
<span id="cb275-16"><a href="#cb275-16" aria-hidden="true" tabindex="-1"></a>        <span class="dt">hostname</span><span class="op">:</span> <span class="st">&#39;**&#39;</span><span class="op">,</span></span>
<span id="cb275-17"><a href="#cb275-17" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb275-18"><a href="#cb275-18" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb275-19"><a href="#cb275-19" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb275-20"><a href="#cb275-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb275-21"><a href="#cb275-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-22"><a href="#cb275-22" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="im">default</span> nextConfig</span></code></pre></div>
<h3 id="update-eslint-config">4.5 Update ESLint Config</h3>
<div class="sourceCode" id="cb276"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Update ESLint Next.js</span></span>
<span id="cb276-2"><a href="#cb276-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install <span class="at">--save-dev</span> eslint-config-next@15</span></code></pre></div>
<h3 id="codemod-untuk-migration">4.6 Codemod untuk Migration</h3>
<p>Next.js menyediakan <strong>codemod</strong> untuk auto-migrate
code:</p>
<div class="sourceCode" id="cb277"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Jalankan codemod</span></span>
<span id="cb277-2"><a href="#cb277-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> @next/codemod@latest upgrade</span>
<span id="cb277-3"><a href="#cb277-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-4"><a href="#cb277-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Atau specific codemod:</span></span>
<span id="cb277-5"><a href="#cb277-5" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> @next/codemod@latest next-async-request-api</span></code></pre></div>
<hr />
<h2 id="upgrade-prisma">5. Upgrade Prisma</h2>
<h3 id="prisma-6-prisma-7">5.1 Prisma 6 → Prisma 7</h3>
<p><strong>⚠️ Prisma 7 masih development (per 2025).</strong></p>
<p><strong>Current stable:</strong> Prisma 6.16.x</p>
<h3 id="upgrade-minor-version-6.16.1-6.x.x">5.2 Upgrade Minor Version
(6.16.1 → 6.x.x)</h3>
<div class="sourceCode" id="cb278"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Upgrade Prisma CLI dan Client sekaligus</span></span>
<span id="cb278-2"><a href="#cb278-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install prisma@6 @prisma/client@6</span>
<span id="cb278-3"><a href="#cb278-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-4"><a href="#cb278-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Atau latest patch</span></span>
<span id="cb278-5"><a href="#cb278-5" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install prisma@latest @prisma/client@latest</span></code></pre></div>
<p><strong>⚠️ PENTING:</strong> Versi <code>prisma</code> dan
<code>@prisma/client</code> <strong>harus sama</strong>!</p>
<div class="sourceCode" id="cb279"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb279-2"><a href="#cb279-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;dependencies&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb279-3"><a href="#cb279-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;@prisma/client&quot;</span><span class="fu">:</span> <span class="st">&quot;^6.16.1&quot;</span> <span class="er">//</span> <span class="er">✅</span> <span class="er">Same</span> <span class="er">version</span></span>
<span id="cb279-4"><a href="#cb279-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb279-5"><a href="#cb279-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;devDependencies&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb279-6"><a href="#cb279-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;prisma&quot;</span><span class="fu">:</span> <span class="st">&quot;^6.16.1&quot;</span> <span class="er">//</span> <span class="er">✅</span> <span class="er">Same</span> <span class="er">version</span></span>
<span id="cb279-7"><a href="#cb279-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb279-8"><a href="#cb279-8" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h3 id="regenerate-prisma-client">5.3 Regenerate Prisma Client</h3>
<p><strong>Wajib setelah upgrade:</strong></p>
<div class="sourceCode" id="cb280"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb280-1"><a href="#cb280-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Generate ulang client</span></span>
<span id="cb280-2"><a href="#cb280-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma generate</span>
<span id="cb280-3"><a href="#cb280-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-4"><a href="#cb280-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Check database connection</span></span>
<span id="cb280-5"><a href="#cb280-5" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma db pull</span>
<span id="cb280-6"><a href="#cb280-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-7"><a href="#cb280-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Test migration</span></span>
<span id="cb280-8"><a href="#cb280-8" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma migrate dev</span></code></pre></div>
<h3 id="breaking-changes-prisma-6">5.4 Breaking Changes Prisma 6</h3>
<h4 id="typedsql-new-feature">1️⃣ TypedSQL (New Feature)</h4>
<div class="sourceCode" id="cb281"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Prisma 6: TypedSQL support</span></span>
<span id="cb281-2"><a href="#cb281-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { sql } <span class="im">from</span> <span class="st">&#39;@prisma/client/sql&#39;</span></span>
<span id="cb281-3"><a href="#cb281-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-4"><a href="#cb281-4" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> result <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="fu">$queryRawTyped</span>(</span>
<span id="cb281-5"><a href="#cb281-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sql</span><span class="vs">`SELECT * FROM Product WHERE price &gt; </span><span class="sc">${</span><span class="dv">1000</span><span class="sc">}</span><span class="vs">`</span></span>
<span id="cb281-6"><a href="#cb281-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<h4 id="improved-error-messages">2️⃣ Improved Error Messages</h4>
<div class="sourceCode" id="cb282"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Prisma 6: Better error messages</span></span>
<span id="cb282-2"><a href="#cb282-2" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span> {</span>
<span id="cb282-3"><a href="#cb282-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">await</span> prisma<span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="fu">create</span>({ data<span class="op">:</span> {} })</span>
<span id="cb282-4"><a href="#cb282-4" aria-hidden="true" tabindex="-1"></a>} <span class="cf">catch</span> (error) {</span>
<span id="cb282-5"><a href="#cb282-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Error messages lebih detail di Prisma 6</span></span>
<span id="cb282-6"><a href="#cb282-6" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(error<span class="op">.</span><span class="at">message</span>)</span>
<span id="cb282-7"><a href="#cb282-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h4 id="performance-improvements">3️⃣ Performance Improvements</h4>
<p>Prisma 6 lebih cepat: - Query optimization - Smaller client bundle
size - Faster cold starts</p>
<h3 id="update-prisma-schema">5.5 Update Prisma Schema</h3>
<p><strong>Tidak ada breaking changes di schema format</strong>, tapi
bisa pakai fitur baru:</p>
<pre class="prisma"><code>// Prisma 6: New features
model Product {
  id    String @id @default(uuid(7)) // ✨ Shorter UUIDs
  title String @db.VarChar(255)     // Explicit DB type
}</code></pre>
<h3 id="migration-strategy">5.6 Migration Strategy</h3>
<div class="sourceCode" id="cb284"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Backup database</span></span>
<span id="cb284-2"><a href="#cb284-2" aria-hidden="true" tabindex="-1"></a><span class="ex">mysqldump</span> <span class="at">-u</span> root <span class="at">-p</span> ecommerce_db <span class="op">&gt;</span> backup.sql</span>
<span id="cb284-3"><a href="#cb284-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-4"><a href="#cb284-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Upgrade Prisma</span></span>
<span id="cb284-5"><a href="#cb284-5" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install prisma@latest @prisma/client@latest</span>
<span id="cb284-6"><a href="#cb284-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-7"><a href="#cb284-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Generate client</span></span>
<span id="cb284-8"><a href="#cb284-8" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma generate</span>
<span id="cb284-9"><a href="#cb284-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-10"><a href="#cb284-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Check pending migrations</span></span>
<span id="cb284-11"><a href="#cb284-11" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma migrate status</span>
<span id="cb284-12"><a href="#cb284-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-13"><a href="#cb284-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Apply migrations (development)</span></span>
<span id="cb284-14"><a href="#cb284-14" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma migrate dev</span>
<span id="cb284-15"><a href="#cb284-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-16"><a href="#cb284-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. Deploy migrations (production)</span></span>
<span id="cb284-17"><a href="#cb284-17" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma migrate deploy</span></code></pre></div>
<hr />
<h2 id="upgrade-nextauth">6. Upgrade NextAuth</h2>
<h3 id="nextauth-v4-v5-auth.js">6.1 NextAuth v4 → v5 (Auth.js)</h3>
<p><strong>⚠️ BREAKING CHANGES BESAR!</strong></p>
<p>NextAuth v5 sekarang bernama <strong>Auth.js</strong> dengan
perubahan signifikan.</p>
<h3 id="major-breaking-changes">6.2 Major Breaking Changes</h3>
<table>
<colgroup>
<col style="width: 21%" />
<col style="width: 40%" />
<col style="width: 37%" />
</colgroup>
<thead>
<tr>
<th>Fitur</th>
<th>NextAuth v4</th>
<th>Auth.js v5</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Package name</strong></td>
<td><code>next-auth</code></td>
<td><code>@auth/nextjs</code></td>
</tr>
<tr>
<td><strong>Config location</strong></td>
<td><code>[...nextauth]/route.ts</code></td>
<td><code>auth.ts</code> (root)</td>
</tr>
<tr>
<td><strong>Import</strong></td>
<td><code>import NextAuth from 'next-auth'</code></td>
<td><code>import NextAuth from '@auth/nextjs'</code></td>
</tr>
<tr>
<td><strong>Session</strong></td>
<td><code>getServerSession()</code></td>
<td><code>auth()</code></td>
</tr>
<tr>
<td><strong>Middleware</strong></td>
<td><code>withAuth()</code></td>
<td><code>middleware.ts</code> dengan <code>auth</code> export</td>
</tr>
</tbody>
</table>
<h3 id="migration-steps">6.3 Migration Steps</h3>
<h4 id="step-1-install-auth.js-v5">Step 1: Install Auth.js v5</h4>
<div class="sourceCode" id="cb285"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb285-1"><a href="#cb285-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Uninstall NextAuth v4</span></span>
<span id="cb285-2"><a href="#cb285-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> uninstall next-auth</span>
<span id="cb285-3"><a href="#cb285-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-4"><a href="#cb285-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Install Auth.js v5</span></span>
<span id="cb285-5"><a href="#cb285-5" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install @auth/nextjs@beta @auth/prisma-adapter@beta</span></code></pre></div>
<h4 id="step-2-buat-auth.ts-root-config">Step 2: Buat auth.ts (Root
Config)</h4>
<p><strong>📁 Buat file baru:</strong> <code>auth.ts</code> (di root
project)</p>
<div class="sourceCode" id="cb286"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb286-1"><a href="#cb286-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> NextAuth <span class="im">from</span> <span class="st">&quot;@auth/nextjs&quot;</span></span>
<span id="cb286-2"><a href="#cb286-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { PrismaAdapter } <span class="im">from</span> <span class="st">&quot;@auth/prisma-adapter&quot;</span></span>
<span id="cb286-3"><a href="#cb286-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { prisma } <span class="im">from</span> <span class="st">&quot;@/lib/prisma&quot;</span></span>
<span id="cb286-4"><a href="#cb286-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> CredentialsProvider <span class="im">from</span> <span class="st">&quot;@auth/nextjs/providers/credentials&quot;</span></span>
<span id="cb286-5"><a href="#cb286-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> bcrypt <span class="im">from</span> <span class="st">&quot;bcryptjs&quot;</span></span>
<span id="cb286-6"><a href="#cb286-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-7"><a href="#cb286-7" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> { handlers<span class="op">,</span> auth<span class="op">,</span> signIn<span class="op">,</span> signOut } <span class="op">=</span> <span class="fu">NextAuth</span>({</span>
<span id="cb286-8"><a href="#cb286-8" aria-hidden="true" tabindex="-1"></a>  adapter<span class="op">:</span> <span class="fu">PrismaAdapter</span>(prisma)<span class="op">,</span></span>
<span id="cb286-9"><a href="#cb286-9" aria-hidden="true" tabindex="-1"></a>  session<span class="op">:</span> { strategy<span class="op">:</span> <span class="st">&quot;jwt&quot;</span> }<span class="op">,</span></span>
<span id="cb286-10"><a href="#cb286-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb286-11"><a href="#cb286-11" aria-hidden="true" tabindex="-1"></a>  providers<span class="op">:</span> [</span>
<span id="cb286-12"><a href="#cb286-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">CredentialsProvider</span>({</span>
<span id="cb286-13"><a href="#cb286-13" aria-hidden="true" tabindex="-1"></a>      credentials<span class="op">:</span> {</span>
<span id="cb286-14"><a href="#cb286-14" aria-hidden="true" tabindex="-1"></a>        email<span class="op">:</span> { label<span class="op">:</span> <span class="st">&quot;Email&quot;</span><span class="op">,</span> type<span class="op">:</span> <span class="st">&quot;email&quot;</span> }<span class="op">,</span></span>
<span id="cb286-15"><a href="#cb286-15" aria-hidden="true" tabindex="-1"></a>        password<span class="op">:</span> { label<span class="op">:</span> <span class="st">&quot;Password&quot;</span><span class="op">,</span> type<span class="op">:</span> <span class="st">&quot;password&quot;</span> }<span class="op">,</span></span>
<span id="cb286-16"><a href="#cb286-16" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb286-17"><a href="#cb286-17" aria-hidden="true" tabindex="-1"></a>      <span class="kw">async</span> <span class="fu">authorize</span>(credentials) {</span>
<span id="cb286-18"><a href="#cb286-18" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> user <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">user</span><span class="op">.</span><span class="fu">findUnique</span>({</span>
<span id="cb286-19"><a href="#cb286-19" aria-hidden="true" tabindex="-1"></a>          where<span class="op">:</span> { email<span class="op">:</span> credentials<span class="op">.</span><span class="at">email</span> <span class="im">as</span> <span class="dt">string</span> }</span>
<span id="cb286-20"><a href="#cb286-20" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb286-21"><a href="#cb286-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-22"><a href="#cb286-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span>user <span class="op">||</span> <span class="op">!</span>user<span class="op">.</span><span class="at">password</span>) <span class="cf">return</span> <span class="kw">null</span></span>
<span id="cb286-23"><a href="#cb286-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-24"><a href="#cb286-24" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> isValid <span class="op">=</span> <span class="cf">await</span> bcrypt<span class="op">.</span><span class="fu">compare</span>(</span>
<span id="cb286-25"><a href="#cb286-25" aria-hidden="true" tabindex="-1"></a>          credentials<span class="op">.</span><span class="at">password</span> <span class="im">as</span> <span class="dt">string</span><span class="op">,</span></span>
<span id="cb286-26"><a href="#cb286-26" aria-hidden="true" tabindex="-1"></a>          user<span class="op">.</span><span class="at">password</span></span>
<span id="cb286-27"><a href="#cb286-27" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb286-28"><a href="#cb286-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-29"><a href="#cb286-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span>isValid) <span class="cf">return</span> <span class="kw">null</span></span>
<span id="cb286-30"><a href="#cb286-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-31"><a href="#cb286-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb286-32"><a href="#cb286-32" aria-hidden="true" tabindex="-1"></a>          id<span class="op">:</span> user<span class="op">.</span><span class="at">id</span><span class="op">,</span></span>
<span id="cb286-33"><a href="#cb286-33" aria-hidden="true" tabindex="-1"></a>          email<span class="op">:</span> user<span class="op">.</span><span class="at">email</span><span class="op">,</span></span>
<span id="cb286-34"><a href="#cb286-34" aria-hidden="true" tabindex="-1"></a>          role<span class="op">:</span> user<span class="op">.</span><span class="at">role</span><span class="op">,</span></span>
<span id="cb286-35"><a href="#cb286-35" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb286-36"><a href="#cb286-36" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb286-37"><a href="#cb286-37" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb286-38"><a href="#cb286-38" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb286-39"><a href="#cb286-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-40"><a href="#cb286-40" aria-hidden="true" tabindex="-1"></a>  callbacks<span class="op">:</span> {</span>
<span id="cb286-41"><a href="#cb286-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">async</span> <span class="fu">jwt</span>({ token<span class="op">,</span> user }) {</span>
<span id="cb286-42"><a href="#cb286-42" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (user) {</span>
<span id="cb286-43"><a href="#cb286-43" aria-hidden="true" tabindex="-1"></a>        token<span class="op">.</span><span class="at">id</span> <span class="op">=</span> user<span class="op">.</span><span class="at">id</span></span>
<span id="cb286-44"><a href="#cb286-44" aria-hidden="true" tabindex="-1"></a>        token<span class="op">.</span><span class="at">role</span> <span class="op">=</span> user<span class="op">.</span><span class="at">role</span></span>
<span id="cb286-45"><a href="#cb286-45" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb286-46"><a href="#cb286-46" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> token</span>
<span id="cb286-47"><a href="#cb286-47" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb286-48"><a href="#cb286-48" aria-hidden="true" tabindex="-1"></a>    <span class="kw">async</span> <span class="fu">session</span>({ session<span class="op">,</span> token }) {</span>
<span id="cb286-49"><a href="#cb286-49" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (token) {</span>
<span id="cb286-50"><a href="#cb286-50" aria-hidden="true" tabindex="-1"></a>        session<span class="op">.</span><span class="at">user</span><span class="op">.</span><span class="at">id</span> <span class="op">=</span> token<span class="op">.</span><span class="at">id</span> <span class="im">as</span> <span class="dt">string</span></span>
<span id="cb286-51"><a href="#cb286-51" aria-hidden="true" tabindex="-1"></a>        session<span class="op">.</span><span class="at">user</span><span class="op">.</span><span class="at">role</span> <span class="op">=</span> token<span class="op">.</span><span class="at">role</span> <span class="im">as</span> <span class="dt">string</span></span>
<span id="cb286-52"><a href="#cb286-52" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb286-53"><a href="#cb286-53" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> session</span>
<span id="cb286-54"><a href="#cb286-54" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb286-55"><a href="#cb286-55" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb286-56"><a href="#cb286-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-57"><a href="#cb286-57" aria-hidden="true" tabindex="-1"></a>  pages<span class="op">:</span> {</span>
<span id="cb286-58"><a href="#cb286-58" aria-hidden="true" tabindex="-1"></a>    signIn<span class="op">:</span> <span class="st">&#39;/login&#39;</span><span class="op">,</span></span>
<span id="cb286-59"><a href="#cb286-59" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb286-60"><a href="#cb286-60" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<h4 id="step-3-update-api-route">Step 3: Update API Route</h4>
<p><strong>📁 File:</strong>
<code>app/api/auth/[...nextauth]/route.ts</code></p>
<div class="sourceCode" id="cb287"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb287-1"><a href="#cb287-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ❌ LAMA (NextAuth v4):</span></span>
<span id="cb287-2"><a href="#cb287-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> NextAuth <span class="im">from</span> <span class="st">&quot;next-auth&quot;</span></span>
<span id="cb287-3"><a href="#cb287-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { authOptions } <span class="im">from</span> <span class="st">&quot;@/lib/auth&quot;</span></span>
<span id="cb287-4"><a href="#cb287-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb287-5"><a href="#cb287-5" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> handler <span class="op">=</span> <span class="fu">NextAuth</span>(authOptions)</span>
<span id="cb287-6"><a href="#cb287-6" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> { handler <span class="im">as</span> GET<span class="op">,</span> handler <span class="im">as</span> POST }</span>
<span id="cb287-7"><a href="#cb287-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb287-8"><a href="#cb287-8" aria-hidden="true" tabindex="-1"></a><span class="co">// ✅ BARU (Auth.js v5):</span></span>
<span id="cb287-9"><a href="#cb287-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { handlers } <span class="im">from</span> <span class="st">&quot;@/auth&quot;</span></span>
<span id="cb287-10"><a href="#cb287-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb287-11"><a href="#cb287-11" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> { GET<span class="op">,</span> POST } <span class="op">=</span> handlers</span></code></pre></div>
<h4 id="step-4-update-middleware">Step 4: Update Middleware</h4>
<p><strong>📁 File:</strong> <code>middleware.ts</code></p>
<div class="sourceCode" id="cb288"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb288-1"><a href="#cb288-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ❌ LAMA (NextAuth v4):</span></span>
<span id="cb288-2"><a href="#cb288-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { withAuth } <span class="im">from</span> <span class="st">&quot;next-auth/middleware&quot;</span></span>
<span id="cb288-3"><a href="#cb288-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb288-4"><a href="#cb288-4" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="im">default</span> <span class="fu">withAuth</span>({</span>
<span id="cb288-5"><a href="#cb288-5" aria-hidden="true" tabindex="-1"></a>  callbacks<span class="op">:</span> {</span>
<span id="cb288-6"><a href="#cb288-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">authorized</span>({ req<span class="op">,</span> token }) {</span>
<span id="cb288-7"><a href="#cb288-7" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (req<span class="op">.</span><span class="at">nextUrl</span><span class="op">.</span><span class="at">pathname</span><span class="op">.</span><span class="fu">startsWith</span>(<span class="st">&#39;/admin&#39;</span>)) {</span>
<span id="cb288-8"><a href="#cb288-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> token<span class="op">?.</span><span class="at">role</span> <span class="op">===</span> <span class="st">&quot;admin&quot;</span></span>
<span id="cb288-9"><a href="#cb288-9" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb288-10"><a href="#cb288-10" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="op">!!</span>token</span>
<span id="cb288-11"><a href="#cb288-11" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb288-12"><a href="#cb288-12" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb288-13"><a href="#cb288-13" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb288-14"><a href="#cb288-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb288-15"><a href="#cb288-15" aria-hidden="true" tabindex="-1"></a><span class="co">// ✅ BARU (Auth.js v5):</span></span>
<span id="cb288-16"><a href="#cb288-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { auth } <span class="im">from</span> <span class="st">&quot;@/auth&quot;</span></span>
<span id="cb288-17"><a href="#cb288-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { NextResponse } <span class="im">from</span> <span class="st">&quot;next/server&quot;</span></span>
<span id="cb288-18"><a href="#cb288-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb288-19"><a href="#cb288-19" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="im">default</span> <span class="fu">auth</span>((req) <span class="kw">=&gt;</span> {</span>
<span id="cb288-20"><a href="#cb288-20" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> { pathname } <span class="op">=</span> req<span class="op">.</span><span class="at">nextUrl</span></span>
<span id="cb288-21"><a href="#cb288-21" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> isLoggedIn <span class="op">=</span> <span class="op">!!</span>req<span class="op">.</span><span class="at">auth</span></span>
<span id="cb288-22"><a href="#cb288-22" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> isAdmin <span class="op">=</span> req<span class="op">.</span><span class="at">auth</span><span class="op">?.</span><span class="at">user</span><span class="op">?.</span><span class="at">role</span> <span class="op">===</span> <span class="st">&quot;admin&quot;</span></span>
<span id="cb288-23"><a href="#cb288-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb288-24"><a href="#cb288-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (pathname<span class="op">.</span><span class="fu">startsWith</span>(<span class="st">&#39;/admin&#39;</span>) <span class="op">&amp;&amp;</span> <span class="op">!</span>isAdmin) {</span>
<span id="cb288-25"><a href="#cb288-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">redirect</span>(<span class="kw">new</span> <span class="fu">URL</span>(<span class="st">&#39;/&#39;</span><span class="op">,</span> req<span class="op">.</span><span class="at">url</span>))</span>
<span id="cb288-26"><a href="#cb288-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb288-27"><a href="#cb288-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb288-28"><a href="#cb288-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">next</span>()</span>
<span id="cb288-29"><a href="#cb288-29" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb288-30"><a href="#cb288-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb288-31"><a href="#cb288-31" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> config <span class="op">=</span> {</span>
<span id="cb288-32"><a href="#cb288-32" aria-hidden="true" tabindex="-1"></a>  matcher<span class="op">:</span> [<span class="st">&#39;/admin/:path*&#39;</span>]</span>
<span id="cb288-33"><a href="#cb288-33" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h4 id="step-5-update-server-components">Step 5: Update Server
Components</h4>
<div class="sourceCode" id="cb289"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb289-1"><a href="#cb289-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ❌ LAMA (NextAuth v4):</span></span>
<span id="cb289-2"><a href="#cb289-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { getServerSession } <span class="im">from</span> <span class="st">&quot;next-auth&quot;</span></span>
<span id="cb289-3"><a href="#cb289-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { authOptions } <span class="im">from</span> <span class="st">&quot;@/lib/auth&quot;</span></span>
<span id="cb289-4"><a href="#cb289-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-5"><a href="#cb289-5" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="im">default</span> <span class="kw">async</span> <span class="kw">function</span> <span class="fu">Page</span>() {</span>
<span id="cb289-6"><a href="#cb289-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> session <span class="op">=</span> <span class="cf">await</span> <span class="fu">getServerSession</span>(authOptions)</span>
<span id="cb289-7"><a href="#cb289-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="op">&lt;</span>div<span class="op">&gt;</span>{session<span class="op">?.</span><span class="at">user</span><span class="op">?.</span><span class="at">email</span>}<span class="op">&lt;/</span>div<span class="op">&gt;</span></span>
<span id="cb289-8"><a href="#cb289-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb289-9"><a href="#cb289-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-10"><a href="#cb289-10" aria-hidden="true" tabindex="-1"></a><span class="co">// ✅ BARU (Auth.js v5):</span></span>
<span id="cb289-11"><a href="#cb289-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { auth } <span class="im">from</span> <span class="st">&quot;@/auth&quot;</span></span>
<span id="cb289-12"><a href="#cb289-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-13"><a href="#cb289-13" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="im">default</span> <span class="kw">async</span> <span class="kw">function</span> <span class="fu">Page</span>() {</span>
<span id="cb289-14"><a href="#cb289-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> session <span class="op">=</span> <span class="cf">await</span> <span class="fu">auth</span>()</span>
<span id="cb289-15"><a href="#cb289-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="op">&lt;</span>div<span class="op">&gt;</span>{session<span class="op">?.</span><span class="at">user</span><span class="op">?.</span><span class="at">email</span>}<span class="op">&lt;/</span>div<span class="op">&gt;</span></span>
<span id="cb289-16"><a href="#cb289-16" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h4 id="step-6-update-client-components">Step 6: Update Client
Components</h4>
<div class="sourceCode" id="cb290"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb290-1"><a href="#cb290-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ❌ LAMA (NextAuth v4):</span></span>
<span id="cb290-2"><a href="#cb290-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { useSession<span class="op">,</span> signIn<span class="op">,</span> signOut } <span class="im">from</span> <span class="st">&quot;next-auth/react&quot;</span></span>
<span id="cb290-3"><a href="#cb290-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-4"><a href="#cb290-4" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="im">default</span> <span class="kw">function</span> <span class="fu">Component</span>() {</span>
<span id="cb290-5"><a href="#cb290-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> { data<span class="op">:</span> session } <span class="op">=</span> <span class="fu">useSession</span>()</span>
<span id="cb290-6"><a href="#cb290-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb290-7"><a href="#cb290-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (</span>
<span id="cb290-8"><a href="#cb290-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>button onClick<span class="op">=</span>{() <span class="kw">=&gt;</span> <span class="fu">signIn</span>()}<span class="op">&gt;</span>Login<span class="op">&lt;/</span>button<span class="op">&gt;</span></span>
<span id="cb290-9"><a href="#cb290-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb290-10"><a href="#cb290-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb290-11"><a href="#cb290-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-12"><a href="#cb290-12" aria-hidden="true" tabindex="-1"></a><span class="co">// ✅ BARU (Auth.js v5):</span></span>
<span id="cb290-13"><a href="#cb290-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { useSession } <span class="im">from</span> <span class="st">&quot;@auth/nextjs/react&quot;</span></span>
<span id="cb290-14"><a href="#cb290-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { signIn<span class="op">,</span> signOut } <span class="im">from</span> <span class="st">&quot;@/auth&quot;</span></span>
<span id="cb290-15"><a href="#cb290-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-16"><a href="#cb290-16" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="im">default</span> <span class="kw">function</span> <span class="fu">Component</span>() {</span>
<span id="cb290-17"><a href="#cb290-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> { data<span class="op">:</span> session } <span class="op">=</span> <span class="fu">useSession</span>()</span>
<span id="cb290-18"><a href="#cb290-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb290-19"><a href="#cb290-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (</span>
<span id="cb290-20"><a href="#cb290-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>button onClick<span class="op">=</span>{() <span class="kw">=&gt;</span> <span class="fu">signIn</span>()}<span class="op">&gt;</span>Login<span class="op">&lt;/</span>button<span class="op">&gt;</span></span>
<span id="cb290-21"><a href="#cb290-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb290-22"><a href="#cb290-22" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="tetap-pakai-nextauth-v4-recommended-untuk-saat-ini">6.4 Tetap
Pakai NextAuth v4 (Recommended untuk Saat Ini)</h3>
<p><strong>Jika belum siap migrate ke v5:</strong></p>
<div class="sourceCode" id="cb291"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb291-1"><a href="#cb291-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Stay di v4, upgrade minor version saja</span></span>
<span id="cb291-2"><a href="#cb291-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install next-auth@4</span>
<span id="cb291-3"><a href="#cb291-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb291-4"><a href="#cb291-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Atau latest v4</span></span>
<span id="cb291-5"><a href="#cb291-5" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install next-auth@^4.24.11</span></code></pre></div>
<p><strong>✅ NextAuth v4 masih actively maintained sampai v5
stable.</strong></p>
<hr />
<h2 id="upgrade-tailwindcss">7. Upgrade TailwindCSS</h2>
<h3 id="tailwindcss-3-tailwindcss-4">7.1 TailwindCSS 3 → TailwindCSS
4</h3>
<p><strong>⚠️ TailwindCSS v4 masih Alpha (per 2025).</strong></p>
<p><strong>Current stable:</strong> TailwindCSS 3.4.x</p>
<h3 id="upgrade-minor-version-3.3.0-3.4.x">7.2 Upgrade Minor Version
(3.3.0 → 3.4.x)</h3>
<div class="sourceCode" id="cb292"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb292-1"><a href="#cb292-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Upgrade Tailwind</span></span>
<span id="cb292-2"><a href="#cb292-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install tailwindcss@3</span>
<span id="cb292-3"><a href="#cb292-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb292-4"><a href="#cb292-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Atau latest 3.x</span></span>
<span id="cb292-5"><a href="#cb292-5" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install tailwindcss@^3.4.0</span></code></pre></div>
<h3 id="update-dependencies">7.3 Update Dependencies</h3>
<div class="sourceCode" id="cb293"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb293-1"><a href="#cb293-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Update semua Tailwind plugins</span></span>
<span id="cb293-2"><a href="#cb293-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install @tailwindcss/forms@latest</span>
<span id="cb293-3"><a href="#cb293-3" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install @tailwindcss/typography@latest</span>
<span id="cb293-4"><a href="#cb293-4" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install daisyui@latest</span></code></pre></div>
<h3 id="breaking-changes-tailwind-3.4">7.4 Breaking Changes Tailwind
3.4</h3>
<h4 id="new-colors">1️⃣ New Colors</h4>
<div class="sourceCode" id="cb294"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb294-1"><a href="#cb294-1" aria-hidden="true" tabindex="-1"></a><span class="co">// tailwind.config.ts</span></span>
<span id="cb294-2"><a href="#cb294-2" aria-hidden="true" tabindex="-1"></a>colors<span class="op">:</span> {</span>
<span id="cb294-3"><a href="#cb294-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Tailwind 3.4 added:</span></span>
<span id="cb294-4"><a href="#cb294-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">lime</span><span class="op">:</span> colors<span class="op">.</span><span class="at">lime</span><span class="op">,</span></span>
<span id="cb294-5"><a href="#cb294-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">cyan</span><span class="op">:</span> colors<span class="op">.</span><span class="at">cyan</span><span class="op">,</span></span>
<span id="cb294-6"><a href="#cb294-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ... more colors</span></span>
<span id="cb294-7"><a href="#cb294-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h4 id="dynamic-breakpoints">2️⃣ Dynamic Breakpoints</h4>
<div class="sourceCode" id="cb295"><pre
class="sourceCode css"><code class="sourceCode css"><span id="cb295-1"><a href="#cb295-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Tailwind 3.4: Dynamic breakpoints */</span></span>
<span id="cb295-2"><a href="#cb295-2" aria-hidden="true" tabindex="-1"></a><span class="im">@media</span> <span class="fu">(</span><span class="kw">min-width</span><span class="ch">:</span> theme<span class="fu">(</span><span class="st">&#39;screens.lg&#39;</span><span class="fu">))</span> {</span>
<span id="cb295-3"><a href="#cb295-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Custom breakpoint */</span></span>
<span id="cb295-4"><a href="#cb295-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="update-tailwind-config">7.5 Update Tailwind Config</h3>
<p><strong>📁 File:</strong> <code>tailwind.config.ts</code></p>
<div class="sourceCode" id="cb296"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb296-1"><a href="#cb296-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="im">type</span> { Config } <span class="im">from</span> <span class="st">&#39;tailwindcss&#39;</span></span>
<span id="cb296-2"><a href="#cb296-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb296-3"><a href="#cb296-3" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> config<span class="op">:</span> Config <span class="op">=</span> {</span>
<span id="cb296-4"><a href="#cb296-4" aria-hidden="true" tabindex="-1"></a>  content<span class="op">:</span> [</span>
<span id="cb296-5"><a href="#cb296-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;./pages/**/*.{js,ts,jsx,tsx,mdx}&#39;</span><span class="op">,</span></span>
<span id="cb296-6"><a href="#cb296-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;./components/**/*.{js,ts,jsx,tsx,mdx}&#39;</span><span class="op">,</span></span>
<span id="cb296-7"><a href="#cb296-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;./app/**/*.{js,ts,jsx,tsx,mdx}&#39;</span><span class="op">,</span></span>
<span id="cb296-8"><a href="#cb296-8" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb296-9"><a href="#cb296-9" aria-hidden="true" tabindex="-1"></a>  theme<span class="op">:</span> {</span>
<span id="cb296-10"><a href="#cb296-10" aria-hidden="true" tabindex="-1"></a>    extend<span class="op">:</span> {</span>
<span id="cb296-11"><a href="#cb296-11" aria-hidden="true" tabindex="-1"></a>      colors<span class="op">:</span> {</span>
<span id="cb296-12"><a href="#cb296-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;custom-yellow&#39;</span><span class="op">:</span> <span class="st">&#39;#FED700&#39;</span><span class="op">,</span></span>
<span id="cb296-13"><a href="#cb296-13" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb296-14"><a href="#cb296-14" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb296-15"><a href="#cb296-15" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb296-16"><a href="#cb296-16" aria-hidden="true" tabindex="-1"></a>  plugins<span class="op">:</span> [</span>
<span id="cb296-17"><a href="#cb296-17" aria-hidden="true" tabindex="-1"></a>    <span class="pp">require</span>(<span class="st">&#39;@tailwindcss/forms&#39;</span>)<span class="op">,</span></span>
<span id="cb296-18"><a href="#cb296-18" aria-hidden="true" tabindex="-1"></a>    <span class="pp">require</span>(<span class="st">&#39;@tailwindcss/typography&#39;</span>)<span class="op">,</span></span>
<span id="cb296-19"><a href="#cb296-19" aria-hidden="true" tabindex="-1"></a>    <span class="pp">require</span>(<span class="st">&#39;daisyui&#39;</span>)<span class="op">,</span></span>
<span id="cb296-20"><a href="#cb296-20" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb296-21"><a href="#cb296-21" aria-hidden="true" tabindex="-1"></a>  daisyui<span class="op">:</span> {</span>
<span id="cb296-22"><a href="#cb296-22" aria-hidden="true" tabindex="-1"></a>    themes<span class="op">:</span> [<span class="st">&quot;light&quot;</span><span class="op">,</span> <span class="st">&quot;dark&quot;</span><span class="op">,</span> <span class="st">&quot;cupcake&quot;</span>]<span class="op">,</span></span>
<span id="cb296-23"><a href="#cb296-23" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb296-24"><a href="#cb296-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb296-25"><a href="#cb296-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb296-26"><a href="#cb296-26" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="im">default</span> config</span></code></pre></div>
<h3 id="rebuild-css">7.6 Rebuild CSS</h3>
<div class="sourceCode" id="cb297"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb297-1"><a href="#cb297-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rebuild Tailwind CSS</span></span>
<span id="cb297-2"><a href="#cb297-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> run dev</span>
<span id="cb297-3"><a href="#cb297-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb297-4"><a href="#cb297-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Atau build production</span></span>
<span id="cb297-5"><a href="#cb297-5" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> run build</span></code></pre></div>
<hr />
<h2 id="upgrade-dependencies-lainnya">8. Upgrade Dependencies
Lainnya</h2>
<h3 id="zod-validation">8.1 Zod (Validation)</h3>
<div class="sourceCode" id="cb298"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb298-1"><a href="#cb298-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Current: 3.22.4</span></span>
<span id="cb298-2"><a href="#cb298-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Latest: 3.24.x</span></span>
<span id="cb298-3"><a href="#cb298-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-4"><a href="#cb298-4" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install zod@latest</span></code></pre></div>
<p><strong>Breaking changes:</strong> Minimal (usually backward
compatible).</p>
<h3 id="zustand-state-management">8.2 Zustand (State Management)</h3>
<div class="sourceCode" id="cb299"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb299-1"><a href="#cb299-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Current: 4.5.1</span></span>
<span id="cb299-2"><a href="#cb299-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Latest: 4.5.x</span></span>
<span id="cb299-3"><a href="#cb299-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb299-4"><a href="#cb299-4" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install zustand@latest</span></code></pre></div>
<p><strong>Breaking changes:</strong> None dalam minor versions.</p>
<h3 id="typescript">8.3 TypeScript</h3>
<div class="sourceCode" id="cb300"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb300-1"><a href="#cb300-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Current: 5.9.2</span></span>
<span id="cb300-2"><a href="#cb300-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Latest: 5.7.x (stable)</span></span>
<span id="cb300-3"><a href="#cb300-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb300-4"><a href="#cb300-4" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install <span class="at">--save-dev</span> typescript@latest</span>
<span id="cb300-5"><a href="#cb300-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb300-6"><a href="#cb300-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Check config compatibility</span></span>
<span id="cb300-7"><a href="#cb300-7" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> tsc <span class="at">--version</span></span></code></pre></div>
<h3 id="dompurify">8.4 DOMPurify</h3>
<div class="sourceCode" id="cb301"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb301-1"><a href="#cb301-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Current: 3.0.8</span></span>
<span id="cb301-2"><a href="#cb301-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Latest: 3.x.x</span></span>
<span id="cb301-3"><a href="#cb301-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-4"><a href="#cb301-4" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install dompurify@latest</span>
<span id="cb301-5"><a href="#cb301-5" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install <span class="at">--save-dev</span> @types/dompurify@latest</span></code></pre></div>
<h3 id="bcryptjs">8.5 bcryptjs</h3>
<div class="sourceCode" id="cb302"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb302-1"><a href="#cb302-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Current: 2.4.3</span></span>
<span id="cb302-2"><a href="#cb302-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Latest: 2.4.x</span></span>
<span id="cb302-3"><a href="#cb302-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-4"><a href="#cb302-4" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install bcryptjs@latest</span>
<span id="cb302-5"><a href="#cb302-5" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install <span class="at">--save-dev</span> @types/bcryptjs@latest</span></code></pre></div>
<h3 id="update-semua-dependencies-sekaligus">8.6 Update Semua
Dependencies Sekaligus</h3>
<div class="sourceCode" id="cb303"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb303-1"><a href="#cb303-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check outdated</span></span>
<span id="cb303-2"><a href="#cb303-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> outdated</span>
<span id="cb303-3"><a href="#cb303-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb303-4"><a href="#cb303-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Update semua (hati-hati!)</span></span>
<span id="cb303-5"><a href="#cb303-5" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> update</span>
<span id="cb303-6"><a href="#cb303-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb303-7"><a href="#cb303-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Atau pakai npm-check-updates</span></span>
<span id="cb303-8"><a href="#cb303-8" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> npm-check-updates <span class="at">-u</span></span>
<span id="cb303-9"><a href="#cb303-9" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install</span></code></pre></div>
<hr />
<h2 id="testing-setelah-upgrade">9. Testing Setelah Upgrade</h2>
<h3 id="testing-checklist">9.1 Testing Checklist</h3>
<p><strong>✅ Wajib Test:</strong></p>
<ul class="task-list">
<li><label><input type="checkbox" /><code>npm run build</code>
sukses</label></li>
<li><label><input type="checkbox" /><code>npm run dev</code>
sukses</label></li>
<li><label><input type="checkbox" />Login/logout works</label></li>
<li><label><input type="checkbox" />Admin dashboard
accessible</label></li>
<li><label><input type="checkbox" />Product CRUD operations</label></li>
<li><label><input type="checkbox" />Cart &amp; Wishlist
functionality</label></li>
<li><label><input type="checkbox" />Order creation</label></li>
<li><label><input type="checkbox" />Database queries
working</label></li>
<li><label><input type="checkbox" />API routes responding</label></li>
<li><label><input type="checkbox" />No console errors</label></li>
<li><label><input type="checkbox" />TypeScript no errors</label></li>
</ul>
<h3 id="build-test">9.2 Build Test</h3>
<div class="sourceCode" id="cb304"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb304-1"><a href="#cb304-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test build</span></span>
<span id="cb304-2"><a href="#cb304-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> run build</span>
<span id="cb304-3"><a href="#cb304-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-4"><a href="#cb304-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Expected output:</span></span>
<span id="cb304-5"><a href="#cb304-5" aria-hidden="true" tabindex="-1"></a><span class="ex">✓</span> Compiled successfully</span>
<span id="cb304-6"><a href="#cb304-6" aria-hidden="true" tabindex="-1"></a><span class="ex">✓</span> Linting and checking validity of types</span>
<span id="cb304-7"><a href="#cb304-7" aria-hidden="true" tabindex="-1"></a><span class="ex">✓</span> Collecting page data</span>
<span id="cb304-8"><a href="#cb304-8" aria-hidden="true" tabindex="-1"></a><span class="ex">✓</span> Generating static pages</span>
<span id="cb304-9"><a href="#cb304-9" aria-hidden="true" tabindex="-1"></a><span class="ex">✓</span> Finalizing page optimization</span>
<span id="cb304-10"><a href="#cb304-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-11"><a href="#cb304-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Test production</span></span>
<span id="cb304-12"><a href="#cb304-12" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> run start</span></code></pre></div>
<h3 id="development-test">9.3 Development Test</h3>
<div class="sourceCode" id="cb305"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb305-1"><a href="#cb305-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run dev server</span></span>
<span id="cb305-2"><a href="#cb305-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> run dev</span>
<span id="cb305-3"><a href="#cb305-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-4"><a href="#cb305-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Open browser</span></span>
<span id="cb305-5"><a href="#cb305-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Test all critical paths</span></span></code></pre></div>
<h3 id="database-test">9.4 Database Test</h3>
<div class="sourceCode" id="cb306"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb306-1"><a href="#cb306-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test Prisma</span></span>
<span id="cb306-2"><a href="#cb306-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma generate</span>
<span id="cb306-3"><a href="#cb306-3" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma migrate status</span>
<span id="cb306-4"><a href="#cb306-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-5"><a href="#cb306-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Test query</span></span>
<span id="cb306-6"><a href="#cb306-6" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma studio</span>
<span id="cb306-7"><a href="#cb306-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Manual check data</span></span></code></pre></div>
<h3 id="type-check">9.5 Type Check</h3>
<div class="sourceCode" id="cb307"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb307-1"><a href="#cb307-1" aria-hidden="true" tabindex="-1"></a><span class="co"># TypeScript type check</span></span>
<span id="cb307-2"><a href="#cb307-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> tsc <span class="at">--noEmit</span></span>
<span id="cb307-3"><a href="#cb307-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb307-4"><a href="#cb307-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Expected: No errors</span></span></code></pre></div>
<h3 id="lint-check">9.6 Lint Check</h3>
<div class="sourceCode" id="cb308"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb308-1"><a href="#cb308-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ESLint check</span></span>
<span id="cb308-2"><a href="#cb308-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> run lint</span>
<span id="cb308-3"><a href="#cb308-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-4"><a href="#cb308-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Expected: No errors</span></span></code></pre></div>
<hr />
<h2 id="rollback-strategy">10. Rollback Strategy</h2>
<h3 id="git-rollback">10.1 Git Rollback</h3>
<div class="sourceCode" id="cb309"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb309-1"><a href="#cb309-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Check commits</span></span>
<span id="cb309-2"><a href="#cb309-2" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> log <span class="at">--oneline</span></span>
<span id="cb309-3"><a href="#cb309-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb309-4"><a href="#cb309-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Rollback ke commit sebelum upgrade</span></span>
<span id="cb309-5"><a href="#cb309-5" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> reset <span class="at">--hard</span> <span class="op">&lt;</span>commit-hash<span class="op">&gt;</span></span>
<span id="cb309-6"><a href="#cb309-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb309-7"><a href="#cb309-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Force push (jika sudah push)</span></span>
<span id="cb309-8"><a href="#cb309-8" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> push <span class="at">--force</span></span></code></pre></div>
<h3 id="package-rollback">10.2 Package Rollback</h3>
<div class="sourceCode" id="cb310"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb310-1"><a href="#cb310-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rollback specific package</span></span>
<span id="cb310-2"><a href="#cb310-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install next@15.5.3 <span class="at">--save-exact</span></span>
<span id="cb310-3"><a href="#cb310-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb310-4"><a href="#cb310-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Rollback semua dari package-lock.json</span></span>
<span id="cb310-5"><a href="#cb310-5" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> ci</span>
<span id="cb310-6"><a href="#cb310-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb310-7"><a href="#cb310-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Atau dari backup</span></span>
<span id="cb310-8"><a href="#cb310-8" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> package.json.backup package.json</span>
<span id="cb310-9"><a href="#cb310-9" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install</span></code></pre></div>
<h3 id="database-rollback">10.3 Database Rollback</h3>
<div class="sourceCode" id="cb311"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb311-1"><a href="#cb311-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Restore database dari backup</span></span>
<span id="cb311-2"><a href="#cb311-2" aria-hidden="true" tabindex="-1"></a><span class="ex">mysql</span> <span class="at">-u</span> root <span class="at">-p</span> ecommerce_db <span class="op">&lt;</span> backup_20250315.sql</span>
<span id="cb311-3"><a href="#cb311-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb311-4"><a href="#cb311-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Atau pakai Prisma migrate</span></span>
<span id="cb311-5"><a href="#cb311-5" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma migrate reset</span></code></pre></div>
<h3 id="full-rollback-procedure">10.4 Full Rollback Procedure</h3>
<div class="sourceCode" id="cb312"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb312-1"><a href="#cb312-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Stop server</span></span>
<span id="cb312-2"><a href="#cb312-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Ctrl+C di terminal</span></span>
<span id="cb312-3"><a href="#cb312-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb312-4"><a href="#cb312-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Git rollback</span></span>
<span id="cb312-5"><a href="#cb312-5" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> checkout feature/upgrade-libraries</span>
<span id="cb312-6"><a href="#cb312-6" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> reset <span class="at">--hard</span> HEAD~1  <span class="co"># Rollback 1 commit</span></span>
<span id="cb312-7"><a href="#cb312-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb312-8"><a href="#cb312-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Reinstall dependencies</span></span>
<span id="cb312-9"><a href="#cb312-9" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-rf</span> node_modules package-lock.json</span>
<span id="cb312-10"><a href="#cb312-10" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install</span>
<span id="cb312-11"><a href="#cb312-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb312-12"><a href="#cb312-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Regenerate Prisma</span></span>
<span id="cb312-13"><a href="#cb312-13" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma generate</span>
<span id="cb312-14"><a href="#cb312-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb312-15"><a href="#cb312-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Restore database</span></span>
<span id="cb312-16"><a href="#cb312-16" aria-hidden="true" tabindex="-1"></a><span class="ex">mysql</span> <span class="at">-u</span> root <span class="at">-p</span> ecommerce_db <span class="op">&lt;</span> backup.sql</span>
<span id="cb312-17"><a href="#cb312-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb312-18"><a href="#cb312-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. Restart</span></span>
<span id="cb312-19"><a href="#cb312-19" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> run dev</span></code></pre></div>
<hr />
<h2 id="troubleshooting-3">11. Troubleshooting</h2>
<h3 id="error-cannot-find-module-next">11.1 Error: “Cannot find module
‘next’”</h3>
<p><strong>Error:</strong></p>
<pre><code>Error: Cannot find module &#39;next&#39;</code></pre>
<p><strong>Solusi:</strong></p>
<div class="sourceCode" id="cb314"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb314-1"><a href="#cb314-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Reinstall Next.js</span></span>
<span id="cb314-2"><a href="#cb314-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install next@15</span>
<span id="cb314-3"><a href="#cb314-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb314-4"><a href="#cb314-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Clear cache</span></span>
<span id="cb314-5"><a href="#cb314-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-rf</span> .next node_modules package-lock.json</span>
<span id="cb314-6"><a href="#cb314-6" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install</span></code></pre></div>
<h3 id="error-prisma-client-version-mismatch">11.2 Error: “Prisma Client
version mismatch”</h3>
<p><strong>Error:</strong></p>
<pre><code>Prisma Client version mismatch
Expected: 6.16.1
Actual: 6.15.0</code></pre>
<p><strong>Solusi:</strong></p>
<div class="sourceCode" id="cb316"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb316-1"><a href="#cb316-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install matching versions</span></span>
<span id="cb316-2"><a href="#cb316-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install prisma@6.16.1 @prisma/client@6.16.1 <span class="at">--save-exact</span></span>
<span id="cb316-3"><a href="#cb316-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb316-4"><a href="#cb316-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Regenerate</span></span>
<span id="cb316-5"><a href="#cb316-5" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma generate</span></code></pre></div>
<h3 id="error-nextauth-session-undefined">11.3 Error: “NextAuth session
undefined”</h3>
<p><strong>Error:</strong></p>
<pre><code>useSession() hook returns undefined</code></pre>
<p><strong>Solusi:</strong></p>
<pre class="tsx"><code>// Pastikan ada SessionProvider
// app/layout.tsx
import { SessionProvider } from &quot;next-auth/react&quot;

export default function RootLayout({ children }) {
  return (
    &lt;html&gt;
      &lt;body&gt;
        &lt;SessionProvider&gt;
          {children}
        &lt;/SessionProvider&gt;
      &lt;/body&gt;
    &lt;/html&gt;
  )
}</code></pre>
<h3 id="error-type-error-in-params">11.4 Error: “Type error in
params”</h3>
<p><strong>Error:</strong></p>
<pre><code>Type &#39;Params&#39; is not assignable to type &#39;Promise&lt;Params&gt;&#39;</code></pre>
<p><strong>Solusi:</strong></p>
<div class="sourceCode" id="cb320"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb320-1"><a href="#cb320-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Update ke async params (Next.js 15)</span></span>
<span id="cb320-2"><a href="#cb320-2" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="im">default</span> <span class="kw">async</span> <span class="kw">function</span> <span class="fu">Page</span>({ params }<span class="op">:</span> { params<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>{ id<span class="op">:</span> <span class="dt">string</span> }<span class="op">&gt;</span> }) {</span>
<span id="cb320-3"><a href="#cb320-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> { id } <span class="op">=</span> <span class="cf">await</span> params</span>
<span id="cb320-4"><a href="#cb320-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="error-build-failed---module-not-found">11.5 Error: “Build failed
- Module not found”</h3>
<p><strong>Error:</strong></p>
<pre><code>Module not found: Can&#39;t resolve &#39;@/components/...&#39;</code></pre>
<p><strong>Solusi:</strong></p>
<div class="sourceCode" id="cb322"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb322-1"><a href="#cb322-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check tsconfig.json paths</span></span>
<span id="cb322-2"><a href="#cb322-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb322-3"><a href="#cb322-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;compilerOptions&quot;</span><span class="ex">:</span> {</span>
<span id="cb322-4"><a href="#cb322-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;paths&quot;</span><span class="ex">:</span> {</span>
<span id="cb322-5"><a href="#cb322-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;@/*&quot;</span><span class="ex">:</span> <span class="pp">[</span><span class="st">&quot;./*&quot;</span><span class="pp">]</span></span>
<span id="cb322-6"><a href="#cb322-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb322-7"><a href="#cb322-7" aria-hidden="true" tabindex="-1"></a>  <span class="er">}</span></span>
<span id="cb322-8"><a href="#cb322-8" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span>
<span id="cb322-9"><a href="#cb322-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb322-10"><a href="#cb322-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Restart TypeScript server</span></span>
<span id="cb322-11"><a href="#cb322-11" aria-hidden="true" tabindex="-1"></a><span class="co"># VSCode: Ctrl+Shift+P → &quot;TypeScript: Restart TS Server&quot;</span></span></code></pre></div>
<h3 id="error-tailwindcss-not-working-after-upgrade">11.6 Error:
“TailwindCSS not working after upgrade”</h3>
<p><strong>Error:</strong> CSS classes tidak apply setelah upgrade.</p>
<p><strong>Solusi:</strong></p>
<div class="sourceCode" id="cb323"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb323-1"><a href="#cb323-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Clear Next.js cache</span></span>
<span id="cb323-2"><a href="#cb323-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-rf</span> .next</span>
<span id="cb323-3"><a href="#cb323-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb323-4"><a href="#cb323-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Rebuild</span></span>
<span id="cb323-5"><a href="#cb323-5" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> run build</span>
<span id="cb323-6"><a href="#cb323-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb323-7"><a href="#cb323-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Check tailwind.config.ts content paths</span></span>
<span id="cb323-8"><a href="#cb323-8" aria-hidden="true" tabindex="-1"></a><span class="ex">content:</span> [</span>
<span id="cb323-9"><a href="#cb323-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;./app/**/*.{js,ts,jsx,tsx,mdx}&#39;</span><span class="ex">,</span></span>
<span id="cb323-10"><a href="#cb323-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;./components/**/*.{js,ts,jsx,tsx,mdx}&#39;</span><span class="ex">,</span></span>
<span id="cb323-11"><a href="#cb323-11" aria-hidden="true" tabindex="-1"></a><span class="ex">]</span></span></code></pre></div>
<hr />
<h2 id="upgrade-checklist-summary">📋 Upgrade Checklist Summary</h2>
<h3 id="pre-upgrade">Pre-Upgrade</h3>
<ul class="task-list">
<li><label><input type="checkbox" />Backup database</label></li>
<li><label><input type="checkbox" />Commit all changes</label></li>
<li><label><input type="checkbox" />Create upgrade branch</label></li>
<li><label><input type="checkbox" />Read changelogs</label></li>
<li><label><input type="checkbox" />Note current versions</label></li>
</ul>
<h3 id="upgrade-process">Upgrade Process</h3>
<ul class="task-list">
<li><label><input type="checkbox" />Upgrade React</label></li>
<li><label><input type="checkbox" />Upgrade Next.js</label></li>
<li><label><input type="checkbox" />Upgrade Prisma</label></li>
<li><label><input type="checkbox" />Update NextAuth
(optional)</label></li>
<li><label><input type="checkbox" />Upgrade TailwindCSS</label></li>
<li><label><input type="checkbox" />Update other
dependencies</label></li>
<li><label><input type="checkbox" />Run
<code>npm install</code></label></li>
<li><label><input type="checkbox" />Run
<code>npx prisma generate</code></label></li>
</ul>
<h3 id="testing">Testing</h3>
<ul class="task-list">
<li><label><input type="checkbox" /><code>npm run build</code>
works</label></li>
<li><label><input type="checkbox" /><code>npm run dev</code>
works</label></li>
<li><label><input type="checkbox" />TypeScript no errors</label></li>
<li><label><input type="checkbox" />ESLint no errors</label></li>
<li><label><input type="checkbox" />All features working</label></li>
<li><label><input type="checkbox" />No console errors</label></li>
<li><label><input type="checkbox" />Test on production-like
env</label></li>
</ul>
<h3 id="post-upgrade">Post-Upgrade</h3>
<ul class="task-list">
<li><label><input type="checkbox" />Update documentation</label></li>
<li><label><input type="checkbox" />Commit changes</label></li>
<li><label><input type="checkbox" />Create PR for review</label></li>
<li><label><input type="checkbox" />Deploy to staging</label></li>
<li><label><input type="checkbox" />Monitor for issues</label></li>
<li><label><input type="checkbox" />Deploy to production</label></li>
</ul>
<hr />
<h2 id="referensi-2">📚 Referensi</h2>
<h3 id="official-upgrade-guides">Official Upgrade Guides</h3>
<ul>
<li><a
href="https://nextjs.org/docs/app/building-your-application/upgrading">Next.js
Upgrade Guide</a></li>
<li><a href="https://react.dev/blog/2024/04/25/react-19">React 19
Upgrade</a></li>
<li><a href="https://www.prisma.io/docs/guides/upgrade-guides">Prisma
Upgrade Guide</a></li>
<li><a href="https://authjs.dev/getting-started/migrating-to-v5">Auth.js
v5 Migration</a></li>
<li><a href="https://tailwindcss.com/docs/upgrade-guide">TailwindCSS
Upgrade</a></li>
</ul>
<h1 id="penambahan-field---tutorial-lengkap">➕ PENAMBAHAN FIELD -
TUTORIAL LENGKAP</h1>
<p><strong>Tutorial Step-by-Step Menambah Field Baru di Database, API,
dan UI</strong></p>
<hr />
<h2 id="daftar-isi-6">📑 Daftar Isi</h2>
<ol type="1">
<li><a href="#1-overview">Overview</a></li>
<li><a href="#2-contoh-kasus-tambah-field-discount">Contoh Kasus: Tambah
Field Discount</a></li>
<li><a href="#3-step-1-update-prisma-schema">Step 1: Update Prisma
Schema</a></li>
<li><a href="#4-step-2-migration-database">Step 2: Migration
Database</a></li>
<li><a href="#5-step-3-update-typescript-types">Step 3: Update
TypeScript Types</a></li>
<li><a href="#6-step-4-update-validasi-zod">Step 4: Update Validasi
(Zod)</a></li>
<li><a href="#7-step-5-update-api-routes">Step 5: Update API
Routes</a></li>
<li><a href="#8-step-6-update-ui-components">Step 6: Update UI
Components</a></li>
<li><a href="#9-step-7-update-admin-dashboard">Step 7: Update Admin
Dashboard</a></li>
<li><a href="#10-step-8-testing">Step 8: Testing</a></li>
<li><a href="#11-contoh-lain-tambah-field-di-model-user">Contoh Lain:
Tambah Field di Model User</a></li>
<li><a href="#12-best-practices">Best Practices</a></li>
<li><a href="#13-troubleshooting">Troubleshooting</a></li>
</ol>
<hr />
<h2 id="overview">1. Overview</h2>
<h3 id="workflow-penambahan-field">1.1 Workflow Penambahan Field</h3>
<pre><code>┌─────────────────────────────────────────────────┐
│         Workflow Tambah Field Baru              │
├─────────────────────────────────────────────────┤
│                                                 │
│  1. Update Prisma Schema (schema.prisma)       │
│     └─ Tambah field di model                   │
│                                                 │
│  2. Generate Migration                         │
│     └─ npx prisma migrate dev                  │
│                                                 │
│  3. Update TypeScript Types (Auto)             │
│     └─ npx prisma generate                     │
│                                                 │
│  4. Update Validasi (Zod)                      │
│     └─ Tambah validasi field baru              │
│                                                 │
│  5. Update API Routes                          │
│     └─ GET, POST, PUT, DELETE                  │
│                                                 │
│  6. Update UI Components                       │
│     └─ Forms, cards, detail pages              │
│                                                 │
│  7. Update Admin Dashboard                     │
│     └─ Table columns, form inputs              │
│                                                 │
│  8. Testing                                    │
│     └─ Test CRUD operations                    │
│                                                 │
└─────────────────────────────────────────────────┘</code></pre>
<h3 id="checklist-lengkap">1.2 Checklist Lengkap</h3>
<p><strong>✅ Sebelum Mulai:</strong></p>
<ul class="task-list">
<li><label><input type="checkbox" />Backup database</label></li>
<li><label><input type="checkbox" />Commit perubahan
terakhir</label></li>
<li><label><input type="checkbox" />Tentukan nama field &amp; tipe
data</label></li>
<li><label><input type="checkbox" />Tentukan apakah nullable atau
required</label></li>
<li><label><input type="checkbox" />Tentukan default value (jika
ada)</label></li>
</ul>
<p><strong>✅ Proses:</strong></p>
<ul class="task-list">
<li><label><input type="checkbox" />Update Prisma schema</label></li>
<li><label><input type="checkbox" />Jalankan migration</label></li>
<li><label><input type="checkbox" />Generate Prisma Client</label></li>
<li><label><input type="checkbox" />Update Zod schema</label></li>
<li><label><input type="checkbox" />Update API routes (GET, POST,
PUT)</label></li>
<li><label><input type="checkbox" />Update forms (admin)</label></li>
<li><label><input type="checkbox" />Update display
components</label></li>
<li><label><input type="checkbox" />Update TypeScript interfaces (jika
manual)</label></li>
</ul>
<p><strong>✅ Setelah Selesai:</strong></p>
<ul class="task-list">
<li><label><input type="checkbox" />Test CRUD via API</label></li>
<li><label><input type="checkbox" />Test admin dashboard</label></li>
<li><label><input type="checkbox" />Test frontend display</label></li>
<li><label><input type="checkbox" />Commit changes</label></li>
<li><label><input type="checkbox" />Update dokumentasi</label></li>
</ul>
<hr />
<h2 id="contoh-kasus-tambah-field-discount">2. Contoh Kasus: Tambah
Field Discount</h2>
<h3 id="requirement">2.1 Requirement</h3>
<p><strong>Target:</strong> Tambah field <code>discount</code> ke model
<code>Product</code></p>
<p><strong>Spesifikasi:</strong> - <strong>Field name:</strong>
<code>discount</code> - <strong>Type:</strong> <code>Float</code>
(decimal untuk persentase) - <strong>Nullable:</strong> Yes (optional) -
<strong>Default:</strong> <code>0</code> (tidak ada diskon) -
<strong>Range:</strong> 0-100 (persen) - <strong>Use case:</strong>
Untuk menampilkan diskon produk</p>
<h3 id="visual-before-after">2.2 Visual Before &amp; After</h3>
<p><strong>BEFORE:</strong></p>
<pre class="prisma"><code>model Product {
  id           String  @id @default(uuid())
  title        String
  price        Int
  description  String
  inStock      Int
}</code></pre>
<p><strong>AFTER:</strong></p>
<pre class="prisma"><code>model Product {
  id           String  @id @default(uuid())
  title        String
  price        Int
  discount     Float?  @default(0)  // ✨ NEW!
  description  String
  inStock      Int
}</code></pre>
<hr />
<h2 id="step-1-update-prisma-schema">3. Step 1: Update Prisma
Schema</h2>
<h3 id="edit-schema-file">3.1 Edit Schema File</h3>
<p><strong>📁 File:</strong> <code>prisma/schema.prisma</code></p>
<p><strong>Lokasi:</strong> Tambah field di model Product (sekitar baris
24)</p>
<pre class="prisma"><code>model Product {
  id             String                   @id @default(uuid())
  slug           String                   @unique
  title          String
  mainImage      String
  price          Int                      @default(0)
  rating         Int                      @default(0)
  
  // ✨✨✨ TAMBAH FIELD BARU DI SINI ✨✨✨
  discount       Float?                   @default(0)
  
  description    String
  manufacturer   String
  inStock        Int                      @default(1)
  categoryId     String
  category       Category                 @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  customerOrders customer_order_product[]
  Wishlist       Wishlist[]
  feedbacks      Feedback[]
}</code></pre>
<h3 id="pilihan-tipe-data">3.2 Pilihan Tipe Data</h3>
<table>
<thead>
<tr>
<th>Prisma Type</th>
<th>SQL Type</th>
<th>Contoh Use Case</th>
<th>Range</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>String</code></td>
<td>VARCHAR</td>
<td>Nama, URL, text pendek</td>
<td>-</td>
</tr>
<tr>
<td><code>String @db.Text</code></td>
<td>TEXT</td>
<td>Deskripsi panjang</td>
<td>-</td>
</tr>
<tr>
<td><code>Int</code></td>
<td>INT</td>
<td>Harga (dalam cent), stok</td>
<td>-2³¹ to 2³¹-1</td>
</tr>
<tr>
<td><code>Float</code></td>
<td>DOUBLE</td>
<td>Persentase, rating decimal</td>
<td>-</td>
</tr>
<tr>
<td><code>Boolean</code></td>
<td>TINYINT(1)</td>
<td>Active/inactive, featured</td>
<td>true/false</td>
</tr>
<tr>
<td><code>DateTime</code></td>
<td>DATETIME</td>
<td>Tanggal, timestamp</td>
<td>-</td>
</tr>
<tr>
<td><code>Json</code></td>
<td>JSON</td>
<td>Data structured</td>
<td>-</td>
</tr>
</tbody>
</table>
<h3 id="attribute-options">3.3 Attribute Options</h3>
<pre class="prisma"><code>// Nullable (optional)
discount Float?

// Non-nullable (required)
discount Float

// Dengan default value
discount Float @default(0)

// Nullable dengan default
discount Float? @default(0)

// Unique constraint
email String @unique

// Index untuk query cepat
@@index([discount])

// Multiple field index
@@index([categoryId, discount])</code></pre>
<h3 id="validasi-di-schema-level">3.4 Validasi di Schema Level</h3>
<pre class="prisma"><code>model Product {
  // Basic field
  discount Float? @default(0)
  
  // Dengan custom database type
  discount Float? @default(0) @db.Decimal(5,2)
  // Decimal(5,2) = max 999.99
  
  // Field dengan komentar
  /// Discount percentage (0-100)
  discount Float? @default(0)
}</code></pre>
<hr />
<h2 id="step-2-migration-database">4. Step 2: Migration Database</h2>
<h3 id="generate-migration">4.1 Generate Migration</h3>
<div class="sourceCode" id="cb330"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb330-1"><a href="#cb330-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Syntax:</span></span>
<span id="cb330-2"><a href="#cb330-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma migrate dev <span class="at">--name</span> nama_migration</span>
<span id="cb330-3"><a href="#cb330-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb330-4"><a href="#cb330-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Contoh untuk case ini:</span></span>
<span id="cb330-5"><a href="#cb330-5" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma migrate dev <span class="at">--name</span> add_discount_to_product</span></code></pre></div>
<p><strong>Output yang diharapkan:</strong></p>
<pre><code>Environment variables loaded from .env
Prisma schema loaded from prisma\schema.prisma
Datasource &quot;db&quot;: MySQL database &quot;ecommerce_db&quot; at &quot;localhost:3306&quot;

✔ Enter a name for the new migration: … add_discount_to_product

Applying migration `20250310120000_add_discount_to_product`

The following migration(s) have been created and applied from new schema changes:

migrations/
  └─ 20250310120000_add_discount_to_product/
    └─ migration.sql

✔ Generated Prisma Client (v6.16.1)</code></pre>
<h3 id="file-migration-yang-dibuat">4.2 File Migration yang Dibuat</h3>
<p><strong>📁 File:</strong>
<code>prisma/migrations/20250310120000_add_discount_to_product/migration.sql</code></p>
<div class="sourceCode" id="cb332"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb332-1"><a href="#cb332-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- AlterTable</span></span>
<span id="cb332-2"><a href="#cb332-2" aria-hidden="true" tabindex="-1"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> `Product` <span class="kw">ADD</span> <span class="kw">COLUMN</span> `discount` <span class="dt">DOUBLE</span> <span class="kw">NULL</span> <span class="kw">DEFAULT</span> <span class="dv">0</span>;</span></code></pre></div>
<h3 id="cek-migration-status">4.3 Cek Migration Status</h3>
<div class="sourceCode" id="cb333"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb333-1"><a href="#cb333-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cek status migrations</span></span>
<span id="cb333-2"><a href="#cb333-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma migrate status</span>
<span id="cb333-3"><a href="#cb333-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb333-4"><a href="#cb333-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Output:</span></span>
<span id="cb333-5"><a href="#cb333-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Database</span> schema is up to date!</span></code></pre></div>
<h3 id="jika-migration-gagal">4.4 Jika Migration Gagal</h3>
<div class="sourceCode" id="cb334"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb334-1"><a href="#cb334-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rollback migration (manual)</span></span>
<span id="cb334-2"><a href="#cb334-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Hapus field di schema.prisma</span></span>
<span id="cb334-3"><a href="#cb334-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Hapus folder migration yang baru</span></span>
<span id="cb334-4"><a href="#cb334-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Jalankan SQL manual untuk drop column</span></span>
<span id="cb334-5"><a href="#cb334-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb334-6"><a href="#cb334-6" aria-hidden="true" tabindex="-1"></a><span class="co"># SQL untuk rollback:</span></span>
<span id="cb334-7"><a href="#cb334-7" aria-hidden="true" tabindex="-1"></a><span class="ex">ALTER</span> TABLE <span class="kw">`</span><span class="ex">Product</span><span class="kw">`</span> DROP COLUMN <span class="kw">`</span><span class="ex">discount</span><span class="kw">`;</span></span>
<span id="cb334-8"><a href="#cb334-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb334-9"><a href="#cb334-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Resolve migration</span></span>
<span id="cb334-10"><a href="#cb334-10" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma migrate resolve <span class="at">--rolled-back</span> <span class="st">&quot;20250310120000_add_discount_to_product&quot;</span></span></code></pre></div>
<hr />
<h2 id="step-3-update-typescript-types">5. Step 3: Update TypeScript
Types</h2>
<h3 id="generate-prisma-client">5.1 Generate Prisma Client</h3>
<div class="sourceCode" id="cb335"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb335-1"><a href="#cb335-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Auto-generate TypeScript types</span></span>
<span id="cb335-2"><a href="#cb335-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma generate</span></code></pre></div>
<p><strong>Output:</strong></p>
<pre><code>✔ Generated Prisma Client (v6.16.1) to ./node_modules/@prisma/client</code></pre>
<h3 id="typescript-types-auto-generated">5.2 TypeScript Types
(Auto-Generated)</h3>
<p>Setelah generate, type Product otomatis punya field
<code>discount</code>:</p>
<div class="sourceCode" id="cb337"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb337-1"><a href="#cb337-1" aria-hidden="true" tabindex="-1"></a><span class="co">// node_modules/.prisma/client/index.d.ts (auto-generated)</span></span>
<span id="cb337-2"><a href="#cb337-2" aria-hidden="true" tabindex="-1"></a><span class="im">export type</span> Product <span class="op">=</span> {</span>
<span id="cb337-3"><a href="#cb337-3" aria-hidden="true" tabindex="-1"></a>  id<span class="op">:</span> <span class="dt">string</span></span>
<span id="cb337-4"><a href="#cb337-4" aria-hidden="true" tabindex="-1"></a>  slug<span class="op">:</span> <span class="dt">string</span></span>
<span id="cb337-5"><a href="#cb337-5" aria-hidden="true" tabindex="-1"></a>  title<span class="op">:</span> <span class="dt">string</span></span>
<span id="cb337-6"><a href="#cb337-6" aria-hidden="true" tabindex="-1"></a>  mainImage<span class="op">:</span> <span class="dt">string</span></span>
<span id="cb337-7"><a href="#cb337-7" aria-hidden="true" tabindex="-1"></a>  price<span class="op">:</span> <span class="dt">number</span></span>
<span id="cb337-8"><a href="#cb337-8" aria-hidden="true" tabindex="-1"></a>  rating<span class="op">:</span> <span class="dt">number</span></span>
<span id="cb337-9"><a href="#cb337-9" aria-hidden="true" tabindex="-1"></a>  discount<span class="op">:</span> <span class="dt">number</span> <span class="op">|</span> <span class="dt">null</span>  <span class="co">// ✨ NEW!</span></span>
<span id="cb337-10"><a href="#cb337-10" aria-hidden="true" tabindex="-1"></a>  description<span class="op">:</span> <span class="dt">string</span></span>
<span id="cb337-11"><a href="#cb337-11" aria-hidden="true" tabindex="-1"></a>  manufacturer<span class="op">:</span> <span class="dt">string</span></span>
<span id="cb337-12"><a href="#cb337-12" aria-hidden="true" tabindex="-1"></a>  inStock<span class="op">:</span> <span class="dt">number</span></span>
<span id="cb337-13"><a href="#cb337-13" aria-hidden="true" tabindex="-1"></a>  categoryId<span class="op">:</span> <span class="dt">string</span></span>
<span id="cb337-14"><a href="#cb337-14" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="manual-type-definitions-jika-perlu">5.3 Manual Type Definitions
(Jika Perlu)</h3>
<p>Jika punya custom types:</p>
<p><strong>📁 File:</strong> <code>types/product.ts</code></p>
<div class="sourceCode" id="cb338"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb338-1"><a href="#cb338-1" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">interface</span> ProductWithDiscount {</span>
<span id="cb338-2"><a href="#cb338-2" aria-hidden="true" tabindex="-1"></a>  id<span class="op">:</span> <span class="dt">string</span></span>
<span id="cb338-3"><a href="#cb338-3" aria-hidden="true" tabindex="-1"></a>  title<span class="op">:</span> <span class="dt">string</span></span>
<span id="cb338-4"><a href="#cb338-4" aria-hidden="true" tabindex="-1"></a>  price<span class="op">:</span> <span class="dt">number</span></span>
<span id="cb338-5"><a href="#cb338-5" aria-hidden="true" tabindex="-1"></a>  discount<span class="op">?:</span> <span class="dt">number</span>  <span class="co">// ✨ Tambahkan ini</span></span>
<span id="cb338-6"><a href="#cb338-6" aria-hidden="true" tabindex="-1"></a>  finalPrice<span class="op">:</span> <span class="dt">number</span> <span class="co">// Computed: price - (price * discount/100)</span></span>
<span id="cb338-7"><a href="#cb338-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb338-8"><a href="#cb338-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb338-9"><a href="#cb338-9" aria-hidden="true" tabindex="-1"></a><span class="co">// Helper function</span></span>
<span id="cb338-10"><a href="#cb338-10" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">function</span> <span class="fu">calculateFinalPrice</span>(price<span class="op">:</span> <span class="dt">number</span><span class="op">,</span> discount<span class="op">?:</span> <span class="dt">number</span>)<span class="op">:</span> <span class="dt">number</span> {</span>
<span id="cb338-11"><a href="#cb338-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>discount) <span class="cf">return</span> price</span>
<span id="cb338-12"><a href="#cb338-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> price <span class="op">-</span> (price <span class="op">*</span> discount <span class="op">/</span> <span class="dv">100</span>)</span>
<span id="cb338-13"><a href="#cb338-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<hr />
<h2 id="step-4-update-validasi-zod-1">6. Step 4: Update Validasi
(Zod)</h2>
<h3 id="update-zod-schema">6.1 Update Zod Schema</h3>
<p><strong>📁 File:</strong> <code>utils/schema.ts</code> atau
<code>lib/validation.ts</code></p>
<div class="sourceCode" id="cb339"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb339-1"><a href="#cb339-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { z } <span class="im">from</span> <span class="st">&#39;zod&#39;</span></span>
<span id="cb339-2"><a href="#cb339-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb339-3"><a href="#cb339-3" aria-hidden="true" tabindex="-1"></a><span class="co">// SEBELUM:</span></span>
<span id="cb339-4"><a href="#cb339-4" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> ProductSchema <span class="op">=</span> z<span class="op">.</span><span class="fu">object</span>({</span>
<span id="cb339-5"><a href="#cb339-5" aria-hidden="true" tabindex="-1"></a>  slug<span class="op">:</span> z<span class="op">.</span><span class="fu">string</span>()<span class="op">.</span><span class="fu">min</span>(<span class="dv">1</span><span class="op">,</span> <span class="st">&quot;Slug required&quot;</span>)<span class="op">,</span></span>
<span id="cb339-6"><a href="#cb339-6" aria-hidden="true" tabindex="-1"></a>  title<span class="op">:</span> z<span class="op">.</span><span class="fu">string</span>()<span class="op">.</span><span class="fu">min</span>(<span class="dv">3</span><span class="op">,</span> <span class="st">&quot;Title min 3 chars&quot;</span>)<span class="op">,</span></span>
<span id="cb339-7"><a href="#cb339-7" aria-hidden="true" tabindex="-1"></a>  price<span class="op">:</span> z<span class="op">.</span><span class="fu">number</span>()<span class="op">.</span><span class="fu">int</span>()<span class="op">.</span><span class="fu">positive</span>(<span class="st">&quot;Price must be positive&quot;</span>)<span class="op">,</span></span>
<span id="cb339-8"><a href="#cb339-8" aria-hidden="true" tabindex="-1"></a>  description<span class="op">:</span> z<span class="op">.</span><span class="fu">string</span>()<span class="op">.</span><span class="fu">min</span>(<span class="dv">10</span>)<span class="op">,</span></span>
<span id="cb339-9"><a href="#cb339-9" aria-hidden="true" tabindex="-1"></a>  manufacturer<span class="op">:</span> z<span class="op">.</span><span class="fu">string</span>()<span class="op">,</span></span>
<span id="cb339-10"><a href="#cb339-10" aria-hidden="true" tabindex="-1"></a>  inStock<span class="op">:</span> z<span class="op">.</span><span class="fu">number</span>()<span class="op">.</span><span class="fu">int</span>()<span class="op">.</span><span class="fu">min</span>(<span class="dv">0</span>)<span class="op">,</span></span>
<span id="cb339-11"><a href="#cb339-11" aria-hidden="true" tabindex="-1"></a>  categoryId<span class="op">:</span> z<span class="op">.</span><span class="fu">string</span>()<span class="op">.</span><span class="fu">uuid</span>()<span class="op">,</span></span>
<span id="cb339-12"><a href="#cb339-12" aria-hidden="true" tabindex="-1"></a>  mainImage<span class="op">:</span> z<span class="op">.</span><span class="fu">string</span>()<span class="op">.</span><span class="fu">url</span>()</span>
<span id="cb339-13"><a href="#cb339-13" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb339-14"><a href="#cb339-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb339-15"><a href="#cb339-15" aria-hidden="true" tabindex="-1"></a><span class="co">// SETELAH:</span></span>
<span id="cb339-16"><a href="#cb339-16" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> ProductSchema <span class="op">=</span> z<span class="op">.</span><span class="fu">object</span>({</span>
<span id="cb339-17"><a href="#cb339-17" aria-hidden="true" tabindex="-1"></a>  slug<span class="op">:</span> z<span class="op">.</span><span class="fu">string</span>()<span class="op">.</span><span class="fu">min</span>(<span class="dv">1</span><span class="op">,</span> <span class="st">&quot;Slug required&quot;</span>)<span class="op">,</span></span>
<span id="cb339-18"><a href="#cb339-18" aria-hidden="true" tabindex="-1"></a>  title<span class="op">:</span> z<span class="op">.</span><span class="fu">string</span>()<span class="op">.</span><span class="fu">min</span>(<span class="dv">3</span><span class="op">,</span> <span class="st">&quot;Title min 3 chars&quot;</span>)<span class="op">,</span></span>
<span id="cb339-19"><a href="#cb339-19" aria-hidden="true" tabindex="-1"></a>  price<span class="op">:</span> z<span class="op">.</span><span class="fu">number</span>()<span class="op">.</span><span class="fu">int</span>()<span class="op">.</span><span class="fu">positive</span>(<span class="st">&quot;Price must be positive&quot;</span>)<span class="op">,</span></span>
<span id="cb339-20"><a href="#cb339-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb339-21"><a href="#cb339-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ✨✨✨ TAMBAH VALIDASI DISCOUNT ✨✨✨</span></span>
<span id="cb339-22"><a href="#cb339-22" aria-hidden="true" tabindex="-1"></a>  discount<span class="op">:</span> z<span class="op">.</span><span class="fu">number</span>()</span>
<span id="cb339-23"><a href="#cb339-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">min</span>(<span class="dv">0</span><span class="op">,</span> <span class="st">&quot;Discount tidak boleh negatif&quot;</span>)</span>
<span id="cb339-24"><a href="#cb339-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">max</span>(<span class="dv">100</span><span class="op">,</span> <span class="st">&quot;Discount maksimal 100%&quot;</span>)</span>
<span id="cb339-25"><a href="#cb339-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">optional</span>()</span>
<span id="cb339-26"><a href="#cb339-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">default</span>(<span class="dv">0</span>)<span class="op">,</span></span>
<span id="cb339-27"><a href="#cb339-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb339-28"><a href="#cb339-28" aria-hidden="true" tabindex="-1"></a>  description<span class="op">:</span> z<span class="op">.</span><span class="fu">string</span>()<span class="op">.</span><span class="fu">min</span>(<span class="dv">10</span>)<span class="op">,</span></span>
<span id="cb339-29"><a href="#cb339-29" aria-hidden="true" tabindex="-1"></a>  manufacturer<span class="op">:</span> z<span class="op">.</span><span class="fu">string</span>()<span class="op">,</span></span>
<span id="cb339-30"><a href="#cb339-30" aria-hidden="true" tabindex="-1"></a>  inStock<span class="op">:</span> z<span class="op">.</span><span class="fu">number</span>()<span class="op">.</span><span class="fu">int</span>()<span class="op">.</span><span class="fu">min</span>(<span class="dv">0</span>)<span class="op">,</span></span>
<span id="cb339-31"><a href="#cb339-31" aria-hidden="true" tabindex="-1"></a>  categoryId<span class="op">:</span> z<span class="op">.</span><span class="fu">string</span>()<span class="op">.</span><span class="fu">uuid</span>()<span class="op">,</span></span>
<span id="cb339-32"><a href="#cb339-32" aria-hidden="true" tabindex="-1"></a>  mainImage<span class="op">:</span> z<span class="op">.</span><span class="fu">string</span>()<span class="op">.</span><span class="fu">url</span>()</span>
<span id="cb339-33"><a href="#cb339-33" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb339-34"><a href="#cb339-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb339-35"><a href="#cb339-35" aria-hidden="true" tabindex="-1"></a><span class="co">// Type inference from Zod</span></span>
<span id="cb339-36"><a href="#cb339-36" aria-hidden="true" tabindex="-1"></a><span class="im">export type</span> ProductInput <span class="op">=</span> z<span class="op">.</span><span class="at">infer</span><span class="op">&lt;</span><span class="kw">typeof</span> ProductSchema<span class="op">&gt;</span></span></code></pre></div>
<h3 id="validasi-di-api-route">6.2 Validasi di API Route</h3>
<div class="sourceCode" id="cb340"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb340-1"><a href="#cb340-1" aria-hidden="true" tabindex="-1"></a><span class="co">// app/api/products/route.ts</span></span>
<span id="cb340-2"><a href="#cb340-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { ProductSchema } <span class="im">from</span> <span class="st">&#39;@/utils/schema&#39;</span></span>
<span id="cb340-3"><a href="#cb340-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb340-4"><a href="#cb340-4" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">async</span> <span class="kw">function</span> <span class="fu">POST</span>(request<span class="op">:</span> Request) {</span>
<span id="cb340-5"><a href="#cb340-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span> {</span>
<span id="cb340-6"><a href="#cb340-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> body <span class="op">=</span> <span class="cf">await</span> request<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb340-7"><a href="#cb340-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb340-8"><a href="#cb340-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Validasi dengan Zod</span></span>
<span id="cb340-9"><a href="#cb340-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> validated <span class="op">=</span> ProductSchema<span class="op">.</span><span class="fu">parse</span>(body)</span>
<span id="cb340-10"><a href="#cb340-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb340-11"><a href="#cb340-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Jika validation pass, lanjut create</span></span>
<span id="cb340-12"><a href="#cb340-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> product <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="fu">create</span>({</span>
<span id="cb340-13"><a href="#cb340-13" aria-hidden="true" tabindex="-1"></a>      data<span class="op">:</span> validated</span>
<span id="cb340-14"><a href="#cb340-14" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb340-15"><a href="#cb340-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb340-16"><a href="#cb340-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Response<span class="op">.</span><span class="fu">json</span>(product)</span>
<span id="cb340-17"><a href="#cb340-17" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">catch</span> (error) {</span>
<span id="cb340-18"><a href="#cb340-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (error <span class="kw">instanceof</span> z<span class="op">.</span><span class="at">ZodError</span>) {</span>
<span id="cb340-19"><a href="#cb340-19" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> Response<span class="op">.</span><span class="fu">json</span>(</span>
<span id="cb340-20"><a href="#cb340-20" aria-hidden="true" tabindex="-1"></a>        { error<span class="op">:</span> error<span class="op">.</span><span class="at">errors</span> }<span class="op">,</span></span>
<span id="cb340-21"><a href="#cb340-21" aria-hidden="true" tabindex="-1"></a>        { status<span class="op">:</span> <span class="dv">400</span> }</span>
<span id="cb340-22"><a href="#cb340-22" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb340-23"><a href="#cb340-23" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb340-24"><a href="#cb340-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Response<span class="op">.</span><span class="fu">json</span>(</span>
<span id="cb340-25"><a href="#cb340-25" aria-hidden="true" tabindex="-1"></a>      { error<span class="op">:</span> <span class="st">&quot;Internal server error&quot;</span> }<span class="op">,</span></span>
<span id="cb340-26"><a href="#cb340-26" aria-hidden="true" tabindex="-1"></a>      { status<span class="op">:</span> <span class="dv">500</span> }</span>
<span id="cb340-27"><a href="#cb340-27" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb340-28"><a href="#cb340-28" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb340-29"><a href="#cb340-29" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<hr />
<h2 id="step-5-update-api-routes">7. Step 5: Update API Routes</h2>
<h3 id="get-route-read">7.1 GET Route (Read)</h3>
<p><strong>📁 File:</strong> <code>app/api/products/route.ts</code></p>
<div class="sourceCode" id="cb341"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb341-1"><a href="#cb341-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { prisma } <span class="im">from</span> <span class="st">&#39;@/lib/prisma&#39;</span></span>
<span id="cb341-2"><a href="#cb341-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { NextResponse } <span class="im">from</span> <span class="st">&#39;next/server&#39;</span></span>
<span id="cb341-3"><a href="#cb341-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb341-4"><a href="#cb341-4" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">async</span> <span class="kw">function</span> <span class="fu">GET</span>(request<span class="op">:</span> Request) {</span>
<span id="cb341-5"><a href="#cb341-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> { searchParams } <span class="op">=</span> <span class="kw">new</span> <span class="fu">URL</span>(request<span class="op">.</span><span class="at">url</span>)</span>
<span id="cb341-6"><a href="#cb341-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> page <span class="op">=</span> <span class="pp">parseInt</span>(searchParams<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;page&#39;</span>) <span class="op">||</span> <span class="st">&#39;1&#39;</span>)</span>
<span id="cb341-7"><a href="#cb341-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> limit <span class="op">=</span> <span class="pp">parseInt</span>(searchParams<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;limit&#39;</span>) <span class="op">||</span> <span class="st">&#39;10&#39;</span>)</span>
<span id="cb341-8"><a href="#cb341-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb341-9"><a href="#cb341-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> products <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="fu">findMany</span>({</span>
<span id="cb341-10"><a href="#cb341-10" aria-hidden="true" tabindex="-1"></a>    skip<span class="op">:</span> (page <span class="op">-</span> <span class="dv">1</span>) <span class="op">*</span> limit<span class="op">,</span></span>
<span id="cb341-11"><a href="#cb341-11" aria-hidden="true" tabindex="-1"></a>    take<span class="op">:</span> limit<span class="op">,</span></span>
<span id="cb341-12"><a href="#cb341-12" aria-hidden="true" tabindex="-1"></a>    select<span class="op">:</span> {</span>
<span id="cb341-13"><a href="#cb341-13" aria-hidden="true" tabindex="-1"></a>      id<span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb341-14"><a href="#cb341-14" aria-hidden="true" tabindex="-1"></a>      slug<span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb341-15"><a href="#cb341-15" aria-hidden="true" tabindex="-1"></a>      title<span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb341-16"><a href="#cb341-16" aria-hidden="true" tabindex="-1"></a>      price<span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb341-17"><a href="#cb341-17" aria-hidden="true" tabindex="-1"></a>      discount<span class="op">:</span> <span class="kw">true</span><span class="op">,</span>  <span class="co">// ✨ TAMBAHKAN INI</span></span>
<span id="cb341-18"><a href="#cb341-18" aria-hidden="true" tabindex="-1"></a>      mainImage<span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb341-19"><a href="#cb341-19" aria-hidden="true" tabindex="-1"></a>      rating<span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb341-20"><a href="#cb341-20" aria-hidden="true" tabindex="-1"></a>      inStock<span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb341-21"><a href="#cb341-21" aria-hidden="true" tabindex="-1"></a>      category<span class="op">:</span> {</span>
<span id="cb341-22"><a href="#cb341-22" aria-hidden="true" tabindex="-1"></a>        select<span class="op">:</span> {</span>
<span id="cb341-23"><a href="#cb341-23" aria-hidden="true" tabindex="-1"></a>          name<span class="op">:</span> <span class="kw">true</span></span>
<span id="cb341-24"><a href="#cb341-24" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb341-25"><a href="#cb341-25" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb341-26"><a href="#cb341-26" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb341-27"><a href="#cb341-27" aria-hidden="true" tabindex="-1"></a>    orderBy<span class="op">:</span> {</span>
<span id="cb341-28"><a href="#cb341-28" aria-hidden="true" tabindex="-1"></a>      createdAt<span class="op">:</span> <span class="st">&#39;desc&#39;</span></span>
<span id="cb341-29"><a href="#cb341-29" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb341-30"><a href="#cb341-30" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb341-31"><a href="#cb341-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb341-32"><a href="#cb341-32" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">json</span>({</span>
<span id="cb341-33"><a href="#cb341-33" aria-hidden="true" tabindex="-1"></a>    products<span class="op">,</span></span>
<span id="cb341-34"><a href="#cb341-34" aria-hidden="true" tabindex="-1"></a>    page<span class="op">,</span></span>
<span id="cb341-35"><a href="#cb341-35" aria-hidden="true" tabindex="-1"></a>    limit</span>
<span id="cb341-36"><a href="#cb341-36" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb341-37"><a href="#cb341-37" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="get-single-product">7.2 GET Single Product</h3>
<p><strong>📁 File:</strong>
<code>app/api/products/[slug]/route.ts</code></p>
<div class="sourceCode" id="cb342"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb342-1"><a href="#cb342-1" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">async</span> <span class="kw">function</span> <span class="fu">GET</span>(</span>
<span id="cb342-2"><a href="#cb342-2" aria-hidden="true" tabindex="-1"></a>  request<span class="op">:</span> Request<span class="op">,</span></span>
<span id="cb342-3"><a href="#cb342-3" aria-hidden="true" tabindex="-1"></a>  { params }<span class="op">:</span> { params<span class="op">:</span> { slug<span class="op">:</span> <span class="dt">string</span> } }</span>
<span id="cb342-4"><a href="#cb342-4" aria-hidden="true" tabindex="-1"></a>) {</span>
<span id="cb342-5"><a href="#cb342-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> product <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="fu">findUnique</span>({</span>
<span id="cb342-6"><a href="#cb342-6" aria-hidden="true" tabindex="-1"></a>    where<span class="op">:</span> { slug<span class="op">:</span> params<span class="op">.</span><span class="at">slug</span> }<span class="op">,</span></span>
<span id="cb342-7"><a href="#cb342-7" aria-hidden="true" tabindex="-1"></a>    include<span class="op">:</span> {</span>
<span id="cb342-8"><a href="#cb342-8" aria-hidden="true" tabindex="-1"></a>      category<span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb342-9"><a href="#cb342-9" aria-hidden="true" tabindex="-1"></a>      feedbacks<span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb342-10"><a href="#cb342-10" aria-hidden="true" tabindex="-1"></a>      discount<span class="op">:</span> <span class="kw">true</span>  <span class="co">// ✨ Include discount</span></span>
<span id="cb342-11"><a href="#cb342-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb342-12"><a href="#cb342-12" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb342-13"><a href="#cb342-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb342-14"><a href="#cb342-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>product) {</span>
<span id="cb342-15"><a href="#cb342-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">json</span>(</span>
<span id="cb342-16"><a href="#cb342-16" aria-hidden="true" tabindex="-1"></a>      { error<span class="op">:</span> <span class="st">&#39;Product not found&#39;</span> }<span class="op">,</span></span>
<span id="cb342-17"><a href="#cb342-17" aria-hidden="true" tabindex="-1"></a>      { status<span class="op">:</span> <span class="dv">404</span> }</span>
<span id="cb342-18"><a href="#cb342-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb342-19"><a href="#cb342-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb342-20"><a href="#cb342-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb342-21"><a href="#cb342-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">json</span>(product)</span>
<span id="cb342-22"><a href="#cb342-22" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="post-route-create">7.3 POST Route (Create)</h3>
<div class="sourceCode" id="cb343"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb343-1"><a href="#cb343-1" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">async</span> <span class="kw">function</span> <span class="fu">POST</span>(request<span class="op">:</span> Request) {</span>
<span id="cb343-2"><a href="#cb343-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span> {</span>
<span id="cb343-3"><a href="#cb343-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> body <span class="op">=</span> <span class="cf">await</span> request<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb343-4"><a href="#cb343-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb343-5"><a href="#cb343-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Validasi</span></span>
<span id="cb343-6"><a href="#cb343-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> validated <span class="op">=</span> ProductSchema<span class="op">.</span><span class="fu">parse</span>(body)</span>
<span id="cb343-7"><a href="#cb343-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb343-8"><a href="#cb343-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create product dengan discount</span></span>
<span id="cb343-9"><a href="#cb343-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> product <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="fu">create</span>({</span>
<span id="cb343-10"><a href="#cb343-10" aria-hidden="true" tabindex="-1"></a>      data<span class="op">:</span> {</span>
<span id="cb343-11"><a href="#cb343-11" aria-hidden="true" tabindex="-1"></a>        slug<span class="op">:</span> validated<span class="op">.</span><span class="at">slug</span><span class="op">,</span></span>
<span id="cb343-12"><a href="#cb343-12" aria-hidden="true" tabindex="-1"></a>        title<span class="op">:</span> validated<span class="op">.</span><span class="at">title</span><span class="op">,</span></span>
<span id="cb343-13"><a href="#cb343-13" aria-hidden="true" tabindex="-1"></a>        price<span class="op">:</span> validated<span class="op">.</span><span class="at">price</span><span class="op">,</span></span>
<span id="cb343-14"><a href="#cb343-14" aria-hidden="true" tabindex="-1"></a>        discount<span class="op">:</span> validated<span class="op">.</span><span class="at">discount</span> <span class="op">||</span> <span class="dv">0</span><span class="op">,</span>  <span class="co">// ✨ Tambahkan discount</span></span>
<span id="cb343-15"><a href="#cb343-15" aria-hidden="true" tabindex="-1"></a>        description<span class="op">:</span> validated<span class="op">.</span><span class="at">description</span><span class="op">,</span></span>
<span id="cb343-16"><a href="#cb343-16" aria-hidden="true" tabindex="-1"></a>        manufacturer<span class="op">:</span> validated<span class="op">.</span><span class="at">manufacturer</span><span class="op">,</span></span>
<span id="cb343-17"><a href="#cb343-17" aria-hidden="true" tabindex="-1"></a>        inStock<span class="op">:</span> validated<span class="op">.</span><span class="at">inStock</span><span class="op">,</span></span>
<span id="cb343-18"><a href="#cb343-18" aria-hidden="true" tabindex="-1"></a>        categoryId<span class="op">:</span> validated<span class="op">.</span><span class="at">categoryId</span><span class="op">,</span></span>
<span id="cb343-19"><a href="#cb343-19" aria-hidden="true" tabindex="-1"></a>        mainImage<span class="op">:</span> validated<span class="op">.</span><span class="at">mainImage</span><span class="op">,</span></span>
<span id="cb343-20"><a href="#cb343-20" aria-hidden="true" tabindex="-1"></a>        rating<span class="op">:</span> <span class="dv">0</span></span>
<span id="cb343-21"><a href="#cb343-21" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb343-22"><a href="#cb343-22" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb343-23"><a href="#cb343-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb343-24"><a href="#cb343-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">json</span>(product<span class="op">,</span> { status<span class="op">:</span> <span class="dv">201</span> })</span>
<span id="cb343-25"><a href="#cb343-25" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">catch</span> (error) {</span>
<span id="cb343-26"><a href="#cb343-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Error handling...</span></span>
<span id="cb343-27"><a href="#cb343-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb343-28"><a href="#cb343-28" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="put-route-update">7.4 PUT Route (Update)</h3>
<div class="sourceCode" id="cb344"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb344-1"><a href="#cb344-1" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">async</span> <span class="kw">function</span> <span class="fu">PUT</span>(</span>
<span id="cb344-2"><a href="#cb344-2" aria-hidden="true" tabindex="-1"></a>  request<span class="op">:</span> Request<span class="op">,</span></span>
<span id="cb344-3"><a href="#cb344-3" aria-hidden="true" tabindex="-1"></a>  { params }<span class="op">:</span> { params<span class="op">:</span> { id<span class="op">:</span> <span class="dt">string</span> } }</span>
<span id="cb344-4"><a href="#cb344-4" aria-hidden="true" tabindex="-1"></a>) {</span>
<span id="cb344-5"><a href="#cb344-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span> {</span>
<span id="cb344-6"><a href="#cb344-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> body <span class="op">=</span> <span class="cf">await</span> request<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb344-7"><a href="#cb344-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb344-8"><a href="#cb344-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Partial validation untuk update</span></span>
<span id="cb344-9"><a href="#cb344-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> PartialProductSchema <span class="op">=</span> ProductSchema<span class="op">.</span><span class="fu">partial</span>()</span>
<span id="cb344-10"><a href="#cb344-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> validated <span class="op">=</span> PartialProductSchema<span class="op">.</span><span class="fu">parse</span>(body)</span>
<span id="cb344-11"><a href="#cb344-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb344-12"><a href="#cb344-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> product <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">product</span><span class="op">.</span><span class="fu">update</span>({</span>
<span id="cb344-13"><a href="#cb344-13" aria-hidden="true" tabindex="-1"></a>      where<span class="op">:</span> { id<span class="op">:</span> params<span class="op">.</span><span class="at">id</span> }<span class="op">,</span></span>
<span id="cb344-14"><a href="#cb344-14" aria-hidden="true" tabindex="-1"></a>      data<span class="op">:</span> {</span>
<span id="cb344-15"><a href="#cb344-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span>validated<span class="op">,</span></span>
<span id="cb344-16"><a href="#cb344-16" aria-hidden="true" tabindex="-1"></a>        discount<span class="op">:</span> validated<span class="op">.</span><span class="at">discount</span>  <span class="co">// ✨ Update discount</span></span>
<span id="cb344-17"><a href="#cb344-17" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb344-18"><a href="#cb344-18" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb344-19"><a href="#cb344-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-20"><a href="#cb344-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">json</span>(product)</span>
<span id="cb344-21"><a href="#cb344-21" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">catch</span> (error) {</span>
<span id="cb344-22"><a href="#cb344-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Error handling...</span></span>
<span id="cb344-23"><a href="#cb344-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb344-24"><a href="#cb344-24" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<hr />
<h2 id="step-6-update-ui-components">8. Step 6: Update UI
Components</h2>
<h3 id="product-card-component">8.1 Product Card Component</h3>
<p><strong>📁 File:</strong> <code>components/ProductItem.tsx</code></p>
<pre class="tsx"><code>interface ProductItemProps {
  product: {
    id: string
    slug: string
    title: string
    price: number
    discount?: number  // ✨ Tambah prop
    mainImage: string
    rating: number
  }
}

export default function ProductItem({ product }: ProductItemProps) {
  // ✨ Hitung harga setelah diskon
  const hasDiscount = product.discount &amp;&amp; product.discount &gt; 0
  const finalPrice = hasDiscount
    ? product.price * (1 - product.discount! / 100)
    : product.price

  return (
    &lt;div className=&quot;product-card border rounded-lg p-4 hover:shadow-lg transition&quot;&gt;
      {/* ✨ Badge diskon */}
      {hasDiscount &amp;&amp; (
        &lt;div className=&quot;absolute top-2 right-2 bg-red-500 text-white px-2 py-1 rounded-md text-sm font-bold&quot;&gt;
          -{product.discount}%
        &lt;/div&gt;
      )}

      &lt;img 
        src={product.mainImage} 
        alt={product.title}
        className=&quot;w-full h-48 object-cover rounded&quot;
      /&gt;
      
      &lt;h3 className=&quot;mt-3 font-semibold text-lg&quot;&gt;{product.title}&lt;/h3&gt;
      
      {/* ✨ Tampilan harga dengan diskon */}
      &lt;div className=&quot;mt-2 flex items-center gap-2&quot;&gt;
        {hasDiscount ? (
          &lt;&gt;
            &lt;span className=&quot;text-gray-400 line-through text-sm&quot;&gt;
              Rp {product.price.toLocaleString()}
            &lt;/span&gt;
            &lt;span className=&quot;text-custom-yellow font-bold text-xl&quot;&gt;
              Rp {finalPrice.toLocaleString()}
            &lt;/span&gt;
          &lt;/&gt;
        ) : (
          &lt;span className=&quot;text-custom-yellow font-bold text-xl&quot;&gt;
            Rp {product.price.toLocaleString()}
          &lt;/span&gt;
        )}
      &lt;/div&gt;
      
      {/* ✨ Text saved amount */}
      {hasDiscount &amp;&amp; (
        &lt;p className=&quot;text-green-600 text-sm mt-1&quot;&gt;
          Hemat Rp {(product.price - finalPrice).toLocaleString()}
        &lt;/p&gt;
      )}
    &lt;/div&gt;
  )
}</code></pre>
<h3 id="product-detail-page">8.2 Product Detail Page</h3>
<p><strong>📁 File:</strong>
<code>app/product/[slug]/page.tsx</code></p>
<pre class="tsx"><code>export default async function ProductDetailPage({ 
  params 
}: { 
  params: { slug: string } 
}) {
  const product = await prisma.product.findUnique({
    where: { slug: params.slug },
    include: { category: true }
  })

  const hasDiscount = product?.discount &amp;&amp; product.discount &gt; 0
  const finalPrice = hasDiscount
    ? product.price * (1 - product.discount! / 100)
    : product.price

  return (
    &lt;div className=&quot;container mx-auto px-4 py-8&quot;&gt;
      &lt;div className=&quot;grid grid-cols-1 md:grid-cols-2 gap-8&quot;&gt;
        {/* Image */}
        &lt;div&gt;
          &lt;img 
            src={product.mainImage} 
            alt={product.title}
            className=&quot;w-full rounded-lg&quot;
          /&gt;
        &lt;/div&gt;

        {/* Info */}
        &lt;div&gt;
          &lt;h1 className=&quot;text-3xl font-bold&quot;&gt;{product.title}&lt;/h1&gt;
          
          {/* ✨ Price dengan discount */}
          &lt;div className=&quot;mt-4&quot;&gt;
            {hasDiscount &amp;&amp; (
              &lt;div className=&quot;flex items-center gap-2 mb-2&quot;&gt;
                &lt;span className=&quot;bg-red-500 text-white px-3 py-1 rounded-full text-sm font-bold&quot;&gt;
                  {product.discount}% OFF
                &lt;/span&gt;
                &lt;span className=&quot;text-gray-500 line-through text-lg&quot;&gt;
                  Rp {product.price.toLocaleString()}
                &lt;/span&gt;
              &lt;/div&gt;
            )}
            
            &lt;div className=&quot;text-4xl font-bold text-custom-yellow&quot;&gt;
              Rp {finalPrice.toLocaleString()}
            &lt;/div&gt;
            
            {hasDiscount &amp;&amp; (
              &lt;p className=&quot;text-green-600 mt-1&quot;&gt;
                Anda hemat Rp {(product.price - finalPrice).toLocaleString()}
              &lt;/p&gt;
            )}
          &lt;/div&gt;

          {/* Description */}
          &lt;p className=&quot;mt-6 text-gray-600&quot;&gt;{product.description}&lt;/p&gt;
          
          {/* Actions */}
          &lt;div className=&quot;mt-8 flex gap-4&quot;&gt;
            &lt;button className=&quot;btn btn-primary flex-1&quot;&gt;
              Add to Cart
            &lt;/button&gt;
            &lt;button className=&quot;btn btn-outline&quot;&gt;
              Add to Wishlist
            &lt;/button&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  )
}</code></pre>
<hr />
<h2 id="step-7-update-admin-dashboard">9. Step 7: Update Admin
Dashboard</h2>
<h3 id="admin-product-table">9.1 Admin Product Table</h3>
<p><strong>📁 File:</strong>
<code>components/DashboardProductTable.tsx</code></p>
<pre class="tsx"><code>export default function DashboardProductTable({ products }: Props) {
  return (
    &lt;table className=&quot;table w-full&quot;&gt;
      &lt;thead&gt;
        &lt;tr&gt;
          &lt;th&gt;ID&lt;/th&gt;
          &lt;th&gt;Title&lt;/th&gt;
          &lt;th&gt;Price&lt;/th&gt;
          &lt;th&gt;Discount&lt;/th&gt;  {/* ✨ New column */}
          &lt;th&gt;Final Price&lt;/th&gt;  {/* ✨ New column */}
          &lt;th&gt;Stock&lt;/th&gt;
          &lt;th&gt;Actions&lt;/th&gt;
        &lt;/tr&gt;
      &lt;/thead&gt;
      &lt;tbody&gt;
        {products.map((product) =&gt; {
          const finalPrice = product.discount
            ? product.price * (1 - product.discount / 100)
            : product.price

          return (
            &lt;tr key={product.id}&gt;
              &lt;td&gt;{product.id.slice(0, 8)}...&lt;/td&gt;
              &lt;td&gt;{product.title}&lt;/td&gt;
              &lt;td&gt;Rp {product.price.toLocaleString()}&lt;/td&gt;
              
              {/* ✨ Discount column */}
              &lt;td&gt;
                {product.discount ? (
                  &lt;span className=&quot;badge badge-error&quot;&gt;
                    -{product.discount}%
                  &lt;/span&gt;
                ) : (
                  &lt;span className=&quot;text-gray-400&quot;&gt;-&lt;/span&gt;
                )}
              &lt;/td&gt;
              
              {/* ✨ Final price column */}
              &lt;td className=&quot;font-bold&quot;&gt;
                Rp {finalPrice.toLocaleString()}
              &lt;/td&gt;
              
              &lt;td&gt;{product.inStock}&lt;/td&gt;
              &lt;td&gt;
                &lt;button className=&quot;btn btn-sm btn-primary&quot;&gt;Edit&lt;/button&gt;
                &lt;button className=&quot;btn btn-sm btn-error&quot;&gt;Delete&lt;/button&gt;
              &lt;/td&gt;
            &lt;/tr&gt;
          )
        })}
      &lt;/tbody&gt;
    &lt;/table&gt;
  )
}</code></pre>
<h3 id="admin-addedit-product-form">9.2 Admin Add/Edit Product Form</h3>
<p><strong>📁 File:</strong>
<code>app/(dashboard)/admin/products/add/page.tsx</code></p>
<pre class="tsx"><code>&quot;use client&quot;

import { useState } from &#39;react&#39;
import { useRouter } from &#39;next/navigation&#39;

export default function AddProductPage() {
  const router = useRouter()
  const [formData, setFormData] = useState({
    slug: &#39;&#39;,
    title: &#39;&#39;,
    price: 0,
    discount: 0,  // ✨ New field
    description: &#39;&#39;,
    manufacturer: &#39;&#39;,
    inStock: 0,
    categoryId: &#39;&#39;,
    mainImage: &#39;&#39;
  })

  const [loading, setLoading] = useState(false)

  const handleSubmit = async (e: React.FormEvent) =&gt; {
    e.preventDefault()
    setLoading(true)

    try {
      const response = await fetch(&#39;/api/products&#39;, {
        method: &#39;POST&#39;,
        headers: { &#39;Content-Type&#39;: &#39;application/json&#39; },
        body: JSON.stringify(formData)
      })

      if (response.ok) {
        router.push(&#39;/admin/products&#39;)
      } else {
        const error = await response.json()
        alert(error.message)
      }
    } catch (error) {
      console.error(error)
      alert(&#39;Failed to create product&#39;)
    } finally {
      setLoading(false)
    }
  }

  return (
    &lt;div className=&quot;container mx-auto px-4 py-8&quot;&gt;
      &lt;h1 className=&quot;text-3xl font-bold mb-6&quot;&gt;Add New Product&lt;/h1&gt;

      &lt;form onSubmit={handleSubmit} className=&quot;space-y-6&quot;&gt;
        {/* Title */}
        &lt;div&gt;
          &lt;label className=&quot;label&quot;&gt;
            &lt;span className=&quot;label-text&quot;&gt;Product Title&lt;/span&gt;
          &lt;/label&gt;
          &lt;input
            type=&quot;text&quot;
            className=&quot;input input-bordered w-full&quot;
            value={formData.title}
            onChange={(e) =&gt; setFormData({ ...formData, title: e.target.value })}
            required
          /&gt;
        &lt;/div&gt;

        {/* Price &amp; Discount (side by side) */}
        &lt;div className=&quot;grid grid-cols-2 gap-4&quot;&gt;
          {/* Price */}
          &lt;div&gt;
            &lt;label className=&quot;label&quot;&gt;
              &lt;span className=&quot;label-text&quot;&gt;Price (Rp)&lt;/span&gt;
            &lt;/label&gt;
            &lt;input
              type=&quot;number&quot;
              className=&quot;input input-bordered w-full&quot;
              value={formData.price}
              onChange={(e) =&gt; setFormData({ 
                ...formData, 
                price: parseInt(e.target.value) 
              })}
              required
            /&gt;
          &lt;/div&gt;

          {/* ✨✨✨ DISCOUNT INPUT ✨✨✨ */}
          &lt;div&gt;
            &lt;label className=&quot;label&quot;&gt;
              &lt;span className=&quot;label-text&quot;&gt;Discount (%)&lt;/span&gt;
            &lt;/label&gt;
            &lt;input
              type=&quot;number&quot;
              className=&quot;input input-bordered w-full&quot;
              min=&quot;0&quot;
              max=&quot;100&quot;
              step=&quot;0.1&quot;
              value={formData.discount}
              onChange={(e) =&gt; setFormData({ 
                ...formData, 
                discount: parseFloat(e.target.value) 
              })}
            /&gt;
            &lt;label className=&quot;label&quot;&gt;
              &lt;span className=&quot;label-text-alt text-gray-500&quot;&gt;
                0-100% (optional, default: 0)
              &lt;/span&gt;
            &lt;/label&gt;
          &lt;/div&gt;
        &lt;/div&gt;

        {/* ✨ Preview harga final */}
        {formData.discount &gt; 0 &amp;&amp; (
          &lt;div className=&quot;alert alert-info&quot;&gt;
            &lt;div&gt;
              &lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot; className=&quot;stroke-current shrink-0 w-6 h-6&quot;&gt;
                &lt;path strokeLinecap=&quot;round&quot; strokeLinejoin=&quot;round&quot; strokeWidth=&quot;2&quot; d=&quot;M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z&quot;&gt;&lt;/path&gt;
              &lt;/svg&gt;
              &lt;div&gt;
                &lt;h3 className=&quot;font-bold&quot;&gt;Price Preview&lt;/h3&gt;
                &lt;div className=&quot;text-xs&quot;&gt;
                  Original: Rp {formData.price.toLocaleString()}
                  &lt;br /&gt;
                  Final: Rp {(formData.price * (1 - formData.discount / 100)).toLocaleString()}
                  &lt;br /&gt;
                  You save: Rp {(formData.price * formData.discount / 100).toLocaleString()}
                &lt;/div&gt;
              &lt;/div&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        )}

        {/* Other fields... */}
        &lt;div&gt;
          &lt;label className=&quot;label&quot;&gt;
            &lt;span className=&quot;label-text&quot;&gt;Description&lt;/span&gt;
          &lt;/label&gt;
          &lt;textarea
            className=&quot;textarea textarea-bordered w-full&quot;
            rows={4}
            value={formData.description}
            onChange={(e) =&gt; setFormData({ ...formData, description: e.target.value })}
            required
          /&gt;
        &lt;/div&gt;

        {/* Submit */}
        &lt;button 
          type=&quot;submit&quot; 
          className=&quot;btn btn-primary w-full&quot;
          disabled={loading}
        &gt;
          {loading ? &#39;Creating...&#39; : &#39;Create Product&#39;}
        &lt;/button&gt;
      &lt;/form&gt;
    &lt;/div&gt;
  )
}</code></pre>
<hr />
<h2 id="step-8-testing">10. Step 8: Testing</h2>
<h3 id="test-di-prisma-studio">10.1 Test di Prisma Studio</h3>
<div class="sourceCode" id="cb349"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb349-1"><a href="#cb349-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Buka Prisma Studio</span></span>
<span id="cb349-2"><a href="#cb349-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma studio</span></code></pre></div>
<ol type="1">
<li>Buka table <code>Product</code></li>
<li>Add record baru</li>
<li>Isi field <code>discount</code> dengan nilai <code>10</code>
(10%)</li>
<li>Save</li>
<li>Verify data tersimpan</li>
</ol>
<h3 id="test-api-dengan-curl">10.2 Test API dengan cURL</h3>
<div class="sourceCode" id="cb350"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb350-1"><a href="#cb350-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test GET all products</span></span>
<span id="cb350-2"><a href="#cb350-2" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> http://localhost:3000/api/products</span>
<span id="cb350-3"><a href="#cb350-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb350-4"><a href="#cb350-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Test POST create product</span></span>
<span id="cb350-5"><a href="#cb350-5" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-X</span> POST http://localhost:3000/api/products <span class="dt">\</span></span>
<span id="cb350-6"><a href="#cb350-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">-H</span> <span class="st">&quot;Content-Type: application/json&quot;</span> <span class="dt">\</span></span>
<span id="cb350-7"><a href="#cb350-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">-d</span> <span class="st">&#39;{</span></span>
<span id="cb350-8"><a href="#cb350-8" aria-hidden="true" tabindex="-1"></a><span class="st">    &quot;slug&quot;: &quot;test-product-discount&quot;,</span></span>
<span id="cb350-9"><a href="#cb350-9" aria-hidden="true" tabindex="-1"></a><span class="st">    &quot;title&quot;: &quot;Test Product with Discount&quot;,</span></span>
<span id="cb350-10"><a href="#cb350-10" aria-hidden="true" tabindex="-1"></a><span class="st">    &quot;price&quot;: 100000,</span></span>
<span id="cb350-11"><a href="#cb350-11" aria-hidden="true" tabindex="-1"></a><span class="st">    &quot;discount&quot;: 15,</span></span>
<span id="cb350-12"><a href="#cb350-12" aria-hidden="true" tabindex="-1"></a><span class="st">    &quot;description&quot;: &quot;Test description&quot;,</span></span>
<span id="cb350-13"><a href="#cb350-13" aria-hidden="true" tabindex="-1"></a><span class="st">    &quot;manufacturer&quot;: &quot;Test Brand&quot;,</span></span>
<span id="cb350-14"><a href="#cb350-14" aria-hidden="true" tabindex="-1"></a><span class="st">    &quot;inStock&quot;: 10,</span></span>
<span id="cb350-15"><a href="#cb350-15" aria-hidden="true" tabindex="-1"></a><span class="st">    &quot;categoryId&quot;: &quot;category-id-here&quot;,</span></span>
<span id="cb350-16"><a href="#cb350-16" aria-hidden="true" tabindex="-1"></a><span class="st">    &quot;mainImage&quot;: &quot;https://example.com/image.jpg&quot;</span></span>
<span id="cb350-17"><a href="#cb350-17" aria-hidden="true" tabindex="-1"></a><span class="st">  }&#39;</span></span>
<span id="cb350-18"><a href="#cb350-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb350-19"><a href="#cb350-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Test PUT update discount</span></span>
<span id="cb350-20"><a href="#cb350-20" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-X</span> PUT http://localhost:3000/api/products/product-id <span class="dt">\</span></span>
<span id="cb350-21"><a href="#cb350-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">-H</span> <span class="st">&quot;Content-Type: application/json&quot;</span> <span class="dt">\</span></span>
<span id="cb350-22"><a href="#cb350-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">-d</span> <span class="st">&#39;{&quot;discount&quot;: 20}&#39;</span></span></code></pre></div>
<h3 id="test-di-frontend">10.3 Test di Frontend</h3>
<p><strong>Manual Testing Checklist:</strong></p>
<ul class="task-list">
<li><label><input type="checkbox" />Product list menampilkan badge
diskon</label></li>
<li><label><input type="checkbox" />Harga coret tampil jika ada
diskon</label></li>
<li><label><input type="checkbox" />Final price dihitung dengan
benar</label></li>
<li><label><input type="checkbox" />Product detail page menampilkan
diskon</label></li>
<li><label><input type="checkbox" />Admin form bisa input
discount</label></li>
<li><label><input type="checkbox" />Admin table menampilkan kolom
discount</label></li>
<li><label><input type="checkbox" />Validasi 0-100%
berfungsi</label></li>
<li><label><input type="checkbox" />Error handling untuk input
invalid</label></li>
</ul>
<h3 id="test-case-examples">10.4 Test Case Examples</h3>
<div class="sourceCode" id="cb351"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb351-1"><a href="#cb351-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Test case 1: Discount 0% (no discount)</span></span>
<span id="cb351-2"><a href="#cb351-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> product1 <span class="op">=</span> {</span>
<span id="cb351-3"><a href="#cb351-3" aria-hidden="true" tabindex="-1"></a>  price<span class="op">:</span> <span class="dv">100000</span><span class="op">,</span></span>
<span id="cb351-4"><a href="#cb351-4" aria-hidden="true" tabindex="-1"></a>  discount<span class="op">:</span> <span class="dv">0</span></span>
<span id="cb351-5"><a href="#cb351-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb351-6"><a href="#cb351-6" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> expected1 <span class="op">=</span> <span class="dv">100000</span></span>
<span id="cb351-7"><a href="#cb351-7" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> actual1 <span class="op">=</span> <span class="fu">calculateFinalPrice</span>(product1<span class="op">.</span><span class="at">price</span><span class="op">,</span> product1<span class="op">.</span><span class="at">discount</span>)</span>
<span id="cb351-8"><a href="#cb351-8" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">assert</span>(actual1 <span class="op">===</span> expected1<span class="op">,</span> <span class="st">&#39;Test 1 failed&#39;</span>)</span>
<span id="cb351-9"><a href="#cb351-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb351-10"><a href="#cb351-10" aria-hidden="true" tabindex="-1"></a><span class="co">// Test case 2: Discount 10%</span></span>
<span id="cb351-11"><a href="#cb351-11" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> product2 <span class="op">=</span> {</span>
<span id="cb351-12"><a href="#cb351-12" aria-hidden="true" tabindex="-1"></a>  price<span class="op">:</span> <span class="dv">100000</span><span class="op">,</span></span>
<span id="cb351-13"><a href="#cb351-13" aria-hidden="true" tabindex="-1"></a>  discount<span class="op">:</span> <span class="dv">10</span></span>
<span id="cb351-14"><a href="#cb351-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb351-15"><a href="#cb351-15" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> expected2 <span class="op">=</span> <span class="dv">90000</span></span>
<span id="cb351-16"><a href="#cb351-16" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> actual2 <span class="op">=</span> <span class="fu">calculateFinalPrice</span>(product2<span class="op">.</span><span class="at">price</span><span class="op">,</span> product2<span class="op">.</span><span class="at">discount</span>)</span>
<span id="cb351-17"><a href="#cb351-17" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">assert</span>(actual2 <span class="op">===</span> expected2<span class="op">,</span> <span class="st">&#39;Test 2 failed&#39;</span>)</span>
<span id="cb351-18"><a href="#cb351-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb351-19"><a href="#cb351-19" aria-hidden="true" tabindex="-1"></a><span class="co">// Test case 3: Discount 50%</span></span>
<span id="cb351-20"><a href="#cb351-20" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> product3 <span class="op">=</span> {</span>
<span id="cb351-21"><a href="#cb351-21" aria-hidden="true" tabindex="-1"></a>  price<span class="op">:</span> <span class="dv">200000</span><span class="op">,</span></span>
<span id="cb351-22"><a href="#cb351-22" aria-hidden="true" tabindex="-1"></a>  discount<span class="op">:</span> <span class="dv">50</span></span>
<span id="cb351-23"><a href="#cb351-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb351-24"><a href="#cb351-24" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> expected3 <span class="op">=</span> <span class="dv">100000</span></span>
<span id="cb351-25"><a href="#cb351-25" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> actual3 <span class="op">=</span> <span class="fu">calculateFinalPrice</span>(product3<span class="op">.</span><span class="at">price</span><span class="op">,</span> product3<span class="op">.</span><span class="at">discount</span>)</span>
<span id="cb351-26"><a href="#cb351-26" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">assert</span>(actual3 <span class="op">===</span> expected3<span class="op">,</span> <span class="st">&#39;Test 3 failed&#39;</span>)</span>
<span id="cb351-27"><a href="#cb351-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb351-28"><a href="#cb351-28" aria-hidden="true" tabindex="-1"></a><span class="co">// Test case 4: Discount null/undefined</span></span>
<span id="cb351-29"><a href="#cb351-29" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> product4 <span class="op">=</span> {</span>
<span id="cb351-30"><a href="#cb351-30" aria-hidden="true" tabindex="-1"></a>  price<span class="op">:</span> <span class="dv">100000</span><span class="op">,</span></span>
<span id="cb351-31"><a href="#cb351-31" aria-hidden="true" tabindex="-1"></a>  discount<span class="op">:</span> <span class="dt">undefined</span></span>
<span id="cb351-32"><a href="#cb351-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb351-33"><a href="#cb351-33" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> expected4 <span class="op">=</span> <span class="dv">100000</span></span>
<span id="cb351-34"><a href="#cb351-34" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> actual4 <span class="op">=</span> <span class="fu">calculateFinalPrice</span>(product4<span class="op">.</span><span class="at">price</span><span class="op">,</span> product4<span class="op">.</span><span class="at">discount</span>)</span>
<span id="cb351-35"><a href="#cb351-35" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">assert</span>(actual4 <span class="op">===</span> expected4<span class="op">,</span> <span class="st">&#39;Test 4 failed&#39;</span>)</span></code></pre></div>
<hr />
<h2 id="contoh-lain-tambah-field-di-model-user">11. Contoh Lain: Tambah
Field di Model User</h2>
<h3 id="requirement-1">11.1 Requirement</h3>
<p><strong>Target:</strong> Tambah field <code>phone</code> dan
<code>address</code> ke model <code>User</code></p>
<h3 id="step-1-update-schema">11.2 Step 1: Update Schema</h3>
<pre class="prisma"><code>model User {
  id        String     @id @default(uuid())
  email     String     @unique
  password  String?
  role      String?    @default(&quot;user&quot;)
  
  // ✨ NEW FIELDS
  phone     String?    // Optional phone number
  address   String?    @db.Text  // Optional address (longer text)
  
  Wishlist  Wishlist[]
  feedbacks Feedback[]
}</code></pre>
<h3 id="step-2-migration">11.3 Step 2: Migration</h3>
<div class="sourceCode" id="cb353"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb353-1"><a href="#cb353-1" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma migrate dev <span class="at">--name</span> add_phone_address_to_user</span></code></pre></div>
<h3 id="step-3-update-validasi">11.4 Step 3: Update Validasi</h3>
<div class="sourceCode" id="cb354"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb354-1"><a href="#cb354-1" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> UpdateUserProfileSchema <span class="op">=</span> z<span class="op">.</span><span class="fu">object</span>({</span>
<span id="cb354-2"><a href="#cb354-2" aria-hidden="true" tabindex="-1"></a>  email<span class="op">:</span> z<span class="op">.</span><span class="fu">string</span>()<span class="op">.</span><span class="fu">email</span>()<span class="op">.</span><span class="fu">optional</span>()<span class="op">,</span></span>
<span id="cb354-3"><a href="#cb354-3" aria-hidden="true" tabindex="-1"></a>  phone<span class="op">:</span> z<span class="op">.</span><span class="fu">string</span>()</span>
<span id="cb354-4"><a href="#cb354-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">regex</span>(<span class="ss">/</span><span class="sc">^(\+</span><span class="ss">62</span><span class="sc">|</span><span class="ss">62</span><span class="sc">|</span><span class="ss">0</span><span class="sc">)[0-9]{9,12}$</span><span class="ss">/</span><span class="op">,</span> <span class="st">&quot;Format nomor HP tidak valid&quot;</span>)</span>
<span id="cb354-5"><a href="#cb354-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">optional</span>()<span class="op">,</span></span>
<span id="cb354-6"><a href="#cb354-6" aria-hidden="true" tabindex="-1"></a>  address<span class="op">:</span> z<span class="op">.</span><span class="fu">string</span>()</span>
<span id="cb354-7"><a href="#cb354-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">min</span>(<span class="dv">10</span><span class="op">,</span> <span class="st">&quot;Alamat minimal 10 karakter&quot;</span>)</span>
<span id="cb354-8"><a href="#cb354-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">max</span>(<span class="dv">500</span><span class="op">,</span> <span class="st">&quot;Alamat maksimal 500 karakter&quot;</span>)</span>
<span id="cb354-9"><a href="#cb354-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">optional</span>()</span>
<span id="cb354-10"><a href="#cb354-10" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<h3 id="step-4-update-api">11.5 Step 4: Update API</h3>
<div class="sourceCode" id="cb355"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb355-1"><a href="#cb355-1" aria-hidden="true" tabindex="-1"></a><span class="co">// app/api/user/profile/route.ts</span></span>
<span id="cb355-2"><a href="#cb355-2" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">async</span> <span class="kw">function</span> <span class="fu">PUT</span>(request<span class="op">:</span> Request) {</span>
<span id="cb355-3"><a href="#cb355-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> session <span class="op">=</span> <span class="cf">await</span> <span class="fu">getServerSession</span>()</span>
<span id="cb355-4"><a href="#cb355-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>session<span class="op">?.</span><span class="at">user</span><span class="op">?.</span><span class="at">id</span>) {</span>
<span id="cb355-5"><a href="#cb355-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">json</span>({ error<span class="op">:</span> <span class="st">&#39;Unauthorized&#39;</span> }<span class="op">,</span> { status<span class="op">:</span> <span class="dv">401</span> })</span>
<span id="cb355-6"><a href="#cb355-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb355-7"><a href="#cb355-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb355-8"><a href="#cb355-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> body <span class="op">=</span> <span class="cf">await</span> request<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb355-9"><a href="#cb355-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> validated <span class="op">=</span> UpdateUserProfileSchema<span class="op">.</span><span class="fu">parse</span>(body)</span>
<span id="cb355-10"><a href="#cb355-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb355-11"><a href="#cb355-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> user <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">user</span><span class="op">.</span><span class="fu">update</span>({</span>
<span id="cb355-12"><a href="#cb355-12" aria-hidden="true" tabindex="-1"></a>    where<span class="op">:</span> { id<span class="op">:</span> session<span class="op">.</span><span class="at">user</span><span class="op">.</span><span class="at">id</span> }<span class="op">,</span></span>
<span id="cb355-13"><a href="#cb355-13" aria-hidden="true" tabindex="-1"></a>    data<span class="op">:</span> {</span>
<span id="cb355-14"><a href="#cb355-14" aria-hidden="true" tabindex="-1"></a>      phone<span class="op">:</span> validated<span class="op">.</span><span class="at">phone</span><span class="op">,</span></span>
<span id="cb355-15"><a href="#cb355-15" aria-hidden="true" tabindex="-1"></a>      address<span class="op">:</span> validated<span class="op">.</span><span class="at">address</span></span>
<span id="cb355-16"><a href="#cb355-16" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb355-17"><a href="#cb355-17" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb355-18"><a href="#cb355-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb355-19"><a href="#cb355-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">json</span>(user)</span>
<span id="cb355-20"><a href="#cb355-20" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="step-5-update-ui-form">11.6 Step 5: Update UI Form</h3>
<pre class="tsx"><code>// app/profile/edit/page.tsx
export default function EditProfilePage() {
  const [formData, setFormData] = useState({
    phone: &#39;&#39;,
    address: &#39;&#39;
  })

  return (
    &lt;form&gt;
      &lt;div&gt;
        &lt;label&gt;Phone Number&lt;/label&gt;
        &lt;input
          type=&quot;tel&quot;
          placeholder=&quot;+62 812-3456-7890&quot;
          value={formData.phone}
          onChange={(e) =&gt; setFormData({ ...formData, phone: e.target.value })}
        /&gt;
      &lt;/div&gt;

      &lt;div&gt;
        &lt;label&gt;Address&lt;/label&gt;
        &lt;textarea
          placeholder=&quot;Jl. Contoh No. 123, Jakarta&quot;
          value={formData.address}
          onChange={(e) =&gt; setFormData({ ...formData, address: e.target.value })}
          rows={4}
        /&gt;
      &lt;/div&gt;

      &lt;button type=&quot;submit&quot;&gt;Save Changes&lt;/button&gt;
    &lt;/form&gt;
  )
}</code></pre>
<hr />
<h2 id="best-practices-2">12. Best Practices</h2>
<h3 id="dos">12.1 ✅ DO’s</h3>
<h4 id="gunakan-nullable-untuk-field-optional">1. Gunakan Nullable untuk
Field Optional</h4>
<pre class="prisma"><code>// ✅ BENAR: Optional field
discount Float? @default(0)

// ❌ SALAH: Required field tanpa default
discount Float</code></pre>
<h4 id="berikan-default-value-yang-masuk-akal">2. Berikan Default Value
yang Masuk Akal</h4>
<pre class="prisma"><code>// ✅ BENAR
discount Float? @default(0)
isActive Boolean @default(true)
createdAt DateTime @default(now())

// ❌ SALAH: No default untuk required field
isActive Boolean  // Bisa error jika tidak diisi</code></pre>
<h4 id="validasi-di-multiple-layers">3. Validasi di Multiple Layers</h4>
<pre><code>1. Database Level (Prisma schema constraints)
2. API Level (Zod validation)
3. UI Level (HTML5 validation + client-side)</code></pre>
<h4 id="commit-per-step">4. Commit per Step</h4>
<div class="sourceCode" id="cb360"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb360-1"><a href="#cb360-1" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> add prisma/schema.prisma</span>
<span id="cb360-2"><a href="#cb360-2" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> commit <span class="at">-m</span> <span class="st">&quot;feat: add discount field to Product model&quot;</span></span>
<span id="cb360-3"><a href="#cb360-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb360-4"><a href="#cb360-4" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> add app/api/products/</span>
<span id="cb360-5"><a href="#cb360-5" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> commit <span class="at">-m</span> <span class="st">&quot;feat: update product API to handle discount&quot;</span></span>
<span id="cb360-6"><a href="#cb360-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb360-7"><a href="#cb360-7" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> add components/ProductItem.tsx</span>
<span id="cb360-8"><a href="#cb360-8" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> commit <span class="at">-m</span> <span class="st">&quot;feat: display discount badge in product card&quot;</span></span></code></pre></div>
<h3 id="donts">12.2 ❌ DON’Ts</h3>
<h4 id="jangan-lupa-generate-client">1. Jangan Lupa Generate Client</h4>
<div class="sourceCode" id="cb361"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb361-1"><a href="#cb361-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ❌ SALAH: Edit schema tapi lupa generate</span></span>
<span id="cb361-2"><a href="#cb361-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Edit schema.prisma</span></span>
<span id="cb361-3"><a href="#cb361-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Langsung coding...  &lt;- TYPE ERROR!</span></span>
<span id="cb361-4"><a href="#cb361-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb361-5"><a href="#cb361-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ✅ BENAR: Generate setelah edit schema</span></span>
<span id="cb361-6"><a href="#cb361-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Edit schema.prisma</span></span>
<span id="cb361-7"><a href="#cb361-7" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma generate  <span class="co"># &lt;- Wajib!</span></span>
<span id="cb361-8"><a href="#cb361-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Baru coding</span></span></code></pre></div>
<h4 id="jangan-hardcode-type-di-banyak-tempat">2. Jangan Hardcode Type
di Banyak Tempat</h4>
<div class="sourceCode" id="cb362"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb362-1"><a href="#cb362-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ❌ SALAH: Duplicate type definition</span></span>
<span id="cb362-2"><a href="#cb362-2" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> ProductA {</span>
<span id="cb362-3"><a href="#cb362-3" aria-hidden="true" tabindex="-1"></a>  id<span class="op">:</span> <span class="dt">string</span></span>
<span id="cb362-4"><a href="#cb362-4" aria-hidden="true" tabindex="-1"></a>  discount<span class="op">?:</span> <span class="dt">number</span></span>
<span id="cb362-5"><a href="#cb362-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb362-6"><a href="#cb362-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb362-7"><a href="#cb362-7" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> ProductB {</span>
<span id="cb362-8"><a href="#cb362-8" aria-hidden="true" tabindex="-1"></a>  id<span class="op">:</span> <span class="dt">string</span></span>
<span id="cb362-9"><a href="#cb362-9" aria-hidden="true" tabindex="-1"></a>  discount<span class="op">?:</span> <span class="dt">number</span></span>
<span id="cb362-10"><a href="#cb362-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb362-11"><a href="#cb362-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb362-12"><a href="#cb362-12" aria-hidden="true" tabindex="-1"></a><span class="co">// ✅ BENAR: Import from Prisma</span></span>
<span id="cb362-13"><a href="#cb362-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { Product } <span class="im">from</span> <span class="st">&#39;@prisma/client&#39;</span></span></code></pre></div>
<h4 id="jangan-skip-validasi">3. Jangan Skip Validasi</h4>
<div class="sourceCode" id="cb363"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb363-1"><a href="#cb363-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ❌ SALAH: No validation</span></span>
<span id="cb363-2"><a href="#cb363-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> discount <span class="op">=</span> req<span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">discount</span>  <span class="co">// Bisa -100 atau 999!</span></span>
<span id="cb363-3"><a href="#cb363-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb363-4"><a href="#cb363-4" aria-hidden="true" tabindex="-1"></a><span class="co">// ✅ BENAR: Validate first</span></span>
<span id="cb363-5"><a href="#cb363-5" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> schema <span class="op">=</span> z<span class="op">.</span><span class="fu">object</span>({</span>
<span id="cb363-6"><a href="#cb363-6" aria-hidden="true" tabindex="-1"></a>  discount<span class="op">:</span> z<span class="op">.</span><span class="fu">number</span>()<span class="op">.</span><span class="fu">min</span>(<span class="dv">0</span>)<span class="op">.</span><span class="fu">max</span>(<span class="dv">100</span>)</span>
<span id="cb363-7"><a href="#cb363-7" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb363-8"><a href="#cb363-8" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> { discount } <span class="op">=</span> schema<span class="op">.</span><span class="fu">parse</span>(req<span class="op">.</span><span class="at">body</span>)</span></code></pre></div>
<hr />
<h2 id="troubleshooting-4">13. Troubleshooting</h2>
<h3 id="error-field-does-not-exist">13.1 Error: “Field does not
exist”</h3>
<p><strong>Error:</strong></p>
<pre><code>Unknown field `discount` for type `Product`.</code></pre>
<p><strong>Penyebab:</strong> Lupa generate Prisma Client.</p>
<p><strong>Solusi:</strong></p>
<div class="sourceCode" id="cb365"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb365-1"><a href="#cb365-1" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma generate</span></code></pre></div>
<h3 id="error-migration-failed">13.2 Error: “Migration failed”</h3>
<p><strong>Error:</strong></p>
<pre><code>Migration failed to apply cleanly to a temporary database.</code></pre>
<p><strong>Solusi:</strong></p>
<div class="sourceCode" id="cb367"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb367-1"><a href="#cb367-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Check database connection</span></span>
<span id="cb367-2"><a href="#cb367-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma db pull</span>
<span id="cb367-3"><a href="#cb367-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb367-4"><a href="#cb367-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Reset dan migrate ulang</span></span>
<span id="cb367-5"><a href="#cb367-5" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma migrate reset</span>
<span id="cb367-6"><a href="#cb367-6" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma migrate dev</span>
<span id="cb367-7"><a href="#cb367-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb367-8"><a href="#cb367-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Jika masih error, cek database manual</span></span>
<span id="cb367-9"><a href="#cb367-9" aria-hidden="true" tabindex="-1"></a><span class="ex">mysql</span> <span class="at">-u</span> root <span class="at">-p</span></span>
<span id="cb367-10"><a href="#cb367-10" aria-hidden="true" tabindex="-1"></a><span class="ex">USE</span> ecommerce_db<span class="kw">;</span></span>
<span id="cb367-11"><a href="#cb367-11" aria-hidden="true" tabindex="-1"></a><span class="ex">DESCRIBE</span> Product<span class="kw">;</span>  <span class="co"># Check if column exists</span></span></code></pre></div>
<h3 id="error-type-error-di-typescript">13.3 Error: “Type error” di
TypeScript</h3>
<p><strong>Error:</strong></p>
<pre><code>Property &#39;discount&#39; does not exist on type &#39;Product&#39;</code></pre>
<p><strong>Solusi:</strong></p>
<div class="sourceCode" id="cb369"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb369-1"><a href="#cb369-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Generate ulang</span></span>
<span id="cb369-2"><a href="#cb369-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> prisma generate</span>
<span id="cb369-3"><a href="#cb369-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb369-4"><a href="#cb369-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Restart TS Server (VSCode)</span></span>
<span id="cb369-5"><a href="#cb369-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Ctrl+Shift+P → &quot;TypeScript: Restart TS Server&quot;</span></span>
<span id="cb369-6"><a href="#cb369-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb369-7"><a href="#cb369-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Restart dev server</span></span>
<span id="cb369-8"><a href="#cb369-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Ctrl+C</span></span>
<span id="cb369-9"><a href="#cb369-9" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> run dev</span></code></pre></div>
<h3 id="error-zod-validation-failed">13.4 Error: “Zod validation
failed”</h3>
<p><strong>Error:</strong></p>
<pre><code>ZodError: [
  {
    &quot;code&quot;: &quot;too_big&quot;,
    &quot;maximum&quot;: 100,
    &quot;path&quot;: [&quot;discount&quot;],
    &quot;message&quot;: &quot;Discount maksimal 100%&quot;
  }
]</code></pre>
<p><strong>Penyebab:</strong> Input melebihi validasi (misalnya discount
150%).</p>
<p><strong>Solusi:</strong> Fix input value atau adjust validasi
range.</p>
<hr />
<h2 id="quick-reference">📋 Quick Reference</h2>
<h3 id="syntax-cheat-sheet">Syntax Cheat Sheet</h3>
<pre class="prisma"><code>// Prisma Schema Field Syntax
fieldName  Type       Modifier  Attribute    Default

discount   Float      ?         @default(0)  @db.Decimal(5,2)
│          │          │         │            │
│          │          │         │            └─ Database-specific type
│          │          │         └─ Default value
│          │          └─ Optional (nullable)
│          └─ Data type
└─ Field name (camelCase)</code></pre>
<h3 id="common-field-patterns">Common Field Patterns</h3>
<pre class="prisma"><code>// String fields
name       String                    // Required varchar
slug       String      @unique       // Unique identifier
bio        String?     @db.Text      // Optional long text

// Number fields
price      Int         @default(0)   // Integer with default
rating     Float       @default(0.0) // Decimal
quantity   Int         @default(1)   // Stock count

// Boolean
isActive   Boolean     @default(true)
featured   Boolean     @default(false)

// DateTime
createdAt  DateTime    @default(now())
updatedAt  DateTime    @updatedAt

// Relations
userId     String                    // Foreign key
user       User        @relation(fields: [userId], references: [id])</code></pre>
<hr />
<h2 id="referensi-3">📚 Referensi</h2>
<h3 id="external-links">External Links</h3>
<ul>
<li><a
href="https://www.prisma.io/docs/reference/api-reference/prisma-schema-reference">Prisma
Schema Reference</a></li>
<li><a href="https://www.prisma.io/docs/guides/migrate">Prisma Migrate
Guide</a></li>
<li><a href="https://zod.dev/">Zod Documentation</a></li>
</ul>
<hr />
<h1 id="api-routes-data-flow---dokumentasi-lengkap">🌐 API ROUTES &amp;
DATA FLOW - DOKUMENTASI LENGKAP</h1>
<p><strong>Dokumentasi API Endpoints, Request/Response Format, dan Alur
Data</strong></p>
<hr />
<h2 id="daftar-isi-7">📑 Daftar Isi</h2>
<ol type="1">
<li><a href="#1-overview-api-architecture">Overview API
Architecture</a></li>
<li><a href="#2-api-endpoints-list">API Endpoints List</a></li>
<li><a href="#3-authentication-api">Authentication API</a></li>
<li><a href="#4-register-api">Register API</a></li>
<li><a href="#5-feedback-api">Feedback API</a></li>
<li><a href="#6-data-flow-diagram">Data Flow Diagram</a></li>
<li><a href="#7-requestresponse-patterns">Request/Response
Patterns</a></li>
<li><a href="#8-error-handling">Error Handling</a></li>
<li><a href="#9-security--rate-limiting">Security &amp; Rate
Limiting</a></li>
<li><a href="#10-testing-api">Testing API</a></li>
<li><a href="#11-best-practices">Best Practices</a></li>
</ol>
<hr />
<h2 id="overview-api-architecture">1. Overview API Architecture</h2>
<h3 id="next.js-app-router-api">1.1 Next.js App Router API</h3>
<p>Project ini menggunakan <strong>Next.js 15 App Router</strong> dengan
API Routes di folder <code>app/api/</code>.</p>
<pre><code>app/api/
├── auth/
│   └── [...nextauth]/
│       └── route.ts         # NextAuth endpoints
├── register/
│   └── route.ts            # User registration
└── feedback/
    ├── route.ts            # GET, POST feedback
    └── [id]/
        └── route.ts        # PUT, DELETE feedback by ID</code></pre>
<h3 id="http-methods-support">1.2 HTTP Methods Support</h3>
<table>
<thead>
<tr>
<th>Method</th>
<th>Purpose</th>
<th>Auth Required</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>GET</code></td>
<td>Read data</td>
<td>Optional</td>
<td>Get products list</td>
</tr>
<tr>
<td><code>POST</code></td>
<td>Create new data</td>
<td>Yes</td>
<td>Create feedback</td>
</tr>
<tr>
<td><code>PUT</code></td>
<td>Update existing data</td>
<td>Yes</td>
<td>Update feedback</td>
</tr>
<tr>
<td><code>DELETE</code></td>
<td>Delete data</td>
<td>Yes</td>
<td>Delete feedback</td>
</tr>
<tr>
<td><code>PATCH</code></td>
<td>Partial update</td>
<td>Yes</td>
<td>Update user profile</td>
</tr>
</tbody>
</table>
<h3 id="base-url">1.3 Base URL</h3>
<pre><code>Development:  http://localhost:3000/api
Production:   https://yourdomain.com/api</code></pre>
<hr />
<h2 id="api-endpoints-list">2. API Endpoints List</h2>
<h3 id="complete-endpoints">2.1 Complete Endpoints</h3>
<table>
<colgroup>
<col style="width: 27%" />
<col style="width: 21%" />
<col style="width: 16%" />
<col style="width: 35%" />
</colgroup>
<thead>
<tr>
<th>Endpoint</th>
<th>Method</th>
<th>Auth</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/api/auth/[...nextauth]</code></td>
<td>GET/POST</td>
<td>No</td>
<td>NextAuth authentication</td>
</tr>
<tr>
<td><code>/api/register</code></td>
<td>POST</td>
<td>No</td>
<td>User registration</td>
</tr>
<tr>
<td><code>/api/feedback</code></td>
<td>GET</td>
<td>Optional</td>
<td>Get feedback (by productId or all for admin)</td>
</tr>
<tr>
<td><code>/api/feedback</code></td>
<td>POST</td>
<td>Yes</td>
<td>Create feedback</td>
</tr>
<tr>
<td><code>/api/feedback/[id]</code></td>
<td>PUT</td>
<td>Yes</td>
<td>Update feedback</td>
</tr>
<tr>
<td><code>/api/feedback/[id]</code></td>
<td>DELETE</td>
<td>Yes</td>
<td>Delete feedback</td>
</tr>
</tbody>
</table>
<h3 id="plannedfuture-endpoints">2.2 Planned/Future Endpoints</h3>
<pre><code>/api/products              GET, POST
/api/products/[id]         GET, PUT, DELETE
/api/categories            GET, POST
/api/categories/[id]       GET, PUT, DELETE
/api/orders                GET, POST
/api/orders/[id]           GET, PUT
/api/wishlist              GET, POST
/api/wishlist/[id]         DELETE
/api/users                 GET (admin only)
/api/users/[id]            GET, PUT, DELETE</code></pre>
<hr />
<h2 id="authentication-api">3. Authentication API</h2>
<h3 id="endpoint-post-apiauthsignin">3.1 Endpoint: POST
/api/auth/signin</h3>
<p><strong>Purpose:</strong> Login dengan credentials (email +
password)</p>
<p><strong>📁 File:</strong>
<code>app/api/auth/[...nextauth]/route.ts</code></p>
<h4 id="request">Request</h4>
<pre class="http"><code>POST /api/auth/signin
Content-Type: application/json

{
  &quot;email&quot;: &quot;user@example.com&quot;,
  &quot;password&quot;: &quot;Password123!&quot;
}</code></pre>
<h4 id="response-success">Response (Success)</h4>
<div class="sourceCode" id="cb377"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb377-1"><a href="#cb377-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb377-2"><a href="#cb377-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;user&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb377-3"><a href="#cb377-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;uuid-here&quot;</span><span class="fu">,</span></span>
<span id="cb377-4"><a href="#cb377-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;email&quot;</span><span class="fu">:</span> <span class="st">&quot;user@example.com&quot;</span><span class="fu">,</span></span>
<span id="cb377-5"><a href="#cb377-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;role&quot;</span><span class="fu">:</span> <span class="st">&quot;user&quot;</span></span>
<span id="cb377-6"><a href="#cb377-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb377-7"><a href="#cb377-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;expires&quot;</span><span class="fu">:</span> <span class="st">&quot;2024-03-15T12:30:00.000Z&quot;</span></span>
<span id="cb377-8"><a href="#cb377-8" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h4 id="response-error">Response (Error)</h4>
<div class="sourceCode" id="cb378"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb378-1"><a href="#cb378-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb378-2"><a href="#cb378-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;error&quot;</span><span class="fu">:</span> <span class="st">&quot;Invalid credentials&quot;</span></span>
<span id="cb378-3"><a href="#cb378-3" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h4 id="status-codes">Status Codes</h4>
<ul>
<li><code>200 OK</code> - Login berhasil</li>
<li><code>401 Unauthorized</code> - Email/password salah</li>
<li><code>500 Internal Server Error</code> - Server error</li>
</ul>
<h3 id="endpoint-post-apiauthsignout">3.2 Endpoint: POST
/api/auth/signout</h3>
<p><strong>Purpose:</strong> Logout user</p>
<h4 id="request-1">Request</h4>
<pre class="http"><code>POST /api/auth/signout</code></pre>
<h4 id="response">Response</h4>
<div class="sourceCode" id="cb380"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb380-1"><a href="#cb380-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb380-2"><a href="#cb380-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;url&quot;</span><span class="fu">:</span> <span class="st">&quot;/&quot;</span></span>
<span id="cb380-3"><a href="#cb380-3" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h3 id="endpoint-get-apiauthsession">3.3 Endpoint: GET
/api/auth/session</h3>
<p><strong>Purpose:</strong> Get current session</p>
<h4 id="request-2">Request</h4>
<pre class="http"><code>GET /api/auth/session
Cookie: next-auth.session-token=...</code></pre>
<h4 id="response-logged-in">Response (Logged In)</h4>
<div class="sourceCode" id="cb382"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb382-1"><a href="#cb382-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb382-2"><a href="#cb382-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;user&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb382-3"><a href="#cb382-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;uuid-here&quot;</span><span class="fu">,</span></span>
<span id="cb382-4"><a href="#cb382-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;email&quot;</span><span class="fu">:</span> <span class="st">&quot;user@example.com&quot;</span><span class="fu">,</span></span>
<span id="cb382-5"><a href="#cb382-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;role&quot;</span><span class="fu">:</span> <span class="st">&quot;user&quot;</span></span>
<span id="cb382-6"><a href="#cb382-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb382-7"><a href="#cb382-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;expires&quot;</span><span class="fu">:</span> <span class="st">&quot;2024-03-15T12:30:00.000Z&quot;</span></span>
<span id="cb382-8"><a href="#cb382-8" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h4 id="response-not-logged-in">Response (Not Logged In)</h4>
<div class="sourceCode" id="cb383"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb383-1"><a href="#cb383-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{}</span></span></code></pre></div>
<hr />
<h2 id="register-api">4. Register API</h2>
<h3 id="endpoint-post-apiregister">4.1 Endpoint: POST /api/register</h3>
<p><strong>Purpose:</strong> Register user baru</p>
<p><strong>📁 File:</strong> <code>app/api/register/route.ts</code></p>
<h4 id="request-3">Request</h4>
<pre class="http"><code>POST /api/register
Content-Type: application/json

{
  &quot;email&quot;: &quot;newuser@example.com&quot;,
  &quot;password&quot;: &quot;SecurePass123!&quot;
}</code></pre>
<h4 id="request-body-schema">Request Body Schema</h4>
<div class="sourceCode" id="cb385"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb385-1"><a href="#cb385-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb385-2"><a href="#cb385-2" aria-hidden="true" tabindex="-1"></a>  email<span class="op">:</span> <span class="dt">string</span><span class="op">,</span>      <span class="co">// Required, valid email format</span></span>
<span id="cb385-3"><a href="#cb385-3" aria-hidden="true" tabindex="-1"></a>  password<span class="op">:</span> <span class="dt">string</span>    <span class="co">// Required, min 8 chars, must contain uppercase, lowercase, number</span></span>
<span id="cb385-4"><a href="#cb385-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h4 id="response-success---201">Response (Success - 201)</h4>
<div class="sourceCode" id="cb386"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb386-1"><a href="#cb386-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb386-2"><a href="#cb386-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;message&quot;</span><span class="fu">:</span> <span class="st">&quot;User created successfully&quot;</span><span class="fu">,</span></span>
<span id="cb386-3"><a href="#cb386-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;user&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb386-4"><a href="#cb386-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;uuid-generated&quot;</span><span class="fu">,</span></span>
<span id="cb386-5"><a href="#cb386-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;email&quot;</span><span class="fu">:</span> <span class="st">&quot;newuser@example.com&quot;</span><span class="fu">,</span></span>
<span id="cb386-6"><a href="#cb386-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;role&quot;</span><span class="fu">:</span> <span class="st">&quot;user&quot;</span></span>
<span id="cb386-7"><a href="#cb386-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb386-8"><a href="#cb386-8" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h4 id="response-error---400">Response (Error - 400)</h4>
<div class="sourceCode" id="cb387"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb387-1"><a href="#cb387-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb387-2"><a href="#cb387-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;error&quot;</span><span class="fu">:</span> <span class="st">&quot;Email already exists&quot;</span></span>
<span id="cb387-3"><a href="#cb387-3" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<div class="sourceCode" id="cb388"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb388-1"><a href="#cb388-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb388-2"><a href="#cb388-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;error&quot;</span><span class="fu">:</span> <span class="st">&quot;Password must be at least 8 characters&quot;</span></span>
<span id="cb388-3"><a href="#cb388-3" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h4 id="response-error---500">Response (Error - 500)</h4>
<div class="sourceCode" id="cb389"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb389-1"><a href="#cb389-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb389-2"><a href="#cb389-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;error&quot;</span><span class="fu">:</span> <span class="st">&quot;Internal server error&quot;</span></span>
<span id="cb389-3"><a href="#cb389-3" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h4 id="status-codes-1">Status Codes</h4>
<ul>
<li><code>201 Created</code> - User berhasil dibuat</li>
<li><code>400 Bad Request</code> - Validation error</li>
<li><code>409 Conflict</code> - Email sudah terdaftar</li>
<li><code>500 Internal Server Error</code> - Server error</li>
</ul>
<h4 id="implementation-example">Implementation Example</h4>
<div class="sourceCode" id="cb390"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb390-1"><a href="#cb390-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { NextRequest<span class="op">,</span> NextResponse } <span class="im">from</span> <span class="st">&quot;next/server&quot;</span><span class="op">;</span></span>
<span id="cb390-2"><a href="#cb390-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> prisma <span class="im">from</span> <span class="st">&quot;@/utils/db&quot;</span><span class="op">;</span></span>
<span id="cb390-3"><a href="#cb390-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> bcrypt <span class="im">from</span> <span class="st">&quot;bcryptjs&quot;</span><span class="op">;</span></span>
<span id="cb390-4"><a href="#cb390-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { nanoid } <span class="im">from</span> <span class="st">&quot;nanoid&quot;</span><span class="op">;</span></span>
<span id="cb390-5"><a href="#cb390-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { z } <span class="im">from</span> <span class="st">&quot;zod&quot;</span><span class="op">;</span></span>
<span id="cb390-6"><a href="#cb390-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb390-7"><a href="#cb390-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Validation schema</span></span>
<span id="cb390-8"><a href="#cb390-8" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> registerSchema <span class="op">=</span> z<span class="op">.</span><span class="fu">object</span>({</span>
<span id="cb390-9"><a href="#cb390-9" aria-hidden="true" tabindex="-1"></a>  email<span class="op">:</span> z<span class="op">.</span><span class="fu">string</span>()<span class="op">.</span><span class="fu">email</span>(<span class="st">&quot;Invalid email format&quot;</span>)<span class="op">,</span></span>
<span id="cb390-10"><a href="#cb390-10" aria-hidden="true" tabindex="-1"></a>  password<span class="op">:</span> z<span class="op">.</span><span class="fu">string</span>()</span>
<span id="cb390-11"><a href="#cb390-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">min</span>(<span class="dv">8</span><span class="op">,</span> <span class="st">&quot;Password min 8 characters&quot;</span>)</span>
<span id="cb390-12"><a href="#cb390-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">regex</span>(<span class="ss">/</span><span class="sc">[A-Z]</span><span class="ss">/</span><span class="op">,</span> <span class="st">&quot;Password harus ada huruf besar&quot;</span>)</span>
<span id="cb390-13"><a href="#cb390-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">regex</span>(<span class="ss">/</span><span class="sc">[a-z]</span><span class="ss">/</span><span class="op">,</span> <span class="st">&quot;Password harus ada huruf kecil&quot;</span>)</span>
<span id="cb390-14"><a href="#cb390-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">regex</span>(<span class="ss">/</span><span class="sc">[0-9]</span><span class="ss">/</span><span class="op">,</span> <span class="st">&quot;Password harus ada angka&quot;</span>)</span>
<span id="cb390-15"><a href="#cb390-15" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb390-16"><a href="#cb390-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb390-17"><a href="#cb390-17" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">async</span> <span class="kw">function</span> <span class="fu">POST</span>(request<span class="op">:</span> NextRequest) {</span>
<span id="cb390-18"><a href="#cb390-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span> {</span>
<span id="cb390-19"><a href="#cb390-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> body <span class="op">=</span> <span class="cf">await</span> request<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb390-20"><a href="#cb390-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb390-21"><a href="#cb390-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Validasi input</span></span>
<span id="cb390-22"><a href="#cb390-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> validated <span class="op">=</span> registerSchema<span class="op">.</span><span class="fu">parse</span>(body)<span class="op">;</span></span>
<span id="cb390-23"><a href="#cb390-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb390-24"><a href="#cb390-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Check existing user</span></span>
<span id="cb390-25"><a href="#cb390-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> existingUser <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">user</span><span class="op">.</span><span class="fu">findUnique</span>({</span>
<span id="cb390-26"><a href="#cb390-26" aria-hidden="true" tabindex="-1"></a>      where<span class="op">:</span> { email<span class="op">:</span> validated<span class="op">.</span><span class="at">email</span> }</span>
<span id="cb390-27"><a href="#cb390-27" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb390-28"><a href="#cb390-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb390-29"><a href="#cb390-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (existingUser) {</span>
<span id="cb390-30"><a href="#cb390-30" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">json</span>(</span>
<span id="cb390-31"><a href="#cb390-31" aria-hidden="true" tabindex="-1"></a>        { error<span class="op">:</span> <span class="st">&quot;Email already exists&quot;</span> }<span class="op">,</span></span>
<span id="cb390-32"><a href="#cb390-32" aria-hidden="true" tabindex="-1"></a>        { status<span class="op">:</span> <span class="dv">409</span> }</span>
<span id="cb390-33"><a href="#cb390-33" aria-hidden="true" tabindex="-1"></a>      )<span class="op">;</span></span>
<span id="cb390-34"><a href="#cb390-34" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb390-35"><a href="#cb390-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb390-36"><a href="#cb390-36" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Hash password</span></span>
<span id="cb390-37"><a href="#cb390-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> hashedPassword <span class="op">=</span> <span class="cf">await</span> bcrypt<span class="op">.</span><span class="fu">hash</span>(validated<span class="op">.</span><span class="at">password</span><span class="op">,</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb390-38"><a href="#cb390-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb390-39"><a href="#cb390-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create user</span></span>
<span id="cb390-40"><a href="#cb390-40" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> user <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">user</span><span class="op">.</span><span class="fu">create</span>({</span>
<span id="cb390-41"><a href="#cb390-41" aria-hidden="true" tabindex="-1"></a>      data<span class="op">:</span> {</span>
<span id="cb390-42"><a href="#cb390-42" aria-hidden="true" tabindex="-1"></a>        id<span class="op">:</span> <span class="fu">nanoid</span>()<span class="op">,</span></span>
<span id="cb390-43"><a href="#cb390-43" aria-hidden="true" tabindex="-1"></a>        email<span class="op">:</span> validated<span class="op">.</span><span class="at">email</span><span class="op">,</span></span>
<span id="cb390-44"><a href="#cb390-44" aria-hidden="true" tabindex="-1"></a>        password<span class="op">:</span> hashedPassword<span class="op">,</span></span>
<span id="cb390-45"><a href="#cb390-45" aria-hidden="true" tabindex="-1"></a>        role<span class="op">:</span> <span class="st">&quot;user&quot;</span></span>
<span id="cb390-46"><a href="#cb390-46" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb390-47"><a href="#cb390-47" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb390-48"><a href="#cb390-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb390-49"><a href="#cb390-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">json</span>(</span>
<span id="cb390-50"><a href="#cb390-50" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb390-51"><a href="#cb390-51" aria-hidden="true" tabindex="-1"></a>        message<span class="op">:</span> <span class="st">&quot;User created successfully&quot;</span><span class="op">,</span></span>
<span id="cb390-52"><a href="#cb390-52" aria-hidden="true" tabindex="-1"></a>        user<span class="op">:</span> {</span>
<span id="cb390-53"><a href="#cb390-53" aria-hidden="true" tabindex="-1"></a>          id<span class="op">:</span> user<span class="op">.</span><span class="at">id</span><span class="op">,</span></span>
<span id="cb390-54"><a href="#cb390-54" aria-hidden="true" tabindex="-1"></a>          email<span class="op">:</span> user<span class="op">.</span><span class="at">email</span><span class="op">,</span></span>
<span id="cb390-55"><a href="#cb390-55" aria-hidden="true" tabindex="-1"></a>          role<span class="op">:</span> user<span class="op">.</span><span class="at">role</span></span>
<span id="cb390-56"><a href="#cb390-56" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb390-57"><a href="#cb390-57" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb390-58"><a href="#cb390-58" aria-hidden="true" tabindex="-1"></a>      { status<span class="op">:</span> <span class="dv">201</span> }</span>
<span id="cb390-59"><a href="#cb390-59" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb390-60"><a href="#cb390-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb390-61"><a href="#cb390-61" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">catch</span> (error) {</span>
<span id="cb390-62"><a href="#cb390-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (error <span class="kw">instanceof</span> z<span class="op">.</span><span class="at">ZodError</span>) {</span>
<span id="cb390-63"><a href="#cb390-63" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">json</span>(</span>
<span id="cb390-64"><a href="#cb390-64" aria-hidden="true" tabindex="-1"></a>        { error<span class="op">:</span> error<span class="op">.</span><span class="at">errors</span>[<span class="dv">0</span>]<span class="op">.</span><span class="at">message</span> }<span class="op">,</span></span>
<span id="cb390-65"><a href="#cb390-65" aria-hidden="true" tabindex="-1"></a>        { status<span class="op">:</span> <span class="dv">400</span> }</span>
<span id="cb390-66"><a href="#cb390-66" aria-hidden="true" tabindex="-1"></a>      )<span class="op">;</span></span>
<span id="cb390-67"><a href="#cb390-67" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb390-68"><a href="#cb390-68" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb390-69"><a href="#cb390-69" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">error</span>(<span class="st">&quot;Registration error:&quot;</span><span class="op">,</span> error)<span class="op">;</span></span>
<span id="cb390-70"><a href="#cb390-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">json</span>(</span>
<span id="cb390-71"><a href="#cb390-71" aria-hidden="true" tabindex="-1"></a>      { error<span class="op">:</span> <span class="st">&quot;Internal server error&quot;</span> }<span class="op">,</span></span>
<span id="cb390-72"><a href="#cb390-72" aria-hidden="true" tabindex="-1"></a>      { status<span class="op">:</span> <span class="dv">500</span> }</span>
<span id="cb390-73"><a href="#cb390-73" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb390-74"><a href="#cb390-74" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb390-75"><a href="#cb390-75" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<hr />
<h2 id="feedback-api">5. Feedback API</h2>
<h3 id="endpoint-get-apifeedback">5.1 Endpoint: GET /api/feedback</h3>
<p><strong>Purpose:</strong> Get feedback list</p>
<p><strong>📁 File:</strong> <code>app/api/feedback/route.ts</code></p>
<h4 id="scenario-1-get-feedback-by-product-id">Scenario 1: Get Feedback
by Product ID</h4>
<p><strong>Request:</strong></p>
<pre class="http"><code>GET /api/feedback?productId=uuid-product-123</code></pre>
<p><strong>Response (200):</strong></p>
<div class="sourceCode" id="cb392"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb392-1"><a href="#cb392-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb392-2"><a href="#cb392-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;feedbacks&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb392-3"><a href="#cb392-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span></span>
<span id="cb392-4"><a href="#cb392-4" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;feedback-uuid-1&quot;</span><span class="fu">,</span></span>
<span id="cb392-5"><a href="#cb392-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;productId&quot;</span><span class="fu">:</span> <span class="st">&quot;uuid-product-123&quot;</span><span class="fu">,</span></span>
<span id="cb392-6"><a href="#cb392-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;userId&quot;</span><span class="fu">:</span> <span class="st">&quot;user-uuid-1&quot;</span><span class="fu">,</span></span>
<span id="cb392-7"><a href="#cb392-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;comment&quot;</span><span class="fu">:</span> <span class="st">&quot;Great product!&quot;</span><span class="fu">,</span></span>
<span id="cb392-8"><a href="#cb392-8" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;rating&quot;</span><span class="fu">:</span> <span class="dv">5</span><span class="fu">,</span></span>
<span id="cb392-9"><a href="#cb392-9" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;createdAt&quot;</span><span class="fu">:</span> <span class="st">&quot;2024-03-15T10:00:00.000Z&quot;</span><span class="fu">,</span></span>
<span id="cb392-10"><a href="#cb392-10" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;updatedAt&quot;</span><span class="fu">:</span> <span class="st">&quot;2024-03-15T10:00:00.000Z&quot;</span><span class="fu">,</span></span>
<span id="cb392-11"><a href="#cb392-11" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;user&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb392-12"><a href="#cb392-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;user-uuid-1&quot;</span><span class="fu">,</span></span>
<span id="cb392-13"><a href="#cb392-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;email&quot;</span><span class="fu">:</span> <span class="st">&quot;customer@example.com&quot;</span></span>
<span id="cb392-14"><a href="#cb392-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">},</span></span>
<span id="cb392-15"><a href="#cb392-15" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;product&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb392-16"><a href="#cb392-16" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;uuid-product-123&quot;</span><span class="fu">,</span></span>
<span id="cb392-17"><a href="#cb392-17" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;title&quot;</span><span class="fu">:</span> <span class="st">&quot;Laptop ASUS ROG&quot;</span></span>
<span id="cb392-18"><a href="#cb392-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb392-19"><a href="#cb392-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb392-20"><a href="#cb392-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span></span>
<span id="cb392-21"><a href="#cb392-21" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;feedback-uuid-2&quot;</span><span class="fu">,</span></span>
<span id="cb392-22"><a href="#cb392-22" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;productId&quot;</span><span class="fu">:</span> <span class="st">&quot;uuid-product-123&quot;</span><span class="fu">,</span></span>
<span id="cb392-23"><a href="#cb392-23" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;userId&quot;</span><span class="fu">:</span> <span class="st">&quot;user-uuid-2&quot;</span><span class="fu">,</span></span>
<span id="cb392-24"><a href="#cb392-24" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;comment&quot;</span><span class="fu">:</span> <span class="st">&quot;Good quality, fast delivery&quot;</span><span class="fu">,</span></span>
<span id="cb392-25"><a href="#cb392-25" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;rating&quot;</span><span class="fu">:</span> <span class="dv">4</span><span class="fu">,</span></span>
<span id="cb392-26"><a href="#cb392-26" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;createdAt&quot;</span><span class="fu">:</span> <span class="st">&quot;2024-03-14T15:30:00.000Z&quot;</span><span class="fu">,</span></span>
<span id="cb392-27"><a href="#cb392-27" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;updatedAt&quot;</span><span class="fu">:</span> <span class="st">&quot;2024-03-14T15:30:00.000Z&quot;</span><span class="fu">,</span></span>
<span id="cb392-28"><a href="#cb392-28" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;user&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb392-29"><a href="#cb392-29" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;user-uuid-2&quot;</span><span class="fu">,</span></span>
<span id="cb392-30"><a href="#cb392-30" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;email&quot;</span><span class="fu">:</span> <span class="st">&quot;buyer@example.com&quot;</span></span>
<span id="cb392-31"><a href="#cb392-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">},</span></span>
<span id="cb392-32"><a href="#cb392-32" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;product&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb392-33"><a href="#cb392-33" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;uuid-product-123&quot;</span><span class="fu">,</span></span>
<span id="cb392-34"><a href="#cb392-34" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;title&quot;</span><span class="fu">:</span> <span class="st">&quot;Laptop ASUS ROG&quot;</span></span>
<span id="cb392-35"><a href="#cb392-35" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb392-36"><a href="#cb392-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb392-37"><a href="#cb392-37" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span></span>
<span id="cb392-38"><a href="#cb392-38" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h4 id="scenario-2-get-all-feedback-admin-only">Scenario 2: Get All
Feedback (Admin Only)</h4>
<p><strong>Request:</strong></p>
<pre class="http"><code>GET /api/feedback
Authorization: Bearer &lt;session-token&gt;</code></pre>
<p><strong>Headers:</strong></p>
<pre><code>Cookie: next-auth.session-token=...</code></pre>
<p><strong>Response (200):</strong></p>
<div class="sourceCode" id="cb395"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb395-1"><a href="#cb395-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb395-2"><a href="#cb395-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;feedbacks&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb395-3"><a href="#cb395-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span></span>
<span id="cb395-4"><a href="#cb395-4" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;feedback-uuid-1&quot;</span><span class="fu">,</span></span>
<span id="cb395-5"><a href="#cb395-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;productId&quot;</span><span class="fu">:</span> <span class="st">&quot;product-1&quot;</span><span class="fu">,</span></span>
<span id="cb395-6"><a href="#cb395-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;userId&quot;</span><span class="fu">:</span> <span class="st">&quot;user-1&quot;</span><span class="fu">,</span></span>
<span id="cb395-7"><a href="#cb395-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;comment&quot;</span><span class="fu">:</span> <span class="st">&quot;Excellent!&quot;</span><span class="fu">,</span></span>
<span id="cb395-8"><a href="#cb395-8" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;rating&quot;</span><span class="fu">:</span> <span class="dv">5</span><span class="fu">,</span></span>
<span id="cb395-9"><a href="#cb395-9" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;createdAt&quot;</span><span class="fu">:</span> <span class="st">&quot;2024-03-15T10:00:00.000Z&quot;</span><span class="fu">,</span></span>
<span id="cb395-10"><a href="#cb395-10" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;user&quot;</span><span class="fu">:</span> <span class="fu">{</span> <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;user-1&quot;</span><span class="fu">,</span> <span class="dt">&quot;email&quot;</span><span class="fu">:</span> <span class="st">&quot;user1@example.com&quot;</span> <span class="fu">},</span></span>
<span id="cb395-11"><a href="#cb395-11" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;product&quot;</span><span class="fu">:</span> <span class="fu">{</span> <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;product-1&quot;</span><span class="fu">,</span> <span class="dt">&quot;title&quot;</span><span class="fu">:</span> <span class="st">&quot;Product A&quot;</span> <span class="fu">}</span></span>
<span id="cb395-12"><a href="#cb395-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb395-13"><a href="#cb395-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span></span>
<span id="cb395-14"><a href="#cb395-14" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;feedback-uuid-2&quot;</span><span class="fu">,</span></span>
<span id="cb395-15"><a href="#cb395-15" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;productId&quot;</span><span class="fu">:</span> <span class="st">&quot;product-2&quot;</span><span class="fu">,</span></span>
<span id="cb395-16"><a href="#cb395-16" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;userId&quot;</span><span class="fu">:</span> <span class="st">&quot;user-2&quot;</span><span class="fu">,</span></span>
<span id="cb395-17"><a href="#cb395-17" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;comment&quot;</span><span class="fu">:</span> <span class="st">&quot;Good value&quot;</span><span class="fu">,</span></span>
<span id="cb395-18"><a href="#cb395-18" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;rating&quot;</span><span class="fu">:</span> <span class="dv">4</span><span class="fu">,</span></span>
<span id="cb395-19"><a href="#cb395-19" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;createdAt&quot;</span><span class="fu">:</span> <span class="st">&quot;2024-03-14T12:00:00.000Z&quot;</span><span class="fu">,</span></span>
<span id="cb395-20"><a href="#cb395-20" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;user&quot;</span><span class="fu">:</span> <span class="fu">{</span> <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;user-2&quot;</span><span class="fu">,</span> <span class="dt">&quot;email&quot;</span><span class="fu">:</span> <span class="st">&quot;user2@example.com&quot;</span> <span class="fu">},</span></span>
<span id="cb395-21"><a href="#cb395-21" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;product&quot;</span><span class="fu">:</span> <span class="fu">{</span> <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;product-2&quot;</span><span class="fu">,</span> <span class="dt">&quot;title&quot;</span><span class="fu">:</span> <span class="st">&quot;Product B&quot;</span> <span class="fu">}</span></span>
<span id="cb395-22"><a href="#cb395-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb395-23"><a href="#cb395-23" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span></span>
<span id="cb395-24"><a href="#cb395-24" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p><strong>Response (401 - Unauthorized):</strong></p>
<div class="sourceCode" id="cb396"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb396-1"><a href="#cb396-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb396-2"><a href="#cb396-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;error&quot;</span><span class="fu">:</span> <span class="st">&quot;Unauthorized or missing productId parameter&quot;</span></span>
<span id="cb396-3"><a href="#cb396-3" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h3 id="endpoint-post-apifeedback">5.2 Endpoint: POST /api/feedback</h3>
<p><strong>Purpose:</strong> Create new feedback (user only, not
admin)</p>
<h4 id="request-4">Request</h4>
<pre class="http"><code>POST /api/feedback
Content-Type: application/json
Cookie: next-auth.session-token=...

{
  &quot;productId&quot;: &quot;uuid-product-123&quot;,
  &quot;comment&quot;: &quot;Amazing product, highly recommended!&quot;,
  &quot;rating&quot;: 5
}</code></pre>
<h4 id="request-body-schema-1">Request Body Schema</h4>
<div class="sourceCode" id="cb398"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb398-1"><a href="#cb398-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb398-2"><a href="#cb398-2" aria-hidden="true" tabindex="-1"></a>  productId<span class="op">:</span> <span class="dt">string</span><span class="op">,</span>  <span class="co">// Required, UUID</span></span>
<span id="cb398-3"><a href="#cb398-3" aria-hidden="true" tabindex="-1"></a>  comment<span class="op">:</span> <span class="dt">string</span><span class="op">,</span>    <span class="co">// Required, min 10 chars</span></span>
<span id="cb398-4"><a href="#cb398-4" aria-hidden="true" tabindex="-1"></a>  rating<span class="op">:</span> <span class="dt">number</span>      <span class="co">// Required, 1-5</span></span>
<span id="cb398-5"><a href="#cb398-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h4 id="response-201---created">Response (201 - Created)</h4>
<div class="sourceCode" id="cb399"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb399-1"><a href="#cb399-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb399-2"><a href="#cb399-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;message&quot;</span><span class="fu">:</span> <span class="st">&quot;Feedback created successfully&quot;</span><span class="fu">,</span></span>
<span id="cb399-3"><a href="#cb399-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;feedback&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb399-4"><a href="#cb399-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;feedback-uuid-new&quot;</span><span class="fu">,</span></span>
<span id="cb399-5"><a href="#cb399-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;productId&quot;</span><span class="fu">:</span> <span class="st">&quot;uuid-product-123&quot;</span><span class="fu">,</span></span>
<span id="cb399-6"><a href="#cb399-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;userId&quot;</span><span class="fu">:</span> <span class="st">&quot;user-uuid-current&quot;</span><span class="fu">,</span></span>
<span id="cb399-7"><a href="#cb399-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;comment&quot;</span><span class="fu">:</span> <span class="st">&quot;Amazing product, highly recommended!&quot;</span><span class="fu">,</span></span>
<span id="cb399-8"><a href="#cb399-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;rating&quot;</span><span class="fu">:</span> <span class="dv">5</span><span class="fu">,</span></span>
<span id="cb399-9"><a href="#cb399-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;createdAt&quot;</span><span class="fu">:</span> <span class="st">&quot;2024-03-15T14:30:00.000Z&quot;</span><span class="fu">,</span></span>
<span id="cb399-10"><a href="#cb399-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;updatedAt&quot;</span><span class="fu">:</span> <span class="st">&quot;2024-03-15T14:30:00.000Z&quot;</span></span>
<span id="cb399-11"><a href="#cb399-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb399-12"><a href="#cb399-12" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h4 id="response-400---validation-error">Response (400 - Validation
Error)</h4>
<div class="sourceCode" id="cb400"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb400-1"><a href="#cb400-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb400-2"><a href="#cb400-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;error&quot;</span><span class="fu">:</span> <span class="st">&quot;Rating must be between 1 and 5&quot;</span></span>
<span id="cb400-3"><a href="#cb400-3" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h4 id="response-401---unauthorized">Response (401 - Unauthorized)</h4>
<div class="sourceCode" id="cb401"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb401-1"><a href="#cb401-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb401-2"><a href="#cb401-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;error&quot;</span><span class="fu">:</span> <span class="st">&quot;Unauthorized&quot;</span></span>
<span id="cb401-3"><a href="#cb401-3" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h4 id="response-403---admin-cannot-create-feedback">Response (403 -
Admin Cannot Create Feedback)</h4>
<div class="sourceCode" id="cb402"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb402-1"><a href="#cb402-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb402-2"><a href="#cb402-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;error&quot;</span><span class="fu">:</span> <span class="st">&quot;Admin cannot create feedback&quot;</span></span>
<span id="cb402-3"><a href="#cb402-3" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h4 id="response-409---duplicate-feedback">Response (409 - Duplicate
Feedback)</h4>
<div class="sourceCode" id="cb403"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb403-1"><a href="#cb403-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb403-2"><a href="#cb403-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;error&quot;</span><span class="fu">:</span> <span class="st">&quot;You have already given feedback for this product&quot;</span></span>
<span id="cb403-3"><a href="#cb403-3" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h4 id="implementation">Implementation</h4>
<div class="sourceCode" id="cb404"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb404-1"><a href="#cb404-1" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">async</span> <span class="kw">function</span> <span class="fu">POST</span>(request<span class="op">:</span> NextRequest) {</span>
<span id="cb404-2"><a href="#cb404-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span> {</span>
<span id="cb404-3"><a href="#cb404-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> session <span class="op">=</span> <span class="cf">await</span> <span class="fu">getServerSession</span>(authOptions)<span class="op">;</span></span>
<span id="cb404-4"><a href="#cb404-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb404-5"><a href="#cb404-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Check authentication</span></span>
<span id="cb404-6"><a href="#cb404-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>session <span class="op">||</span> <span class="op">!</span>(session <span class="im">as</span> <span class="dt">any</span>)<span class="op">?.</span><span class="at">user</span>) {</span>
<span id="cb404-7"><a href="#cb404-7" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">json</span>(</span>
<span id="cb404-8"><a href="#cb404-8" aria-hidden="true" tabindex="-1"></a>        { error<span class="op">:</span> <span class="st">&quot;Unauthorized&quot;</span> }<span class="op">,</span></span>
<span id="cb404-9"><a href="#cb404-9" aria-hidden="true" tabindex="-1"></a>        { status<span class="op">:</span> <span class="dv">401</span> }</span>
<span id="cb404-10"><a href="#cb404-10" aria-hidden="true" tabindex="-1"></a>      )<span class="op">;</span></span>
<span id="cb404-11"><a href="#cb404-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb404-12"><a href="#cb404-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb404-13"><a href="#cb404-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> user <span class="op">=</span> (session <span class="im">as</span> <span class="dt">any</span>)<span class="op">.</span><span class="at">user</span><span class="op">;</span></span>
<span id="cb404-14"><a href="#cb404-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb404-15"><a href="#cb404-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Admin tidak boleh buat feedback</span></span>
<span id="cb404-16"><a href="#cb404-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (user<span class="op">.</span><span class="at">role</span> <span class="op">===</span> <span class="st">&quot;admin&quot;</span>) {</span>
<span id="cb404-17"><a href="#cb404-17" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">json</span>(</span>
<span id="cb404-18"><a href="#cb404-18" aria-hidden="true" tabindex="-1"></a>        { error<span class="op">:</span> <span class="st">&quot;Admin cannot create feedback&quot;</span> }<span class="op">,</span></span>
<span id="cb404-19"><a href="#cb404-19" aria-hidden="true" tabindex="-1"></a>        { status<span class="op">:</span> <span class="dv">403</span> }</span>
<span id="cb404-20"><a href="#cb404-20" aria-hidden="true" tabindex="-1"></a>      )<span class="op">;</span></span>
<span id="cb404-21"><a href="#cb404-21" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb404-22"><a href="#cb404-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb404-23"><a href="#cb404-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> body <span class="op">=</span> <span class="cf">await</span> request<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb404-24"><a href="#cb404-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb404-25"><a href="#cb404-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Validasi</span></span>
<span id="cb404-26"><a href="#cb404-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> feedbackSchema <span class="op">=</span> z<span class="op">.</span><span class="fu">object</span>({</span>
<span id="cb404-27"><a href="#cb404-27" aria-hidden="true" tabindex="-1"></a>      productId<span class="op">:</span> z<span class="op">.</span><span class="fu">string</span>()<span class="op">.</span><span class="fu">uuid</span>()<span class="op">,</span></span>
<span id="cb404-28"><a href="#cb404-28" aria-hidden="true" tabindex="-1"></a>      comment<span class="op">:</span> z<span class="op">.</span><span class="fu">string</span>()<span class="op">.</span><span class="fu">min</span>(<span class="dv">10</span><span class="op">,</span> <span class="st">&quot;Comment min 10 characters&quot;</span>)<span class="op">,</span></span>
<span id="cb404-29"><a href="#cb404-29" aria-hidden="true" tabindex="-1"></a>      rating<span class="op">:</span> z<span class="op">.</span><span class="fu">number</span>()<span class="op">.</span><span class="fu">int</span>()<span class="op">.</span><span class="fu">min</span>(<span class="dv">1</span>)<span class="op">.</span><span class="fu">max</span>(<span class="dv">5</span>)</span>
<span id="cb404-30"><a href="#cb404-30" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb404-31"><a href="#cb404-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb404-32"><a href="#cb404-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> validated <span class="op">=</span> feedbackSchema<span class="op">.</span><span class="fu">parse</span>(body)<span class="op">;</span></span>
<span id="cb404-33"><a href="#cb404-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb404-34"><a href="#cb404-34" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Check duplicate feedback</span></span>
<span id="cb404-35"><a href="#cb404-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> existingFeedback <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">feedback</span><span class="op">.</span><span class="fu">findUnique</span>({</span>
<span id="cb404-36"><a href="#cb404-36" aria-hidden="true" tabindex="-1"></a>      where<span class="op">:</span> {</span>
<span id="cb404-37"><a href="#cb404-37" aria-hidden="true" tabindex="-1"></a>        productId_userId<span class="op">:</span> {</span>
<span id="cb404-38"><a href="#cb404-38" aria-hidden="true" tabindex="-1"></a>          productId<span class="op">:</span> validated<span class="op">.</span><span class="at">productId</span><span class="op">,</span></span>
<span id="cb404-39"><a href="#cb404-39" aria-hidden="true" tabindex="-1"></a>          userId<span class="op">:</span> user<span class="op">.</span><span class="at">id</span></span>
<span id="cb404-40"><a href="#cb404-40" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb404-41"><a href="#cb404-41" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb404-42"><a href="#cb404-42" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb404-43"><a href="#cb404-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb404-44"><a href="#cb404-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (existingFeedback) {</span>
<span id="cb404-45"><a href="#cb404-45" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">json</span>(</span>
<span id="cb404-46"><a href="#cb404-46" aria-hidden="true" tabindex="-1"></a>        { error<span class="op">:</span> <span class="st">&quot;You have already given feedback for this product&quot;</span> }<span class="op">,</span></span>
<span id="cb404-47"><a href="#cb404-47" aria-hidden="true" tabindex="-1"></a>        { status<span class="op">:</span> <span class="dv">409</span> }</span>
<span id="cb404-48"><a href="#cb404-48" aria-hidden="true" tabindex="-1"></a>      )<span class="op">;</span></span>
<span id="cb404-49"><a href="#cb404-49" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb404-50"><a href="#cb404-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb404-51"><a href="#cb404-51" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create feedback</span></span>
<span id="cb404-52"><a href="#cb404-52" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> feedback <span class="op">=</span> <span class="cf">await</span> prisma<span class="op">.</span><span class="at">feedback</span><span class="op">.</span><span class="fu">create</span>({</span>
<span id="cb404-53"><a href="#cb404-53" aria-hidden="true" tabindex="-1"></a>      data<span class="op">:</span> {</span>
<span id="cb404-54"><a href="#cb404-54" aria-hidden="true" tabindex="-1"></a>        id<span class="op">:</span> <span class="fu">nanoid</span>()<span class="op">,</span></span>
<span id="cb404-55"><a href="#cb404-55" aria-hidden="true" tabindex="-1"></a>        productId<span class="op">:</span> validated<span class="op">.</span><span class="at">productId</span><span class="op">,</span></span>
<span id="cb404-56"><a href="#cb404-56" aria-hidden="true" tabindex="-1"></a>        userId<span class="op">:</span> user<span class="op">.</span><span class="at">id</span><span class="op">,</span></span>
<span id="cb404-57"><a href="#cb404-57" aria-hidden="true" tabindex="-1"></a>        comment<span class="op">:</span> validated<span class="op">.</span><span class="at">comment</span><span class="op">,</span></span>
<span id="cb404-58"><a href="#cb404-58" aria-hidden="true" tabindex="-1"></a>        rating<span class="op">:</span> validated<span class="op">.</span><span class="at">rating</span></span>
<span id="cb404-59"><a href="#cb404-59" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb404-60"><a href="#cb404-60" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb404-61"><a href="#cb404-61" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb404-62"><a href="#cb404-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">json</span>(</span>
<span id="cb404-63"><a href="#cb404-63" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb404-64"><a href="#cb404-64" aria-hidden="true" tabindex="-1"></a>        message<span class="op">:</span> <span class="st">&quot;Feedback created successfully&quot;</span><span class="op">,</span></span>
<span id="cb404-65"><a href="#cb404-65" aria-hidden="true" tabindex="-1"></a>        feedback</span>
<span id="cb404-66"><a href="#cb404-66" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb404-67"><a href="#cb404-67" aria-hidden="true" tabindex="-1"></a>      { status<span class="op">:</span> <span class="dv">201</span> }</span>
<span id="cb404-68"><a href="#cb404-68" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb404-69"><a href="#cb404-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb404-70"><a href="#cb404-70" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">catch</span> (error) {</span>
<span id="cb404-71"><a href="#cb404-71" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Error handling...</span></span>
<span id="cb404-72"><a href="#cb404-72" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb404-73"><a href="#cb404-73" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="endpoint-put-apifeedbackid">5.3 Endpoint: PUT
/api/feedback/[id]</h3>
<p><strong>Purpose:</strong> Update existing feedback (owner or
admin)</p>
<h4 id="request-5">Request</h4>
<pre class="http"><code>PUT /api/feedback/feedback-uuid-123
Content-Type: application/json
Cookie: next-auth.session-token=...

{
  &quot;comment&quot;: &quot;Updated comment text&quot;,
  &quot;rating&quot;: 4
}</code></pre>
<h4 id="response-200---success">Response (200 - Success)</h4>
<div class="sourceCode" id="cb406"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb406-1"><a href="#cb406-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb406-2"><a href="#cb406-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;message&quot;</span><span class="fu">:</span> <span class="st">&quot;Feedback updated successfully&quot;</span><span class="fu">,</span></span>
<span id="cb406-3"><a href="#cb406-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;feedback&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb406-4"><a href="#cb406-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;feedback-uuid-123&quot;</span><span class="fu">,</span></span>
<span id="cb406-5"><a href="#cb406-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;productId&quot;</span><span class="fu">:</span> <span class="st">&quot;product-uuid&quot;</span><span class="fu">,</span></span>
<span id="cb406-6"><a href="#cb406-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;userId&quot;</span><span class="fu">:</span> <span class="st">&quot;user-uuid&quot;</span><span class="fu">,</span></span>
<span id="cb406-7"><a href="#cb406-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;comment&quot;</span><span class="fu">:</span> <span class="st">&quot;Updated comment text&quot;</span><span class="fu">,</span></span>
<span id="cb406-8"><a href="#cb406-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;rating&quot;</span><span class="fu">:</span> <span class="dv">4</span><span class="fu">,</span></span>
<span id="cb406-9"><a href="#cb406-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;createdAt&quot;</span><span class="fu">:</span> <span class="st">&quot;2024-03-15T10:00:00.000Z&quot;</span><span class="fu">,</span></span>
<span id="cb406-10"><a href="#cb406-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;updatedAt&quot;</span><span class="fu">:</span> <span class="st">&quot;2024-03-15T14:45:00.000Z&quot;</span></span>
<span id="cb406-11"><a href="#cb406-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb406-12"><a href="#cb406-12" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h4 id="response-403---forbidden">Response (403 - Forbidden)</h4>
<div class="sourceCode" id="cb407"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb407-1"><a href="#cb407-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb407-2"><a href="#cb407-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;error&quot;</span><span class="fu">:</span> <span class="st">&quot;You can only edit your own feedback&quot;</span></span>
<span id="cb407-3"><a href="#cb407-3" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h4 id="response-404---not-found">Response (404 - Not Found)</h4>
<div class="sourceCode" id="cb408"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb408-1"><a href="#cb408-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb408-2"><a href="#cb408-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;error&quot;</span><span class="fu">:</span> <span class="st">&quot;Feedback not found&quot;</span></span>
<span id="cb408-3"><a href="#cb408-3" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h3 id="endpoint-delete-apifeedbackid">5.4 Endpoint: DELETE
/api/feedback/[id]</h3>
<p><strong>Purpose:</strong> Delete feedback (owner or admin)</p>
<h4 id="request-6">Request</h4>
<pre class="http"><code>DELETE /api/feedback/feedback-uuid-123
Cookie: next-auth.session-token=...</code></pre>
<h4 id="response-200---success-1">Response (200 - Success)</h4>
<div class="sourceCode" id="cb410"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb410-1"><a href="#cb410-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb410-2"><a href="#cb410-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;message&quot;</span><span class="fu">:</span> <span class="st">&quot;Feedback deleted successfully&quot;</span></span>
<span id="cb410-3"><a href="#cb410-3" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h4 id="response-403---forbidden-1">Response (403 - Forbidden)</h4>
<div class="sourceCode" id="cb411"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb411-1"><a href="#cb411-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb411-2"><a href="#cb411-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;error&quot;</span><span class="fu">:</span> <span class="st">&quot;You can only delete your own feedback&quot;</span></span>
<span id="cb411-3"><a href="#cb411-3" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h4 id="response-404---not-found-1">Response (404 - Not Found)</h4>
<div class="sourceCode" id="cb412"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb412-1"><a href="#cb412-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb412-2"><a href="#cb412-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;error&quot;</span><span class="fu">:</span> <span class="st">&quot;Feedback not found&quot;</span></span>
<span id="cb412-3"><a href="#cb412-3" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<hr />
<h2 id="data-flow-diagram">6. Data Flow Diagram</h2>
<h3 id="authentication-flow">6.1 Authentication Flow</h3>
<pre><code>┌─────────────┐
│   Browser   │
└──────┬──────┘
       │ 1. POST /api/auth/signin
       │    { email, password }
       ▼
┌─────────────────────────────┐
│   API Route                 │
│   /api/auth/[...nextauth]   │
└──────┬──────────────────────┘
       │ 2. Validate credentials
       ▼
┌─────────────────┐
│  Prisma Client  │
└──────┬──────────┘
       │ 3. Query user
       ▼
┌─────────────────┐
│  MySQL Database │
└──────┬──────────┘
       │ 4. Return user data
       ▼
┌─────────────────────────────┐
│   NextAuth                  │
│   - Generate JWT            │
│   - Create session          │
└──────┬──────────────────────┘
       │ 5. Set cookie + return session
       ▼
┌─────────────┐
│   Browser   │
│   (Logged)  │
└─────────────┘</code></pre>
<h3 id="create-feedback-flow">6.2 Create Feedback Flow</h3>
<pre><code>┌─────────────┐
│   Browser   │
│  (Customer) │
└──────┬──────┘
       │ 1. POST /api/feedback
       │    { productId, comment, rating }
       │    Cookie: session-token
       ▼
┌─────────────────────────────┐
│   Middleware                │
│   - Check authentication    │
│   - Get session             │
└──────┬──────────────────────┘
       │ 2. Session valid?
       ▼
┌─────────────────────────────┐
│   API Route Handler         │
│   /api/feedback/route.ts    │
└──────┬──────────────────────┘
       │ 3. Validate with Zod
       │    - productId (UUID)
       │    - comment (min 10 chars)
       │    - rating (1-5)
       ▼
┌─────────────────────────────┐
│   Business Logic            │
│   - Check if admin (reject) │
│   - Check duplicate         │
└──────┬──────────────────────┘
       │ 4. Check duplicate feedback
       ▼
┌─────────────────┐
│  Prisma Client  │
│  findUnique()   │
└──────┬──────────┘
       │ 5. Query existing feedback
       ▼
┌─────────────────┐
│  MySQL Database │
└──────┬──────────┘
       │ 6. No duplicate? Create!
       ▼
┌─────────────────┐
│  Prisma Client  │
│  create()       │
└──────┬──────────┘
       │ 7. INSERT feedback
       ▼
┌─────────────────┐
│  MySQL Database │
└──────┬──────────┘
       │ 8. Return created feedback
       ▼
┌─────────────────────────────┐
│   API Response              │
│   201 Created               │
│   { feedback }              │
└──────┬──────────────────────┘
       │ 9. JSON response
       ▼
┌─────────────┐
│   Browser   │
│   (Success) │
└─────────────┘</code></pre>
<h3 id="full-stack-data-flow">6.3 Full Stack Data Flow</h3>
<pre><code>┌──────────────────────────────────────────────────────────────┐
│                       FRONTEND (Client)                       │
│  ┌────────────┐  ┌────────────┐  ┌────────────┐             │
│  │ Components │  │   Zustand  │  │  useEffect │             │
│  │   (UI)     │  │   Store    │  │   Hooks    │             │
│  └─────┬──────┘  └──────┬─────┘  └──────┬─────┘             │
│        │                │                │                    │
└────────┼────────────────┼────────────────┼────────────────────┘
         │                │                │
         │ fetch()        │ setState()     │ fetch()
         ▼                ▼                ▼
┌──────────────────────────────────────────────────────────────┐
│                     BACKEND (Next.js API)                     │
│  ┌──────────────────────────────────────────────────────┐   │
│  │                API Route Handlers                     │   │
│  │  /api/feedback/route.ts                              │   │
│  │  /api/register/route.ts                              │   │
│  │  /api/auth/[...nextauth]/route.ts                    │   │
│  └─────┬────────────────────────────────────────────────┘   │
│        │                                                      │
│        │ NextAuth Session Check                              │
│        ▼                                                      │
│  ┌──────────────────────────────────────────────────────┐   │
│  │              Middleware &amp; Validation                  │   │
│  │  - Authentication (NextAuth)                         │   │
│  │  - Authorization (role check)                        │   │
│  │  - Zod Schema Validation                             │   │
│  │  - DOMPurify Sanitization                            │   │
│  └─────┬────────────────────────────────────────────────┘   │
│        │                                                      │
└────────┼──────────────────────────────────────────────────────┘
         │
         │ Prisma Query
         ▼
┌──────────────────────────────────────────────────────────────┐
│                      ORM LAYER (Prisma)                       │
│  ┌──────────────────────────────────────────────────────┐   │
│  │               Prisma Client                           │   │
│  │  prisma.feedback.findMany()                          │   │
│  │  prisma.user.create()                                │   │
│  │  prisma.product.update()                             │   │
│  └─────┬────────────────────────────────────────────────┘   │
│        │                                                      │
└────────┼──────────────────────────────────────────────────────┘
         │
         │ SQL Query
         ▼
┌──────────────────────────────────────────────────────────────┐
│                     DATABASE (MySQL)                          │
│  ┌──────────────────────────────────────────────────────┐   │
│  │  Tables:                                              │   │
│  │  - Product                                            │   │
│  │  - User                                               │   │
│  │  - Feedback                                           │   │
│  │  - Customer_order                                     │   │
│  │  - Category                                           │   │
│  │  - Wishlist                                           │   │
│  └──────────────────────────────────────────────────────┘   │
└──────────────────────────────────────────────────────────────┘</code></pre>
<hr />
<h2 id="requestresponse-patterns">7. Request/Response Patterns</h2>
<h3 id="standard-response-format">7.1 Standard Response Format</h3>
<h4 id="success-response">Success Response</h4>
<div class="sourceCode" id="cb416"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb416-1"><a href="#cb416-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb416-2"><a href="#cb416-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Single resource</span></span>
<span id="cb416-3"><a href="#cb416-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;user&quot;</span><span class="op">:</span> { <span class="op">...</span> }<span class="op">,</span></span>
<span id="cb416-4"><a href="#cb416-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;product&quot;</span><span class="op">:</span> { <span class="op">...</span> }<span class="op">,</span></span>
<span id="cb416-5"><a href="#cb416-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb416-6"><a href="#cb416-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Multiple resources</span></span>
<span id="cb416-7"><a href="#cb416-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;users&quot;</span><span class="op">:</span> [ <span class="op">...</span> ]<span class="op">,</span></span>
<span id="cb416-8"><a href="#cb416-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;products&quot;</span><span class="op">:</span> [ <span class="op">...</span> ]<span class="op">,</span></span>
<span id="cb416-9"><a href="#cb416-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb416-10"><a href="#cb416-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">// With metadata</span></span>
<span id="cb416-11"><a href="#cb416-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;data&quot;</span><span class="op">:</span> [ <span class="op">...</span> ]<span class="op">,</span></span>
<span id="cb416-12"><a href="#cb416-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;page&quot;</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb416-13"><a href="#cb416-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;limit&quot;</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb416-14"><a href="#cb416-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;total&quot;</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span></span>
<span id="cb416-15"><a href="#cb416-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb416-16"><a href="#cb416-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">// With message</span></span>
<span id="cb416-17"><a href="#cb416-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;message&quot;</span><span class="op">:</span> <span class="st">&quot;Operation successful&quot;</span><span class="op">,</span></span>
<span id="cb416-18"><a href="#cb416-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;result&quot;</span><span class="op">:</span> { <span class="op">...</span> }</span>
<span id="cb416-19"><a href="#cb416-19" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h4 id="error-response">Error Response</h4>
<div class="sourceCode" id="cb417"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb417-1"><a href="#cb417-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb417-2"><a href="#cb417-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;error&quot;</span><span class="op">:</span> <span class="st">&quot;Error message here&quot;</span><span class="op">,</span></span>
<span id="cb417-3"><a href="#cb417-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb417-4"><a href="#cb417-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">// With details (validation errors)</span></span>
<span id="cb417-5"><a href="#cb417-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;errors&quot;</span><span class="op">:</span> [</span>
<span id="cb417-6"><a href="#cb417-6" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb417-7"><a href="#cb417-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;field&quot;</span><span class="op">:</span> <span class="st">&quot;email&quot;</span><span class="op">,</span></span>
<span id="cb417-8"><a href="#cb417-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;message&quot;</span><span class="op">:</span> <span class="st">&quot;Invalid email format&quot;</span></span>
<span id="cb417-9"><a href="#cb417-9" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb417-10"><a href="#cb417-10" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb417-11"><a href="#cb417-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;field&quot;</span><span class="op">:</span> <span class="st">&quot;password&quot;</span><span class="op">,</span></span>
<span id="cb417-12"><a href="#cb417-12" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;message&quot;</span><span class="op">:</span> <span class="st">&quot;Password too short&quot;</span></span>
<span id="cb417-13"><a href="#cb417-13" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb417-14"><a href="#cb417-14" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb417-15"><a href="#cb417-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="http-status-codes">7.2 HTTP Status Codes</h3>
<table>
<colgroup>
<col style="width: 24%" />
<col style="width: 36%" />
<col style="width: 40%" />
</colgroup>
<thead>
<tr>
<th>Code</th>
<th>Meaning</th>
<th>Use Case</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>200</strong></td>
<td>OK</td>
<td>Successful GET, PUT, DELETE</td>
</tr>
<tr>
<td><strong>201</strong></td>
<td>Created</td>
<td>Successful POST (resource created)</td>
</tr>
<tr>
<td><strong>204</strong></td>
<td>No Content</td>
<td>Successful DELETE (no response body)</td>
</tr>
<tr>
<td><strong>400</strong></td>
<td>Bad Request</td>
<td>Validation error, malformed JSON</td>
</tr>
<tr>
<td><strong>401</strong></td>
<td>Unauthorized</td>
<td>Not logged in, invalid token</td>
</tr>
<tr>
<td><strong>403</strong></td>
<td>Forbidden</td>
<td>Logged in but no permission</td>
</tr>
<tr>
<td><strong>404</strong></td>
<td>Not Found</td>
<td>Resource tidak ditemukan</td>
</tr>
<tr>
<td><strong>409</strong></td>
<td>Conflict</td>
<td>Duplicate entry (email exists)</td>
</tr>
<tr>
<td><strong>422</strong></td>
<td>Unprocessable Entity</td>
<td>Semantic error (e.g., invalid state)</td>
</tr>
<tr>
<td><strong>500</strong></td>
<td>Internal Server Error</td>
<td>Unexpected server error</td>
</tr>
</tbody>
</table>
<h3 id="pagination-pattern">7.3 Pagination Pattern</h3>
<div class="sourceCode" id="cb418"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb418-1"><a href="#cb418-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Request</span></span>
<span id="cb418-2"><a href="#cb418-2" aria-hidden="true" tabindex="-1"></a>GET <span class="op">/</span>api<span class="op">/</span>products<span class="op">?</span>page<span class="op">=</span><span class="dv">2</span><span class="op">&amp;</span>limit<span class="op">=</span><span class="dv">20</span></span>
<span id="cb418-3"><a href="#cb418-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb418-4"><a href="#cb418-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Response</span></span>
<span id="cb418-5"><a href="#cb418-5" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb418-6"><a href="#cb418-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;products&quot;</span><span class="op">:</span> [ <span class="op">...</span> ]<span class="op">,</span></span>
<span id="cb418-7"><a href="#cb418-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;pagination&quot;</span><span class="op">:</span> {</span>
<span id="cb418-8"><a href="#cb418-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;page&quot;</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb418-9"><a href="#cb418-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;limit&quot;</span><span class="op">:</span> <span class="dv">20</span><span class="op">,</span></span>
<span id="cb418-10"><a href="#cb418-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;total&quot;</span><span class="op">:</span> <span class="dv">150</span><span class="op">,</span></span>
<span id="cb418-11"><a href="#cb418-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;totalPages&quot;</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb418-12"><a href="#cb418-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;hasNext&quot;</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb418-13"><a href="#cb418-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;hasPrev&quot;</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb418-14"><a href="#cb418-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb418-15"><a href="#cb418-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="filtering-pattern">7.4 Filtering Pattern</h3>
<div class="sourceCode" id="cb419"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb419-1"><a href="#cb419-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Single filter</span></span>
<span id="cb419-2"><a href="#cb419-2" aria-hidden="true" tabindex="-1"></a>GET <span class="op">/</span>api<span class="op">/</span>products<span class="op">?</span>categoryId<span class="op">=</span>uuid<span class="op">-</span><span class="dv">123</span></span>
<span id="cb419-3"><a href="#cb419-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb419-4"><a href="#cb419-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Multiple filters</span></span>
<span id="cb419-5"><a href="#cb419-5" aria-hidden="true" tabindex="-1"></a>GET <span class="op">/</span>api<span class="op">/</span>products<span class="op">?</span>categoryId<span class="op">=</span>uuid<span class="op">-</span><span class="dv">123</span><span class="op">&amp;</span>minPrice<span class="op">=</span><span class="dv">1000</span><span class="op">&amp;</span>maxPrice<span class="op">=</span><span class="dv">5000</span></span>
<span id="cb419-6"><a href="#cb419-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb419-7"><a href="#cb419-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Search</span></span>
<span id="cb419-8"><a href="#cb419-8" aria-hidden="true" tabindex="-1"></a>GET <span class="op">/</span>api<span class="op">/</span>products<span class="op">?</span>search<span class="op">=</span>laptop</span>
<span id="cb419-9"><a href="#cb419-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb419-10"><a href="#cb419-10" aria-hidden="true" tabindex="-1"></a><span class="co">// Sort</span></span>
<span id="cb419-11"><a href="#cb419-11" aria-hidden="true" tabindex="-1"></a>GET <span class="op">/</span>api<span class="op">/</span>products<span class="op">?</span>sortBy<span class="op">=</span>price<span class="op">&amp;</span>order<span class="op">=</span>asc</span></code></pre></div>
<hr />
<h2 id="error-handling-1">8. Error Handling</h2>
<h3 id="centralized-error-handler">8.1 Centralized Error Handler</h3>
<div class="sourceCode" id="cb420"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb420-1"><a href="#cb420-1" aria-hidden="true" tabindex="-1"></a><span class="co">// lib/api-error-handler.ts</span></span>
<span id="cb420-2"><a href="#cb420-2" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">class</span> ApiError <span class="kw">extends</span> <span class="bu">Error</span> {</span>
<span id="cb420-3"><a href="#cb420-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">constructor</span>(</span>
<span id="cb420-4"><a href="#cb420-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> statusCode<span class="op">:</span> <span class="dt">number</span><span class="op">,</span></span>
<span id="cb420-5"><a href="#cb420-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> message<span class="op">:</span> <span class="dt">string</span><span class="op">,</span></span>
<span id="cb420-6"><a href="#cb420-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> errors<span class="op">?:</span> <span class="dt">any</span>[]</span>
<span id="cb420-7"><a href="#cb420-7" aria-hidden="true" tabindex="-1"></a>  ) {</span>
<span id="cb420-8"><a href="#cb420-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">super</span>(message)<span class="op">;</span></span>
<span id="cb420-9"><a href="#cb420-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb420-10"><a href="#cb420-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb420-11"><a href="#cb420-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb420-12"><a href="#cb420-12" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">function</span> <span class="fu">handleApiError</span>(error<span class="op">:</span> <span class="dt">unknown</span>) {</span>
<span id="cb420-13"><a href="#cb420-13" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">error</span>(<span class="st">&quot;API Error:&quot;</span><span class="op">,</span> error)<span class="op">;</span></span>
<span id="cb420-14"><a href="#cb420-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb420-15"><a href="#cb420-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Zod validation error</span></span>
<span id="cb420-16"><a href="#cb420-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (error <span class="kw">instanceof</span> z<span class="op">.</span><span class="at">ZodError</span>) {</span>
<span id="cb420-17"><a href="#cb420-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">json</span>(</span>
<span id="cb420-18"><a href="#cb420-18" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb420-19"><a href="#cb420-19" aria-hidden="true" tabindex="-1"></a>        error<span class="op">:</span> <span class="st">&quot;Validation failed&quot;</span><span class="op">,</span></span>
<span id="cb420-20"><a href="#cb420-20" aria-hidden="true" tabindex="-1"></a>        errors<span class="op">:</span> error<span class="op">.</span><span class="at">errors</span><span class="op">.</span><span class="fu">map</span>(e <span class="kw">=&gt;</span> ({</span>
<span id="cb420-21"><a href="#cb420-21" aria-hidden="true" tabindex="-1"></a>          field<span class="op">:</span> e<span class="op">.</span><span class="at">path</span><span class="op">.</span><span class="fu">join</span>(<span class="st">&#39;.&#39;</span>)<span class="op">,</span></span>
<span id="cb420-22"><a href="#cb420-22" aria-hidden="true" tabindex="-1"></a>          message<span class="op">:</span> e<span class="op">.</span><span class="at">message</span></span>
<span id="cb420-23"><a href="#cb420-23" aria-hidden="true" tabindex="-1"></a>        }))</span>
<span id="cb420-24"><a href="#cb420-24" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb420-25"><a href="#cb420-25" aria-hidden="true" tabindex="-1"></a>      { status<span class="op">:</span> <span class="dv">400</span> }</span>
<span id="cb420-26"><a href="#cb420-26" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb420-27"><a href="#cb420-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb420-28"><a href="#cb420-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb420-29"><a href="#cb420-29" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Custom API error</span></span>
<span id="cb420-30"><a href="#cb420-30" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (error <span class="kw">instanceof</span> ApiError) {</span>
<span id="cb420-31"><a href="#cb420-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">json</span>(</span>
<span id="cb420-32"><a href="#cb420-32" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb420-33"><a href="#cb420-33" aria-hidden="true" tabindex="-1"></a>        error<span class="op">:</span> error<span class="op">.</span><span class="at">message</span><span class="op">,</span></span>
<span id="cb420-34"><a href="#cb420-34" aria-hidden="true" tabindex="-1"></a>        errors<span class="op">:</span> error<span class="op">.</span><span class="at">errors</span></span>
<span id="cb420-35"><a href="#cb420-35" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb420-36"><a href="#cb420-36" aria-hidden="true" tabindex="-1"></a>      { status<span class="op">:</span> error<span class="op">.</span><span class="at">statusCode</span> }</span>
<span id="cb420-37"><a href="#cb420-37" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb420-38"><a href="#cb420-38" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb420-39"><a href="#cb420-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb420-40"><a href="#cb420-40" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Prisma error</span></span>
<span id="cb420-41"><a href="#cb420-41" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (error <span class="kw">instanceof</span> Prisma<span class="op">.</span><span class="at">PrismaClientKnownRequestError</span>) {</span>
<span id="cb420-42"><a href="#cb420-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (error<span class="op">.</span><span class="at">code</span> <span class="op">===</span> <span class="st">&#39;P2002&#39;</span>) {</span>
<span id="cb420-43"><a href="#cb420-43" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">json</span>(</span>
<span id="cb420-44"><a href="#cb420-44" aria-hidden="true" tabindex="-1"></a>        { error<span class="op">:</span> <span class="st">&quot;Duplicate entry&quot;</span> }<span class="op">,</span></span>
<span id="cb420-45"><a href="#cb420-45" aria-hidden="true" tabindex="-1"></a>        { status<span class="op">:</span> <span class="dv">409</span> }</span>
<span id="cb420-46"><a href="#cb420-46" aria-hidden="true" tabindex="-1"></a>      )<span class="op">;</span></span>
<span id="cb420-47"><a href="#cb420-47" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb420-48"><a href="#cb420-48" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb420-49"><a href="#cb420-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb420-50"><a href="#cb420-50" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Generic error</span></span>
<span id="cb420-51"><a href="#cb420-51" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">json</span>(</span>
<span id="cb420-52"><a href="#cb420-52" aria-hidden="true" tabindex="-1"></a>    { error<span class="op">:</span> <span class="st">&quot;Internal server error&quot;</span> }<span class="op">,</span></span>
<span id="cb420-53"><a href="#cb420-53" aria-hidden="true" tabindex="-1"></a>    { status<span class="op">:</span> <span class="dv">500</span> }</span>
<span id="cb420-54"><a href="#cb420-54" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb420-55"><a href="#cb420-55" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="usage-in-api-route-1">8.2 Usage in API Route</h3>
<div class="sourceCode" id="cb421"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb421-1"><a href="#cb421-1" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">async</span> <span class="kw">function</span> <span class="fu">POST</span>(request<span class="op">:</span> NextRequest) {</span>
<span id="cb421-2"><a href="#cb421-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span> {</span>
<span id="cb421-3"><a href="#cb421-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Your logic here</span></span>
<span id="cb421-4"><a href="#cb421-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb421-5"><a href="#cb421-5" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">catch</span> (error) {</span>
<span id="cb421-6"><a href="#cb421-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">handleApiError</span>(error)<span class="op">;</span></span>
<span id="cb421-7"><a href="#cb421-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb421-8"><a href="#cb421-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<hr />
<h2 id="security-rate-limiting">9. Security &amp; Rate Limiting</h2>
<h3 id="authentication-check">9.1 Authentication Check</h3>
<div class="sourceCode" id="cb422"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb422-1"><a href="#cb422-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Middleware untuk check auth</span></span>
<span id="cb422-2"><a href="#cb422-2" aria-hidden="true" tabindex="-1"></a><span class="kw">async</span> <span class="kw">function</span> <span class="fu">requireAuth</span>(request<span class="op">:</span> NextRequest) {</span>
<span id="cb422-3"><a href="#cb422-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> session <span class="op">=</span> <span class="cf">await</span> <span class="fu">getServerSession</span>(authOptions)<span class="op">;</span></span>
<span id="cb422-4"><a href="#cb422-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb422-5"><a href="#cb422-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>session<span class="op">?.</span><span class="at">user</span>) {</span>
<span id="cb422-6"><a href="#cb422-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">throw</span> <span class="kw">new</span> <span class="fu">ApiError</span>(<span class="dv">401</span><span class="op">,</span> <span class="st">&quot;Unauthorized&quot;</span>)<span class="op">;</span></span>
<span id="cb422-7"><a href="#cb422-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb422-8"><a href="#cb422-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb422-9"><a href="#cb422-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> session<span class="op">.</span><span class="at">user</span><span class="op">;</span></span>
<span id="cb422-10"><a href="#cb422-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb422-11"><a href="#cb422-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb422-12"><a href="#cb422-12" aria-hidden="true" tabindex="-1"></a><span class="co">// Usage</span></span>
<span id="cb422-13"><a href="#cb422-13" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">async</span> <span class="kw">function</span> <span class="fu">POST</span>(request<span class="op">:</span> NextRequest) {</span>
<span id="cb422-14"><a href="#cb422-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> user <span class="op">=</span> <span class="cf">await</span> <span class="fu">requireAuth</span>(request)<span class="op">;</span></span>
<span id="cb422-15"><a href="#cb422-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb422-16"><a href="#cb422-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">// User authenticated, proceed...</span></span>
<span id="cb422-17"><a href="#cb422-17" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="role-based-authorization">9.2 Role-Based Authorization</h3>
<div class="sourceCode" id="cb423"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb423-1"><a href="#cb423-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">requireRole</span>(user<span class="op">:</span> <span class="dt">any</span><span class="op">,</span> allowedRoles<span class="op">:</span> <span class="dt">string</span>[]) {</span>
<span id="cb423-2"><a href="#cb423-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>allowedRoles<span class="op">.</span><span class="fu">includes</span>(user<span class="op">.</span><span class="at">role</span>)) {</span>
<span id="cb423-3"><a href="#cb423-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">throw</span> <span class="kw">new</span> <span class="fu">ApiError</span>(<span class="dv">403</span><span class="op">,</span> <span class="st">&quot;Forbidden: Insufficient permissions&quot;</span>)<span class="op">;</span></span>
<span id="cb423-4"><a href="#cb423-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb423-5"><a href="#cb423-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb423-6"><a href="#cb423-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb423-7"><a href="#cb423-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Usage</span></span>
<span id="cb423-8"><a href="#cb423-8" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">async</span> <span class="kw">function</span> <span class="fu">DELETE</span>(request<span class="op">:</span> NextRequest) {</span>
<span id="cb423-9"><a href="#cb423-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> user <span class="op">=</span> <span class="cf">await</span> <span class="fu">requireAuth</span>(request)<span class="op">;</span></span>
<span id="cb423-10"><a href="#cb423-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">requireRole</span>(user<span class="op">,</span> [<span class="st">&#39;admin&#39;</span>])<span class="op">;</span> <span class="co">// Only admin can delete</span></span>
<span id="cb423-11"><a href="#cb423-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb423-12"><a href="#cb423-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Proceed with delete...</span></span>
<span id="cb423-13"><a href="#cb423-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="rate-limiting-future-implementation">9.3 Rate Limiting (Future
Implementation)</h3>
<div class="sourceCode" id="cb424"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb424-1"><a href="#cb424-1" aria-hidden="true" tabindex="-1"></a><span class="co">// lib/rate-limit.ts</span></span>
<span id="cb424-2"><a href="#cb424-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { RateLimiter } <span class="im">from</span> <span class="st">&#39;express-rate-limit&#39;</span></span>
<span id="cb424-3"><a href="#cb424-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb424-4"><a href="#cb424-4" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> limiter <span class="op">=</span> <span class="kw">new</span> <span class="fu">RateLimiter</span>({</span>
<span id="cb424-5"><a href="#cb424-5" aria-hidden="true" tabindex="-1"></a>  windowMs<span class="op">:</span> <span class="dv">15</span> <span class="op">*</span> <span class="dv">60</span> <span class="op">*</span> <span class="dv">1000</span><span class="op">,</span> <span class="co">// 15 minutes</span></span>
<span id="cb424-6"><a href="#cb424-6" aria-hidden="true" tabindex="-1"></a>  max<span class="op">:</span> <span class="dv">100</span><span class="op">,</span> <span class="co">// Max 100 requests per window</span></span>
<span id="cb424-7"><a href="#cb424-7" aria-hidden="true" tabindex="-1"></a>  message<span class="op">:</span> <span class="st">&quot;Too many requests, please try again later&quot;</span></span>
<span id="cb424-8"><a href="#cb424-8" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb424-9"><a href="#cb424-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb424-10"><a href="#cb424-10" aria-hidden="true" tabindex="-1"></a><span class="co">// Apply to API route</span></span>
<span id="cb424-11"><a href="#cb424-11" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">async</span> <span class="kw">function</span> <span class="fu">POST</span>(request<span class="op">:</span> NextRequest) {</span>
<span id="cb424-12"><a href="#cb424-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">await</span> <span class="fu">limiter</span>(request)<span class="op">;</span></span>
<span id="cb424-13"><a href="#cb424-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb424-14"><a href="#cb424-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Your logic...</span></span>
<span id="cb424-15"><a href="#cb424-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<hr />
<h2 id="testing-api">10. Testing API</h2>
<h3 id="test-dengan-curl">10.1 Test dengan cURL</h3>
<div class="sourceCode" id="cb425"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb425-1"><a href="#cb425-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Register</span></span>
<span id="cb425-2"><a href="#cb425-2" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-X</span> POST http://localhost:3000/api/register <span class="dt">\</span></span>
<span id="cb425-3"><a href="#cb425-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">-H</span> <span class="st">&quot;Content-Type: application/json&quot;</span> <span class="dt">\</span></span>
<span id="cb425-4"><a href="#cb425-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">-d</span> <span class="st">&#39;{&quot;email&quot;:&quot;test@example.com&quot;,&quot;password&quot;:&quot;Test123!&quot;}&#39;</span></span>
<span id="cb425-5"><a href="#cb425-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb425-6"><a href="#cb425-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Login (get session cookie)</span></span>
<span id="cb425-7"><a href="#cb425-7" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-X</span> POST http://localhost:3000/api/auth/signin <span class="dt">\</span></span>
<span id="cb425-8"><a href="#cb425-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">-H</span> <span class="st">&quot;Content-Type: application/json&quot;</span> <span class="dt">\</span></span>
<span id="cb425-9"><a href="#cb425-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">-d</span> <span class="st">&#39;{&quot;email&quot;:&quot;test@example.com&quot;,&quot;password&quot;:&quot;Test123!&quot;}&#39;</span> <span class="dt">\</span></span>
<span id="cb425-10"><a href="#cb425-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">-c</span> cookies.txt</span>
<span id="cb425-11"><a href="#cb425-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb425-12"><a href="#cb425-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create feedback (with session)</span></span>
<span id="cb425-13"><a href="#cb425-13" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-X</span> POST http://localhost:3000/api/feedback <span class="dt">\</span></span>
<span id="cb425-14"><a href="#cb425-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">-H</span> <span class="st">&quot;Content-Type: application/json&quot;</span> <span class="dt">\</span></span>
<span id="cb425-15"><a href="#cb425-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">-b</span> cookies.txt <span class="dt">\</span></span>
<span id="cb425-16"><a href="#cb425-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">-d</span> <span class="st">&#39;{&quot;productId&quot;:&quot;uuid-123&quot;,&quot;comment&quot;:&quot;Great product!&quot;,&quot;rating&quot;:5}&#39;</span></span>
<span id="cb425-17"><a href="#cb425-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb425-18"><a href="#cb425-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Get feedback</span></span>
<span id="cb425-19"><a href="#cb425-19" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> http://localhost:3000/api/feedback<span class="pp">?</span>productId=uuid-123</span></code></pre></div>
<h3 id="test-dengan-postmanthunder-client">10.2 Test dengan
Postman/Thunder Client</h3>
<p><strong>Collection structure:</strong></p>
<pre><code>Electronics eCommerce API
├── Auth
│   ├── POST Register
│   ├── POST Login
│   └── GET Session
├── Feedback
│   ├── GET Feedback (by product)
│   ├── GET All Feedback (admin)
│   ├── POST Create Feedback
│   ├── PUT Update Feedback
│   └── DELETE Feedback
└── Products (future)</code></pre>
<h3 id="automated-testing-jest">10.3 Automated Testing (Jest)</h3>
<div class="sourceCode" id="cb427"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb427-1"><a href="#cb427-1" aria-hidden="true" tabindex="-1"></a><span class="co">// __tests__/api/feedback.test.ts</span></span>
<span id="cb427-2"><a href="#cb427-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { POST } <span class="im">from</span> <span class="st">&#39;@/app/api/feedback/route&#39;</span><span class="op">;</span></span>
<span id="cb427-3"><a href="#cb427-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb427-4"><a href="#cb427-4" aria-hidden="true" tabindex="-1"></a><span class="fu">describe</span>(<span class="st">&#39;POST /api/feedback&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb427-5"><a href="#cb427-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">it</span>(<span class="st">&#39;should create feedback successfully&#39;</span><span class="op">,</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb427-6"><a href="#cb427-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> request <span class="op">=</span> <span class="kw">new</span> <span class="fu">Request</span>(<span class="st">&#39;http://localhost:3000/api/feedback&#39;</span><span class="op">,</span> {</span>
<span id="cb427-7"><a href="#cb427-7" aria-hidden="true" tabindex="-1"></a>      method<span class="op">:</span> <span class="st">&#39;POST&#39;</span><span class="op">,</span></span>
<span id="cb427-8"><a href="#cb427-8" aria-hidden="true" tabindex="-1"></a>      headers<span class="op">:</span> { <span class="st">&#39;Content-Type&#39;</span><span class="op">:</span> <span class="st">&#39;application/json&#39;</span> }<span class="op">,</span></span>
<span id="cb427-9"><a href="#cb427-9" aria-hidden="true" tabindex="-1"></a>      body<span class="op">:</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>({</span>
<span id="cb427-10"><a href="#cb427-10" aria-hidden="true" tabindex="-1"></a>        productId<span class="op">:</span> <span class="st">&#39;test-uuid&#39;</span><span class="op">,</span></span>
<span id="cb427-11"><a href="#cb427-11" aria-hidden="true" tabindex="-1"></a>        comment<span class="op">:</span> <span class="st">&#39;Test comment&#39;</span><span class="op">,</span></span>
<span id="cb427-12"><a href="#cb427-12" aria-hidden="true" tabindex="-1"></a>        rating<span class="op">:</span> <span class="dv">5</span></span>
<span id="cb427-13"><a href="#cb427-13" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb427-14"><a href="#cb427-14" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb427-15"><a href="#cb427-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb427-16"><a href="#cb427-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="fu">POST</span>(request <span class="im">as</span> <span class="dt">any</span>)<span class="op">;</span></span>
<span id="cb427-17"><a href="#cb427-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> data <span class="op">=</span> <span class="cf">await</span> response<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb427-18"><a href="#cb427-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb427-19"><a href="#cb427-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expect</span>(response<span class="op">.</span><span class="at">status</span>)<span class="op">.</span><span class="fu">toBe</span>(<span class="dv">201</span>)<span class="op">;</span></span>
<span id="cb427-20"><a href="#cb427-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expect</span>(data<span class="op">.</span><span class="at">feedback</span>)<span class="op">.</span><span class="fu">toBeDefined</span>()<span class="op">;</span></span>
<span id="cb427-21"><a href="#cb427-21" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb427-22"><a href="#cb427-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb427-23"><a href="#cb427-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">it</span>(<span class="st">&#39;should reject invalid rating&#39;</span><span class="op">,</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb427-24"><a href="#cb427-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> request <span class="op">=</span> <span class="kw">new</span> <span class="fu">Request</span>(<span class="st">&#39;http://localhost:3000/api/feedback&#39;</span><span class="op">,</span> {</span>
<span id="cb427-25"><a href="#cb427-25" aria-hidden="true" tabindex="-1"></a>      method<span class="op">:</span> <span class="st">&#39;POST&#39;</span><span class="op">,</span></span>
<span id="cb427-26"><a href="#cb427-26" aria-hidden="true" tabindex="-1"></a>      body<span class="op">:</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>({</span>
<span id="cb427-27"><a href="#cb427-27" aria-hidden="true" tabindex="-1"></a>        productId<span class="op">:</span> <span class="st">&#39;test-uuid&#39;</span><span class="op">,</span></span>
<span id="cb427-28"><a href="#cb427-28" aria-hidden="true" tabindex="-1"></a>        comment<span class="op">:</span> <span class="st">&#39;Test&#39;</span><span class="op">,</span></span>
<span id="cb427-29"><a href="#cb427-29" aria-hidden="true" tabindex="-1"></a>        rating<span class="op">:</span> <span class="dv">6</span> <span class="co">// Invalid!</span></span>
<span id="cb427-30"><a href="#cb427-30" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb427-31"><a href="#cb427-31" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb427-32"><a href="#cb427-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb427-33"><a href="#cb427-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="fu">POST</span>(request <span class="im">as</span> <span class="dt">any</span>)<span class="op">;</span></span>
<span id="cb427-34"><a href="#cb427-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb427-35"><a href="#cb427-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expect</span>(response<span class="op">.</span><span class="at">status</span>)<span class="op">.</span><span class="fu">toBe</span>(<span class="dv">400</span>)<span class="op">;</span></span>
<span id="cb427-36"><a href="#cb427-36" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb427-37"><a href="#cb427-37" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<hr />
<h2 id="best-practices-3">11. Best Practices</h2>
<h3 id="dos-1">11.1 ✅ DO’s</h3>
<h4 id="use-typescript-types">1. Use TypeScript Types</h4>
<div class="sourceCode" id="cb428"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb428-1"><a href="#cb428-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ✅ BENAR: Strong typing</span></span>
<span id="cb428-2"><a href="#cb428-2" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> CreateFeedbackRequest {</span>
<span id="cb428-3"><a href="#cb428-3" aria-hidden="true" tabindex="-1"></a>  productId<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb428-4"><a href="#cb428-4" aria-hidden="true" tabindex="-1"></a>  comment<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb428-5"><a href="#cb428-5" aria-hidden="true" tabindex="-1"></a>  rating<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb428-6"><a href="#cb428-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb428-7"><a href="#cb428-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb428-8"><a href="#cb428-8" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">async</span> <span class="kw">function</span> <span class="fu">POST</span>(request<span class="op">:</span> NextRequest) {</span>
<span id="cb428-9"><a href="#cb428-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> body<span class="op">:</span> CreateFeedbackRequest <span class="op">=</span> <span class="cf">await</span> request<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb428-10"><a href="#cb428-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h4 id="validate-all-inputs">2. Validate All Inputs</h4>
<div class="sourceCode" id="cb429"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb429-1"><a href="#cb429-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ✅ BENAR: Validate dengan Zod</span></span>
<span id="cb429-2"><a href="#cb429-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> schema <span class="op">=</span> z<span class="op">.</span><span class="fu">object</span>({</span>
<span id="cb429-3"><a href="#cb429-3" aria-hidden="true" tabindex="-1"></a>  email<span class="op">:</span> z<span class="op">.</span><span class="fu">string</span>()<span class="op">.</span><span class="fu">email</span>()<span class="op">,</span></span>
<span id="cb429-4"><a href="#cb429-4" aria-hidden="true" tabindex="-1"></a>  password<span class="op">:</span> z<span class="op">.</span><span class="fu">string</span>()<span class="op">.</span><span class="fu">min</span>(<span class="dv">8</span>)</span>
<span id="cb429-5"><a href="#cb429-5" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb429-6"><a href="#cb429-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb429-7"><a href="#cb429-7" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> validated <span class="op">=</span> schema<span class="op">.</span><span class="fu">parse</span>(body)<span class="op">;</span></span></code></pre></div>
<h4 id="use-proper-http-status-codes">3. Use Proper HTTP Status
Codes</h4>
<div class="sourceCode" id="cb430"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb430-1"><a href="#cb430-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ✅ BENAR</span></span>
<span id="cb430-2"><a href="#cb430-2" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">json</span>(data<span class="op">,</span> { status<span class="op">:</span> <span class="dv">201</span> })<span class="op">;</span> <span class="co">// Created</span></span>
<span id="cb430-3"><a href="#cb430-3" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">json</span>(error<span class="op">,</span> { status<span class="op">:</span> <span class="dv">404</span> })<span class="op">;</span> <span class="co">// Not Found</span></span>
<span id="cb430-4"><a href="#cb430-4" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">json</span>(error<span class="op">,</span> { status<span class="op">:</span> <span class="dv">403</span> })<span class="op">;</span> <span class="co">// Forbidden</span></span></code></pre></div>
<h4 id="sanitize-user-input">4. Sanitize User Input</h4>
<div class="sourceCode" id="cb431"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb431-1"><a href="#cb431-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> DOMPurify <span class="im">from</span> <span class="st">&#39;dompurify&#39;</span><span class="op">;</span></span>
<span id="cb431-2"><a href="#cb431-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb431-3"><a href="#cb431-3" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> clean <span class="op">=</span> DOMPurify<span class="op">.</span><span class="fu">sanitize</span>(userInput)<span class="op">;</span></span></code></pre></div>
<h4 id="log-errors">5. Log Errors</h4>
<div class="sourceCode" id="cb432"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb432-1"><a href="#cb432-1" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">error</span>(<span class="st">&#39;API Error:&#39;</span><span class="op">,</span> {</span>
<span id="cb432-2"><a href="#cb432-2" aria-hidden="true" tabindex="-1"></a>  endpoint<span class="op">:</span> <span class="st">&#39;/api/feedback&#39;</span><span class="op">,</span></span>
<span id="cb432-3"><a href="#cb432-3" aria-hidden="true" tabindex="-1"></a>  method<span class="op">:</span> <span class="st">&#39;POST&#39;</span><span class="op">,</span></span>
<span id="cb432-4"><a href="#cb432-4" aria-hidden="true" tabindex="-1"></a>  error<span class="op">:</span> error<span class="op">.</span><span class="at">message</span><span class="op">,</span></span>
<span id="cb432-5"><a href="#cb432-5" aria-hidden="true" tabindex="-1"></a>  stack<span class="op">:</span> error<span class="op">.</span><span class="at">stack</span></span>
<span id="cb432-6"><a href="#cb432-6" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h3 id="donts-1">11.2 ❌ DON’Ts</h3>
<h4 id="jangan-expose-sensitive-data">1. Jangan Expose Sensitive
Data</h4>
<div class="sourceCode" id="cb433"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb433-1"><a href="#cb433-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ❌ SALAH: Return password</span></span>
<span id="cb433-2"><a href="#cb433-2" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">json</span>({ user<span class="op">:</span> { <span class="op">...</span>user } })<span class="op">;</span></span>
<span id="cb433-3"><a href="#cb433-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb433-4"><a href="#cb433-4" aria-hidden="true" tabindex="-1"></a><span class="co">// ✅ BENAR: Select only needed fields</span></span>
<span id="cb433-5"><a href="#cb433-5" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">json</span>({</span>
<span id="cb433-6"><a href="#cb433-6" aria-hidden="true" tabindex="-1"></a>  user<span class="op">:</span> {</span>
<span id="cb433-7"><a href="#cb433-7" aria-hidden="true" tabindex="-1"></a>    id<span class="op">:</span> user<span class="op">.</span><span class="at">id</span><span class="op">,</span></span>
<span id="cb433-8"><a href="#cb433-8" aria-hidden="true" tabindex="-1"></a>    email<span class="op">:</span> user<span class="op">.</span><span class="at">email</span><span class="op">,</span></span>
<span id="cb433-9"><a href="#cb433-9" aria-hidden="true" tabindex="-1"></a>    role<span class="op">:</span> user<span class="op">.</span><span class="at">role</span></span>
<span id="cb433-10"><a href="#cb433-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb433-11"><a href="#cb433-11" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h4 id="jangan-skip-authentication">2. Jangan Skip Authentication</h4>
<div class="sourceCode" id="cb434"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb434-1"><a href="#cb434-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ❌ SALAH: No auth check</span></span>
<span id="cb434-2"><a href="#cb434-2" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">async</span> <span class="kw">function</span> <span class="fu">DELETE</span>(request<span class="op">:</span> NextRequest) {</span>
<span id="cb434-3"><a href="#cb434-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">await</span> prisma<span class="op">.</span><span class="at">feedback</span><span class="op">.</span><span class="fu">delete</span>(<span class="op">...</span>)<span class="op">;</span></span>
<span id="cb434-4"><a href="#cb434-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb434-5"><a href="#cb434-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb434-6"><a href="#cb434-6" aria-hidden="true" tabindex="-1"></a><span class="co">// ✅ BENAR: Check auth first</span></span>
<span id="cb434-7"><a href="#cb434-7" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">async</span> <span class="kw">function</span> <span class="fu">DELETE</span>(request<span class="op">:</span> NextRequest) {</span>
<span id="cb434-8"><a href="#cb434-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> session <span class="op">=</span> <span class="cf">await</span> <span class="fu">getServerSession</span>()<span class="op">;</span></span>
<span id="cb434-9"><a href="#cb434-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>session) {</span>
<span id="cb434-10"><a href="#cb434-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">json</span>({ error<span class="op">:</span> <span class="st">&#39;Unauthorized&#39;</span> }<span class="op">,</span> { status<span class="op">:</span> <span class="dv">401</span> })<span class="op">;</span></span>
<span id="cb434-11"><a href="#cb434-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb434-12"><a href="#cb434-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb434-13"><a href="#cb434-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">await</span> prisma<span class="op">.</span><span class="at">feedback</span><span class="op">.</span><span class="fu">delete</span>(<span class="op">...</span>)<span class="op">;</span></span>
<span id="cb434-14"><a href="#cb434-14" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h4 id="jangan-return-stack-trace-ke-client">3. Jangan Return Stack
Trace ke Client</h4>
<div class="sourceCode" id="cb435"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb435-1"><a href="#cb435-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ❌ SALAH</span></span>
<span id="cb435-2"><a href="#cb435-2" aria-hidden="true" tabindex="-1"></a><span class="cf">catch</span> (error) {</span>
<span id="cb435-3"><a href="#cb435-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">json</span>({ error<span class="op">:</span> error<span class="op">.</span><span class="at">stack</span> }<span class="op">,</span> { status<span class="op">:</span> <span class="dv">500</span> })<span class="op">;</span></span>
<span id="cb435-4"><a href="#cb435-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb435-5"><a href="#cb435-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb435-6"><a href="#cb435-6" aria-hidden="true" tabindex="-1"></a><span class="co">// ✅ BENAR</span></span>
<span id="cb435-7"><a href="#cb435-7" aria-hidden="true" tabindex="-1"></a><span class="cf">catch</span> (error) {</span>
<span id="cb435-8"><a href="#cb435-8" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">error</span>(error)<span class="op">;</span> <span class="co">// Log di server</span></span>
<span id="cb435-9"><a href="#cb435-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> NextResponse<span class="op">.</span><span class="fu">json</span>(</span>
<span id="cb435-10"><a href="#cb435-10" aria-hidden="true" tabindex="-1"></a>    { error<span class="op">:</span> <span class="st">&#39;Internal server error&#39;</span> }<span class="op">,</span></span>
<span id="cb435-11"><a href="#cb435-11" aria-hidden="true" tabindex="-1"></a>    { status<span class="op">:</span> <span class="dv">500</span> }</span>
<span id="cb435-12"><a href="#cb435-12" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb435-13"><a href="#cb435-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<hr />
<h2 id="referensi-4">📚 Referensi</h2>
<h3 id="official-docs">Official Docs</h3>
<ul>
<li><a
href="https://nextjs.org/docs/app/building-your-application/routing/route-handlers">Next.js
Route Handlers</a></li>
<li><a
href="https://next-auth.js.org/getting-started/rest-api">NextAuth.js
API</a></li>
<li><a
href="https://www.prisma.io/docs/reference/api-reference/prisma-client-reference">Prisma
Client API</a></li>
</ul>
</body>
</html>
